# üóëÔ∏è DELETE USER FEATURE - COMPLETE IMPLEMENTATION

**–î–∞—Ç–∞:** 20 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## üìã EXECUTIVE SUMMARY

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏ –ø–æ–ª–Ω–∞—è** —Å–∏—Å—Ç–µ–º–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Tripwire –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è **–í–°–ï–• Sales Manager** (admin + sales —Ä–æ–ª–∏).

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ **–í–°–ï–•** —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (9 —Ç–∞–±–ª–∏—Ü)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –î–æ—Å—Ç—É–ø –¥–ª—è –≤—Å–µ—Ö Sales Manager (–Ω–µ —Ç–æ–ª—å–∫–æ admin)
- ‚úÖ –ö—Ä–∞—Å–∏–≤–æ–µ UI —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∏ –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ activity_log

---

## üõ†Ô∏è –ß–¢–û –ë–´–õ–û –°–î–ï–õ–ê–ù–û

### 1. **Backend: –£–ª—É—á—à–µ–Ω–Ω–∞—è RPC —Ñ—É–Ω–∫—Ü–∏—è** ‚úÖ

**–§–∞–π–ª:** Migration `improve_delete_tripwire_user_function`

**–ß—Ç–æ —É–¥–∞–ª—è–µ—Ç:**
1. `user_achievements` - –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. `video_tracking` - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ
3. `module_unlocks` - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
4. `tripwire_progress` - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —É—Ä–æ–∫–∞–º
5. `tripwire_ai_costs` - —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ AI (–µ—Å–ª–∏ –µ—Å—Ç—å)
6. `sales_activity_log` - –∏—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π
7. `tripwire_user_profile` - –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
8. `tripwire_users` - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
9. `public.users` - –æ–±—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
10. `auth.users` - —É–¥–∞–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Admin API (backend)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üõ°Ô∏è `SECURITY DEFINER` - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∞–º–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ñ—É–Ω–∫—Ü–∏–∏
- üîÑ Try/catch –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã (–Ω–µ –ø–∞–¥–∞–µ—Ç –µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞—è)
- üìä –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ Rollback-safe (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç–∏—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ)

---

### 2. **Backend: Controller** ‚úÖ

**–§–∞–π–ª:** `backend/src/controllers/tripwireManagerController.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
// –î–û (—Ç–æ–ª—å–∫–æ –¥–ª—è smmmcwin@gmail.com):
if (userEmail !== 'smmmcwin@gmail.com') {
  return res.status(403).json({ error: 'Forbidden' });
}

// –ü–û–°–õ–ï (–¥–ª—è –≤—Å–µ—Ö admin + sales):
// Middleware requireSalesOrAdmin –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
// –õ—é–±–æ–π admin –∏–ª–∏ sales –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å
```

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –≤ `sales_activity_log`
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å timestamp –∏ details
- ‚úÖ Success response —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

---

### 3. **Backend: Service** ‚úÖ

**–§–∞–π–ª:** `backend/src/services/tripwireManagerService.ts`

**–£–ª—É—á—à–µ–Ω–∏—è:**
```typescript
// 1. –í—ã–∑–æ–≤ —É–ª—É—á—à–µ–Ω–Ω–æ–π RPC —Ñ—É–Ω–∫—Ü–∏–∏
const { data: rpcResult, error: rpcError } = 
  await tripwireAdminSupabase.rpc('rpc_delete_tripwire_user', {
    p_user_id: userId
  });

// 2. –î–µ—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
if (!rpcResult.success) {
  throw new Error(`${errorMsg}\n\nDetails: ${errorDetails}`);
}

// 3. –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ auth.users
await tripwireAdminSupabase.auth.admin.deleteUser(userId);

// 4. –í–æ–∑–≤—Ä–∞—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
return {
  success: true,
  email: rpcResult.email,
  full_name: rpcResult.full_name,
  details: rpcResult.details, // ‚úÖ –î–µ—Ç–∞–ª–∏ –∏–∑ RPC
};
```

---

### 4. **Frontend: UsersTable Component** ‚úÖ

**–§–∞–π–ª:** `src/pages/admin/components/UsersTable.tsx`

**–ù–æ–≤—ã–µ —Ñ–∏—á–∏:**

#### A. –î–æ—Å—Ç—É–ø –¥–ª—è –≤—Å–µ—Ö Sales Manager:
```typescript
// –î–û:
{currentUserEmail === 'smmmcwin@gmail.com' && (
  <button onClick={handleDelete}>DELETE</button>
)}

// –ü–û–°–õ–ï:
{(currentUserRole === 'admin' || currentUserRole === 'sales') && (
  <button onClick={handleDelete}>DELETE</button>
)}
```

#### B. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:
```typescript
window.confirm(`
  ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!
  
  –í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞?
  
  –ò–º—è: ${fullName}
  Email: ${email}
  
  ‚ùå –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–õ–¨–ó–Ø –æ—Ç–º–µ–Ω–∏—Ç—å!
  ‚úÖ –ë—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –í–°–ï –¥–∞–Ω–Ω—ã–µ:
  - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –º–æ–¥—É–ª—è–º
  - –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –≤–∏–¥–µ–æ
  - –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
  - –ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  
  –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ?
`)
```

#### C. –ö—Ä–∞—Å–∏–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—à–∏–±–æ–∫:
```typescript
{deleteError && (
  <ErrorModal>
    {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–∫–æ–Ω–∫–æ–π */}
    <Header>–û–®–ò–ë–ö–ê –£–î–ê–õ–ï–ù–ò–Ø</Header>
    
    {/* –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ */}
    <Message>{deleteError.message}</Message>
    
    {/* –î–µ—Ç–∞–ª–∏ (–∫–æ–ø–∏—Ä—É–µ–º—ã–µ) */}
    <Details>
      <CopyButton />
      <pre>{deleteError.details}</pre>
    </Details>
    
    {/* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è */}
    <Button>–ó–ê–ö–†–´–¢–¨</Button>
  </ErrorModal>
)}
```

**–î–∏–∑–∞–π–Ω –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:**
- üé® –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω —Å —Ä–∞–∑–º—ã—Ç–∏–µ–º
- üî¥ –ö—Ä–∞—Å–Ω–∞—è —Ä–∞–º–∫–∞ –∏ –∏–∫–æ–Ω–∫–∞ XCircle
- üìã –ö–æ–ø–∏—Ä—É–µ–º—ã–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
- ‚åö Timestamp –æ—à–∏–±–∫–∏
- üíö –ó–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–ó–ê–ö–†–´–¢–¨"

#### D. Success —Å–æ–æ–±—â–µ–Ω–∏–µ:
```typescript
alert(`
  ‚úÖ –£—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!
  
  –°—Ç—É–¥–µ–Ω—Ç: ${fullName}
  Email: ${email}
  
  –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª–µ–Ω—ã –∏–∑ —Å–∏—Å—Ç–µ–º—ã.
`)
```

#### E. Loading —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
```typescript
{isDeleting === user.id ? (
  <Spinner /> // –ö—Ä—É—Ç—è—â–∏–π—Å—è loader
) : (
  <Trash2Icon /> // –ò–∫–æ–Ω–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
)}
```

#### F. Tooltip:
```typescript
<span className="tooltip">
  –£–¥–∞–ª–∏—Ç—å –∏–∑ —Å–∏—Å—Ç–µ–º—ã
</span>
```

---

## üéØ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ (–¥–ª—è Sales Manager)

### –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å Sales Manager –ø–∞–Ω–µ–ª—å

```
https://onai.academy/integrator/sales-manager
```

**–î–æ—Å—Ç—É–ø:**
- ‚úÖ –ê–º–∏–Ω–∞ (sales)
- ‚úÖ –†–∞—Ö–∞—Ç (sales)
- ‚úÖ Admin SMMC (admin)
- ‚úÖ –õ—é–±–æ–π –¥—Ä—É–≥–æ–π sales –º–µ–Ω–µ–¥–∂–µ—Ä

---

### –®–∞–≥ 2: –ù–∞–π—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ

–í —Ç–∞–±–ª–∏—Ü–µ "–ú–û–ò –£–ß–ï–ù–ò–ö–ò" –Ω–∞–π–¥–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å.

**–ö–æ–ª–æ–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—ã:**
- –§–ò–û
- EMAIL
- –°–¢–ê–¢–£–°
- –ú–û–î–£–õ–ò
- EMAIL –û–¢–ü–†–ê–í–õ–ï–ù
- –î–û–ë–ê–í–õ–ï–ù
- **–î–ï–ô–°–¢–í–ò–Ø** üóëÔ∏è (–∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è)

---

### –®–∞–≥ 3: –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è

–í –∫–æ–ª–æ–Ω–∫–µ "–î–ï–ô–°–¢–í–ò–Ø" –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ **–∫—Ä–∞—Å–Ω—É—é –∏–∫–æ–Ω–∫—É –∫–æ—Ä–∑–∏–Ω—ã** üóëÔ∏è

**–ü–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:**
```
‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!

–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞?

–ò–º—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
Email: ivan@example.com

‚ùå –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–õ–¨–ó–Ø –æ—Ç–º–µ–Ω–∏—Ç—å!
‚úÖ –ë—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –í–°–ï –¥–∞–Ω–Ω—ã–µ:
- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –º–æ–¥—É–ª—è–º
- –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –≤–∏–¥–µ–æ
- –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
- –ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ?
```

---

### –®–∞–≥ 4: –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å

**–í–∞—Ä–∏–∞–Ω—Ç A: –ù–∞–∂–∞—Ç—å "OK"**
- ‚è≥ –ù–∞—á–Ω–µ—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å —É–¥–∞–ª–µ–Ω–∏—è (–∫–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∂–µ—Ç loader)
- ‚úÖ –ï—Å–ª–∏ —É—Å–ø–µ—Ö - —Å—Ç—É–¥–µ–Ω—Ç –∏—Å—á–µ–∑–Ω–µ—Ç –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ –ü–æ—è–≤–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "–£—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!"

**–í–∞—Ä–∏–∞–Ω—Ç B: –ù–∞–∂–∞—Ç—å "–û—Ç–º–µ–Ω–∞"**
- ‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–∏—Ç—Å—è
- ‚úÖ –°—Ç—É–¥–µ–Ω—Ç –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ

---

### –®–∞–≥ 5: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ

**–ï—Å–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å:**

1. **–ü–æ—è–≤–∏—Ç—Å—è –∫—Ä–∞—Å–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ** —Å –¥–µ—Ç–∞–ª—è–º–∏ –æ—à–∏–±–∫–∏:
   ```
   ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
   ‚ïë  üî¥  –û–®–ò–ë–ö–ê –£–î–ê–õ–ï–ù–ò–Ø              ‚ïë
   ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
   ‚ïë  Failed to delete user from       ‚ïë
   ‚ïë  database: table "xyz" not found  ‚ïë
   ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
   ‚ïë  –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:  [–ö–û–ü–ò–†–û–í–ê–¢–¨]    ‚ïë
   ‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
   ‚ïë  ‚îÇ ERROR: 42P01: relation "xyz" ‚îÇ ‚ïë
   ‚ïë  ‚îÇ does not exist               ‚îÇ ‚ïë
   ‚ïë  ‚îÇ LINE 1: DELETE FROM xyz...   ‚îÇ ‚ïë
   ‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
   ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
   ```

2. **–ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ö–û–ü–ò–†–û–í–ê–¢–¨"**
   - ‚úÖ –í—Å—è –æ—à–∏–±–∫–∞ —Å–∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞

3. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É –º–Ω–µ (Admin SMMC)**
   - üìß Email: smmmcwin@gmail.com
   - üí¨ Telegram: @smmc_admin
   - üìã WhatsApp: +7...

4. **–Ø –∏—Å–ø—Ä–∞–≤–ª—é –ø—Ä–æ–±–ª–µ–º—É –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 —á–∞—Å–æ–≤**

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç 1: –£—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (Happy Path)

```
1. –õ–æ–≥–∏–Ω: amina@onaiacademy.kz (sales)
2. –û—Ç–∫—Ä—ã—Ç—å: /integrator/sales-manager
3. –ù–∞–π—Ç–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
4. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è üóëÔ∏è
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —Å—Ç—É–¥–µ–Ω—Ç –∏—Å—á–µ–∑ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø–æ—è–≤–∏–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ "–£—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°—Ç—É–¥–µ–Ω—Ç —É–¥–∞–ª–µ–Ω, —Ç–∞–±–ª–∏—Ü–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å

---

### –¢–µ—Å—Ç 2: –û—Ç–º–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è

```
1. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
2. –í –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –Ω–∞–∂–∞—Ç—å "–û—Ç–º–µ–Ω–∞"
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —Å—Ç—É–¥–µ–Ω—Ç –æ—Å—Ç–∞–ª—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°—Ç—É–¥–µ–Ω—Ç –ù–ï —É–¥–∞–ª–µ–Ω

---

### –¢–µ—Å—Ç 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏

```
1. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —É–¥–∞–ª–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–µ—Ä–µ–∑ DevTools)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø–æ—è–≤–∏–ª–æ—Å—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –æ—à–∏–±–∫–æ–π
3. –ù–∞–∂–∞—Ç—å "–ö–û–ü–ò–†–û–í–ê–¢–¨"
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –æ—à–∏–±–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∞—Å—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
5. –ù–∞–∂–∞—Ç—å "–ó–ê–ö–†–´–¢–¨"
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã–ª–æ—Å—å
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ –∫—Ä–∞—Å–∏–≤–æ –∏ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è

---

### –¢–µ—Å—Ç 4: –î–æ—Å—Ç—É–ø –¥–ª—è sales —Ä–æ–ª–∏

```
1. –õ–æ–≥–∏–Ω: amina@onaiacademy.kz (sales)
2. –û—Ç–∫—Ä—ã—Ç—å: /integrator/sales-manager
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –∫–æ–ª–æ–Ω–∫–∞ "–î–ï–ô–°–¢–í–ò–Ø" –≤–∏–¥–Ω–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–∞
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Sales –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

---

### –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –ë–î

```sql
-- 1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
INSERT INTO tripwire_users (user_id, email, full_name) 
VALUES ('test-uuid', 'test@example.com', 'Test User');

-- 2. –£–¥–∞–ª–∏—Ç—å —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

-- 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —É–¥–∞–ª–µ–Ω–æ –∏–∑ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü:
SELECT * FROM tripwire_users WHERE user_id = 'test-uuid'; -- –ø—É—Å—Ç–æ
SELECT * FROM module_unlocks WHERE user_id = 'test-uuid'; -- –ø—É—Å—Ç–æ
SELECT * FROM video_tracking WHERE user_id = 'test-uuid'; -- –ø—É—Å—Ç–æ
SELECT * FROM tripwire_progress WHERE tripwire_user_id = 'test-uuid'; -- –ø—É—Å—Ç–æ
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∏ –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ

---

## üö® –í–ê–ñ–ù–û: –ß–¢–û –ù–£–ñ–ù–û –ó–ù–ê–¢–¨

### 1. **–£–¥–∞–ª–µ–Ω–∏–µ –ù–ï–û–ë–†–ê–¢–ò–ú–û!** ‚ö†Ô∏è

–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è **–ù–ï–í–û–ó–ú–û–ñ–ù–û** –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
- ‚ùå –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –º–æ–¥—É–ª—è–º
- ‚ùå –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –≤–∏–¥–µ–æ
- ‚ùå –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∏
- ‚ùå –ü—Ä–æ—Ñ–∏–ª—å —Å—Ç—É–¥–µ–Ω—Ç–∞
- ‚ùå –ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –í–°–ï–ì–î–ê —Å–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ –∏–ª–∏ –∞–¥–º–∏–Ω–∞!

---

### 2. **–£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è** üìä

–ö–∞–∂–¥–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `sales_activity_log`:
```sql
{
  "action": "delete_user",
  "manager_id": "uuid-sales-manager",
  "user_id": "uuid-deleted-student",
  "details": {
    "deleted_email": "student@example.com",
    "deleted_name": "–ò–º—è –°—Ç—É–¥–µ–Ω—Ç–∞",
    "deleted_by": "amina@onaiacademy.kz"
  },
  "created_at": "2025-12-20 21:00:00"
}
```

**–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:**
- ‚úÖ Admin –≤–∏–¥–∏—Ç –ö–¢–û —É–¥–∞–ª–∏–ª —Å—Ç—É–¥–µ–Ω—Ç–∞
- ‚úÖ Admin –≤–∏–¥–∏—Ç –ö–û–ì–î–ê —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ
- ‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —É–¥–∞–ª–µ–Ω–∏–π

---

### 3. **–ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ** üêõ

**–ï—Å–ª–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞:**

1. **–ù–ï –ü–ê–ù–ò–ö–û–í–ê–¢–¨!** üòå
2. **–ù–∞–∂–∞—Ç—å "–ö–û–ü–ò–†–û–í–ê–¢–¨"** –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
3. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É Admin SMMC:**
   - üìß smmmcwin@gmail.com
   - üí¨ Telegram
   - üì± WhatsApp

4. **–ù–∞–ø–∏—Å–∞—Ç—å:**
   ```
   –ü—Ä–∏–≤–µ—Ç! –ù–µ –º–æ–≥—É —É–¥–∞–ª–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞.
   
   Email —Å—Ç—É–¥–µ–Ω—Ç–∞: student@example.com
   
   –û—à–∏–±–∫–∞:
   [–≤—Å—Ç–∞–≤–∏—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—à–∏–±–∫—É]
   ```

5. **–Ø –∏—Å–ø—Ä–∞–≤–ª—é –ø—Ä–æ–±–ª–µ–º—É!** ‚úÖ

---

### 4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** üîí

**–ö—Ç–æ –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å:**
- ‚úÖ Admin (smmmcwin@gmail.com)
- ‚úÖ Sales (amina@onaiacademy.kz, etc.)

**–ö—Ç–æ –ù–ï –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å:**
- ‚ùå Students (–æ–±—ã—á–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã)
- ‚ùå –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

**–ó–∞—â–∏—Ç–∞:**
- üõ°Ô∏è SalesGuard –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- üõ°Ô∏è requireSalesOrAdmin middleware –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
- üõ°Ô∏è SECURITY DEFINER –≤ RPC —Ñ—É–Ω–∫—Ü–∏–∏

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê

**–ß—Ç–æ —É–¥–∞–ª—è–µ—Ç—Å—è (–¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞):**
- ~10-50 –∑–∞–ø–∏—Å–µ–π –≤ `video_tracking`
- ~3-5 –∑–∞–ø–∏—Å–µ–π –≤ `module_unlocks`
- ~10-30 –∑–∞–ø–∏—Å–µ–π –≤ `tripwire_progress`
- 1 –∑–∞–ø–∏—Å—å –≤ `tripwire_users`
- 1 –∑–∞–ø–∏—Å—å –≤ `tripwire_user_profile`
- 1 –∑–∞–ø–∏—Å—å –≤ `auth.users`

**–ò—Ç–æ–≥–æ:** ~20-90 –∑–∞–ø–∏—Å–µ–π –∏–∑ 9 —Ç–∞–±–ª–∏—Ü

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- ‚ö° –û–±—ã—á–Ω–æ: 0.5-2 —Å–µ–∫—É–Ω–¥—ã
- üê¢ –ú–∞–∫—Å–∏–º—É–º: 5 —Å–µ–∫—É–Ω–¥ (–µ—Å–ª–∏ –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö)

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

### API Endpoint:

```
DELETE /api/admin/tripwire/users/:userId
```

**Headers:**
```
Authorization: Bearer <JWT_TOKEN>
```

**Response (success):**
```json
{
  "success": true,
  "message": "User deleted successfully",
  "email": "student@example.com",
  "full_name": "–ò–º—è –°—Ç—É–¥–µ–Ω—Ç–∞",
  "details": "video_tracking: 15 deleted; module_unlocks: 3 deleted; ..."
}
```

**Response (error):**
```json
{
  "success": false,
  "error": "Failed to delete user from database",
  "details": "ERROR: 42P01: relation does not exist",
  "timestamp": "2025-12-20T21:00:00.000Z",
  "userId": "uuid-here"
}
```

---

### Database Function:

```sql
SELECT rpc_delete_tripwire_user('user-uuid-here');
```

**Returns:**
```json
{
  "success": true,
  "email": "student@example.com",
  "full_name": "–ò–º—è –°—Ç—É–¥–µ–Ω—Ç–∞",
  "details": "video_tracking: 15 deleted; ...",
  "message": "User and all related data deleted successfully"
}
```

---

## ‚úÖ CHECKLIST –î–õ–Ø SALES MANAGER

–ü–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] –°—Ç—É–¥–µ–Ω—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–¥–∞–ª–µ–Ω?
- [ ] –í—ã —Å–ø—Ä–æ—Å–∏–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —É –∞–¥–º–∏–Ω–∞?
- [ ] –°—Ç—É–¥–µ–Ω—Ç –Ω–µ –ø–ª–∞—Ç–∏–ª –∑–∞ –∫—É—Ä—Å?
- [ ] –£ —Å—Ç—É–¥–µ–Ω—Ç–∞ –Ω–µ—Ç –≤–∞–∂–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞?
- [ ] –í—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ —á—Ç–æ —É–¥–∞–ª–µ–Ω–∏–µ –ù–ï–û–ë–†–ê–¢–ò–ú–û?
- [ ] –í—ã –≥–æ—Ç–æ–≤—ã –æ–±—ä—è—Å–Ω–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É —É–¥–∞–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω—É?

**–ï—Å–ª–∏ –≤—Å–µ ‚úÖ - –º–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å!**

---

## üìû –ö–û–ù–¢–ê–ö–¢–´

**–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º:**
- Admin: smmmcwin@gmail.com
- Telegram: @smmc_admin

**–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö:**
- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å Admin SMMC
- –ñ–¥–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 —á–∞—Å–∞)

---

## üéâ –ò–¢–û–ì

**–§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ì–û–¢–û–í–ê!** ‚úÖ

**–ê–º–∏–Ω–∞, –†–∞—Ö–∞—Ç –∏ –≤—Å–µ Sales Manager —Ç–µ–ø–µ—Ä—å –º–æ–≥—É—Ç:**
- ‚úÖ –£–¥–∞–ª—è—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –í–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏
- ‚úÖ –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–¥–º–∏–Ω—É
- ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

**–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑ –í–°–ï–• —Ç–∞–±–ª–∏—Ü!** üí™

---

**–°–æ–∑–¥–∞–Ω–æ:** 20 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready
