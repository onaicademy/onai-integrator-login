#!/bin/bash

# ๐ก๏ธ ะะะฉะะขะ ะะข ะะฃะะะะะะขะะ: ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะธััะบะฐ ะฟัะพัะตััะพะฒ ะฟะตัะตะด ะทะฐะฟััะบะพะผ
# ะัะฟะพะปัะทะพะฒะฐะฝะธะต: ./scripts/start-clean.sh

echo "๐ ะัะพะฒะตััะตะผ ััะฐััะต ะฟัะพัะตััั Node.js..."

# ะะพะบะฐะทัะฒะฐะตะผ ััะพ ัะตะนัะฐั ัะฐะฑะพัะฐะตั
PROCESS_COUNT=$(ps aux | grep -E "[n]ode.*server|[n]odemon" | wc -l | tr -d ' ')

if [ "$PROCESS_COUNT" -gt 0 ]; then
  echo "โ๏ธ  ะะฐะนะดะตะฝะพ $PROCESS_COUNT ััะฐััั ะฟัะพัะตััะพะฒ!"
  echo "๐ ะกะฟะธัะพะบ ะฟัะพัะตััะพะฒ:"
  ps aux | grep -E "[n]ode.*server|[n]odemon" | awk '{print "   PID " $2 ": " $11 " " $12 " " $13}'
  
  echo ""
  echo "๐จ ะฃะฑะธะฒะฐะตะผ ััะฐััะต ะฟัะพัะตััั..."
  killall -9 node nodemon 2>/dev/null
  
  if [ $? -eq 0 ]; then
    echo "โ ะกัะฐััะต ะฟัะพัะตััั ัะฑะธัั!"
  else
    echo "โ๏ธ  ะะต ัะดะฐะปะพัั ัะฑะธัั ะฟัะพัะตััั (ะฒะพะทะผะพะถะฝะพ ะธั ัะถะต ะฝะตั)"
  fi
else
  echo "โ ะกัะฐััั ะฟัะพัะตััะพะฒ ะฝะต ะฝะฐะนะดะตะฝะพ"
fi

# ะะดะตะผ ััะพะฑั ะฟะพััั ะพัะฒะพะฑะพะดะธะปะธัั
echo ""
echo "โณ ะะดะตะผ 3 ัะตะบัะฝะดั ะดะปั ะพัะฒะพะฑะพะถะดะตะฝะธั ะฟะพััะพะฒ..."
sleep 3

# ะัะพะฒะตััะตะผ ััะพ ะฟะพัั 3000 ัะฒะพะฑะพะดะตะฝ
PORT_CHECK=$(lsof -ti:3000 | wc -l | tr -d ' ')
if [ "$PORT_CHECK" -gt 0 ]; then
  echo "โ๏ธ  ะะพัั 3000 ะฒัะต ะตัะต ะทะฐะฝัั! ะัะธะฝัะดะธัะตะปัะฝะพ ะพัะฒะพะฑะพะถะดะฐะตะผ..."
  lsof -ti:3000 | xargs kill -9 2>/dev/null
  sleep 2
fi

echo ""
echo "๐ ะะฐะฟััะบะฐะตะผ ัะธัััะน ัะตัะฒะตั..."
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ะะฐะฟััะบะฐะตะผ npm run dev
npm run dev

# ะญัะพั ะบะพะด ะฒัะฟะพะปะฝะธััั ัะพะปัะบะพ ะตัะปะธ ัะตัะฒะตั ะพััะฐะฝะพะฒะธััั
echo ""
echo "๐ ะกะตัะฒะตั ะพััะฐะฝะพะฒะปะตะฝ"





