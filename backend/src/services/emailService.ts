import nodemailer from 'nodemailer';

/**
 * Email Service –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–∏—Å–µ–º
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Google Workspace SMTP
 */

interface WelcomeEmailParams {
  toEmail: string;
  name: string;
  password: string;
}

interface EmailChangeNotificationParams {
  toEmail: string;
  name: string;
  oldEmail: string;
  newEmail: string;
}

interface PasswordChangeNotificationParams {
  toEmail: string;
  name: string;
}

/**
 * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ –Ω–æ–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é Tripwire
 */
export async function sendWelcomeEmail(params: WelcomeEmailParams): Promise<boolean> {
  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ SMTP –Ω–∞—Å—Ç—Ä–æ–µ–∫
    if (!process.env.SMTP_USER || !process.env.SMTP_PASS) {
      console.warn('‚ö†Ô∏è SMTP credentials not configured, skipping email send');
      return false;
    }

    // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–ª—è Gmail
    const transporter = nodemailer.createTransport({
      host: process.env.SMTP_HOST || 'smtp.gmail.com',
      port: parseInt(process.env.SMTP_PORT || '465'),
      secure: process.env.SMTP_SECURE === 'true', // true –¥–ª—è –ø–æ—Ä—Ç–∞ 465
      auth: {
        user: process.env.SMTP_USER,
        pass: process.env.SMTP_PASS,
      },
    });

    // HTML —à–∞–±–ª–æ–Ω –ø–∏—Å—å–º–∞
    const htmlContent = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ò–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä 3.0</title>
  <style>
    body { margin: 0; padding: 0; background-color: #030303; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #FFFFFF; }
    .container { max-width: 600px; margin: 0 auto; background-color: #0A0A0A; border: 1px solid #1F1F1F; border-radius: 24px; overflow: hidden; }
    .header { background-color: #000000; padding: 30px 40px; text-align: center; border-bottom: 1px solid #1F1F1F; }
    .logo-svg { display: block; margin: 0 auto; width: 250px; height: auto; }
    .content { padding: 40px; color: #E0E0E0; line-height: 1.7; font-size: 16px; text-align: center; }
    .h1 { color: #FFFFFF; font-size: 26px; margin-bottom: 15px; font-weight: 700; text-transform: uppercase; }
    .feature-list-wrapper { display: inline-block; text-align: left; margin: 10px 0 25px 0; max-width: 90%; }
    .feature-list { padding-left: 0; list-style: none; margin: 0; }
    .feature-list li { margin-bottom: 14px; font-weight: 600; color: #E0E0E0; display: flex; align-items: flex-start; }
    .feature-list span.icon { margin-right: 15px; color: #00FF94; font-weight: bold; }
    .highlight-box { background-color: rgba(15, 15, 15, 0.6); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 12px; padding: 30px 25px; margin: 35px 0; text-align: center; box-shadow: 0 0 20px rgba(0, 255, 148, 0.05); }
    .label { color: #888888; font-size: 13px; margin-bottom: 6px; }
    .value { color: #00FF94; font-size: 20px; font-family: 'Courier New', monospace; font-weight: 500; background: rgba(0, 255, 148, 0.05); padding: 8px 12px; border-radius: 6px; border: 1px solid rgba(0, 255, 148, 0.1); display: inline-block; }
    .btn { background-color: #00FF94; color: #000000 !important; padding: 18px 45px; display: inline-block; font-size: 16px; font-weight: 800; text-transform: uppercase; text-decoration: none; border-radius: 4px; }
    .footer { padding: 30px; text-align: center; font-size: 12px; color: #555555; border-top: 1px solid #1F1F1F; }
    .save-data-badge { display: inline-block; border: 1px solid rgba(0, 255, 148, 0.3); border-radius: 4px; padding: 8px 16px; color: #E0E0E0; font-size: 13px; font-weight: 600; }
  </style>
</head>
<body>
  <table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#030303">
    <tr>
      <td align="center" style="padding: 40px 0;">
        <div class="container">
          <div class="header">
             <svg width="250" height="58" viewBox="0 0 3017 694" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: block; margin: 0 auto;">
<path d="M948.328 239.746C990.482 239.746 1023.04 253.283 1046 280.358C1069.31 307.433 1080.96 351.815 1080.96 413.504V529.171H962.722V415.046C962.722 393.455 961.522 375.805 959.123 362.096C956.724 348.387 950.898 336.906 941.645 327.653C932.391 318.4 917.997 313.773 898.462 313.773C877.899 313.773 862.648 318.228 852.71 327.139C842.771 335.707 836.43 346.845 833.689 360.554C830.947 374.263 829.576 392.255 829.576 414.532V529.171H711.339V248.999H829.576V283.957C855.623 254.483 895.207 239.746 948.328 239.746Z" fill="white"/>
<path d="M1671.76 529.171H1543.76L1508.29 463.883H1292.89L1257.42 529.171H1129.41L1335.56 148.755H1465.62L1671.76 529.171ZM1400.85 264.936L1339.16 378.033H1462.02L1400.85 264.936ZM1809.85 529.171H1682.87V148.755H1809.85V529.171Z" fill="#2EE57C"/>
<path d="M2290.59 250.496C2290.59 261.595 2287.95 271.584 2282.67 280.463C2277.38 289.342 2269.88 296.318 2260.15 301.392C2250.43 306.466 2239.12 309.002 2226.22 309.002H2170.09V191.672H2226.06C2238.96 191.672 2250.27 194.209 2259.99 199.283C2269.82 204.356 2277.38 211.333 2282.67 220.212C2287.95 229.091 2290.59 239.186 2290.59 250.496ZM2229.07 289.659C2237 289.659 2244.03 288.179 2250.16 285.219C2256.4 282.154 2261.26 277.714 2264.75 271.901C2268.34 265.981 2270.14 258.846 2270.14 250.496C2270.14 243.519 2268.34 237.019 2264.75 230.994C2261.26 224.969 2256.35 220.159 2250 216.565C2243.77 212.971 2236.79 211.174 2229.07 211.174H2190.7V289.659H2229.07ZM2327.12 309.002H2306.5V191.672H2327.12V309.002ZM2483.61 309.002H2470.61L2467.44 291.879C2460.99 298.326 2453.12 303.347 2443.81 306.941C2434.51 310.429 2424.58 312.174 2414 312.174C2400.58 312.174 2388.48 309.478 2377.7 304.087C2366.91 298.696 2358.41 291.35 2352.17 282.048C2346.04 272.641 2342.97 262.123 2342.97 250.496C2342.97 238.763 2346.14 228.245 2352.49 218.943C2358.83 209.536 2367.39 202.19 2378.17 196.904C2389.06 191.619 2401 188.977 2414 188.977C2423.31 188.977 2432.56 190.562 2441.75 193.733C2450.95 196.904 2459.14 201.767 2466.33 208.32C2473.52 214.874 2478.59 223.013 2481.55 232.738L2459.67 232.896C2457.13 227.083 2453.33 222.273 2448.25 218.468C2443.18 214.557 2437.58 211.703 2431.45 209.906C2425.42 208.003 2419.66 207.052 2414.16 207.052C2404.54 207.052 2395.88 208.849 2388.16 212.443C2380.55 215.931 2374.52 221.005 2370.09 227.664C2365.75 234.218 2363.58 241.828 2363.58 250.496C2363.58 259.692 2365.86 267.62 2370.4 274.279C2375.05 280.833 2381.24 285.801 2388.95 289.183C2396.67 292.566 2405.07 294.257 2414.16 294.257C2423.68 294.257 2432.66 292.09 2441.12 287.756C2449.57 283.422 2455.97 276.816 2460.3 267.937H2415.91V251.764H2482.98V263.18L2483.61 309.002ZM2520.05 309.002H2499.43V191.672H2520.05V309.002ZM2536.69 209.43V191.672H2666.87L2536.69 209.43ZM2666.87 191.672V209.906H2612.48V309.002H2591.87V209.906H2536.69V191.672H2666.87ZM2787.67 309.002H2765.47L2750.73 281.731H2672.88L2658.13 309.002H2635.93L2699.51 191.672H2724.09L2787.67 309.002ZM2711.88 209.906L2683.34 262.387H2740.26L2711.88 209.906ZM2817.8 191.672V291.086H2901.83V309.002H2797.19V191.672H2817.8ZM2312.32 496.002H2290.12L2275.37 468.731H2197.52L2182.78 496.002H2160.58L2224.16 378.672H2248.74L2312.32 496.002ZM2236.53 396.906L2207.99 449.387H2264.91L2236.53 396.906ZM2449.86 496.002H2436.85L2433.68 478.879C2427.24 485.326 2419.36 490.347 2410.06 493.941C2400.76 497.429 2390.82 499.174 2380.25 499.174C2366.83 499.174 2354.72 496.478 2343.94 491.087C2333.16 485.696 2324.65 478.35 2318.41 469.048C2312.28 459.641 2309.22 449.123 2309.22 437.496C2309.22 425.763 2312.39 415.245 2318.73 405.943C2325.07 396.536 2333.64 389.19 2344.42 383.904C2355.3 378.619 2367.25 375.977 2380.25 375.977C2389.55 375.977 2398.8 377.562 2408 380.733C2417.19 383.904 2425.39 388.767 2432.57 395.32C2439.76 401.874 2444.83 410.013 2447.79 419.738L2425.91 419.896C2423.38 414.083 2419.57 409.273 2414.5 405.468C2409.42 401.557 2403.82 398.703 2397.69 396.906C2391.67 395.003 2385.91 394.052 2380.41 394.052C2370.79 394.052 2362.12 395.849 2354.41 399.443C2346.8 402.931 2340.77 408.005 2336.33 414.664C2332 421.218 2329.83 428.828 2329.83 437.496C2329.83 446.692 2332.1 454.62 2336.65 461.279C2341.3 467.833 2347.48 472.801 2355.2 476.183C2362.91 479.566 2371.32 481.257 2380.41 481.257C2389.92 481.257 2398.91 479.09 2407.36 474.756C2415.82 470.422 2422.21 463.816 2426.55 454.937H2382.15V438.764H2449.22V450.18L2449.86 496.002ZM2569.69 443.679H2486.29V478.403L2583.01 477.769V496.002H2465.68V378.672H2583.01L2583.17 396.906H2486.29V425.446H2569.69V443.679ZM2620.38 496.002H2599.77V378.672L2620.38 496.002ZM2732.95 496.002H2712.34H2732.95ZM2712.34 467.621V378.672H2732.95V496.002H2712.34L2620.38 406.895V496.002H2599.77V378.672H2620.38L2712.34 467.621ZM2748.8 437.496C2748.8 425.763 2751.92 415.193 2758.16 405.785C2764.5 396.377 2773.12 389.031 2784 383.746C2794.89 378.355 2806.99 375.66 2820.31 375.66C2836.27 375.66 2850.28 379.623 2862.33 387.551C2874.48 395.479 2883.26 406.736 2888.65 421.323L2867.09 421.64C2864.87 415.721 2861.11 410.647 2855.83 406.419C2850.54 402.191 2844.68 399.02 2838.23 396.906C2831.89 394.686 2825.97 393.576 2820.47 393.576C2812.23 393.576 2804.14 395.32 2796.21 398.809C2788.39 402.191 2781.94 407.212 2776.87 413.871C2771.9 420.531 2769.42 428.405 2769.42 437.496C2769.42 446.798 2771.74 454.725 2776.39 461.279C2781.04 467.833 2787.23 472.801 2794.94 476.183C2802.77 479.566 2811.27 481.257 2820.47 481.257C2825.86 481.257 2831.52 480.253 2837.44 478.244C2843.36 476.13 2848.9 473.012 2854.08 468.89C2859.26 464.767 2863.39 459.746 2866.45 453.827H2888.81C2882.89 468.625 2873.96 479.883 2862.01 487.599C2850.17 495.315 2836.27 499.174 2820.31 499.174C2807.1 499.174 2795 496.478 2784 491.087C2773.12 485.696 2764.5 478.297 2758.16 468.89C2751.92 459.482 2748.8 449.017 2748.8 437.496ZM2986.99 378.672H3013.15L2956.23 446.533V496.002H2933.24V446.851L2876.16 378.672H2902.32L2944.34 429.727L2986.99 378.672Z" fill="white"/>
<path d="M1997.34 164.379V512.937" stroke="white" stroke-width="15.4423"/>
<path d="M537.318 249.729H313.642C239.605 249.729 179.437 310.923 179.437 386.22C179.437 461.517 239.605 522.711 313.642 522.711H537.318C611.355 522.711 671.524 461.517 671.524 386.22C671.524 310.923 611.355 249.729 537.318 249.729ZM537.318 477.214H313.642C264.21 477.214 224.172 436.494 224.172 386.22C224.172 335.946 264.21 295.226 313.642 295.226H537.318C586.75 295.226 626.788 335.946 626.788 386.22C626.788 436.494 586.75 477.214 537.318 477.214ZM537.318 317.975C500.188 317.975 470.215 348.458 470.215 386.22C470.215 423.982 500.188 454.465 537.318 454.465C574.448 454.465 604.421 423.982 604.421 386.22C604.421 348.458 574.448 317.975 537.318 317.975Z" fill="white"/>
<path d="M537.318 317.975C500.188 317.975 470.215 348.458 470.215 386.22C470.215 423.982 500.188 454.465 537.318 454.465C574.448 454.465 604.421 423.982 604.421 386.22C604.421 348.458 574.448 317.975 537.318 317.975Z" fill="#2EE57C"/>
</svg>
          </div>

          <div class="content">
            <div class="h1">–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú, ${params.name}!</div>
            <p style="margin-bottom: 25px;">
              –í—ã —Å–¥–µ–ª–∞–ª–∏ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ —Ç–æ–º—É, —á—Ç–æ–±—ã <strong style="color: #00FF94;">–≤–ª–∞–¥–µ—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏ –±—É–¥—É—â–µ–≥–æ</strong>.
              –ò–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä 3.0 ‚Äî —ç—Ç–æ –≤–∞—à–∞ —Ä–µ–ø–µ—Ç–∏—Ü–∏—è –ø–µ—Ä–µ–¥ –±–æ–ª—å—à–æ–π —Å—Ü–µ–Ω–æ–π.
            </p>

            <div class="feature-list-wrapper">
                <ul class="feature-list">
                  <li><span class="icon">‚úì</span><span>–û—Å–≤–æ–∏—Ç–µ –±–∞–∑–æ–≤—ã–µ AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ</span></li>
                  <li><span class="icon">‚úì</span><span>–ü–æ–π–º—ë—Ç–µ, –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö</span></li>
                  <li><span class="icon">‚úì</span><span>–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ—Å—å –∫ –ø–æ–ª–Ω–æ–º—É –∫—É—Ä—Å—É</span></li>
                </ul>
            </div>

            <p style="text-align: center; color: #00FF94; font-weight: 700; text-transform: uppercase; margin-bottom: 35px;">
                –î–û–°–¢–£–ü –ê–ö–¢–ò–í–ò–†–û–í–ê–ù. –í–†–ï–ú–Ø –î–ï–ô–°–¢–í–û–í–ê–¢–¨.
            </p>

            <div class="highlight-box">
              <div class="label">–í–∞—à –ª–æ–≥–∏–Ω:</div>
              <div style="margin-bottom: 20px;">
                  <span class="value" style="font-size: 18px;">${params.toEmail}</span>
              </div>

              <div class="label">–í–∞—à –ø–∞—Ä–æ–ª—å:</div>
              <div style="margin-bottom: 15px; position: relative;">
                  <span class="value" id="password-text" style="font-size: 18px;">${params.password}</span>
                  <button onclick="copyPassword()" style="margin-left: 10px; background: rgba(0, 255, 148, 0.15); border: 1px solid #00FF94; color: #00FF94; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                    üìã –ö–û–ü–ò–†–û–í–ê–¢–¨
                  </button>
              </div>
              
              <p style="text-align: center; margin-top: 25px; margin-bottom: 0; color: #888888; font-size: 14px;">
                üí° –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞—Ä–æ–ª—å –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
              </p>
            </div>

            <div style="text-align: center; margin-top: 35px; margin-bottom: 20px;">
                  <a href="https://onai.academy/tripwire/login?email=${encodeURIComponent(params.toEmail)}" class="btn">–í–û–ô–¢–ò –í –ü–õ–ê–¢–§–û–†–ú–£</a>
            </div>
            
            <script>
              function copyPassword() {
                const password = '${params.password}';
                if (navigator.clipboard && navigator.clipboard.writeText) {
                  navigator.clipboard.writeText(password).then(function() {
                    alert('‚úÖ –ü–∞—Ä–æ–ª—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                  }).catch(function(err) {
                    fallbackCopy(password);
                  });
                } else {
                  fallbackCopy(password);
                }
              }
              
              function fallbackCopy(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                  document.execCommand('copy');
                  alert('‚úÖ –ü–∞—Ä–æ–ª—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                } catch (err) {
                  alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é: ' + text);
                }
                document.body.removeChild(textArea);
              }
            </script>
          </div>

          <div class="footer">
            <p style="margin: 0; padding-bottom: 5px;">onAI Academy ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä 3.0</p>
            <p style="margin: 0;">&copy; 2025 –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            <p style="margin-top: 10px; opacity: 0.7;">–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–∏—Å—å–º–æ.</p>
          </div>
        </div>
      </td>
    </tr>
  </table>
</body>
</html>
    `;

    // –û—Ç–ø—Ä–∞–≤–∫–∞ email
    await transporter.sendMail({
      from: `"onAI Academy" <${process.env.SMTP_USER}>`,
      to: params.toEmail,
      subject: 'üöÄ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ò–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä 3.0 ‚Äî –í–∞—à –ø—É—Ç—å –∫ AI –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å!',
      html: htmlContent,
    });

    console.log(`‚úÖ Welcome email sent to ${params.toEmail}`);
    return true;
  } catch (error: any) {
    console.error(`‚ùå Error sending welcome email:`, error.message);
    return false;
  }
}

/**
 * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–º–µ–Ω–µ email
 */
export async function sendEmailChangeNotification(params: EmailChangeNotificationParams): Promise<boolean> {
  try {
    if (!process.env.SMTP_USER || !process.env.SMTP_PASS) {
      console.warn('‚ö†Ô∏è SMTP credentials not configured, skipping email send');
      return false;
    }

    const transporter = nodemailer.createTransport({
      host: process.env.SMTP_HOST || 'smtp.gmail.com',
      port: parseInt(process.env.SMTP_PORT || '465'),
      secure: process.env.SMTP_SECURE === 'true',
      auth: {
        user: process.env.SMTP_USER,
        pass: process.env.SMTP_PASS,
      },
    });

    const htmlContent = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</title>
  <style>
    body { margin: 0; padding: 0; background-color: #030303; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #FFFFFF; }
    .container { max-width: 600px; margin: 0 auto; background-color: #0A0A0A; border: 1px solid #1F1F1F; border-radius: 24px; overflow: hidden; }
    .header { background-color: #000000; padding: 30px 40px; text-align: center; border-bottom: 1px solid #1F1F1F; }
    .logo-svg { display: block; margin: 0 auto; width: 250px; height: auto; }
    .content { padding: 40px; color: #E0E0E0; line-height: 1.7; font-size: 16px; text-align: center; }
    .h1 { color: #FFFFFF; font-size: 26px; margin-bottom: 15px; font-weight: 700; text-transform: uppercase; }
    .alert-box { background-color: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 12px; padding: 30px 25px; margin: 35px 0; text-align: center; }
    .info-box { background-color: rgba(15, 15, 15, 0.6); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 12px; padding: 20px 25px; margin: 20px 0; text-align: left; }
    .label { color: #888888; font-size: 13px; margin-bottom: 6px; }
    .value { color: #00FF94; font-size: 18px; font-family: 'Courier New', monospace; font-weight: 500; }
    .btn { background-color: #00FF94; color: #000000 !important; padding: 18px 45px; display: inline-block; font-size: 16px; font-weight: 800; text-transform: uppercase; text-decoration: none; border-radius: 4px; margin-top: 30px; }
    .footer { padding: 30px; text-align: center; font-size: 12px; color: #555555; border-top: 1px solid #1F1F1F; }
  </style>
</head>
<body>
  <table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#030303">
    <tr>
      <td align="center" style="padding: 40px 0;">
        <div class="container">
          <div class="header">
            <svg width="250" height="58" viewBox="0 0 3017 694" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: block; margin: 0 auto;">
<path d="M948.328 239.746C990.482 239.746 1023.04 253.283 1046 280.358C1069.31 307.433 1080.96 351.815 1080.96 413.504V529.171H962.722V415.046C962.722 393.455 961.522 375.805 959.123 362.096C956.724 348.387 950.898 336.906 941.645 327.653C932.391 318.4 917.997 313.773 898.462 313.773C877.899 313.773 862.648 318.228 852.71 327.139C842.771 335.707 836.43 346.845 833.689 360.554C830.947 374.263 829.576 392.255 829.576 414.532V529.171H711.339V248.999H829.576V283.957C855.623 254.483 895.207 239.746 948.328 239.746Z" fill="white"/>
<path d="M1671.76 529.171H1543.76L1508.29 463.883H1292.89L1257.42 529.171H1129.41L1335.56 148.755H1465.62L1671.76 529.171ZM1400.85 264.936L1339.16 378.033H1462.02L1400.85 264.936ZM1809.85 529.171H1682.87V148.755H1809.85V529.171Z" fill="#2EE57C"/>
<path d="M2290.59 250.496C2290.59 261.595 2287.95 271.584 2282.67 280.463C2277.38 289.342 2269.88 296.318 2260.15 301.392C2250.43 306.466 2239.12 309.002 2226.22 309.002H2170.09V191.672H2226.06C2238.96 191.672 2250.27 194.209 2259.99 199.283C2269.82 204.356 2277.38 211.333 2282.67 220.212C2287.95 229.091 2290.59 239.186 2290.59 250.496ZM2229.07 289.659C2237 289.659 2244.03 288.179 2250.16 285.219C2256.4 282.154 2261.26 277.714 2264.75 271.901C2268.34 265.981 2270.14 258.846 2270.14 250.496C2270.14 243.519 2268.34 237.019 2264.75 230.994C2261.26 224.969 2256.35 220.159 2250 216.565C2243.77 212.971 2236.79 211.174 2229.07 211.174H2190.7V289.659H2229.07ZM2327.12 309.002H2306.5V191.672H2327.12V309.002ZM2483.61 309.002H2470.61L2467.44 291.879C2460.99 298.326 2453.12 303.347 2443.81 306.941C2434.51 310.429 2424.58 312.174 2414 312.174C2400.58 312.174 2388.48 309.478 2377.7 304.087C2366.91 298.696 2358.41 291.35 2352.17 282.048C2346.04 272.641 2342.97 262.123 2342.97 250.496C2342.97 238.763 2346.14 228.245 2352.49 218.943C2358.83 209.536 2367.39 202.19 2378.17 196.904C2389.06 191.619 2401 188.977 2414 188.977C2423.31 188.977 2432.56 190.562 2441.75 193.733C2450.95 196.904 2459.14 201.767 2466.33 208.32C2473.52 214.874 2478.59 223.013 2481.55 232.738L2459.67 232.896C2457.13 227.083 2453.33 222.273 2448.25 218.468C2443.18 214.557 2437.58 211.703 2431.45 209.906C2425.42 208.003 2419.66 207.052 2414.16 207.052C2404.54 207.052 2395.88 208.849 2388.16 212.443C2380.55 215.931 2374.52 221.005 2370.09 227.664C2365.75 234.218 2363.58 241.828 2363.58 250.496C2363.58 259.692 2365.86 267.62 2370.4 274.279C2375.05 280.833 2381.24 285.801 2388.95 289.183C2396.67 292.566 2405.07 294.257 2414.16 294.257C2423.68 294.257 2432.66 292.09 2441.12 287.756C2449.57 283.422 2455.97 276.816 2460.3 267.937H2415.91V251.764H2482.98V263.18L2483.61 309.002ZM2520.05 309.002H2499.43V191.672H2520.05V309.002ZM2536.69 209.43V191.672H2666.87L2536.69 209.43ZM2666.87 191.672V209.906H2612.48V309.002H2591.87V209.906H2536.69V191.672H2666.87ZM2787.67 309.002H2765.47L2750.73 281.731H2672.88L2658.13 309.002H2635.93L2699.51 191.672H2724.09L2787.67 309.002ZM2711.88 209.906L2683.34 262.387H2740.26L2711.88 209.906ZM2817.8 191.672V291.086H2901.83V309.002H2797.19V191.672H2817.8ZM2312.32 496.002H2290.12L2275.37 468.731H2197.52L2182.78 496.002H2160.58L2224.16 378.672H2248.74L2312.32 496.002ZM2236.53 396.906L2207.99 449.387H2264.91L2236.53 396.906ZM2449.86 496.002H2436.85L2433.68 478.879C2427.24 485.326 2419.36 490.347 2410.06 493.941C2400.76 497.429 2390.82 499.174 2380.25 499.174C2366.83 499.174 2354.72 496.478 2343.94 491.087C2333.16 485.696 2324.65 478.35 2318.41 469.048C2312.28 459.641 2309.22 449.123 2309.22 437.496C2309.22 425.763 2312.39 415.245 2318.73 405.943C2325.07 396.536 2333.64 389.19 2344.42 383.904C2355.3 378.619 2367.25 375.977 2380.25 375.977C2389.55 375.977 2398.8 377.562 2408 380.733C2417.19 383.904 2425.39 388.767 2432.57 395.32C2439.76 401.874 2444.83 410.013 2447.79 419.738L2425.91 419.896C2423.38 414.083 2419.57 409.273 2414.5 405.468C2409.42 401.557 2403.82 398.703 2397.69 396.906C2391.67 395.003 2385.91 394.052 2380.41 394.052C2370.79 394.052 2362.12 395.849 2354.41 399.443C2346.8 402.931 2340.77 408.005 2336.33 414.664C2332 421.218 2329.83 428.828 2329.83 437.496C2329.83 446.692 2332.1 454.62 2336.65 461.279C2341.3 467.833 2347.48 472.801 2355.2 476.183C2362.91 479.566 2371.32 481.257 2380.41 481.257C2389.92 481.257 2398.91 479.09 2407.36 474.756C2415.82 470.422 2422.21 463.816 2426.55 454.937H2382.15V438.764H2449.22V450.18L2449.86 496.002ZM2569.69 443.679H2486.29V478.403L2583.01 477.769V496.002H2465.68V378.672H2583.01L2583.17 396.906H2486.29V425.446H2569.69V443.679ZM2620.38 496.002H2599.77V378.672L2620.38 496.002ZM2732.95 496.002H2712.34H2732.95ZM2712.34 467.621V378.672H2732.95V496.002H2712.34L2620.38 406.895V496.002H2599.77V378.672H2620.38L2712.34 467.621ZM2748.8 437.496C2748.8 425.763 2751.92 415.193 2758.16 405.785C2764.5 396.377 2773.12 389.031 2784 383.746C2794.89 378.355 2806.99 375.66 2820.31 375.66C2836.27 375.66 2850.28 379.623 2862.33 387.551C2874.48 395.479 2883.26 406.736 2888.65 421.323L2867.09 421.64C2864.87 415.721 2861.11 410.647 2855.83 406.419C2850.54 402.191 2844.68 399.02 2838.23 396.906C2831.89 394.686 2825.97 393.576 2820.47 393.576C2812.23 393.576 2804.14 395.32 2796.21 398.809C2788.39 402.191 2781.94 407.212 2776.87 413.871C2771.9 420.531 2769.42 428.405 2769.42 437.496C2769.42 446.798 2771.74 454.725 2776.39 461.279C2781.04 467.833 2787.23 472.801 2794.94 476.183C2802.77 479.566 2811.27 481.257 2820.47 481.257C2825.86 481.257 2831.52 480.253 2837.44 478.244C2843.36 476.13 2848.9 473.012 2854.08 468.89C2859.26 464.767 2863.39 459.746 2866.45 453.827H2888.81C2882.89 468.625 2873.96 479.883 2862.01 487.599C2850.17 495.315 2836.27 499.174 2820.31 499.174C2807.1 499.174 2795 496.478 2784 491.087C2773.12 485.696 2764.5 478.297 2758.16 468.89C2751.92 459.482 2748.8 449.017 2748.8 437.496ZM2986.99 378.672H3013.15L2956.23 446.533V496.002H2933.24V446.851L2876.16 378.672H2902.32L2944.34 429.727L2986.99 378.672Z" fill="white"/>
<path d="M1997.34 164.379V512.937" stroke="white" stroke-width="15.4423"/>
<path d="M537.318 249.729H313.642C239.605 249.729 179.437 310.923 179.437 386.22C179.437 461.517 239.605 522.711 313.642 522.711H537.318C611.355 522.711 671.524 461.517 671.524 386.22C671.524 310.923 611.355 249.729 537.318 249.729ZM537.318 477.214H313.642C264.21 477.214 224.172 436.494 224.172 386.22C224.172 335.946 264.21 295.226 313.642 295.226H537.318C586.75 295.226 626.788 335.946 626.788 386.220C626.788 436.494 586.75 477.214 537.318 477.214ZM537.318 317.975C500.188 317.975 470.215 348.458 470.215 386.22C470.215 423.982 500.188 454.465 537.318 454.465C574.448 454.465 604.421 423.982 604.421 386.22C604.421 348.458 574.448 317.975 537.318 317.975Z" fill="white"/>
<path d="M537.318 317.975C500.188 317.975 470.215 348.458 470.215 386.22C470.215 423.982 500.188 454.465 537.318 454.465C574.448 454.465 604.421 423.982 604.421 386.22C604.421 348.458 574.448 317.975 537.318 317.975Z" fill="#2EE57C"/>
</svg>
          </div>

          <div class="content">
            <div class="h1">üîê –û–ë–ù–û–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–• –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò</div>
            
            <div class="alert-box">
              <p style="margin: 0; font-size: 18px; color: #FFC107; font-weight: 600;">
                ‚ö†Ô∏è SECURITY ALERT: EMAIL –ò–ó–ú–ï–ù–ï–ù
              </p>
            </div>

            <p style="margin-bottom: 25px; text-align: left;">
              –£–≤–∞–∂–∞–µ–º—ã–π <strong style="color: #00FF94;">${params.name}</strong>,
            </p>
            
            <p style="text-align: left; margin-bottom: 30px; font-size: 16px; line-height: 1.8;">
              –í–∞—à email –∞–¥—Ä–µ—Å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É <strong>onAI Academy</strong> –±—ã–ª —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω.
            </p>

            <div class="info-box">
              <div style="margin-bottom: 15px;">
                <div class="label">–°–¢–ê–†–´–ô –ê–î–†–ï–°:</div>
                <div class="value" style="color: #888888; text-decoration: line-through;">${params.oldEmail}</div>
              </div>
              <div>
                <div class="label">–ù–û–í–´–ô –ê–î–†–ï–°:</div>
                <div class="value">${params.newEmail}</div>
              </div>
            </div>

            <div style="background-color: rgba(220, 38, 38, 0.15); border-left: 4px solid #DC2626; padding: 25px; margin-top: 35px; text-align: left; border-radius: 8px;">
              <p style="margin: 0; font-size: 16px; font-weight: 700; color: #EF4444;">
                ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!
              </p>
              <p style="margin: 10px 0 0 0; font-size: 15px; color: #E0E0E0; line-height: 1.6;">
                –ï—Å–ª–∏ —ç—Ç–æ —Å–¥–µ–ª–∞–ª–∏ <strong>–Ω–µ –≤—ã</strong> ‚Äî —Å—Ä–æ—á–Ω–æ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ –∞–¥—Ä–µ—Å—É 
                <a href="mailto:support@onaiacademy.kz" style="color: #00FF94; text-decoration: underline; font-weight: 600;">support@onaiacademy.kz</a>
              </p>
            </div>

            <div style="text-align: center; margin-top: 40px;">
              <a href="https://onai.academy/tripwire/profile" class="btn">–ü–ï–†–ï–ô–¢–ò –í –ü–†–û–§–ò–õ–¨</a>
            </div>
          </div>

          <div class="footer">
            <p style="margin: 0; padding-bottom: 5px;">onAI Academy ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä 3.0</p>
            <p style="margin: 0;">&copy; 2025 –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            <p style="margin-top: 10px; opacity: 0.7;">–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–∏—Å—å–º–æ.</p>
          </div>
        </div>
      </td>
    </tr>
  </table>
</body>
</html>
    `;

    await transporter.sendMail({
      from: `"onAI Academy Security" <${process.env.SMTP_USER}>`,
      to: params.toEmail,
      subject: 'üîê –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–º–µ–Ω–µ email ‚Äî onAI Academy',
      html: htmlContent,
    });

    console.log(`‚úÖ Email change notification sent to ${params.toEmail}`);
    return true;
  } catch (error: any) {
    console.error(`‚ùå Error sending email change notification:`, error.message);
    return false;
  }
}

/**
 * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è
 */
export async function sendPasswordChangeNotification(params: PasswordChangeNotificationParams): Promise<boolean> {
  try {
    if (!process.env.SMTP_USER || !process.env.SMTP_PASS) {
      console.warn('‚ö†Ô∏è SMTP credentials not configured, skipping email send');
      return false;
    }

    const transporter = nodemailer.createTransport({
      host: process.env.SMTP_HOST || 'smtp.gmail.com',
      port: parseInt(process.env.SMTP_PORT || '465'),
      secure: process.env.SMTP_SECURE === 'true',
      auth: {
        user: process.env.SMTP_USER,
        pass: process.env.SMTP_PASS,
      },
    });

    const htmlContent = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</title>
  <style>
    body { margin: 0; padding: 0; background-color: #030303; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #FFFFFF; }
    .container { max-width: 600px; margin: 0 auto; background-color: #0A0A0A; border: 1px solid #1F1F1F; border-radius: 24px; overflow: hidden; }
    .header { background-color: #000000; padding: 30px 40px; text-align: center; border-bottom: 1px solid #1F1F1F; }
    .content { padding: 40px; color: #E0E0E0; line-height: 1.7; font-size: 16px; text-align: center; }
    .h1 { color: #FFFFFF; font-size: 26px; margin-bottom: 15px; font-weight: 700; text-transform: uppercase; }
    .alert-box { background-color: rgba(46, 229, 124, 0.1); border: 1px solid rgba(46, 229, 124, 0.3); border-radius: 12px; padding: 30px 25px; margin: 35px 0; text-align: center; }
    .btn { background-color: #00FF94; color: #000000 !important; padding: 18px 45px; display: inline-block; font-size: 16px; font-weight: 800; text-transform: uppercase; text-decoration: none; border-radius: 4px; margin-top: 30px; }
    .footer { padding: 30px; text-align: center; font-size: 12px; color: #555555; border-top: 1px solid #1F1F1F; }
  </style>
</head>
<body>
  <table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#030303">
    <tr>
      <td align="center" style="padding: 40px 0;">
        <div class="container">
          <div class="header">
            <svg width="250" height="58" viewBox="0 0 3017 694" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: block; margin: 0 auto;">
<path d="M948.328 239.746C990.482 239.746 1023.04 253.283 1046 280.358C1069.31 307.433 1080.96 351.815 1080.96 413.504V529.171H962.722V415.046C962.722 393.455 961.522 375.805 959.123 362.096C956.724 348.387 950.898 336.906 941.645 327.653C932.391 318.4 917.997 313.773 898.462 313.773C877.899 313.773 862.648 318.228 852.71 327.139C842.771 335.707 836.43 346.845 833.689 360.554C830.947 374.263 829.576 392.255 829.576 414.532V529.171H711.339V248.999H829.576V283.957C855.623 254.483 895.207 239.746 948.328 239.746Z" fill="white"/>
<path d="M1671.76 529.171H1543.76L1508.29 463.883H1292.89L1257.42 529.171H1129.41L1335.56 148.755H1465.62L1671.76 529.171ZM1400.85 264.936L1339.16 378.033H1462.02L1400.85 264.936ZM1809.85 529.171H1682.87V148.755H1809.85V529.171Z" fill="#2EE57C"/>
<path d="M2290.59 250.496C2290.59 261.595 2287.95 271.584 2282.67 280.463C2277.38 289.342 2269.88 296.318 2260.15 301.392C2250.43 306.466 2239.12 309.002 2226.22 309.002H2170.09V191.672H2226.06C2238.96 191.672 2250.27 194.209 2259.99 199.283C2269.82 204.356 2277.38 211.333 2282.67 220.212C2287.95 229.091 2290.59 239.186 2290.59 250.496ZM2229.07 289.659C2237 289.659 2244.03 288.179 2250.16 285.219C2256.4 282.154 2261.26 277.714 2264.75 271.901C2268.34 265.981 2270.14 258.846 2270.14 250.496C2270.14 243.519 2268.34 237.019 2264.75 230.994C2261.26 224.969 2256.35 220.159 2250 216.565C2243.77 212.971 2236.79 211.174 2229.07 211.174H2190.7V289.659H2229.07ZM2327.12 309.002H2306.5V191.672H2327.12V309.002ZM2483.61 309.002H2470.61L2467.44 291.879C2460.99 298.326 2453.12 303.347 2443.81 306.941C2434.51 310.429 2424.58 312.174 2414 312.174C2400.58 312.174 2388.48 309.478 2377.7 304.087C2366.91 298.696 2358.41 291.35 2352.17 282.048C2346.04 272.641 2342.97 262.123 2342.97 250.496C2342.97 238.763 2346.14 228.245 2352.49 218.943C2358.83 209.536 2367.39 202.19 2378.17 196.904C2389.06 191.619 2401 188.977 2414 188.977C2423.31 188.977 2432.56 190.562 2441.75 193.733C2450.95 196.904 2459.14 201.767 2466.33 208.32C2473.52 214.874 2478.59 223.013 2481.55 232.738L2459.67 232.896C2457.13 227.083 2453.33 222.273 2448.25 218.468C2443.18 214.557 2437.58 211.703 2431.45 209.906C2425.42 208.003 2419.66 207.052 2414.16 207.052C2404.54 207.052 2395.88 208.849 2388.16 212.443C2380.55 215.931 2374.52 221.005 2370.09 227.664C2365.75 234.218 2363.58 241.828 2363.58 250.496C2363.58 259.692 2365.86 267.62 2370.4 274.279C2375.05 280.833 2381.24 285.801 2388.95 289.183C2396.67 292.566 2405.07 294.257 2414.16 294.257C2423.68 294.257 2432.66 292.09 2441.12 287.756C2449.57 283.422 2455.97 276.816 2460.3 267.937H2415.91V251.764H2482.98V263.18L2483.61 309.002ZM2520.05 309.002H2499.43V191.672H2520.05V309.002ZM2536.69 209.43V191.672H2666.87L2536.69 209.43ZM2666.87 191.672V209.906H2612.48V309.002H2591.87V209.906H2536.69V191.672H2666.87ZM2787.67 309.002H2765.47L2750.73 281.731H2672.88L2658.13 309.002H2635.93L2699.51 191.672H2724.09L2787.67 309.002ZM2711.88 209.906L2683.34 262.387H2740.26L2711.88 209.906ZM2817.8 191.672V291.086H2901.83V309.002H2797.19V191.672H2817.8ZM2312.32 496.002H2290.12L2275.37 468.731H2197.52L2182.78 496.002H2160.58L2224.16 378.672H2248.74L2312.32 496.002ZM2236.53 396.906L2207.99 449.387H2264.91L2236.53 396.906ZM2449.86 496.002H2436.85L2433.68 478.879C2427.24 485.326 2419.36 490.347 2410.06 493.941C2400.76 497.429 2390.82 499.174 2380.25 499.174C2366.83 499.174 2354.72 496.478 2343.94 491.087C2333.16 485.696 2324.65 478.35 2318.41 469.048C2312.28 459.641 2309.22 449.123 2309.22 437.496C2309.22 425.763 2312.39 415.245 2318.73 405.943C2325.07 396.536 2333.64 389.19 2344.42 383.904C2355.3 378.619 2367.25 375.977 2380.25 375.977C2389.55 375.977 2398.8 377.562 2408 380.733C2417.19 383.904 2425.39 388.767 2432.57 395.32C2439.76 401.874 2444.83 410.013 2447.79 419.738L2425.91 419.896C2423.38 414.083 2419.57 409.273 2414.5 405.468C2409.42 401.557 2403.82 398.703 2397.69 396.906C2391.67 395.003 2385.91 394.052 2380.41 394.052C2370.79 394.052 2362.12 395.849 2354.41 399.443C2346.8 402.931 2340.77 408.005 2336.33 414.664C2332 421.218 2329.83 428.828 2329.83 437.496C2329.83 446.692 2332.1 454.62 2336.65 461.279C2341.3 467.833 2347.48 472.801 2355.2 476.183C2362.91 479.566 2371.32 481.257 2380.41 481.257C2389.92 481.257 2398.91 479.09 2407.36 474.756C2415.82 470.422 2422.21 463.816 2426.55 454.937H2382.15V438.764H2449.22V450.18L2449.86 496.002ZM2569.69 443.679H2486.29V478.403L2583.01 477.769V496.002H2465.68V378.672H2583.01L2583.17 396.906H2486.29V425.446H2569.69V443.679ZM2620.38 496.002H2599.77V378.672L2620.38 496.002ZM2732.95 496.002H2712.34H2732.95ZM2712.34 467.621V378.672H2732.95V496.002H2712.34L2620.38 406.895V496.002H2599.77V378.672H2620.38L2712.34 467.621ZM2748.8 437.496C2748.8 425.763 2751.92 415.193 2758.16 405.785C2764.5 396.377 2773.12 389.031 2784 383.746C2794.89 378.355 2806.99 375.66 2820.31 375.66C2836.27 375.66 2850.28 379.623 2862.33 387.551C2874.48 395.479 2883.26 406.736 2888.65 421.323L2867.09 421.64C2864.87 415.721 2861.11 410.647 2855.83 406.419C2850.54 402.191 2844.68 399.02 2838.23 396.906C2831.89 394.686 2825.97 393.576 2820.47 393.576C2812.23 393.576 2804.14 395.32 2796.21 398.809C2788.39 402.191 2781.94 407.212 2776.87 413.871C2771.9 420.531 2769.42 428.405 2769.42 437.496C2769.42 446.798 2771.74 454.725 2776.39 461.279C2781.04 467.833 2787.23 472.801 2794.94 476.183C2802.77 479.566 2811.27 481.257 2820.47 481.257C2825.86 481.257 2831.52 480.253 2837.44 478.244C2843.36 476.13 2848.9 473.012 2854.08 468.89C2859.26 464.767 2863.39 459.746 2866.45 453.827H2888.81C2882.89 468.625 2873.96 479.883 2862.01 487.599C2850.17 495.315 2836.27 499.174 2820.31 499.174C2807.1 499.174 2795 496.478 2784 491.087C2773.12 485.696 2764.5 478.297 2758.16 468.89C2751.92 459.482 2748.8 449.017 2748.8 437.496ZM2986.99 378.672H3013.15L2956.23 446.533V496.002H2933.24V446.851L2876.16 378.672H2902.32L2944.34 429.727L2986.99 378.672Z" fill="white"/>
<path d="M1997.34 164.379V512.937" stroke="white" stroke-width="15.4423"/>
<path d="M537.318 249.729H313.642C239.605 249.729 179.437 310.923 179.437 386.22C179.437 461.517 239.605 522.711 313.642 522.711H537.318C611.355 522.711 671.524 461.517 671.524 386.22C671.524 310.923 611.355 249.729 537.318 249.729ZM537.318 477.214H313.642C264.21 477.214 224.172 436.494 224.172 386.22C224.172 335.946 264.21 295.226 313.642 295.226H537.318C586.75 295.226 626.788 335.946 626.788 386.22C626.788 436.494 586.75 477.214 537.318 477.214ZM537.318 317.975C500.188 317.975 470.215 348.458 470.215 386.22C470.215 423.982 500.188 454.465 537.318 454.465C574.448 454.465 604.421 423.982 604.421 386.22C604.421 348.458 574.448 317.975 537.318 317.975Z" fill="white"/>
<path d="M537.318 317.975C500.188 317.975 470.215 348.458 470.215 386.22C470.215 423.982 500.188 454.465 537.318 454.465C574.448 454.465 604.421 423.982 604.421 386.22C604.421 348.458 574.448 317.975 537.318 317.975Z" fill="#2EE57C"/>
</svg>
          </div>

          <div class="content">
            <div class="h1">üîê –û–ë–ù–û–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–• –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò</div>
            
            <div class="alert-box">
              <p style="margin: 0; font-size: 18px; color: #2EE57C; font-weight: 600;">
                ‚úÖ SECURITY ALERT: –ü–ê–†–û–õ–¨ –ò–ó–ú–ï–ù–ï–ù
              </p>
            </div>

            <p style="margin-bottom: 25px; text-align: left;">
              –£–≤–∞–∂–∞–µ–º—ã–π <strong style="color: #00FF94;">${params.name}</strong>,
            </p>
            
            <p style="text-align: left; margin-bottom: 30px; font-size: 16px; line-height: 1.8;">
              –í–∞—à –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É <strong>onAI Academy</strong> –±—ã–ª —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω.
            </p>

            <div style="background-color: rgba(220, 38, 38, 0.15); border-left: 4px solid #DC2626; padding: 25px; margin-top: 35px; text-align: left; border-radius: 8px;">
              <p style="margin: 0; font-size: 16px; font-weight: 700; color: #EF4444;">
                ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!
              </p>
              <p style="margin: 10px 0 0 0; font-size: 15px; color: #E0E0E0; line-height: 1.6;">
                –ï—Å–ª–∏ —ç—Ç–æ —Å–¥–µ–ª–∞–ª–∏ <strong>–Ω–µ –≤—ã</strong> ‚Äî —Å—Ä–æ—á–Ω–æ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ –∞–¥—Ä–µ—Å—É 
                <a href="mailto:support@onaiacademy.kz" style="color: #00FF94; text-decoration: underline; font-weight: 600;">support@onaiacademy.kz</a>
              </p>
            </div>

            <div style="text-align: center; margin-top: 40px;">
              <a href="https://onai.academy/tripwire/profile" class="btn">–ü–ï–†–ï–ô–¢–ò –í –ü–†–û–§–ò–õ–¨</a>
            </div>
          </div>

          <div class="footer">
            <p style="margin: 0; padding-bottom: 5px;">onAI Academy ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä 3.0</p>
            <p style="margin: 0;">&copy; 2025 –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            <p style="margin-top: 10px; opacity: 0.7;">–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–∏—Å—å–º–æ.</p>
          </div>
        </div>
      </td>
    </tr>
  </table>
</body>
</html>
    `;

    await transporter.sendMail({
      from: `"onAI Academy Security" <${process.env.SMTP_USER}>`,
      to: params.toEmail,
      subject: 'üîê –ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω ‚Äî onAI Academy',
      html: htmlContent,
    });

    console.log(`‚úÖ Password change notification sent to ${params.toEmail}`);
    return true;
  } catch (error: any) {
    console.error(`‚ùå Error sending password change notification:`, error.message);
    return false;
  }
}

