# üìö –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ì–î–ï –•–†–ê–ù–Ø–¢–°–Ø –°–¢–£–î–ï–ù–¢–´ –ò –ö–ê–ö –° –ù–ò–ú–ò –†–ê–ë–û–¢–ê–¢–¨

**–î–∞—Ç–∞:** 11 –Ω–æ—è–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä:** Cursor AI  
**–î–ª—è:** –ù–∞–ø–∞—Ä–Ω–∏–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

---

## üéØ –ö–†–ê–¢–ö–ò–ô –û–¢–í–ï–¢ –ù–ê –í–û–ü–†–û–°–´:

### ‚ùì **–ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å—Ç—É–¥–µ–Ω—Ç—ã?**

**–û–¢–í–ï–¢:** –°—Ç—É–¥–µ–Ω—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **–î–í–£–• —Ç–∞–±–ª–∏—Ü–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:**

1. **`profiles`** - –æ–±—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∞–¥–º–∏–Ω—ã, –∫—É—Ä–∞—Ç–æ—Ä—ã, —Å—Ç—É–¥–µ–Ω—Ç—ã)
   - –ö–æ–ª–æ–Ω–∫–∞ `role = 'student'` —É–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ —ç—Ç–æ —Å—Ç—É–¥–µ–Ω—Ç
   
2. **`student_profiles`** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¢–û–õ–¨–ö–û –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
   - –°–æ–¥–µ—Ä–∂–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: `phone`, `total_xp`, `streak_days`, `level` –∏ —Ç.–¥.

### ‚ùì **–ë—ã–ª–∏ –ª–∏ –∫–æ–≥–¥–∞-—Ç–æ —Å—Ç—É–¥–µ–Ω—Ç—ã –≤ student_profiles?**

**–û–¢–í–ï–¢:** –î–ê! –¢–∞–±–ª–∏—Ü–∞ `student_profiles` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –î–û–õ–ñ–ù–ê —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤!

**–ü–†–û–ë–õ–ï–ú–ê –°–ï–ô–ß–ê–°:** –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `StudentsActivity.tsx` –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ —Å `profiles` –Ω–∞ `student_profiles`, –Ω–æ:
- –í–æ–∑–º–æ–∂–Ω–æ —Ç–∞–±–ª–∏—Ü–∞ `student_profiles` –ø—É—Å—Ç–∞—è
- –í–æ–∑–º–æ–∂–Ω–æ —Ç—É–¥–∞ –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Å—Ç—É–¥–µ–Ω—Ç—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- –ù—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ Edge Function `create-student`

### ‚ùì **–ö–∞–∫ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã?**

**–û–¢–í–ï–¢:** –ß–µ—Ä–µ–∑ **Edge Function** `create-student`, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ 3 –º–µ—Å—Ç–∞—Ö:

1. `auth.users` (Supabase Authentication) - –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å
2. `profiles` - –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ñ–∏–ª—å —Å —Ä–æ–ª—å—é
3. `student_profiles` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å—Ç—É–¥–µ–Ω—Ç–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ role = 'student')

---

## üóÑÔ∏è –î–ï–¢–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•

### **–¢–∞–±–ª–∏—Ü–∞ 1: `auth.users` (Supabase Authentication)**

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü–æ–ª—è:**
```sql
id              UUID PRIMARY KEY
email           TEXT UNIQUE
phone           TEXT
encrypted_password TEXT
email_confirmed BOOLEAN
created_at      TIMESTAMPTZ
```

**–ö—Ç–æ —Å–æ–∑–¥–∞—ë—Ç:** Edge Function —á–µ—Ä–µ–∑ `supabaseAdmin.auth.admin.createUser()`

---

### **–¢–∞–±–ª–∏—Ü–∞ 2: `profiles` (–û–±—â–∞—è –¥–ª—è –≤—Å–µ—Ö)**

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

**–ü–æ–ª—è:**
```sql
id                    UUID PRIMARY KEY (FK ‚Üí auth.users.id)
email                 TEXT UNIQUE NOT NULL
full_name             TEXT
role                  TEXT ('admin', 'curator', 'tech_support', 'student')
is_active             BOOLEAN DEFAULT true
account_expires_at    TIMESTAMPTZ (NULL –¥–ª—è –Ω–µ-—Å—Ç—É–¥–µ–Ω—Ç–æ–≤)
deleted_at            TIMESTAMPTZ
deactivation_reason   TEXT
created_at            TIMESTAMPTZ
updated_at            TIMESTAMPTZ
```

**–ö—Ç–æ —Å–æ–∑–¥–∞—ë—Ç:** Edge Function —á–µ—Ä–µ–∑ `.from('profiles').insert()`

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "email": "student@example.com",
  "full_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "role": "student",
  "is_active": true,
  "account_expires_at": "2026-11-11T00:00:00Z",
  "created_at": "2025-11-11T10:00:00Z"
}
```

---

### **–¢–∞–±–ª–∏—Ü–∞ 3: `student_profiles` (–¢–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç—ã)**

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¢–û–õ–¨–ö–û –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

**–ü–æ–ª—è:**
```sql
id                        UUID PRIMARY KEY (FK ‚Üí auth.users.id)
email                     TEXT NOT NULL
full_name                 TEXT NOT NULL
phone                     TEXT
avatar_url                TEXT
is_active                 BOOLEAN DEFAULT true
email_verified            BOOLEAN DEFAULT false
invited_by                UUID (FK ‚Üí profiles.id)
invited_at                TIMESTAMPTZ
last_login_at             TIMESTAMPTZ
notification_preferences  JSONB
total_xp                  INTEGER DEFAULT 0
level                     INTEGER DEFAULT 1
streak_days               INTEGER DEFAULT 0
longest_streak            INTEGER DEFAULT 0
last_active_date          DATE
created_at                TIMESTAMPTZ
updated_at                TIMESTAMPTZ
```

**–ö—Ç–æ —Å–æ–∑–¥–∞—ë—Ç:** Edge Function —á–µ—Ä–µ–∑ `.from('student_profiles').insert()` (–¢–û–õ–¨–ö–û –µ—Å–ª–∏ role = 'student')

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "email": "student@example.com",
  "full_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "phone": "+7 777 123 4567",
  "total_xp": 0,
  "level": 1,
  "streak_days": 0,
  "is_active": true,
  "created_at": "2025-11-11T10:00:00Z"
}
```

---

## üîÑ –ü–†–û–¶–ï–°–° –°–û–ó–î–ê–ù–ò–Ø –°–¢–£–î–ï–ù–¢–ê

### **–®–ê–ì 1: –ê–¥–º–∏–Ω –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏**

**–§–∞–π–ª:** `src/pages/admin/StudentsActivity.tsx`

**–§–æ—Ä–º–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- Email
- –ü–æ–ª–Ω–æ–µ –∏–º—è
- –¢–µ–ª–µ—Ñ–æ–Ω
- –ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤)
- –†–æ–ª—å (student, curator, tech_support, admin)
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (3/6/12 –º–µ—Å—è—Ü–µ–≤) - –¢–û–õ–¨–ö–û –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- –ö—É—Ä—Å—ã –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

**–ö–æ–¥:**
```typescript
const handleAddStudent = async () => {
  const { data, error } = await supabase.functions.invoke('create-student', {
    body: {
      email: formData.email.trim(),
      full_name: formData.fullName.trim(),
      phone: formData.phone.trim(),
      password: formData.password,
      role: formData.role,
      account_expires_at: expiresAt,
      course_ids: formData.selectedCourses,
    },
  });
}
```

---

### **–®–ê–ì 2: Edge Function –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å**

**–§–∞–π–ª:** `supabase/functions/create-student/index.ts`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è:**

#### **2.1 –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `auth.users`**

```typescript
const { data: authData, error: authError } = await supabaseAdmin.auth.admin.createUser({
  email,
  password,
  phone,  // ‚Üê –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω –≤ auth.users
  email_confirm: true,
  user_metadata: {
    full_name,
    role
  }
});

// –†–µ–∑—É–ª—å—Ç–∞—Ç: 
// - –°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å id
// - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞—Ä–æ–ª—å
// - Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
// - –°–æ—Ö—Ä–∞–Ω—ë–Ω —Ç–µ–ª–µ—Ñ–æ–Ω
```

#### **2.2 –°–æ–∑–¥–∞—ë—Ç –ø—Ä–æ—Ñ–∏–ª—å –≤ `profiles`**

```typescript
const { error: profileError } = await supabaseAdmin
  .from('profiles')
  .insert({
    id: authData.user.id,      // ‚Üê –°–≤—è–∑—å —Å auth.users
    email,
    full_name,
    role,                       // ‚Üê 'student'
    is_active: true,
    account_expires_at,         // ‚Üê –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è (–¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤)
    created_at: new Date().toISOString()
  });

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// - –°–æ–∑–¥–∞–Ω –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ñ–∏–ª—å
// - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ä–æ–ª—å 'student'
// - –£–∫–∞–∑–∞–Ω —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
```

#### **2.3 –°–æ–∑–¥–∞—ë—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≤ `student_profiles` (–¢–û–õ–¨–ö–û –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤)**

```typescript
if (role === 'student') {
  const { error: studentError } = await supabaseAdmin
    .from('student_profiles')
    .insert({
      id: authData.user.id,    // ‚Üê –¢–æ—Ç –∂–µ ID —á—Ç–æ –∏ –≤ profiles
      email,
      full_name,
      phone,
      total_xp: 0,
      streak_days: 0,
      is_active: true
    });
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// - –°–æ–∑–¥–∞–Ω —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å—Ç—É–¥–µ–Ω—Ç–∞
// - –°–æ—Ö—Ä–∞–Ω—ë–Ω —Ç–µ–ª–µ—Ñ–æ–Ω
// - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã XP –∏ streak
```

#### **2.4 –ù–∞–∑–Ω–∞—á–∞–µ—Ç –∫—É—Ä—Å—ã (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã)**

```typescript
if (course_ids && course_ids.length > 0) {
  const coursesToInsert = course_ids.map(courseId => ({
    student_id: authData.user.id,
    course_id: courseId,
    status: 'active',
    enrolled_at: new Date().toISOString()
  }));
  
  await supabaseAdmin.from('student_courses').insert(coursesToInsert);
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// - –°—Ç—É–¥–µ–Ω—Ç –∑–∞—á–∏—Å–ª–µ–Ω –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã
```

---

## üîç –ö–ê–ö –ó–ê–ì–†–£–ñ–ê–¢–¨ –°–¢–£–î–ï–ù–¢–û–í

### **–ü–†–ê–í–ò–õ–¨–ù–û ‚úÖ (–∏–∑ `student_profiles`)**

```typescript
const { data: profiles, error } = await supabase
  .from("student_profiles")
  .select("*")
  .order("created_at", { ascending: false });

// –†–µ–∑—É–ª—å—Ç–∞—Ç: –¢–û–õ–¨–ö–û —Å—Ç—É–¥–µ–Ω—Ç—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```

### **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚ùå (–∏–∑ `profiles` –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞)**

```typescript
const { data: profiles, error } = await supabase
  .from("profiles")
  .select("*")
  .order("created_at", { ascending: false });

// –†–µ–∑—É–ª—å—Ç–∞—Ç: –í–°–ï –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–∞–¥–º–∏–Ω—ã + —Å—Ç—É–¥–µ–Ω—Ç—ã + –∫—É—Ä–∞—Ç–æ—Ä—ã)
```

### **–ú–û–ñ–ù–û ‚úÖ (–∏–∑ `profiles` –° —Ñ–∏–ª—å—Ç—Ä–æ–º)**

```typescript
const { data: profiles, error } = await supabase
  .from("profiles")
  .select("*")
  .eq("role", "student")  // ‚Üê –§–∏–ª—å—Ç—Ä –ø–æ —Ä–æ–ª–∏
  .order("created_at", { ascending: false });

// –†–µ–∑—É–ª—å—Ç–∞—Ç: –¢–û–õ–¨–ö–û —Å—Ç—É–¥–µ–Ω—Ç—ã, –Ω–æ –ë–ï–ó —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (phone, xp, streak)
```

---

## ‚ö†Ô∏è –¢–ï–ö–£–©–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### **–ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å:**

–í —Ñ–∞–π–ª–µ `src/pages/admin/StudentsActivity.tsx` (—Å—Ç—Ä–æ–∫–∞ 119) –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ:

**–ë–´–õ–û:**
```typescript
.from("profiles")
```

**–°–¢–ê–õ–û:**
```typescript
.from("student_profiles")
```

### **–ü—Ä–æ–±–ª–µ–º–∞:**

–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ `student_profiles` **–ü–£–°–¢–ê–Ø**, —Ç–æ —Å—Ç—É–¥–µ–Ω—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è!

### **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—É—Å—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã:**

1. ‚ùå Edge Function `create-student` –Ω–µ –¥–µ–ø–ª–æ–∏–ª–∞—Å—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. ‚ùå Edge Function –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ `student_profiles` –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏
3. ‚ùå –í—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –î–û –≤–Ω–µ–¥—Ä–µ–Ω–∏—è `student_profiles` (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)
4. ‚ùå RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å –≤ `student_profiles`

---

## ‚úÖ –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨ –ò –ò–°–ü–†–ê–í–ò–¢–¨

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ï—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ `student_profiles`?**

–û—Ç–∫—Ä–æ–π Supabase Dashboard ‚Üí SQL Editor –∏ –≤—ã–ø–æ–ª–Ω–∏:

```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
SELECT COUNT(*) FROM student_profiles;

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—ã–µ 5 –∑–∞–ø–∏—Å–µ–π
SELECT * FROM student_profiles LIMIT 5;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ï—Å–ª–∏ `COUNT(*) = 0` ‚Üí —Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞—è, –Ω—É–∂–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è
- –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ RLS –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–µ

---

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ï—Å—Ç—å –ª–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã –≤ `profiles`?**

```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ profiles
SELECT 
  id, 
  email, 
  full_name, 
  role, 
  is_active, 
  created_at 
FROM profiles 
WHERE role = 'student'
ORDER BY created_at DESC
LIMIT 10;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ ‚Üí —Å—Ç—É–¥–µ–Ω—Ç—ã –ï–°–¢–¨, –Ω–æ —Ç–æ–ª—å–∫–æ –≤ `profiles`
- –ù—É–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ `student_profiles`

---

### **–†–ï–®–ï–ù–ò–ï 1: –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤**

–ï—Å–ª–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã –ï–°–¢–¨ –≤ `profiles`, –Ω–æ –ù–ï–¢ –≤ `student_profiles`:

```sql
-- –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏–∑ profiles –≤ student_profiles
INSERT INTO student_profiles (
  id,
  email,
  full_name,
  phone,
  is_active,
  total_xp,
  level,
  streak_days,
  created_at,
  updated_at
)
SELECT 
  p.id,
  p.email,
  p.full_name,
  NULL as phone,              -- –¢–µ–ª–µ—Ñ–æ–Ω –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –≤—Ä—É—á–Ω—É—é
  p.is_active,
  0 as total_xp,
  1 as level,
  0 as streak_days,
  p.created_at,
  p.updated_at
FROM profiles p
WHERE p.role = 'student'
  AND NOT EXISTS (
    SELECT 1 FROM student_profiles sp WHERE sp.id = p.id
  );

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–æ—Å—å
SELECT COUNT(*) FROM student_profiles;
```

---

### **–†–ï–®–ï–ù–ò–ï 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ Edge Function**

–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ Edge Function –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä—å —Å–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π
supabase functions list --project-ref arqhkacellqbhjhbebfh

# –ï—Å–ª–∏ –Ω–µ—Ç create-student - –∑–∞–¥–µ–ø–ª–æ–π
supabase functions deploy create-student --project-ref arqhkacellqbhjhbebfh
```

---

### **–†–ï–®–ï–ù–ò–ï 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ RLS**

–ü—Ä–æ–≤–µ—Ä—å –ø–æ–ª–∏—Ç–∏–∫–∏ RLS –Ω–∞ `student_profiles`:

```sql
-- –°–º–æ—Ç—Ä–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏
SELECT * FROM pg_policies WHERE tablename = 'student_profiles';

-- –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º RLS –¥–ª—è —Ç–µ—Å—Ç–∞
ALTER TABLE student_profiles DISABLE ROW LEVEL SECURITY;

-- –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
-- –ï—Å–ª–∏ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ - –ø—Ä–æ–±–ª–µ–º–∞ –≤ RLS

-- –í–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
ALTER TABLE student_profiles ENABLE ROW LEVEL SECURITY;
```

---

## üéØ –§–ò–ù–ê–õ–¨–ù–ê–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

### **–î–õ–Ø –ó–ê–ì–†–£–ó–ö–ò –°–¢–£–î–ï–ù–¢–û–í –ò–°–ü–û–õ–¨–ó–£–ô:**

```typescript
// –õ–£–ß–®–ò–ô –í–ê–†–ò–ê–ù–¢: –∏–∑ student_profiles
const { data: profiles, error } = await supabase
  .from("student_profiles")
  .select("*")
  .order("created_at", { ascending: false });
```

### **–ù–û –ü–ï–†–ï–î –≠–¢–ò–ú –£–ë–ï–î–ò–°–¨:**

1. ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `student_profiles` –ù–ï –ø—É—Å—Ç–∞—è
2. ‚úÖ Edge Function `create-student` –¥–µ–ø–ª–æ–µ–Ω–∞
3. ‚úÖ RLS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∞
4. ‚úÖ –í—Å–µ —Å—Ç–∞—Ä—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ `profiles`

---

## üìû –ö–û–ù–¢–ê–ö–¢–´ –î–õ–Ø –ü–û–ú–û–©–ò

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Edge Function –≤ Supabase Dashboard
- –ü—Ä–æ–≤–µ—Ä—å —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ SQL Editor

**–£–°–ü–ï–•–û–í! üöÄ**

