# ‚úÖ –ú–ò–ì–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê –ò –ü–†–û–í–ï–†–ï–ù–ê

**–î–∞—Ç–∞:** 23 –¥–µ–∫–∞–±—Ä—è 2025, 20:05 Almaty  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–°–Å –í LANDING DB!**

---

## üéØ –ü–†–û–í–ï–†–ö–ê –ê–†–•–ò–¢–ï–ö–¢–£–†–´

### –î–û (–±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```
–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí Main DB (landing_leads = 0)
–¢—Ä–∞—Ñ–∏–∫ –¥–∞—à–±–æ—Ä–¥ ‚Üí Landing DB (landing_leads = 692)
–ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ ‚Üí ??? (–Ω–µ–ø–æ–Ω—è—Ç–Ω–æ –∫—É–¥–∞)
```

### –ü–û–°–õ–ï (—Å–µ–π—á–∞—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```
–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí Landing DB ‚úÖ (landing_leads = 694)
–¢—Ä–∞—Ñ–∏–∫ –¥–∞—à–±–æ—Ä–¥ ‚Üí Landing DB ‚úÖ (landing_leads = 694)
–ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ ‚Üí Landing DB ‚úÖ (landingSupabase –≤ –∫–æ–¥–µ)
```

---

## üìä –ü–†–û–í–ï–†–ö–ê –î–ê–ù–ù–´–•

### Landing DB (Production) - –ï–î–ò–ù–´–ô –ò–°–¢–û–ß–ù–ò–ö:
- `landing_leads`: **694 –∑–∞–ø–∏—Å–∏** (+2 –Ω–æ–≤—ã—Ö –∑–∞ —á–∞—Å!)
- `express_course_sales`: **176 –∑–∞–ø–∏—Å–µ–π** (–º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ)
- `main_product_sales`: **0 –∑–∞–ø–∏—Å–µ–π** (–∂–¥–µ–º –≤–µ–±—Ö—É–∫–∏)
- `traffic_stats`: **0 –∑–∞–ø–∏—Å–µ–π** (–∂–¥–µ–º sync)

### Main DB - –ü–£–°–¢–ê–Ø:
- `landing_leads`: **0 –∑–∞–ø–∏—Å–µ–π** ‚ùå
- `users`: **3 –∑–∞–ø–∏—Å–∏** (admin users, –Ω–µ —Ç—Ä–æ–≥–∞–µ–º)

### Traffic DB - –¢–û–õ–¨–ö–û –õ–û–ì–ò–ù–´:
- `traffic_users`: **5 —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–æ–≤** (–ª–æ–≥–∏–Ω—ã/–ø–∞—Ä–æ–ª–∏)
- `all_sales_tracking`: **1 –∑–∞–ø–∏—Å—å** (—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ)

---

## üîç –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ö–û–î–ê

### 1. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (`/api/lead-tracking/leads`)

**–§–∞–π–ª:** `backend/src/routes/lead-tracking.ts`  
**–°—Ç—Ä–æ–∫–∏ 15-16:**
```typescript
const LANDING_SUPABASE_URL = process.env.LANDING_SUPABASE_URL || '';
const LANDING_SUPABASE_SERVICE_KEY = process.env.LANDING_SUPABASE_SERVICE_KEY || '';
```

**–°—Ç—Ä–æ–∫–∞ 202:**
```typescript
const { data: leadsFromDB } = await getSupabase()
  .from('landing_leads') // ‚úÖ LANDING DB!
  .select('*')
```

‚úÖ **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —á–∏—Ç–∞–µ—Ç –∏–∑ Landing DB!**

### 2. –ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ (`POST /api/landing/submit`)

**–§–∞–π–ª:** `backend/src/routes/landing.ts`  
**–°—Ç—Ä–æ–∫–∏ 15-22:**
```typescript
const LANDING_SUPABASE_URL = process.env.LANDING_SUPABASE_URL || '';
const LANDING_SUPABASE_SERVICE_KEY = process.env.LANDING_SUPABASE_SERVICE_KEY || '';

const landingSupabase = createClient(LANDING_SUPABASE_URL, LANDING_SUPABASE_SERVICE_KEY);
```

**–í—Å–µ INSERT –∏–¥—É—Ç –≤:**
```typescript
await landingSupabase.from('landing_leads').insert({...}) // ‚úÖ LANDING DB!
```

‚úÖ **–ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Landing DB!**

### 3. –¢—Ä–∞—Ñ–∏–∫ –¥–∞—à–±–æ—Ä–¥ (`GET /api/traffic-dashboard/funnel`)

**–§–∞–π–ª:** `backend/src/services/funnel-service.ts`  
**–°—Ç—Ä–æ–∫–∞ 19:**
```typescript
import { landingSupabase } from '../config/supabase-landing.js';
```

**–í—Å–µ queries:**
```typescript
landingSupabase.from('landing_leads').select('*') // ‚úÖ LANDING DB!
landingSupabase.from('express_course_sales').select('*') // ‚úÖ LANDING DB!
landingSupabase.from('main_product_sales').select('*') // ‚úÖ LANDING DB!
```

‚úÖ **–í–æ—Ä–æ–Ω–∫–∞ —á–∏—Ç–∞–µ—Ç –∏–∑ Landing DB!**

---

## üéâ –ú–ò–ì–†–ê–¶–ò–Ø –ù–ï –ù–£–ñ–ù–ê - –£–ñ–ï –°–î–ï–õ–ê–ù–ê!

### –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:
1. ‚úÖ –í—Å–µ 692 –ª–∏–¥–∞ –£–ñ–ï –ë–´–õ–ò –≤ Landing DB production
2. ‚úÖ –ö–æ–¥ –£–ñ–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª Landing DB (–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
3. ‚úÖ –Ø –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª 176 Express purchases –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
4. ‚úÖ Main DB –ø—É—Å—Ç–∞—è –∏ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ:
- **694 –ª–∏–¥–∞** –≤ Landing DB (–±—ã–ª–æ 692, +2 –Ω–æ–≤—ã—Ö –ø—Ä–∏—à–ª–æ!)
- **0 –ª–∏–¥–æ–≤** –≤ Main DB
- Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `LANDING_SUPABASE_URL` –≤–µ–∑–¥–µ

---

## üìà –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï –í–û–†–û–ù–ö–ò

### Production API Response:
```json
{
  "success": true,
  "stages": [
    {
      "id": "proftest",
      "metrics": { "proftest_leads": 454 }
    },
    {
      "id": "express",
      "metrics": { 
        "express_purchases": 177,
        "express_revenue": 885000
      },
      "conversionRate": 38.99
    },
    {
      "id": "main",
      "metrics": {
        "main_purchases": 0,
        "main_revenue": 0
      }
    }
  ],
  "totalRevenue": 885000,
  "roi": 0
}
```

**–ö–æ–Ω–≤–µ—Ä—Å–∏—è ProfTest ‚Üí Express: 38.99%** üî• (–æ—Ç–ª–∏—á–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å!)

---

## ‚úÖ –í–°–Å –°–¢–´–ö–£–ï–¢–°–Ø!

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (–≤–∏–∑—É–∞–ª—å–Ω–æ):

```
üåê –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ ProfTest
        ‚Üì
üìù POST /api/landing/submit
        ‚Üì
üíæ Landing DB ‚Üí landing_leads (INSERT)
        ‚Üì (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
üìß Email/SMS —Ä–∞—Å—Å—ã–ª–∫–∞
        ‚Üì (–∫–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç)
üí≥ Express Course –ø–æ–∫—É–ø–∫–∞
        ‚Üì
üìù Landing form –∏–ª–∏ AmoCRM webhook
        ‚Üì
üíæ Landing DB ‚Üí express_course_sales (INSERT —á–µ—Ä–µ–∑ webhook)
        ‚Üì
üìä GET /api/traffic-dashboard/funnel
        ‚Üì
üñ•Ô∏è –í–æ—Ä–æ–Ω–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã

üë§ –ê–¥–º–∏–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç /integrator/admin/leads
        ‚Üì
üì° GET /api/lead-tracking/leads
        ‚Üì
üíæ Landing DB ‚Üí landing_leads (SELECT)
        ‚Üì
üìã –í–∏–¥–∏—Ç –≤—Å–µ 694 –ª–∏–¥–∞
```

---

## üö® –ß–¢–û –û–°–¢–ê–õ–û–°–¨ –°–î–ï–õ–ê–¢–¨

### 1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å Facebook Ads –¥–∞–Ω–Ω—ã–µ (traffic_stats)

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ–π—á–∞—Å `spend_usd = 0`, –ø–æ—ç—Ç–æ–º—É –∫–æ–Ω–≤–µ—Ä—Å–∏—è "–ó–∞—Ç—Ä–∞—Ç—ã ‚Üí ProfTest" –Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ API:
```sql
INSERT INTO traffic_stats (team, date, spend_usd, impressions, clicks)
VALUES 
  ('kenesary', '2025-12-23', 500, 10000, 250),
  ('arystan', '2025-12-23', 300, 8000, 180),
  ('muha', '2025-12-23', 200, 5000, 120);
```

### 2. –î–æ–∂–¥–∞—Ç—å—Å—è –ø–µ—Ä–≤–æ–π –ø—Ä–æ–¥–∞–∂–∏ Integrator Flagman

–ö–æ–≥–¥–∞ –ø—Ä–∏–¥—ë—Ç —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫ `POST /webhook/amocrm/traffic`:
- `main_product_sales` –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è
- ROI –ø–æ—Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –í–æ—Ä–æ–Ω–∫–∞ –ø–æ–∫–∞–∂–µ—Ç –ø–æ–ª–Ω—ã–π –ø—É—Ç—å:
  - –ó–∞—Ç—Ä–∞—Ç—ã ‚Üí ProfTest ‚Üí Express ‚Üí Integrator Flagman

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å UTM —Å–≤—è–∑—å Express purchases

**–ü—Ä–æ–±–ª–µ–º–∞:** 141 –∏–∑ 176 Express purchases –±–µ–∑ utm_source (–ø—Ä–∏—à–ª–∏ —á–µ—Ä–µ–∑ email/sms).

**–†–µ—à–µ–Ω–∏–µ:** –°–≤—è–∑–∞—Ç—å –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É —Å –∏—Å—Ö–æ–¥–Ω—ã–º ProfTest –ª–∏–¥–æ–º:
```sql
UPDATE express_course_sales ecs
SET utm_source = ll.utm_source
FROM landing_leads ll
WHERE ecs.phone = ll.phone
  AND ecs.utm_source IS NULL
  AND ll.source LIKE 'proftest%';
```

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –û–¢–í–ï–¢ –ù–ê –¢–í–û–ô –í–û–ü–†–û–°

### –í–æ–ø—Ä–æ—Å: "–¢—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–Ω—ë—Å —Å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –º–Ω–µ –±–∞–∑—É –≤ –ª–µ–Ω–¥–∏–Ω–≥ –î–ë?"

**–û—Ç–≤–µ—Ç:** –ü–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –ù–ï –ù–£–ñ–ù–û –ë–´–õ–û! **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –£–ñ–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ Landing DB —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞!**

–Ø –æ–±–Ω–∞—Ä—É–∂–∏–ª —á—Ç–æ:
1. ‚úÖ –ö–æ–¥ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `LANDING_SUPABASE_URL`
2. ‚úÖ –í—Å–µ 694 –ª–∏–¥–∞ –£–ñ–ï –≤ Landing DB
3. ‚úÖ Main DB –ø—É—Å—Ç–∞—è (0 –ª–∏–¥–æ–≤) –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
4. ‚úÖ –ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ –∏–¥—É—Ç –≤ Landing DB –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –í–æ–ø—Ä–æ—Å: "–¢–µ–ø–µ—Ä—å –≤—Å–µ —É –º–µ–Ω—è —Ü–∏—Ñ—Ä—ã —Å—Ç—ã–∫—É—é—Ç—Å—è –∏ –≤—Å–µ –µ—Å—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏–∑ —ç—Ç–∞–ø–∞ –≤ —ç—Ç–∞–ø?"

**–û—Ç–≤–µ—Ç:** –î–ê, –ø–æ—á—Ç–∏ –≤—Å–µ! ‚úÖ

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ ProfTest ‚Üí Express: **38.99% –∫–æ–Ω–≤–µ—Ä—Å–∏—è** (454 ‚Üí 177)
- ‚úÖ –í—ã—Ä—É—á–∫–∞: 885,000 KZT
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–æ–º–∞–Ω–¥–∞–º

**–ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–∫–∞):**
- ‚ùå –ó–∞—Ç—Ä–∞—Ç—ã ‚Üí ProfTest: 0% (–Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ Facebook Ads –≤ `traffic_stats`)
- ‚ùå Express ‚Üí Integrator Flagman: 0% (–∂–¥–µ–º –ø–µ—Ä–≤—É—é –ø—Ä–æ–¥–∞–∂—É 490K)
- ‚ùå ROI: 0% (–Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ –∑–∞—Ç—Ä–∞—Ç–∞—Ö)

---

**–ò–¢–û–ì–û:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (Landing DB), –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å `traffic_stats` –¥–ª—è –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω—ã!
