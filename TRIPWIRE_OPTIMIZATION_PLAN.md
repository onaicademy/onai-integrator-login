# üöÄ TRIPWIRE - –ü–õ–ê–ù –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ü–õ–ê–¢–§–û–†–ú–´

## ‚úÖ –ü–†–û–í–ï–†–ï–ù–û:

### 1Ô∏è‚É£ **–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è (Achievements)**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `user_achievements` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ Backend API `/api/tripwire/unlock-achievement` —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Frontend –≤—ã–∑—ã–≤–∞–µ—Ç API –ø–æ—Å–ª–µ completion
- ‚úÖ Confetti –∞–Ω–∏–º–∞—Ü–∏—è –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- ‚úÖ –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–æ–¥—É–ª—è

### 2Ô∏è‚É£ **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (Certificates)**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–¥–∞—á–∞ –ø–æ—Å–ª–µ Module 18 (3)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `tripwire_user_profile.certificate_issued`
- ‚úÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ `tripwire_graduate` —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

### 3Ô∏è‚É£ **–í–∏–¥–µ–æ –¢—Ä–µ–∫–∏–Ω–≥ (80% –ø—Ä–∞–≤–∏–ª–æ)**
- ‚úÖ –°–µ–≥–º–µ–Ω—Ç–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–µ–∫—É–Ω–¥
- ‚úÖ –†–∞—Å—á—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ 80% –¥–ª—è completion
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `video_tracking` / `tripwire_progress`

---

## üî• –ü–†–û–ë–õ–ï–ú–´ (–û–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø):

1. **–î–∏–∫–æ –ª–∞–≥–∞–µ—Ç** - –º–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
2. **–í–∏—Å–Ω–µ—Ç** - —Ñ—Ä–∏–∑—ã –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
3. **–í–∏–¥–µ–æ –≥—Ä—É–∑–∏—Ç—Å—è –æ—á–µ–Ω—å –¥–æ–ª–≥–æ** - –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

---

## üéØ –ü–õ–ê–ù –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò:

### 1Ô∏è‚É£ **–í–ò–î–ï–û –ü–õ–ï–ï–† (–ö–†–ò–¢–ò–ß–ù–û)**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º
- –ù–µ—Ç preloading —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- –í–æ–∑–º–æ–∂–Ω–æ –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ = –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä

#### –†–µ—à–µ–Ω–∏–µ:
```typescript
// a) Lazy loading –≤–∏–¥–µ–æ
<video 
  preload="metadata"  // ‚úÖ –í–º–µ—Å—Ç–æ "auto"
  poster={thumbnailUrl}  // ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
/>

// b) Adaptive bitrate (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º Bunny Stream)
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HLS/DASH –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∫–∞—á–µ—Å—Ç–≤–∞

// c) –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Bunny Stream
// - Enable video compression
// - Use multiple resolutions (360p, 480p, 720p, 1080p)
// - Enable adaptive streaming
```

#### –ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
**File:** `src/pages/tripwire/TripwireLesson.tsx`

```diff
<video
  ref={videoRef}
  src={currentLesson?.video_url}
  className="w-full rounded-xl"
- preload="auto"
+ preload="metadata"
+ poster={currentLesson?.thumbnail_url}
  onTimeUpdate={handleTimeUpdate}
  onPlay={handlePlay}
  onPause={handlePause}
  onSeeking={handleSeeking}
  onLoadedMetadata={handleLoadedMetadata}
/>
```

---

### 2Ô∏è‚É£ **REACT –†–ï–†–ï–ù–î–ï–†–´ (–í–ê–ñ–ù–û)**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –ú–Ω–æ–≥–æ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- Inline —Ñ—É–Ω–∫—Ü–∏–∏ –≤ JSX
- –ù–µ—Ç –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ —Ç—è–∂—ë–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

#### –†–µ—à–µ–Ω–∏–µ:

**a) –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**
```typescript
import { memo, useMemo, useCallback } from 'react';

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–æ–≤
export const ModuleCard = memo(({ module }) => {
  // ...
});

// –í—ã—á–∏—Å–ª–µ–Ω–∏—è
const sortedModules = useMemo(() => {
  return modules.sort((a, b) => a.id - b.id);
}, [modules]);

// –ö–æ–ª–ª–±—ç–∫–∏
const handleClick = useCallback(() => {
  navigate(`/tripwire/lesson/${lessonId}`);
}, [lessonId, navigate]);
```

**b) –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤ (–µ—Å–ª–∏ –º–Ω–æ–≥–æ —É—Ä–æ–∫–æ–≤):**
```typescript
import { FixedSizeList } from 'react-window';

// –î–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤ —É—Ä–æ–∫–æ–≤
<FixedSizeList
  height={600}
  itemCount={lessons.length}
  itemSize={100}
>
  {({ index, style }) => (
    <div style={style}>
      <LessonCard lesson={lessons[index]} />
    </div>
  )}
</FixedSizeList>
```

---

### 3Ô∏è‚É£ **API –ó–ê–ü–†–û–°–´ (–í–ê–ñ–ù–û)**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- Waterfall –∑–∞–ø—Ä–æ—Å—ã (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ)

#### –†–µ—à–µ–Ω–∏–µ:

**a) React Query –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:**
```typescript
import { useQuery } from '@tanstack/react-query';

const { data: modules } = useQuery({
  queryKey: ['modules', userId],
  queryFn: () => api.get('/api/tripwire/modules'),
  staleTime: 5 * 60 * 1000, // 5 –º–∏–Ω—É—Ç –∫—ç—à
  cacheTime: 10 * 60 * 1000, // 10 –º–∏–Ω—É—Ç –≤ –ø–∞–º—è—Ç–∏
});
```

**b) Batch API –∑–∞–ø—Ä–æ—Å—ã:**
```typescript
// ‚ùå –ü–õ–û–•–û: 3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞
const modules = await api.get('/api/tripwire/modules');
const progress = await api.get('/api/tripwire/progress');
const achievements = await api.get('/api/tripwire/achievements');

// ‚úÖ –•–û–†–û–®–û: 1 –±–∞—Ç—á –∑–∞–ø—Ä–æ—Å
const data = await api.post('/api/tripwire/batch', {
  queries: ['modules', 'progress', 'achievements']
});
```

**c) –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**
```typescript
// ‚ùå –ü–õ–û–•–û: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
const modules = await api.get('/api/tripwire/modules');
const progress = await api.get('/api/tripwire/progress');

// ‚úÖ –•–û–†–û–®–û: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
const [modules, progress] = await Promise.all([
  api.get('/api/tripwire/modules'),
  api.get('/api/tripwire/progress')
]);
```

---

### 4Ô∏è‚É£ **BUNDLE SIZE (–í–ê–ñ–ù–û)**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞ = –º–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—Ä–∞–∑—É

#### –†–µ—à–µ–Ω–∏–µ:

**a) Code Splitting:**
```typescript
import { lazy, Suspense } from 'react';

// ‚ùå –ü–õ–û–•–û
import TripwireLesson from './pages/tripwire/TripwireLesson';

// ‚úÖ –•–û–†–û–®–û
const TripwireLesson = lazy(() => import('./pages/tripwire/TripwireLesson'));

// –í Router:
<Route path="/tripwire/lesson/:id" element={
  <Suspense fallback={<Loader />}>
    <TripwireLesson />
  </Suspense>
} />
```

**b) –ê–Ω–∞–ª–∏–∑ bundle size:**
```bash
npm run build
npx vite-bundle-visualizer
```

---

### 5Ô∏è‚É£ **IMAGES & ASSETS (–í–ê–ñ–ù–û)**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –ë–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ù–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ —Å—Ä–∞–∑—É

#### –†–µ—à–µ–Ω–∏–µ:

**a) Lazy loading –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
```typescript
<img 
  src={imageUrl} 
  loading="lazy"  // ‚úÖ Native lazy loading
  decoding="async"  // ‚úÖ Async –¥–µ–∫–æ–¥–∏–Ω–≥
/>
```

**b) Modern formats (WebP, AVIF):**
```typescript
<picture>
  <source srcSet={`${imageUrl}.avif`} type="image/avif" />
  <source srcSet={`${imageUrl}.webp`} type="image/webp" />
  <img src={`${imageUrl}.jpg`} alt="..." />
</picture>
```

---

### 6Ô∏è‚É£ **DATABASE OPTIMIZATION (BACKEND)**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- N+1 –∑–∞–ø—Ä–æ—Å—ã
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ JOIN
- –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤

#### –†–µ—à–µ–Ω–∏–µ:

**a) –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã:**
```sql
-- –î–ª—è video_tracking
CREATE INDEX idx_video_tracking_user_lesson 
ON video_tracking(user_id, lesson_id);

-- –î–ª—è user_achievements
CREATE INDEX idx_user_achievements_user_completed 
ON user_achievements(user_id, is_completed);

-- –î–ª—è module_unlocks
CREATE INDEX idx_module_unlocks_user 
ON module_unlocks(user_id, module_id);
```

**b) –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:**
```typescript
// ‚ùå –ü–õ–û–•–û: N+1
for (const lesson of lessons) {
  const progress = await db.query('SELECT * FROM video_tracking WHERE lesson_id = $1', [lesson.id]);
}

// ‚úÖ –•–û–†–û–®–û: 1 –∑–∞–ø—Ä–æ—Å
const progress = await db.query(`
  SELECT * FROM video_tracking 
  WHERE lesson_id = ANY($1)
`, [lessonIds]);
```

---

## üìä –ü–†–ò–û–†–ò–¢–ï–¢–´:

### üî¥ –ö–†–ò–¢–ò–ß–ù–û (–î–ï–õ–ê–ï–ú –°–ï–ô–ß–ê–°):
1. ‚úÖ –í–∏–¥–µ–æ preload="metadata"
2. ‚úÖ React.memo –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. ‚úÖ Lazy loading —Å—Ç—Ä–∞–Ω–∏—Ü
4. ‚úÖ API –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### üü° –í–ê–ñ–ù–û (–ü–û–¢–û–ú):
5. Batch API –∑–∞–ø—Ä–æ—Å—ã
6. Database –∏–Ω–¥–µ–∫—Å—ã
7. Image optimization

### üü¢ –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢:
8. –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤ (–µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ > 50 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
9. Service Worker –¥–ª—è offline
10. CDN –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏

---

## üöÄ –ù–ê–ß–ò–ù–ê–ï–ú –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Æ!

**–ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π:**
1. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ –ø–ª–µ–µ—Ä–∞
2. ‚úÖ React.memo –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. ‚úÖ Lazy loading —Ä–æ—É—Ç–æ–≤
4. ‚úÖ API –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

---

**–î–ê–¢–ê:** 2025-12-07  
**–°–¢–ê–¢–£–°:** üöÄ –ù–ê–ß–ò–ù–ê–ï–ú –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Æ
