# üß™ –ü–õ–ê–ù –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ü–†–û–§–¢–ï–°–¢ - –ü–û–õ–ù–ê–Ø –í–û–†–û–ù–ö–ê

## üìã –¶–ï–õ–¨ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å—é –≤–æ—Ä–æ–Ω–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç –≤—Ö–æ–¥–∞ –Ω–∞ –ø—Ä–æ—Ñ—Ç–µ—Å—Ç –¥–æ –∫–ª–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ –≤ email/SMS —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π.

---

## üéØ USER JOURNEY (–ü—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ñ—Ç–µ—Å—Ç–∞
   ‚Üì
2. –ü—Ä–æ—Ö–æ–¥–∏—Ç 10 –≤–æ–ø—Ä–æ—Å–æ–≤ —Ç–µ—Å—Ç–∞
   ‚Üì
3. –í–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —Ñ–æ—Ä–º—É –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è (–∏–º—è, email, —Ç–µ–ª–µ—Ñ–æ–Ω)
   ‚Üì
4. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç
   ‚Üì
5. [BACKEND] –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Supabase (landing_leads)
   ‚Üì
6. [BACKEND] –õ–∏–¥ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ AmoCRM
   ‚Üì
7. [BACKEND] –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç (scheduled_notifications)
   ‚Üì
8. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç "–î–∞–Ω–Ω—ã–µ –ø—Ä–∏–Ω—è—Ç—ã, –æ–∂–∏–¥–∞–π—Ç–µ SMS"
   ‚Üì
9. [–ß–ï–†–ï–ó 10 –ú–ò–ù–£–¢] –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Email —Å –∫—Ä–∞—Å–∏–≤—ã–º —à–∞–±–ª–æ–Ω–æ–º
   ‚Üì
10. [–ß–ï–†–ï–ó 10 –ú–ò–ù–£–¢] –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è SMS —Å tracking —Å—Å—ã–ª–∫–æ–π
   ‚Üì
11. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç Email –∏ SMS
   ‚Üì
12. [EMAIL –ö–õ–ò–ö] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫—É –≤ –ø–∏—Å—å–º–µ
   ‚Üì
13. [TRACKING] –§–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –∫–ª–∏–∫ –ø–æ email (email_clicked: true)
   ‚Üì
14. [REDIRECT] –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ https://onai.academy/integrator/expresscourse
   ‚Üì
15. [SMS –ö–õ–ò–ö] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ —Å—Å—ã–ª–∫—É –≤ SMS
   ‚Üì
16. [TRACKING] –§–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –∫–ª–∏–∫ –ø–æ SMS (sms_clicked: true)
   ‚Üì
17. [REDIRECT] –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ https://onai.academy/integrator/expresscourse
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –≠–¢–ê–ü 1: –í—Ö–æ–¥ –Ω–∞ –ø—Ä–æ—Ñ—Ç–µ—Å—Ç
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ—Ç–µ—Å—Ç–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è: https://onai.academy/proftest/kenesary
- [ ] Facebook Pixel –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [ ] UTM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- [ ] –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (10 –≤–æ–ø—Ä–æ—Å–æ–≤)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
https://onai.academy/proftest/kenesary

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Facebook Pixel –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
```

---

### –≠–¢–ê–ü 2: –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞
- [ ] –í—Å–µ 10 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- [ ] –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –æ—Ç–≤–µ—Ç—ã
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ü—Ä–æ–π—Ç–∏ –≤–µ—Å—å —Ç–µ—Å—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–æ—Ä–º–∞ –ø–æ—è–≤–∏–ª–∞—Å—å

---

### –≠–¢–ê–ü 3: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
- [ ] –§–æ—Ä–º–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª—è: –∏–º—è, email, —Ç–µ–ª–µ—Ñ–æ–Ω
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ö–Ω–æ–ø–∫–∞ "–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã" –∞–∫—Ç–∏–≤–Ω–∞

**–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
–ò–º—è: –¢–µ—Å—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
Email: test-proftest@gmail.com  (–∏–ª–∏ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π)
–¢–µ–ª–µ—Ñ–æ–Ω: +7 (777) 123-45-67
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É
- –ù–∞–∂–∞—Ç—å "–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"

---

### –≠–¢–ê–ü 4: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:**
1. POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/landing/proftest`
2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `landing_leads` —Ç–∞–±–ª–∏—Ü—É
3. –û—Ç–≤–µ—Ç: `{ success: true, leadId: "uuid" }`
4. –ü–æ–∫–∞–∑ success modal "–î–∞–Ω–Ω—ã–µ –ø—Ä–∏–Ω—è—Ç—ã"

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Supabase (landing DB)
SELECT 
  id,
  name,
  email,
  phone,
  source,
  metadata->>'campaignSlug' as campaign,
  created_at
FROM landing_leads
ORDER BY created_at DESC
LIMIT 1;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å —Å –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ `source` = "proftest_kenesary"
- ‚úÖ `metadata` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
ssh onai-backend "pm2 logs onai-backend --lines 50 | grep proftest"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üìù Processing proftest lead submission: { name: '–¢–µ—Å—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', email: 'test***', ... }
‚úÖ Lead saved to Supabase: {leadId}
```

---

### –≠–¢–ê–ü 5: –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–¥–∞ –≤ AmoCRM

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:**
1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –≤ AmoCRM
2. –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –≤ –≤–æ—Ä–æ–Ω–∫–µ "–ó–ê–Ø–í–ö–ê_–°_–ü–†–û–§–¢–ï–°–¢–ê"
3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è —Å –æ—Ç–≤–µ—Ç–∞–º–∏ –Ω–∞ –ø—Ä–æ—Ñ—Ç–µ—Å—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
ssh onai-backend "pm2 logs onai-backend --lines 50 | grep -A5 'AmoCRM'"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚ú® Creating new lead in stage: –ó–ê–Ø–í–ö–ê_–°_–ü–†–û–§–¢–ï–°–¢–ê
üÜï Creating new contact for: –¢–µ—Å—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
‚úÖ Lead created: ID {amocrmLeadId}
‚úÖ AmoCRM: Lead created (ID: {amocrmLeadId}, isNew: true)
‚úÖ Database updated with AmoCRM ID
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ AmoCRM:**
- –û—Ç–∫—Ä—ã—Ç—å https://onaiagencykz.amocrm.ru
- –ù–∞–π—Ç–∏ –ª–∏–¥–∞ –ø–æ –∏–º–µ–Ω–∏ "–¢–µ—Å—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–¥–µ–ª–∫–∞ –≤ –Ω—É–∂–Ω–æ–π –≤–æ—Ä–æ–Ω–∫–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ —Å –æ—Ç–≤–µ—Ç–∞–º–∏

---

### –≠–¢–ê–ü 6: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ notifications

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:**
1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `scheduled_notifications` —Ç–∞–±–ª–∏—Ü–µ
2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `unified_lead_tracking` —Ç–∞–±–ª–∏—Ü–µ
3. –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –Ω–∞ 10 –º–∏–Ω—É—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
ssh onai-backend "pm2 logs onai-backend --lines 50 | grep -A10 'SCHEDULING'"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚è∞ SCHEDULING NOTIFICATIONS for –¢–µ—Å—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
 üìß Email: test-proftest@gmail.com
 üì± SMS: +7 (777) 123-45-67
 ‚è≥ Delay: 10 minutes
 üîó Lead ID: {leadId}

üìù [Lead {leadId}] Creating in unified_lead_tracking...
‚úÖ [Lead {leadId}] Added to unified_lead_tracking
üíæ [Lead {leadId}] Saved to DB (scheduled_notifications)
‚úÖ Scheduled + saved to DB
‚úÖ Notifications scheduled
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å scheduled_notifications
SELECT 
  id,
  lead_id,
  notification_type,
  recipient_email,
  recipient_phone,
  scheduled_for,
  status,
  created_at
FROM scheduled_notifications
WHERE recipient_email = 'test-proftest@gmail.com'
ORDER BY created_at DESC
LIMIT 1;
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ `status` = 'pending'
- ‚úÖ `notification_type` = 'both'
- ‚úÖ `scheduled_for` = —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è + 10 –º–∏–Ω—É—Ç

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å unified_lead_tracking
SELECT 
  id,
  full_name,
  email,
  phone,
  source,
  source_campaign,
  source_lead_id,
  email_sent,
  sms_sent,
  created_at
FROM unified_lead_tracking
WHERE email = 'test-proftest@gmail.com'
ORDER BY created_at DESC
LIMIT 1;
```

---

### –≠–¢–ê–ü 7: –û—Ç–ø—Ä–∞–≤–∫–∞ Email (—á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç)

**‚è∞ –ñ–î–ï–ú 10 –ú–ò–ù–£–¢**

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:**
1. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ scheduled task
2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –∏–∑ –∫—Ä–∞—Å–∏–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞
3. –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Resend API
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –ë–î

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ (—á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç):**
```bash
ssh onai-backend "pm2 logs onai-backend --lines 100 | grep -A15 'Executing scheduled notification'"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üöÄ [Lead {leadId}] Executing scheduled notification...

üìù [Lead {leadId}] Creating in unified_lead_tracking...
‚úÖ [Lead {leadId}] Added to unified_lead_tracking

üìß [Lead {leadId}] Sending Email to test-proftest@gmail.com...
‚úÖ [Lead {leadId}] Email sent successfully (ID: {resendEmailId})
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Resend –ø–∞–Ω–µ–ª–∏:**
- –û—Ç–∫—Ä—ã—Ç—å https://resend.com/emails
- –ù–∞–π—Ç–∏ –ø–∏—Å—å–º–æ –Ω–∞ `test-proftest@gmail.com`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å: **Delivered**

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ø–æ—á—Ç–µ:**
- –û—Ç–∫—Ä—ã—Ç—å `test-proftest@gmail.com`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å inbox –∏ —Å–ø–∞–º
- –ü–∏—Å—å–º–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å –∫—Ä–∞—Å–∏–≤—ã–º –¥–∏–∑–∞–π–Ω–æ–º OnAI Academy
- –ö–Ω–æ–ø–∫–∞ "–ü–û–õ–£–ß–ò–¢–¨ –ü–†–û–î–£–ö–¢ ‚Üí"

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–∏—Å—å–º–∞:**
- [ ] –õ–æ–≥–æ—Ç–∏–ø OnAI Academy –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] –ó–µ–ª–µ–Ω—ã–π —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Ü–≤–µ—Ç (#00FF94)
- [ ] –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "–ü—Ä–∏–≤–µ—Ç, –¢–µ—Å—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å!"
- [ ] –¢—Ä–∏ –±–ª–æ–∫–∞ —Å –≥–∞–ª–æ—á–∫–∞–º–∏
- [ ] –ó–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–ü–û–õ–£–ß–ò–¢–¨ –ü–†–û–î–£–ö–¢ ‚Üí"
- [ ] –°—Å—ã–ª–∫–∞: `https://api.onai.academy/api/landing/track/{leadId}?source=email`

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
SELECT 
  id,
  email,
  email_sent,
  email_sent_at,
  email_clicked,
  email_clicked_at
FROM landing_leads
WHERE email = 'test-proftest@gmail.com'
ORDER BY created_at DESC
LIMIT 1;
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ `email_sent` = true
- ‚úÖ `email_sent_at` = timestamp
- ‚úÖ `email_clicked` = null (–ø–æ–∫–∞ –Ω–µ –∫–ª–∏–∫–Ω—É–ª–∏)

---

### –≠–¢–ê–ü 8: –û—Ç–ø—Ä–∞–≤–∫–∞ SMS (—á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç)

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:**
1. –û—Ç–ø—Ä–∞–≤–∫–∞ SMS —á–µ—Ä–µ–∑ Mobizon API
2. –¢–µ–∫—Å—Ç: "–¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω. –í–∞—à–∞ —Å—Å—ã–ª–∫–∞ https://api.onai.academy/api/landing/track/{leadId}?source=sms"
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –ë–î

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
ssh onai-backend "pm2 logs onai-backend --lines 100 | grep -A5 'Sending SMS'"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üì± [Lead {leadId}] Sending SMS to +7 (777) 123-45-67...
üì± Sending SMS via Mobizon: { recipient: '777***', textLength: 71 }
‚úÖ SMS sent successfully via Mobizon
‚úÖ [Lead {leadId}] SMS sent successfully
‚úÖ [Lead {leadId}] DB status ‚Üí sent
‚úÖ [Lead {leadId}] Notification completed successfully
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:**
- SMS –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏–π—Ç–∏ –Ω–∞ +7 (777) 123-45-67
- –¢–µ–∫—Å—Ç: "–¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω. –í–∞—à–∞ —Å—Å—ã–ª–∫–∞ https://api.onai.academy/api/landing/track/{leadId}?source=sms"

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
SELECT 
  id,
  phone,
  sms_sent,
  sms_sent_at,
  sms_clicked,
  sms_clicked_at
FROM landing_leads
WHERE phone LIKE '%777%123%'
ORDER BY created_at DESC
LIMIT 1;
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ `sms_sent` = true
- ‚úÖ `sms_sent_at` = timestamp
- ‚úÖ `sms_clicked` = null (–ø–æ–∫–∞ –Ω–µ –∫–ª–∏–∫–Ω—É–ª–∏)

---

### –≠–¢–ê–ü 9: –ö–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ –≤ Email

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –û—Ç–∫—Ä—ã—Ç—å email –ø–∏—Å—å–º–æ
2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü–û–õ–£–ß–ò–¢–¨ –ü–†–û–î–£–ö–¢ ‚Üí"

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:**
1. GET –∑–∞–ø—Ä–æ—Å: `https://api.onai.academy/api/landing/track/{leadId}?source=email`
2. Backend —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∫–ª–∏–∫ –≤ –ë–î
3. –†–µ–¥–∏—Ä–µ–∫—Ç 302 ‚Üí `https://onai.academy/integrator/expresscourse?utm_source=email&utm_campaign=proftest&lead_id={leadId}`
4. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ExpressCourse

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
ssh onai-backend "pm2 logs onai-backend --lines 50 | grep -A5 'Click tracked'"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
GET /api/landing/track/{leadId}?source=email
üìä Click tracked: Lead {leadId}, Source: email
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
SELECT 
  id,
  email,
  email_clicked,
  email_clicked_at,
  click_count
FROM landing_leads
WHERE id = '{leadId}';
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ `email_clicked` = true
- ‚úÖ `email_clicked_at` = timestamp –∫–ª–∏–∫–∞
- ‚úÖ `click_count` = 1 (–∏–ª–∏ –±–æ–ª—å—à–µ)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞:**
- [ ] –û—Ç–∫—Ä—ã–ª–∞—Å—å —Å—Ç—Ä–∞–Ω–∏—Ü–∞ https://onai.academy/integrator/expresscourse
- [ ] –í URL –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `utm_source=email&utm_campaign=proftest&lead_id={leadId}`

---

### –≠–¢–ê–ü 10: –ö–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ –≤ SMS

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –û—Ç–∫—Ä—ã—Ç—å SMS –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Å—Å—ã–ª–∫—É

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:**
1. GET –∑–∞–ø—Ä–æ—Å: `https://api.onai.academy/api/landing/track/{leadId}?source=sms`
2. Backend —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∫–ª–∏–∫ –≤ –ë–î
3. –†–µ–¥–∏—Ä–µ–∫—Ç 302 ‚Üí `https://onai.academy/integrator/expresscourse?utm_source=sms&utm_campaign=proftest&lead_id={leadId}`
4. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ExpressCourse

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
ssh onai-backend "pm2 logs onai-backend --lines 50 | grep -A5 'Click tracked'"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
GET /api/landing/track/{leadId}?source=sms
üìä Click tracked: Lead {leadId}, Source: sms
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
SELECT 
  id,
  phone,
  sms_clicked,
  sms_clicked_at,
  click_count
FROM landing_leads
WHERE id = '{leadId}';
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ `sms_clicked` = true
- ‚úÖ `sms_clicked_at` = timestamp –∫–ª–∏–∫–∞
- ‚úÖ `click_count` = 2 (–µ—Å–ª–∏ —É–∂–µ –∫–ª–∏–∫–∞–ª–∏ –ø–æ email)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞:**
- [ ] –û—Ç–∫—Ä—ã–ª–∞—Å—å —Å—Ç—Ä–∞–Ω–∏—Ü–∞ https://onai.academy/integrator/expresscourse
- [ ] –í URL –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `utm_source=sms&utm_campaign=proftest&lead_id={leadId}`

---

## üìä –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –í–°–ï–ô –í–û–†–û–ù–ö–ò

### –ó–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
```sql
SELECT 
  l.id,
  l.name,
  l.email,
  l.phone,
  l.source,
  l.created_at,
  l.amocrm_lead_id,
  l.email_sent,
  l.email_sent_at,
  l.email_clicked,
  l.email_clicked_at,
  l.sms_sent,
  l.sms_sent_at,
  l.sms_clicked,
  l.sms_clicked_at,
  l.click_count,
  sn.status as notification_status,
  sn.scheduled_for,
  sn.sent_at
FROM landing_leads l
LEFT JOIN scheduled_notifications sn ON sn.lead_id = l.id
WHERE l.email = 'test-proftest@gmail.com'
ORDER BY l.created_at DESC
LIMIT 1;
```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –í–°–ï–ô –≤–æ—Ä–æ–Ω–∫–∏:

| –≠—Ç–∞–ø | –ü–æ–ª–µ | –û–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------|-------------------|
| 1. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã | `created_at` | timestamp |
| 2. AmoCRM | `amocrm_lead_id` | —á–∏—Å–ª–æ (ID —Å–¥–µ–ª–∫–∏) |
| 3. Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω | `email_sent` | true |
| 4. Email timestamp | `email_sent_at` | timestamp |
| 5. SMS –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ | `sms_sent` | true |
| 6. SMS timestamp | `sms_sent_at` | timestamp |
| 7. –ö–ª–∏–∫ –ø–æ email | `email_clicked` | true |
| 8. Email –∫–ª–∏–∫ time | `email_clicked_at` | timestamp |
| 9. –ö–ª–∏–∫ –ø–æ SMS | `sms_clicked` | true |
| 10. SMS –∫–ª–∏–∫ time | `sms_clicked_at` | timestamp |
| 11. –í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤ | `click_count` | 2 |
| 12. –°—Ç–∞—Ç—É—Å notification | `notification_status` | 'sent' |

---

## üîç –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Email –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- Resend –ø–∞–Ω–µ–ª—å: https://resend.com/emails
- –õ–æ–≥–∏ backend: `pm2 logs onai-backend`
- –°–ø–∞–º –ø–∞–ø–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RESEND_API_KEY
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ scheduled task –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è

### –ü—Ä–æ–±–ª–µ–º–∞ 2: SMS –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –õ–æ–≥–∏ backend: `pm2 logs onai-backend | grep Mobizon`
- –ë–∞–ª–∞–Ω—Å Mobizon API

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å MOBIZON_API_KEY
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Tracking –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- Endpoint `/api/landing/track/:leadId` –¥–æ—Å—Ç—É–ø–µ–Ω
- –õ–æ–≥–∏: `pm2 logs onai-backend | grep 'Click tracked'`
- –ë–î –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ leadId –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞ 4: AmoCRM –ª–∏–¥ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- AMOCRM_ACCESS_TOKEN –∞–∫—Ç—É–∞–ª–µ–Ω
- –õ–æ–≥–∏: `pm2 logs onai-backend | grep AmoCRM`

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω AmoCRM
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–®–ù–û–ì–û –ü–†–û–•–û–ñ–î–ï–ù–ò–Ø –¢–ï–°–¢–ê

- [x] –§–æ—Ä–º–∞ –ø—Ä–æ—Ñ—Ç–µ—Å—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Supabase
- [x] –õ–∏–¥ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ AmoCRM
- [x] Scheduled notification –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è
- [x] Email –ø—Ä–∏—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç —Å –∫—Ä–∞—Å–∏–≤—ã–º —à–∞–±–ª–æ–Ω–æ–º
- [x] SMS –ø—Ä–∏—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç —Å tracking —Å—Å—ã–ª–∫–æ–π
- [x] –ö–ª–∏–∫ –ø–æ email —Å—Å—ã–ª–∫–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è
- [x] –ö–ª–∏–∫ –ø–æ SMS —Å—Å—ã–ª–∫–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è
- [x] –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –í—Å–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ –ë–î

---

## üìù –¢–ï–°–¢–û–í–´–ï –î–ê–ù–ù–´–ï

```javascript
{
  "name": "–¢–µ—Å—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
  "email": "test-proftest@gmail.com",
  "phone": "+7 (777) 123-45-67",
  "campaignSlug": "kenesary",
  "answers": [0,1,2,0,1,2,0,1,2,0] // –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
}
```

---

## üéØ –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç:

```typescript
// backend/scripts/test-proftest-funnel.ts
async function testProftestFunnel() {
  // 1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ—Ç–µ—Å—Ç–∞
  // 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –≤ –ë–î
  // 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å scheduled notification
  // 4. –ü–æ–¥–æ–∂–¥–∞—Ç—å 10 –º–∏–Ω—É—Ç (–∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å delay –Ω–∞ 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Ç–µ—Å—Ç–∞)
  // 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email/SMS
  // 6. –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–∫–∏
  // 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
}
```

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 14 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é  
**–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞**: ~15 –º–∏–Ω—É—Ç (10 –º–∏–Ω—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è + 5 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫)
