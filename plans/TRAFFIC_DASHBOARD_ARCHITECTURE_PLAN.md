# Traffic Dashboard - –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π

## üìã –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º—ã

–•–æ—Ç—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ, —Å–∏—Å—Ç–µ–º–∞ **–ù–ï –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É** –∏–∑-–∑–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. ‚ùå **AuthManager ReferenceError** - `AuthManager` –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ `TrafficTeamConstructor.tsx`
2. ‚ùå **4 –∫–æ–º–∞–Ω–¥—ã –≤ –ë–î** - —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ (Arystan, Kenesary, Muha, Traf4) –Ω—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å
3. ‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã** - `sales_activity_log`, `lead_tracking` –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
4. ‚ùå **403 Forbidden** - JWT token malformed –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–∞–Ω–¥
5. ‚ùå **Attribution –ø—É—Å—Ç–æ–π** - –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ AmoCRM
6. ‚ùå **–ù–µ—Ç –≥–ª–∞–≤–Ω–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞** - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º
7. ‚ùå **–†–∞–∑–¥–µ–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω** - –Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Facebook Ads
8. ‚ùå **–ù–µ—Ç —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–æ–≥–æ site bar** - –Ω–µ—Ç Admin Panel –≤ –º–µ–Ω—é

---

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. UTM-–∞—Ç—Ä–∏–±—É—Ü–∏—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AmoCRM

#### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã `express_course_sales` (166 –∑–∞–ø–∏—Å–µ–π) –∏ `main_product_sales` (12 –∑–∞–ø–∏—Å–µ–π) —Å—É—â–µ—Å—Ç–≤—É—é—Ç
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `all_sales_tracking` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (0 –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `traffic_stats` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (17 –∑–∞–ø–∏—Å–µ–π)
- ‚ùå –¢–∞–±–ª–∏—Ü—ã `sales_activity_log`, `lead_tracking` –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
- ‚ùå –ù–µ—Ç –ª–æ–≥–∏–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ AmoCRM

#### –¢—Ä–µ–±—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```mermaid
graph TD
    A[AmoCRM Webhook] --> B[Express Sales]
    A --> C[Main Product Sales]
    B --> D[all_sales_tracking]
    C --> D
    D --> E[UTM Attribution Engine]
    E --> F[traffic_stats]
    F --> G[Traffic Dashboard]
    
    style A fill:#ff6b6b
    style D fill:#4ecdc4
    style E fill:#ffe66d
    style G fill:#95e1d3
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **Webhook Handler** (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ backend):
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç webhooks –æ—Ç AmoCRM
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `express_course_sales` –∏ `main_product_sales`

2. **Sales Aggregator** (–ù–û–í–´–ô):
   - –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `express_course_sales` –∏ `main_product_sales`
   - –ó–∞–ø–æ–ª–Ω—è–µ—Ç `all_sales_tracking`
   - –î–æ–±–∞–≤–ª—è–µ—Ç UTM-–º–µ—Ç–∫–∏ –∏–∑ `landing_leads`

3. **UTM Attribution Engine** (–ù–û–í–´–ô):
   - –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç `utm_source` —Å –∫–æ–º–∞–Ω–¥–∞–º–∏
   - –§–æ—Ä–º–∞—Ç: `fb_teamname` ‚Üí –∫–æ–º–∞–Ω–¥–∞ `teamname`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª–µ `team` –≤ `traffic_stats`

4. **Traffic Stats Calculator** (–ù–û–í–´–ô):
   - –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –¥–Ω—è–º/–∫–æ–º–∞–Ω–¥–∞–º
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç ROI, CPA, ROAS
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `traffic_stats`

**–¢—Ä–µ–±—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**

```sql
-- sales_activity_log - –õ–æ–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–∞–∂
CREATE TABLE sales_activity_log (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  sale_id UUID REFERENCES all_sales_tracking(id),
  action_type TEXT NOT NULL, -- 'created', 'updated', 'attributed'
  team_name TEXT,
  user_id UUID REFERENCES traffic_users(id),
  metadata JSONB DEFAULT '{}',
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- lead_tracking - –¢—Ä–µ–∫–∏–Ω–≥ –ª–∏–¥–æ–≤ –ø–æ UTM
CREATE TABLE lead_tracking (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  lead_id UUID REFERENCES landing_leads(id),
  utm_source TEXT,
  utm_medium TEXT,
  utm_campaign TEXT,
  utm_content TEXT,
  utm_term TEXT,
  team_name TEXT,
  attributed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 2. Facebook Ads Integration

#### –¢—Ä–µ–±—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```mermaid
graph LR
    A[Traffic Targetologist] --> B[Settings Panel]
    B --> C[Connect Facebook Account]
    C --> D[OAuth Flow]
    D --> E[Store Access Token]
    E --> F[Fetch Ad Accounts]
    F --> G[Select Accounts to Track]
    G --> H[Sync Campaign Stats]
    H --> I[traffic_stats]
    
    style B fill:#4ecdc4
    style D fill:#ffe66d
    style I fill:#95e1d3
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **Facebook OAuth Handler** (–ù–û–í–´–ô):
   - OAuth flow –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
   - –•—Ä–∞–Ω–µ–Ω–∏–µ access token –≤ `traffic_targetologist_settings.fb_access_token`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

2. **Ad Account Fetcher** (–ù–û–í–´–ô):
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Facebook Marketing API
   - –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ `traffic_targetologist_settings.fb_ad_accounts`

3. **Campaign Stats Sync** (–ù–û–í–´–ô):
   - –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–º–ø–∞–Ω–∏–π
   - –ó–∞–ø–∏—Å—å –≤ `traffic_stats`
   - –ê—Ç—Ä–∏–±—É—Ç–∞—Ü–∏—è –ø–æ UTM source

**API Endpoints:**

```typescript
// Facebook OAuth
POST /api/traffic-admin/facebook/oauth-url
GET /api/traffic-admin/facebook/callback
POST /api/traffic-admin/facebook/disconnect

// Ad Accounts
GET /api/traffic-admin/facebook/ad-accounts
POST /api/traffic-admin/facebook/ad-accounts/select

// Campaign Stats
POST /api/traffic-admin/facebook/sync-stats
GET /api/traffic-admin/facebook/campaign-stats
```

### 3. –ì–ª–∞–≤–Ω—ã–π Dashboard —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π

#### –¢—Ä–µ–±—É–µ–º—ã–π UI:

```mermaid
graph TB
    A[Main Dashboard] --> B[Overview Cards]
    A --> C[Team Comparison]
    A --> D[Sales Funnel]
    A --> E[ROI Analysis]
    A --> F[Time Series Charts]
    
    B --> B1[Total Revenue]
    B --> B2[Total Spend]
    B --> B3[Total ROI]
    B --> B4[Total Sales]
    
    C --> C1[Team Table]
    C --> C2[Team Cards]
    
    D --> D1[Leads ‚Üí Registrations ‚Üí Sales]
    
    E --> E1[ROI by Team]
    E --> E2[ROI by Campaign]
    E --> E3[ROI by Day]
    
    F --> F1[Revenue Chart]
    F --> F2[Spend Chart]
    F --> F3[ROI Chart]
    
    style A fill:#4ecdc4
    style D fill:#ffe66d
    style E fill:#ff6b6b
```

**–ú–µ—Ç—Ä–∏–∫–∏:**

1. **Overview Cards:**
   - Total Revenue (KZT/USD)
   - Total Spend (KZT/USD)
   - Total ROI (%)
   - Total Sales (Express + Flagman)

2. **Team Comparison:**
   - –¢–∞–±–ª–∏—Ü–∞ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø–æ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥–µ
   - –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ª—é–±–æ–º—É —Å—Ç–æ–ª–±—Ü—É

3. **Sales Funnel:**
   - Leads (–∏–∑ `landing_leads`)
   - Registrations (–∏–∑ `traffic_stats.registrations`)
   - Express Sales (–∏–∑ `traffic_stats.express_sales`)
   - Flagman Sales (–∏–∑ `traffic_stats.main_sales`)
   - –ö–æ–Ω–≤–µ—Ä—Å–∏–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

4. **ROI Analysis:**
   - ROI –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
   - ROI –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º
   - ROI –ø–æ –¥–Ω—è–º
   - Heatmap

5. **Time Series:**
   - Revenue over time
   - Spend over time
   - ROI over time
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã: –¥–µ–Ω—å, –Ω–µ–¥–µ–ª—è, –º–µ—Å—è—Ü

### 4. –†–∞–∑–¥–µ–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ (Settings Panel)

#### –¢—Ä–µ–±—É–µ–º—ã–π UI:

```mermaid
graph TB
    A[Settings Panel] --> B[Facebook Integration]
    A --> C[UTM Settings]
    A --> D[Notifications]
    A --> E[Team Management]
    
    B --> B1[Connect Account]
    B --> B2[Select Ad Accounts]
    B --> B3[Tracked Campaigns]
    
    C --> C1[UTM Source]
    C --> C2[UTM Medium]
    C --> C3[UTM Templates]
    
    D --> D1[Email Notifications]
    D --> D2[Telegram Notifications]
    D --> D3[Report Frequency]
    
    E --> E1[Team Name]
    E --> E2[Team Color]
    E --> E3[Team Emoji]
    
    style A fill:#4ecdc4
    style B fill:#ffe66d
    style C fill:#95e1d3
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **Facebook Integration:**
   - –ö–Ω–æ–ø–∫–∞ "Connect Facebook Account"
   - –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö ad accounts
   - –í—ã–±–æ—Ä –∫–∞–º–ø–∞–Ω–∏–π –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
   - –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

2. **UTM Settings:**
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `utm_source` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `facebook`)
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `utm_medium` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `cpc`)
   - UTM —à–∞–±–ª–æ–Ω—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

3. **Notifications:**
   - Email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - Telegram chat ID
   - –ß–∞—Å—Ç–æ—Ç–∞ –æ—Ç—á–µ—Ç–æ–≤ (daily, weekly, monthly)

4. **Team Management:**
   - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
   - –¶–≤–µ—Ç –∫–æ–º–∞–Ω–¥—ã
   - Emoji –∫–æ–º–∞–Ω–¥—ã

### 5. –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π Site Bar

#### –¢—Ä–µ–±—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```mermaid
graph TB
    A[Site Bar] --> B[Toggle Button]
    A --> C[Navigation Items]
    A --> D[Admin Panel Link]
    
    B --> B1[Expand/Collapse]
    
    C --> C1[Dashboard]
    C --> C2[Analytics]
    C --> C3[Settings]
    
    D --> D1[Admin Panel]
    D --> D2[Team Constructor]
    
    style A fill:#4ecdc4
    style B fill:#ffe66d
    style D fill:#ff6b6b
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **Toggle Button:**
   - –ò–∫–æ–Ω–∫–∞ (hamburger menu)
   - –ê–Ω–∏–º–∞—Ü–∏—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ localStorage

2. **Navigation Items:**
   - Dashboard
   - Analytics
   - Settings
   - Logout

3. **Admin Panel Link:**
   - –¢–æ–ª—å–∫–æ –¥–ª—è admin role
   - Admin Panel
   - Team Constructor

### 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### –¢—Ä–µ–±—É–µ–º—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **Authentication:**
   - ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ sessionStorage/localStorage
   - ‚úÖ `AuthManager` —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω–∞–º–∏
   - ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å refresh token rotation

2. **Authorization:**
   - ‚úÖ `TrafficGuard` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
   - ‚úÖ `requireAdmin` –¥–ª—è admin routes
   - ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å RBAC (Role-Based Access Control)

3. **API Security:**
   - ‚úÖ `authenticateToken` middleware –Ω–∞ –≤—Å–µ—Ö routes
   - ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å rate limiting
   - ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å CORS headers
   - ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å input validation

4. **Data Security:**
   - ‚úÖ RLS (Row Level Security) –Ω–∞ Supabase
   - ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å encryption –¥–ª—è sensitive data
   - ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å audit logging

---

## üìù –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Phase 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–°–†–û–ß–ù–û)

1. **Fix AuthManager Import**
   - –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç `AuthManager` –≤ `TrafficTeamConstructor.tsx`
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥

2. **–û—á–∏—Å—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–∞–Ω–¥**
   - –°–æ–∑–¥–∞—Ç—å SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è 4 –∫–æ–º–∞–Ω–¥
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å UTM-–º–µ—Ç–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ production

3. **–°–æ–∑–¥–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã**
   - `sales_activity_log`
   - `lead_tracking`
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ production

4. **Fix JWT Token Issue**
   - –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø–æ—á–µ–º—É —Ç–æ–∫–µ–Ω malformed
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### Phase 2: UTM-–∞—Ç—Ä–∏–±—É—Ü–∏—è –∏ AmoCRM

5. **Sales Aggregator**
   - –°–æ–∑–¥–∞—Ç—å backend endpoint –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
   - –ó–∞–ø–æ–ª–Ω–∏—Ç—å `all_sales_tracking`
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

6. **UTM Attribution Engine**
   - –°–æ–∑–¥–∞—Ç—å –ª–æ–≥–∏–∫—É —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è UTM ‚Üí Team
   - –û–±–Ω–æ–≤–∏—Ç—å `traffic_stats`
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

7. **Traffic Stats Calculator**
   - –°–æ–∑–¥–∞—Ç—å endpoint –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –º–µ—Ç—Ä–∏–∫
   - –û–±–Ω–æ–≤–∏—Ç—å `traffic_stats`
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### Phase 3: Facebook Ads Integration

8. **Facebook OAuth Handler**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å OAuth flow
   - –•—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω—ã
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

9. **Ad Account Fetcher**
   - –ü–æ–ª—É—á–∞—Ç—å ad accounts
   - –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –≤ UI
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

10. **Campaign Stats Sync**
    - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    - –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤ `traffic_stats`
    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### Phase 4: UI Components

11. **Main Dashboard**
    - –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
    - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
    - –î–æ–±–∞–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏
    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

12. **Settings Panel**
    - –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
    - –î–æ–±–∞–≤–∏—Ç—å Facebook integration
    - –î–æ–±–∞–≤–∏—Ç—å UTM settings
    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

13. **Collapsible Site Bar**
    - –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
    - –î–æ–±–∞–≤–∏—Ç—å toggle
    - –î–æ–±–∞–≤–∏—Ç—å Admin Panel link
    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### Phase 5: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

14. **Refresh Token Rotation**
    - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É
    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

15. **RBAC**
    - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–æ–ª–∏
    - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å middleware
    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

16. **Rate Limiting**
    - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiter
    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

17. **CORS Headers**
    - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS
    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

18. **Input Validation**
    - –î–æ–±–∞–≤–∏—Ç—å validation
    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

19. **Audit Logging**
    - –°–æ–∑–¥–∞—Ç—å audit log
    - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è
    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

---

## üé® –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã

### –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞:
- Primary: `#00FF88` (–ù–µ–æ–Ω–æ–≤—ã–π –∑–µ–ª–µ–Ω—ã–π)
- Secondary: `#3B82F6` (–°–∏–Ω–∏–π)
- Accent: `#F59E0B` (–û—Ä–∞–Ω–∂–µ–≤—ã–π)
- Danger: `#EF4444` (–ö—Ä–∞—Å–Ω—ã–π)
- Success: `#10B981` (–ò–∑—É–º—Ä—É–¥–Ω—ã–π)
- Background: `#000000` (–ß–µ—Ä–Ω—ã–π)
- Surface: `rgba(0,0,0,0.4)` (–ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —á–µ—Ä–Ω—ã–π)

### –®—Ä–∏—Ñ—Ç—ã:
- Headings: Inter, 700
- Body: Inter, 400
- Mono: JetBrains Mono

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- Cards: `bg-black/40 border border-[#00FF88]/10 rounded-2xl`
- Buttons: `bg-[#00FF88] hover:bg-[#00FF88]/90 text-black`
- Inputs: `bg-black/50 border-[#00FF88]/20 text-white`

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:
- ‚úÖ –í—Å–µ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ UTM-–∞—Ç—Ä–∏–±—É—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ Facebook Ads –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î —Å–æ–∑–¥–∞–Ω—ã

### –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏:
- ‚úÖ Admin –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º
- ‚úÖ Targetologists –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —Å–≤–æ—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É
- ‚úÖ ROI —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Sales funnel –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç

---

## ‚ùì –í–æ–ø—Ä–æ—Å—ã –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

1. **UTM-–º–µ—Ç–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–∞–Ω–¥** - –Ω—É–∂–Ω–æ –ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å UTM-–º–µ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ Arystan, Kenesary, Muha, Traf4 –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º?

2. **Facebook Ads** - –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ Facebook App ID –∏ Secret –¥–ª—è OAuth?

3. **AmoCRM** - –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ –ø–æ–ª—è –∏–∑ AmoCRM –Ω—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤ Traffic Dashboard?

4. **–û—Ç—á–µ—Ç—ã** - –∫–∞–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ—Ç—á–µ—Ç–æ–≤ –Ω—É–∂–Ω–∞? (daily, weekly, monthly)

5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - —á–µ—Ä–µ–∑ –∫–∞–∫–∏–µ –∫–∞–Ω–∞–ª—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è? (Email, Telegram, –æ–±–∞)

6. **ROI Calculation** - –∫–∞–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞ ROI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è? `(Revenue - Spend) / Spend * 100`?

7. **Currency** - –≤ –∫–∞–∫–æ–π –≤–∞–ª—é—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏? (KZT, USD, –æ–±–µ)

8. **Timezone** - –≤ –∫–∞–∫–æ–π —Ç–∞–π–º–∑–æ–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ? (Asia/Almaty, UTC)

---

## üìã Checklist –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è

- [ ] –£—Ç–æ—á–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –≤—ã—à–µ
- [ ] –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É UTM-–∞—Ç—Ä–∏–±—É—Ü–∏–∏
- [ ] –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Facebook Ads integration
- [ ] –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å UI –¥–ª—è Main Dashboard
- [ ] –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å UI –¥–ª—è Settings Panel
- [ ] –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å UI –¥–ª—è Collapsible Site Bar
- [ ] –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- [ ] –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ø–ª–∞–Ω –æ—á–∏—Å—Ç–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–∞–Ω–¥
- [ ] –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ø–ª–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ñ–∞–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
