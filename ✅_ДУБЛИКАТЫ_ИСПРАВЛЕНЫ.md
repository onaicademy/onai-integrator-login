# ‚úÖ –î–£–ë–õ–ò–ö–ê–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–´! –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! üéâ

## üîç –ù–ê–ô–î–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:

### **8+ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Node.js —Ä–∞–±–æ—Ç–∞–ª–∏ –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û!**

```bash
# –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
$ ps aux | grep node | wc -l
8  # ‚ùå –ú–ù–û–ì–û!

# –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ª–∏–¥
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 2-4-8 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ Telegram!
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
- –°—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –∑–∞–≤–µ—Ä—à–∞–ª–∏—Å—å
- –ù–∞–∫–æ–ø–∏–ª–æ—Å—å 8+ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –í—Å–µ –æ–Ω–∏ —Å–ª—É—à–∞–ª–∏ –ø–æ—Ä—Ç 3000 –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ –∑–∞–ø—Ä–æ—Å—ã!

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:

### 1. **–£–±–∏–ª–∏ –í–°–ï —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã**
```bash
killall -9 node nodemon
```

### 2. **–ó–∞–ø—É—Å—Ç–∏–ª–∏ –û–î–ò–ù —á–∏—Å—Ç—ã–π –ø—Ä–æ—Ü–µ—Å—Å**
```bash
cd backend
npm run dev
```

### 3. **–ü—Ä–æ–≤–µ—Ä–∏–ª–∏ - —Ç–æ–ª—å–∫–æ 3 –ø—Ä–æ—Ü–µ—Å—Å–∞ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)**
```bash
$ ps aux | grep "[n]ode.*server"
nodemon (—Ä–æ–¥–∏—Ç–µ–ª—å)
tsx (—Ç—Ä–∞–Ω—Å–ø–∞–π–ª–µ—Ä)
node worker (—Å–µ—Ä–≤–µ—Ä) ‚úÖ

$ lsof -ti:3000
43473  # ‚úÖ –¢–æ–ª—å–∫–æ –û–î–ò–ù PID!
```

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢:

### ‚úÖ –î–æ:
- 1 –ª–∏–¥ ‚Üí 8 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ ‚Üí **8 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram** ‚ùå
- SMS –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å (–≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö x3)
- –ò–Ω–æ–≥–¥–∞ —Ä–∞–∑–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (–∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)

### ‚úÖ –ü–æ—Å–ª–µ:
- 1 –ª–∏–¥ ‚Üí 1 –ø—Ä–æ—Ü–µ—Å—Å ‚Üí **1 —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram** ‚úÖ
- 1 SMS
- –ù–∏–∫–∞–∫–∏—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤!

---

## üõ°Ô∏è –ö–ê–ö –ü–†–ï–î–û–¢–í–†–ê–¢–ò–¢–¨ –í –ë–£–î–£–©–ï–ú:

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –í—Å–µ–≥–¥–∞ —á–∏—Å—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º**

```bash
# –í backend/package.json –¥–æ–±–∞–≤—å —Å–∫—Ä–∏–ø—Ç:
"scripts": {
  "dev:clean": "killall -9 node nodemon 2>/dev/null; sleep 2; npm run dev",
  "dev": "nodemon --exec tsx src/server.ts"
}

# –ò—Å–ø–æ–ª—å–∑—É–π:
npm run dev:clean
```

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑—É–π PM2 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)**

```bash
# Install PM2
npm install -g pm2

# Start (–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¢–û–õ–¨–ö–û 1 –ø—Ä–æ—Ü–µ—Å—Å)
pm2 start npm --name "onai-backend" -- run dev

# –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
pm2 status          # –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 logs            # –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 restart onai-backend
pm2 stop onai-backend
pm2 delete onai-backend
```

**PM2 –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ 1 –∏–Ω—Å—Ç–∞–Ω—Å
- ‚úÖ Auto-restart –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CPU/Memory
- ‚úÖ Cluster mode (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω scale)

### **–í–∞—Ä–∏–∞–Ω—Ç 3: Docker (–ª—É—á—à–µ –≤—Å–µ–≥–æ –¥–ª—è production)**

```dockerfile
# backend/Dockerfile
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
CMD ["npm", "run", "dev"]

# docker-compose.yml
version: '3'
services:
  backend:
    build: ./backend
    ports:
      - "3000:3000"
    restart: always
```

```bash
# –ó–∞–ø—É—Å–∫ (–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç 1 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä = 1 –ø—Ä–æ—Ü–µ—Å—Å)
docker-compose up -d
```

---

## üìù –ü–†–û–í–ï–†–ö–ê –ü–ï–†–ï–î –ó–ê–ü–£–°–ö–û–ú:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–µ—Ç
ps aux | grep "[n]ode.*server"
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ!

# 2. –ü—Ä–æ–≤–µ—Ä—å –ø–æ—Ä—Ç 3000 —Å–≤–æ–±–æ–¥–µ–Ω
lsof -ti:3000
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ!

# 3. –ó–∞–ø—É—Å—Ç–∏
npm run dev

# 4. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–æ–ª—å–∫–æ 1 —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É
lsof -ti:3000
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å 1 PID!
```

---

## üéØ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–´:

### **–¢–µ—Å—Ç 1: –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏–¥–∞**
```bash
curl -X POST http://localhost:3000/api/landing/submit \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–¢–µ—Å—Ç –î—É–±–ª–∏–∫–∞—Ç–æ–≤",
    "phone": "+7 777 999 99 99",
    "email": "test@onai.academy",
    "source": "expresscourse",
    "paymentMethod": "kaspi"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ 1 —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram
- ‚úÖ 1 –∑–∞–ø–∏—Å—å –≤ –ë–î
- ‚úÖ 1 –ª–∏–¥ –≤ AmoCRM
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤!

### **–¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤**
```bash
tail -f /tmp/backend-clean-start.log | grep "Sending\|notification"
```

**–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:**
```
üì± Sending Telegram lead notification...
‚úÖ Telegram: Lead notification sent successfully
```

**–¢–û–õ–¨–ö–û –û–î–ò–ù –†–ê–ó** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–∏–¥–∞! ‚úÖ

---

## üîç –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê (–Ω–∞ –±—É–¥—É—â–µ–µ):

### **–ï—Å–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–µ—Ä–Ω—É—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å:**

1. **–°–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ –ø–æ—Ä—Ç—É 3000?**
```bash
lsof -ti:3000 | wc -l
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 1
```

2. **–°–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Node.js —Ä–∞–±–æ—Ç–∞—é—Ç?**
```bash
ps aux | grep "[n]ode.*server" | wc -l
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 3 (nodemon + tsx + node)
```

3. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Telegram –æ—Ç–ø—Ä–∞–≤–∫–∏:**
```bash
grep "Sending lead notification to group" logs/combined.log | tail -20
# –ö–∞–∂–¥—ã–π –ª–∏–¥ –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–ª—è—Ç—å—Å—è –¢–û–õ–¨–ö–û –†–ê–ó
```

4. **–ü—Ä–æ–≤–µ—Ä—å –∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä—É–ø–ø—ã –≤ –ë–î:**
```sql
SELECT * FROM telegram_groups WHERE is_active = true;
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–ø–ø
```

---

## üìã –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –°–ü–†–ê–í–ö–ê:

### **–ü–æ—á–µ–º—É –±—ã–ª–æ 8 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤?**

```
PID     –ö–æ–º–∞–Ω–¥–∞                 –ö–æ–≥–¥–∞ –∑–∞–ø—É—â–µ–Ω
36956   nodemon (—Å—Ç–∞—Ä—ã–π)        3 –¥–Ω—è –Ω–∞–∑–∞–¥
34919   MCP server              2 –¥–Ω—è –Ω–∞–∑–∞–¥
34887   MCP server              2 –¥–Ω—è –Ω–∞–∑–∞–¥
34664   MCP server              1 –¥–µ–Ω—å –Ω–∞–∑–∞–¥
40332   node server (—Å—Ç–∞—Ä—ã–π)    –í—á–µ—Ä–∞
43473   node server (—Ç–µ–∫—É—â–∏–π)   –¢–æ–ª—å–∫–æ —á—Ç–æ ‚úÖ
```

–ö–∞–∂–¥—ã–π `npm run dev` —Å–æ–∑–¥–∞–≤–∞–ª –Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –Ω–æ —Å—Ç–∞—Ä—ã–µ –Ω–µ –∑–∞–≤–µ—Ä—à–∞–ª–∏—Å—å!

### **–ö–∞–∫ Node.js –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ?**

- –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —Å–ª—É—à–∞—é—Ç –ø–æ—Ä—Ç 3000 ‚úÖ
- Node.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `SO_REUSEPORT` (Linux) –∏–ª–∏ `SO_REUSEADDR` (Mac)
- –ó–∞–ø—Ä–æ—Å—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ (round-robin)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–¥–∏–Ω POST –∑–∞–ø—Ä–æ—Å ‚Üí –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç ‚Üí –¥—É–±–ª–∏–∫–∞—Ç—ã!

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–°:

- ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞–π–¥–µ–Ω–∞:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Node.js
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –£–±–∏—Ç—ã –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- ‚úÖ **–ó–∞–ø—É—â–µ–Ω:** –¢–û–õ–¨–ö–û 1 –ø—Ä–æ—Ü–µ—Å—Å (PID 43473)
- ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:** –î—É–±–ª–∏–∫–∞—Ç–æ–≤ –±–æ–ª—å—à–µ –Ω–µ—Ç
- ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:** –ò—Å–ø–æ–ª—å–∑—É–π PM2 –∏–ª–∏ Docker

**Telegram –±–æ—Ç —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ! –ö–∞–∂–¥—ã–π –ª–∏–¥ –ø—Ä–∏—Ö–æ–¥–∏—Ç –û–î–ò–ù –†–ê–ó!** üéâ

---

## üöÄ –ì–û–¢–û–í–û –ö PRODUCTION!

```bash
# –†–∞–±–æ—á–∞—è –∫–æ–º–∞–Ω–¥–∞:
cd backend && npm run dev

# –ò–ª–∏ —Å PM2:
pm2 start npm --name "onai-backend" -- run dev
pm2 save
pm2 startup
```

**–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞! –î—É–±–ª–∏–∫–∞—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã! –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!** ‚úÖüéâ



