# üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è amoCRM —Å Tripwire –≤–æ—Ä–æ–Ω–∫–æ–π

## üìã –ß—Ç–æ —ç—Ç–æ?

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –≤ amoCRM –ø—Ä–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ —É—Ä–æ–∫–æ–≤ Tripwire –∫—É—Ä—Å–∞.

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –°—Ç—É–¥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç —É—Ä–æ–∫ 1 ‚Üí –°–¥–µ–ª–∫–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø "–ü–†–û–®–ï–õ –ü–ï–†–í–´–ô –£–†–û–ö"
- –°—Ç—É–¥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç —É—Ä–æ–∫ 2 ‚Üí –°–¥–µ–ª–∫–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø "–ü–†–û–®–ï–õ –í–¢–û–†–û–ô –£–†–û–ö"
- –°—Ç—É–¥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç —É—Ä–æ–∫ 3 ‚Üí –°–¥–µ–ª–∫–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø "–ü–†–û–®–ï–õ 3–ô –£–†–û–ö"

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –ù–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å: `backend/src/services/amoCrmService.ts`

–°–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:
- –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –≤ amoCRM –ø–æ email
- –ü–æ–∏—Å–∫ —Å–¥–µ–ª–∫–∏, —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º
- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –Ω–∞ –Ω—É–∂–Ω—ã–π —ç—Ç–∞–ø –≤–æ—Ä–æ–Ω–∫–∏

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤: `backend/src/routes/tripwire-lessons.ts`

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞ (POST `/api/tripwire/complete`):
- –ü–æ–ª—É—á–∞–µ–º email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–º–µ—Ä —É—Ä–æ–∫–∞ (1, 2 –∏–ª–∏ 3)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–¥–µ–ª–∫—É –≤ amoCRM (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç—É)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–®–∞–≥ –∑–∞ —à–∞–≥–æ–º)

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ Access Token –æ—Ç amoCRM

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ OAuth (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ó–∞–π–¥–∏—Ç–µ –≤ [–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π amoCRM](https://www.amocrm.ru/settings/integrations/)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
3. –ü–æ–ª—É—á–∏—Ç–µ `client_id` –∏ `client_secret`
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ OAuth flow –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `access_token` –∏ `refresh_token`

**–í–∞–∂–Ω–æ:** Access Token –¥–µ–π—Å—Ç–≤—É–µ—Ç 24 —á–∞—Å–∞. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Refresh Token.

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω (–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

1. –ó–∞–π–¥–∏—Ç–µ –≤ amoCRM –ø–æ–¥ –∞–∫–∫–∞—É–Ω—Ç–æ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network
3. –ù–∞–π–¥–∏—Ç–µ –ª—é–±–æ–π API –∑–∞–ø—Ä–æ—Å –∫ `api/v4`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer ...`

**‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:** –¢–∞–∫–æ–π —Ç–æ–∫–µ–Ω –∂–∏–≤—ë—Ç 24 —á–∞—Å–∞ –∏ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞!

---

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç–µ ID –≤–æ—Ä–æ–Ω–∫–∏ (Pipeline ID)

1. –ó–∞–π–¥–∏—Ç–µ –≤ amoCRM ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –í–æ—Ä–æ–Ω–∫–∏ –∏ —ç—Ç–∞–ø—ã
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–æ—Ä–æ–Ω–∫—É **"onAI Academy"**
3. –í URL –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞–π–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `pipeline_id`:
   ```
   https://yoursubdomain.amocrm.ru/settings/pipelines/edit/?id=10350882
                                                              ^^^^^^^^
   ```
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `10350882`)

---

### –®–∞–≥ 3: –ü–æ–ª—É—á–∏—Ç–µ ID —ç—Ç–∞–ø–æ–≤ (Status IDs)

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ UI (–ü—Ä–æ—Å—Ç–æ–π)

1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–æ—Ä–æ–Ω–∫–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —ç—Ç–∞–ø **"–ü–†–û–®–ï–õ –ü–ï–†–í–´–ô –£–†–û–ö"**
2. –í URL –ø–æ—è–≤–∏—Ç—Å—è `status_id`:
   ```
   https://yoursubdomain.amocrm.ru/settings/pipelines/edit/?id=10350882&status_id=12345678
                                                                          ^^^^^^^^
   ```
3. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –≤—Å–µ—Ö —Ç—Ä—ë—Ö —ç—Ç–∞–ø–æ–≤

#### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ API (–¢–æ—á–Ω—ã–π)

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ Node.js –∫–æ–Ω—Å–æ–ª–∏ (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é):

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ Node.js REPL
node

# –í –∫–æ–Ω—Å–æ–ª–∏:
const amoCrm = require('./backend/src/services/amoCrmService');
await amoCrm.listPipelines();
```

–í—ã —É–≤–∏–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–æ—Ä–æ–Ω–æ–∫ –∏ –∏—Ö —ç—Ç–∞–ø–æ–≤ —Å ID.

---

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `backend/.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
# ========================================
# AMOCRM INTEGRATION
# ========================================

# –í–∞—à –ø–æ–¥–¥–æ–º–µ–Ω amoCRM (–±–µ–∑ .amocrm.ru)
AMOCRM_SUBDOMAIN=yoursubdomain

# Access Token (OAuth –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–π)
AMOCRM_ACCESS_TOKEN=your_access_token_here

# ID –≤–æ—Ä–æ–Ω–∫–∏ "onAI Academy"
AMOCRM_PIPELINE_ID=10350882

# ID —ç—Ç–∞–ø–æ–≤ –≤–æ—Ä–æ–Ω–∫–∏ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ!)
AMOCRM_STAGE_LESSON_1=12345678  # ID —ç—Ç–∞–ø–∞ "–ü–†–û–®–ï–õ –ü–ï–†–í–´–ô –£–†–û–ö"
AMOCRM_STAGE_LESSON_2=23456789  # ID —ç—Ç–∞–ø–∞ "–ü–†–û–®–ï–õ –í–¢–û–†–û–ô –£–†–û–ö"
AMOCRM_STAGE_LESSON_3=34567890  # ID —ç—Ç–∞–ø–∞ "–ü–†–û–®–ï–õ 3–ô –£–†–û–ö"
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ó–∞–º–µ–Ω–∏—Ç–µ `12345678`, `23456789`, `34567890` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ ID –∏–∑ –≤–∞—à–µ–π amoCRM!

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ó–∞–ø—É—Å—Ç–∏—Ç–µ Node.js –∫–æ–Ω—Å–æ–ª—å –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
node
```

–í—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
const amoCrm = require('./backend/src/services/amoCrmService');
await amoCrm.testConnection();
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ [AmoCRM] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!
{
  id: 12345,
  name: 'Your Account',
  subdomain: 'yoursubdomain'
}
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∏—Å–∫–∞ —Å–¥–µ–ª–∫–∏

```javascript
const amoCrm = require('./backend/src/services/amoCrmService');
await amoCrm.findLeadIdByEmail('student@example.com');
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
[AmoCRM] –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –ø–æ email: student@example.com
[AmoCRM] –ù–∞–π–¥–µ–Ω –∫–æ–Ω—Ç–∞–∫—Ç: ID 123456, –∏–º—è "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"
[AmoCRM] –ù–∞–π–¥–µ–Ω–∞ —Å–¥–µ–ª–∫–∞: ID 789012, —Å—Ç–∞—Ç—É—Å 65432100
789012
```

### –¢–µ—Å—Ç 3: –†–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –ø–æ–¥ —Å—Ç—É–¥–µ–Ω—Ç–æ–º Tripwire
2. –ó–∞–≤–µ—Ä—à–∏—Ç–µ –£—Ä–æ–∫ 1 (lesson_id: 67)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞:

```
[AMOCRM] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ amoCRM –¥–ª—è student@example.com, —É—Ä–æ–∫ 1
üéØ [AmoCRM] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å student@example.com –∑–∞–≤–µ—Ä—à–∏–ª —É—Ä–æ–∫ 1. –û–±–Ω–æ–≤–ª—è–µ–º CRM...
[AmoCRM] –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –ø–æ email: student@example.com
[AmoCRM] –ù–∞–π–¥–µ–Ω –∫–æ–Ω—Ç–∞–∫—Ç: ID 123456, –∏–º—è "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"
[AmoCRM] –ù–∞–π–¥–µ–Ω–∞ —Å–¥–µ–ª–∫–∞: ID 789012, —Å—Ç–∞—Ç—É—Å 65432100
[AmoCRM] –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Å–¥–µ–ª–∫—É 789012 –Ω–∞ —ç—Ç–∞–ø 12345678
‚úÖ [AmoCRM] –°–¥–µ–ª–∫–∞ 789012 —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –Ω–∞ —ç—Ç–∞–ø 12345678
```

4. –û—Ç–∫—Ä–æ–π—Ç–µ amoCRM –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–¥–µ–ª–∫–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∞—Å—å –Ω–∞ —ç—Ç–∞–ø "–ü–†–û–®–ï–õ –ü–ï–†–í–´–ô –£–†–û–ö"

---

## üî• –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### 1. Fire-and-Forget (–ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞)

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ**. –ï—Å–ª–∏ amoCRM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
- –°—Ç—É–¥–µ–Ω—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ —É–≤–∏–¥–∏—Ç "‚úÖ –£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω"
- –í –ª–æ–≥–∞—Ö –ø–æ—è–≤–∏—Ç—Å—è –æ—à–∏–±–∫–∞, –Ω–æ UX –Ω–µ –ø–æ—Å—Ç—Ä–∞–¥–∞–µ—Ç

```typescript
// –ó–∞–ø—É—Å–∫–∞–µ–º –≤ —Ñ–æ–Ω–µ, –Ω–µ –∂–¥—ë–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
amoCrmService.onLessonCompleted(userEmail, lessonNumber)
  .catch(err => console.error('[AMOCRM] –§–æ–Ω–æ–≤–∞—è –æ—à–∏–±–∫–∞:', err.message));
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –∑–∞–¥–∞–Ω—ã:
- –°–µ—Ä–≤–∏—Å –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- –í –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ

### 3. Refresh Token (–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

Access Token –∂–∏–≤—ë—Ç 24 —á–∞—Å–∞. –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω—É–∂–Ω–æ:

1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `refresh_token` –≤ `.env`:
   ```bash
   AMOCRM_REFRESH_TOKEN=your_refresh_token
   AMOCRM_CLIENT_ID=your_client_id
   AMOCRM_CLIENT_SECRET=your_client_secret
   ```

2. –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ `amoCrmService.ts`:
   ```typescript
   async function refreshAccessToken() {
     const response = await axios.post(
       `https://${process.env.AMOCRM_SUBDOMAIN}.amocrm.ru/oauth2/access_token`,
       {
         client_id: process.env.AMOCRM_CLIENT_ID,
         client_secret: process.env.AMOCRM_CLIENT_SECRET,
         grant_type: 'refresh_token',
         refresh_token: process.env.AMOCRM_REFRESH_TOKEN,
       }
     );
     
     // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π access_token –∏ refresh_token
     process.env.AMOCRM_ACCESS_TOKEN = response.data.access_token;
     process.env.AMOCRM_REFRESH_TOKEN = response.data.refresh_token;
   }
   ```

3. –í—ã–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ 401 (Unauthorized)

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É [`amocrm-js`](https://www.npmjs.com/package/amocrm-js), –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### 4. –ú–∞–ø–ø–∏–Ω–≥ —É—Ä–æ–∫–æ–≤

Tripwire –≤–æ—Ä–æ–Ω–∫–∞ –∏–º–µ–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥:

| Module ID | Lesson ID | –ù–æ–º–µ—Ä —É—Ä–æ–∫–∞ | –≠—Ç–∞–ø amoCRM |
|-----------|-----------|-------------|-------------|
| 16        | 67        | 1           | –ü–†–û–®–ï–õ –ü–ï–†–í–´–ô –£–†–û–ö |
| 17        | 68        | 2           | –ü–†–û–®–ï–õ –í–¢–û–†–û–ô –£–†–û–ö |
| 18        | 69        | 3           | –ü–†–û–®–ï–õ 3–ô –£–†–û–ö |

–ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è, –æ–±–Ω–æ–≤–∏—Ç–µ –º–∞–ø–ø–∏–Ω–≥ –≤ —Ñ–∞–π–ª–µ:
- `backend/src/routes/tripwire-lessons.ts` (—Å—Ç—Ä–æ–∫–∞ ~340)

---

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "‚ùå [AmoCRM] –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ AMOCRM_ACCESS_TOKEN"

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫ (–∂–∏–≤—ë—Ç 24 —á–∞—Å–∞)

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω (—Å–º. –®–∞–≥ 1)
2. –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Refresh Token

---

### –û—à–∏–±–∫–∞: "‚ùå [AmoCRM] –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ AMOCRM_SUBDOMAIN"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥–¥–æ–º–µ–Ω –∏–ª–∏ ID –≤–æ—Ä–æ–Ω–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `AMOCRM_SUBDOMAIN` (–±–µ–∑ `.amocrm.ru`)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `AMOCRM_PIPELINE_ID` (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ)

---

### –°–¥–µ–ª–∫–∞ –Ω–µ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–ö–æ–Ω—Ç–∞–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ email**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ email —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å email –≤ amoCRM
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç: `amoCrm.findLeadIdByEmail('email@example.com')`

2. **–°–¥–µ–ª–∫–∞ –Ω–µ –≤ –Ω—É–∂–Ω–æ–π –≤–æ—Ä–æ–Ω–∫–µ**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–¥–µ–ª–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –≤–æ—Ä–æ–Ω–∫–µ —Å ID = `AMOCRM_PIPELINE_ID`
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–¥–µ–ª–æ–∫, –±–µ—Ä—ë—Ç—Å—è —Å–∞–º–∞—è —Å–≤–µ–∂–∞—è

3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ID —ç—Ç–∞–ø–∞**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `AMOCRM_STAGE_LESSON_1/2/3`
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `amoCrm.listPipelines()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (pm2)
pm2 logs backend --lines 100 | grep AMOCRM

# –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
# –õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ npm run dev
```

### –£—Å–ø–µ—à–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
```
‚úÖ [AmoCRM] –°–¥–µ–ª–∫–∞ 789012 —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –Ω–∞ —ç—Ç–∞–ø 12345678
```

### –û—à–∏–±–∫–∏ amoCRM –Ω–µ –ª–æ–º–∞—é—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—É:
```
[AMOCRM] –§–æ–Ω–æ–≤–∞—è –æ—à–∏–±–∫–∞: Request failed with status code 401
‚úÖ [SUCCESS] Lesson completion successful!  ‚Üê –°—Ç—É–¥–µ–Ω—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ –≤–∏–¥–∏—Ç —É—Å–ø–µ—Ö
```

---

## üéì –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è amoCRM API v4](https://www.amocrm.ru/developers/content/crm_platform/platform-api)
- [OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ amoCRM](https://www.amocrm.ru/developers/content/oauth/step-by-step)
- [–†–∞–±–æ—Ç–∞ —Å–æ —Å–¥–µ–ª–∫–∞–º–∏ (Leads)](https://www.amocrm.ru/developers/content/crm_platform/leads-api)
- [–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ amocrm-js](https://www.npmjs.com/package/amocrm-js)

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] –ü–æ–ª—É—á–µ–Ω Access Token –æ—Ç amoCRM
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `backend/.env`
- [ ] ID —ç—Ç–∞–ø–æ–≤ –∑–∞–º–µ–Ω–µ–Ω—ã —Å –∑–∞–≥–ª—É—à–µ–∫ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω —Ç–µ—Å—Ç `amoCrm.testConnection()` ‚Üí —É—Å–ø–µ—à–Ω–æ
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω —Ç–µ—Å—Ç `amoCrm.findLeadIdByEmail()` ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç —Å–¥–µ–ª–∫—É
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π —É—Ä–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω ‚Üí —Å–¥–µ–ª–∫–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∞—Å—å –≤ amoCRM
- [ ] (–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞) –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Refresh Token

---

## üöÄ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–æ–≤ Tripwire —Å–¥–µ–ª–∫–∏ –≤ amoCRM –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –ø–æ –≤–æ—Ä–æ–Ω–∫–µ.

**–í–æ–ø—Ä–æ—Å—ã?** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª [Troubleshooting](#-troubleshooting) –∏–ª–∏ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞.




