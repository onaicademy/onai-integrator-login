name: Check Vercel Deployment Status

# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–µ–ø–ª–æ—è Vercel
# –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

on:
  workflow_dispatch:  # –¢–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
  schedule:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ push (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    - cron: '*/5 * * * *'

jobs:
  check-vercel:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Check Vercel deployment status
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–µ–ø–ª–æ—è Vercel..."
          
          if [ -z "$VERCEL_TOKEN" ]; then
            echo "‚ùå VERCEL_TOKEN –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
            echo ""
            echo "üìã –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:"
            echo "1. –ü–µ—Ä–µ–π–¥–∏ –≤ Vercel Dashboard ‚Üí Settings ‚Üí Tokens"
            echo "2. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω"
            echo "3. –î–æ–±–∞–≤—å –≤ GitHub Secrets:"
            echo "   - VERCEL_TOKEN"
            echo "   - VERCEL_ORG_ID (–∏–∑ Settings ‚Üí General)"
            echo "   - VERCEL_PROJECT_ID (–∏–∑ Project Settings ‚Üí General)"
            exit 1
          fi
          
          echo "üì° –ü–æ–ª—É—á–∞—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –¥–µ–ø–ª–æ–µ..."
          
          # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π
          RESPONSE=$(curl -s \
            -H "Authorization: Bearer $VERCEL_TOKEN" \
            "https://api.vercel.com/v6/deployments?projectId=$VERCEL_PROJECT_ID&limit=1")
          
          if [ $? -ne 0 ]; then
            echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ Vercel API"
            exit 1
          fi
          
          DEPLOYMENT=$(echo "$RESPONSE" | jq -r '.deployments[0] // empty')
          
          if [ -z "$DEPLOYMENT" ] || [ "$DEPLOYMENT" = "null" ]; then
            echo "‚ö†Ô∏è –î–µ–ø–ª–æ–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
            exit 0
          fi
          
          STATE=$(echo "$DEPLOYMENT" | jq -r '.state // "unknown"')
          URL=$(echo "$DEPLOYMENT" | jq -r '.url // "unknown"')
          CREATED=$(echo "$DEPLOYMENT" | jq -r '.createdAt // "unknown"')
          CREATOR=$(echo "$DEPLOYMENT" | jq -r '.creator.username // "unknown"')
          TARGET=$(echo "$DEPLOYMENT" | jq -r '.target // "unknown"')
          
          echo ""
          echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
          echo "‚ïë   üìä –°–¢–ê–¢–£–° VERCEL –î–ï–ü–õ–û–Ø             ‚ïë"
          echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
          echo ""
          echo "üì¶ –°—Ç–∞—Ç—É—Å: $STATE"
          echo "üåê URL: $URL"
          echo "üë§ –°–æ–∑–¥–∞–ª: $CREATOR"
          echo "üéØ Target: $TARGET"
          echo "üìÖ –°–æ–∑–¥–∞–Ω: $CREATED"
          echo ""
          
          case "$STATE" in
            "READY")
              echo "‚úÖ –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω –∏ –≥–æ—Ç–æ–≤!"
              echo "üåê Production: https://onai.academy"
              exit 0
              ;;
            "BUILDING")
              echo "‚è≥ –î–µ–ø–ª–æ–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–±–æ—Ä–∫–∏..."
              echo "üìä –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º: https://vercel.com/dashboard"
              exit 0
              ;;
            "QUEUED")
              echo "‚è∏Ô∏è –î–µ–ø–ª–æ–π –≤ –æ—á–µ—Ä–µ–¥–∏..."
              echo "üìä –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º: https://vercel.com/dashboard"
              exit 0
              ;;
            "ERROR")
              echo "‚ùå –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π!"
              echo "üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: https://vercel.com/dashboard"
              exit 1
              ;;
            "CANCELED")
              echo "‚ö†Ô∏è –î–µ–ø–ª–æ–π –æ—Ç–º–µ–Ω—ë–Ω"
              echo "üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: https://vercel.com/dashboard"
              exit 1
              ;;
            *)
              echo "‚ÑπÔ∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å: $STATE"
              echo "üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: https://vercel.com/dashboard"
              exit 0
              ;;
          esac

