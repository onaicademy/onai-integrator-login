# üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è "3—Ö –¥–Ω–µ–≤–Ω–∏–∫" - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç

**–î–∞—Ç–∞:** 2026-01-02
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Backend –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ | ‚è≥ –¢—Ä–µ–±—É—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ AmoCRM

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. SQL –ú–∏–≥—Ä–∞—Ü–∏—è - –í–´–ü–û–õ–ù–ï–ù–û ‚úÖ

**–§–∞–π–ª:** `sql/migrations/010_create_challenge3d_sales.sql`

**–°–æ–∑–¥–∞–Ω–æ –≤ Landing DB:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `challenge3d_sales` (28 –∫–æ–ª–æ–Ω–æ–∫)
- ‚úÖ 13 –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ Trigger –¥–ª—è auto-update `updated_at`
- ‚úÖ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ UTM attribution
- ‚úÖ –ü–æ–ª—è –¥–ª—è prepaid/package_type
- ‚úÖ Phone-based attribution support

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

### 2. AmoCRM Webhooks - –°–û–ó–î–ê–ù–´ ‚úÖ

#### 2.1. Webhook –¥–ª—è –ø—Ä–æ–¥–∞–∂ (Sales)

**–§–∞–π–ª:** `backend/src/routes/amocrm-challenge3d-webhook.ts`

**Endpoint:** `POST /api/amocrm/challenge3d-sale`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ—Ä–æ–Ω–æ–∫ 9777626 (–ö–¶) –∏ 9430994 (–û–ü)
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É 142 (–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ UTM –º–µ—Ç–æ–∫ –∏–∑ custom fields
- ‚úÖ Phone-based attribution (first-touch + last-touch)
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∞ (Kenesary, Arystan, Muha, Traf4)
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ product type (challenge3d vs express)
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç vs –ø–æ–ª–Ω—ã—Ö –æ–ø–ª–∞—Ç
- ‚úÖ Deduplication (5-–º–∏–Ω—É—Ç–Ω–æ–µ –æ–∫–Ω–æ)
- ‚úÖ Health check endpoint
- ‚úÖ –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ retry loop)

#### 2.2. Webhook –¥–ª—è –≤—Å–µ—Ö –ª–∏–¥–æ–≤ (All Leads)

**–§–∞–π–ª:** `backend/src/routes/amocrm-challenge3d-leads-webhook.ts`

**Endpoint:** `POST /api/amocrm/challenge3d-lead`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –í–°–ï–• —Å—Ç–∞—Ç—É—Å–æ–≤ –∏–∑ –≤–æ—Ä–æ–Ω–æ–∫ 9777626 –∏ 9430994
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `landing_leads` —Å `source='challenge3d'`
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ product type –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è Express
- ‚úÖ –ü–æ–ª–Ω–∞—è UTM –∞—Ç—Ä–∏–±—É—Ü–∏—è
- ‚úÖ Health check endpoint

**–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤:** `backend/src/server.ts`
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã (—Å—Ç—Ä–æ–∫–∏ 161-162)
- ‚úÖ Body parsers –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (—Å—Ç—Ä–æ–∫–∏ 422-425)
- ‚úÖ –†–æ—É—Ç–µ—Ä—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã (—Å—Ç—Ä–æ–∫–∏ 432-433)

---

### 3. –°–∫—Ä–∏–ø—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ - –°–û–ó–î–ê–ù ‚úÖ

**–§–∞–π–ª:** `backend/scripts/import-challenge3d-historical.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –ø—Ä–æ–¥–∞–∂ –∏–∑ pipelines 9777626 –∏ 9430994
- ‚úÖ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Å 2024-12-29 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- ‚úÖ Phone-based attribution –¥–ª—è original UTM
- ‚úÖ Product type detection (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ Express)
- ‚úÖ Prepaid vs full payment detection
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∞

---

### 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - –ì–û–¢–û–í–ê ‚úÖ

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
1. ‚úÖ `CHALLENGE3D_INTEGRATION_SQL.md` - SQL –¥–ª—è MCP –∞–≥–µ–Ω—Ç–∞
2. ‚úÖ `CHALLENGE3D_INTEGRATION_COMPLETE.md` - —ç—Ç–æ—Ç –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç

---

## ‚è≥ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (—Ç—Ä–µ–±—É—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–µ–±—Ö—É–∫–∏ –≤ AmoCRM

#### 1.1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ AmoCRM:
https://onaiagencykz.amocrm.ru/settings/webhooks

#### 1.2. –°–æ–∑–¥–∞—Ç—å Webhook #1 - Sales (–ü—Ä–æ–¥–∞–∂–∏):

**URL:** `https://onai.academy/api/amocrm/challenge3d-sale`

**–°–æ–±—ã—Ç–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–¥–µ–ª–∫–∏

**–£—Å–ª–æ–≤–∏—è:**
- Pipeline ID: `9777626` (–ö–¶) **–ò–õ–ò** `9430994` (–û–ü)
- Status ID: `142` (–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –§–∏–∫—Å–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `challenge3d_sales`

#### 1.3. –°–æ–∑–¥–∞—Ç—å Webhook #2 - All Leads (–í—Å–µ –∑–∞—è–≤–∫–∏):

**URL:** `https://onai.academy/api/amocrm/challenge3d-lead`

**–°–æ–±—ã—Ç–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–¥–µ–ª–∫–∏

**–£—Å–ª–æ–≤–∏—è:**
- Pipeline ID: `9777626` (–ö–¶) **–ò–õ–ò** `9430994` (–û–ü)
- **–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã** (–Ω–µ —Ç–æ–ª—å–∫–æ 142)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –§–∏–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞—è–≤–∫–∏ (–ª–∏–¥—ã) –≤ —Ç–∞–±–ª–∏—Ü–µ `landing_leads` —Å `source='challenge3d'`

#### 1.4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhooks:

```bash
# Health check - Sales webhook
curl https://onai.academy/api/amocrm/challenge3d-sale/health

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
{
  "status": "ok",
  "service": "Challenge3D Sales Webhook",
  "pipelines": [9777626, 9430994],
  "targetStatus": 142,
  "timestamp": "2026-01-02T..."
}

# Health check - Leads webhook
curl https://onai.academy/api/amocrm/challenge3d-lead/health

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
{
  "status": "ok",
  "service": "Challenge3D Leads Webhook",
  "pipelines": [9777626, 9430994],
  "timestamp": "2026-01-02T..."
}
```

---

### –®–∞–≥ 2: –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ)

#### 2.1. –°–∫—Ä–∏–ø—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ - –°–û–ó–î–ê–ù ‚úÖ

**–§–∞–π–ª:** `backend/scripts/import-challenge3d-historical.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ AmoCRM API
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫ –∏–∑ pipelines 9777626 –∏ 9430994
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É 142 (–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- ‚úÖ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –∏–º–ø–æ—Ä—Ç —Å 2024-12-29 (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∏–Ω–∞—á–µ)
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ UTM –º–µ—Ç–æ–∫ –∏–∑ custom fields
- ‚úÖ Phone-based attribution –¥–ª—è original UTM
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ product type (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ Express)
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ prepaid vs full payment
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `challenge3d_sales` —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∞

**–ó–∞–ø—É—Å–∫:**
```bash
cd backend
set -a && source .env && set +a

# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Å 2024-12-29 –¥–æ —Å–µ–π—á–∞—Å
npx tsx scripts/import-challenge3d-historical.ts

# –£–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥
npx tsx scripts/import-challenge3d-historical.ts --from=2024-12-29 --to=2025-01-02

# –ò–º–ø–æ—Ä—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π
npx tsx scripts/import-challenge3d-historical.ts --days=90
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤–æ—Ä–æ–Ω–∫–∞–º (–ö–¶ vs –û–ü)
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∞–º
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø—É –æ–ø–ª–∞—Ç—ã (prepaid vs full)
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–∞—Ç–∞–º

---

### –®–∞–≥ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Traffic Dashboard

#### 3.1. –û–±–Ω–æ–≤–∏—Ç—å combined-analytics API

**–§–∞–π–ª:** `backend/src/routes/traffic-stats.ts`

**Endpoint:** `GET /api/traffic/combined-analytics?funnel=challenge3d`

**–ó–∞–¥–∞—á–∏:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å fetching –¥–∞–Ω–Ω—ã—Ö –∏–∑ `challenge3d_sales`
- [ ] –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫: spend, revenue, ROAS, CPA
- [ ] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ UTM source/campaign
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ date range filters

#### 3.2. –û–±–Ω–æ–≤–∏—Ç—å funnel-service

**–§–∞–π–ª:** `backend/src/services/funnel-service.ts`

**–ó–∞–¥–∞—á–∏:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å `challenge3d` –≤ `getFunnelMetrics()`
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–æ—Ä–æ–Ω–∫—É:
  1. Spend (Facebook Ads)
  2. Leads (–∏–∑ Vakas Tools –∏–ª–∏ landing_leads)
  3. Prepayments (challenge3d_sales WHERE prepaid=true)
  4. Full Sales (challenge3d_sales WHERE prepaid=false)
- [ ] –†–∞—Å—á–µ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–π –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏

---

### –®–∞–≥ 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Vakas Tools (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í –∫–æ–¥–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Vakas Tools.

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
1. **Manual:** –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Vakas Tools ‚Üí –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ –ë–î
2. **API:** –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Vakas Tools API (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
3. **Alternative:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `landing_leads` –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –ª–∏–¥–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£—Ç–æ—á–Ω–∏—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–∏–¥–æ–≤ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤.

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     AmoCRM Pipelines                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ 9777626 (–ö–¶)     ‚îÇ        ‚îÇ 9430994 (–û–ü)     ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ –ö–æ—Ä–æ—Ç–∫–∏–π –ö—É—Ä—Å    ‚îÇ        ‚îÇ –û—Å–Ω–æ–≤–Ω—ã–µ –ü—Ä–æ–¥—É–∫—Ç—ã‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ           ‚îÇ                            ‚îÇ                     ‚îÇ
‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ
‚îÇ                        ‚îÇ Status 142 (–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ Webhook
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Backend: amocrm-challenge3d-webhook.ts         ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  1. ‚úÖ Validate pipeline_id (9777626 or 9430994)           ‚îÇ
‚îÇ  2. ‚úÖ Validate status_id (142)                            ‚îÇ
‚îÇ  3. ‚úÖ Extract UTM from custom fields (434xxx)             ‚îÇ
‚îÇ  4. ‚úÖ Phone-based attribution (original UTM lookup)       ‚îÇ
‚îÇ  5. ‚úÖ Determine targetologist (Kenesary/Arystan/...)      ‚îÇ
‚îÇ  6. ‚úÖ Detect prepaid vs full payment                      ‚îÇ
‚îÇ  7. ‚úÖ Save to challenge3d_sales                           ‚îÇ
‚îÇ  8. ‚úÖ Return 200 OK (prevent retry)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          Landing DB: challenge3d_sales table                ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  deal_id | pipeline_id | amount | prepaid | utm_source ... ‚îÇ
‚îÇ  123456  | 9777626     | 5000   | true    | fb_kenesary    ‚îÇ
‚îÇ  123457  | 9430994     | 15000  | false   | fb_arystan     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ Query
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Traffic Dashboard (Frontend)                   ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Tab: Challenge3D (üìö –¢—Ä–µ—Ö–¥–Ω–µ–≤–Ω–∏–∫)                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Funnel Pyramid:                                        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  1. Spend (FB Ads)              ‚Üê traffic_stats        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  2. Leads (Vakas/Landing)       ‚Üê external/landing_leads‚îÇ‚îÇ
‚îÇ  ‚îÇ  3. Prepayments                 ‚Üê challenge3d (prepaid)‚îÇ‚îÇ
‚îÇ  ‚îÇ  4. Full Sales                  ‚Üê challenge3d (full)   ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                         ‚îÇ‚îÇ
‚îÇ  ‚îÇ Metrics: ROAS, CPA, Revenue, CTR                       ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AmoCRM

### Custom Field IDs (—É–∂–µ –≤ –∫–æ–¥–µ):
```typescript
UTM_SOURCE: 434731
UTM_MEDIUM: 434727
UTM_CAMPAIGN: 434729
UTM_CONTENT: 434725
UTM_TERM: 434733
UTM_REFERRER: 434735
FBCLID: 434761
```

### Pipeline IDs:
```typescript
CHALLENGE3D_PIPELINES = [
  9777626,  // –ö–¶ (–ö–æ—Ä–æ—Ç–∫–∏–π –ö—É—Ä—Å)
  9430994   // –û–ü (–û—Å–Ω–æ–≤–Ω—ã–µ –ü—Ä–æ–¥—É–∫—Ç—ã)
]
```

### Success Status ID:
```typescript
STATUS_–£–°–ü–ï–®–ù–û = 142  // –£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. Test Webhook Endpoint

```bash
# Health check
curl https://onai.academy/api/amocrm/challenge3d-sale/health

# Test webhook (—Å–∏–º—É–ª—è—Ü–∏—è AmoCRM)
curl -X POST https://onai.academy/api/amocrm/challenge3d-sale \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d 'leads[status][0][id]=999999&leads[status][0][pipeline_id]=9777626&leads[status][0][status_id]=142&leads[status][0][price]=5000'
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ø—Ä–æ–¥–∞–∂
SELECT
  deal_id,
  pipeline_id,
  amount,
  prepaid,
  utm_source,
  utm_campaign,
  sale_date,
  created_at
FROM challenge3d_sales
ORDER BY created_at DESC
LIMIT 10;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ—Ä–æ–Ω–∫–∞–º
SELECT
  pipeline_id,
  prepaid,
  COUNT(*) as sales_count,
  SUM(amount) as total_revenue
FROM challenge3d_sales
GROUP BY pipeline_id, prepaid;
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PM2
pm2 logs onai-backend --lines 100 | grep Challenge3D

# –ò–ª–∏ –µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ npm
# –°–º–æ—Ç—Ä–µ—Ç—å –≤—ã–≤–æ–¥ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –∏—Å–∫–∞—Ç—å "[Challenge3D Webhook]"
```

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|------|-----------|--------|
| `sql/migrations/010_create_challenge3d_sales.sql` | SQL –º–∏–≥—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞ |
| `backend/src/routes/amocrm-challenge3d-webhook.ts` | Webhook –¥–ª—è –ø—Ä–æ–¥–∞–∂ (status 142) | ‚úÖ –°–æ–∑–¥–∞–Ω |
| `backend/src/routes/amocrm-challenge3d-leads-webhook.ts` | Webhook –¥–ª—è –≤—Å–µ—Ö –ª–∏–¥–æ–≤ | ‚úÖ –°–æ–∑–¥–∞–Ω |
| `backend/src/server.ts` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±–æ–∏—Ö webhooks | ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω |
| `backend/scripts/import-challenge3d-historical.ts` | –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç | ‚úÖ –°–æ–∑–¥–∞–Ω |
| `CHALLENGE3D_INTEGRATION_SQL.md` | SQL –¥–ª—è MCP –∞–≥–µ–Ω—Ç–∞ | ‚úÖ –°–æ–∑–¥–∞–Ω |
| `CHALLENGE3D_INTEGRATION_COMPLETE.md` | –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç | ‚úÖ –≠—Ç–æ—Ç —Ñ–∞–π–ª |

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. Deduplication
- 5-–º–∏–Ω—É—Ç–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- Webhook ID = `challenge3d_{leadIds}_{timestamp_minute}`
- –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç retry loop)

### 2. UTM Attribution
- **Last-touch:** –¢–µ–∫—É—â–∏–µ UTM –∏–∑ —Å–¥–µ–ª–∫–∏
- **First-touch:** Phone-based lookup –≤ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–¥–µ–ª–∫–∞—Ö
- **Confidence:** current_deal > related_deal > fallback

### 3. Targetologist Detection
- –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ UTM source/medium/campaign
- –ü–∞—Ç—Ç–µ—Ä–Ω—ã: Kenesary, Arystan, Muha, Traf4
- –í–æ–∑–≤—Ä–∞—Ç `null` –µ—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω

### 4. Prepaid Detection
- –õ–æ–≥–∏–∫–∞: `amount < 10000 KZT` ‚Üí prepaid
- –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
- –ü–æ–ª–µ `package_type` –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞

### 5. Product Type Differentiation ‚≠ê NEW
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `utm_source` (–Ω–∞–ø—Ä–∏–º–µ—Ä, "kenjifb") –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (Challenge3D –∏ Express Course)
- **–†–µ—à–µ–Ω–∏–µ:** –î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
  1. **Pipeline ID** (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π): 9777626/9430994 ‚Üí Challenge3D, 10350882 ‚Üí Express
  2. **utm_campaign keywords**: "3d", "challenge", "—Ç—Ä–µ—Ö–¥–Ω–µ–≤–Ω–∏–∫" ‚Üí Challenge3D, "express", "—ç–∫—Å–ø—Ä–µ—Å—Å" ‚Üí Express
- **–ó–∞—â–∏—Ç–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ Express leads –∏–∑ Challenge3D webhooks
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–µ—Ç –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω–æ–≥–æ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏

---

## üö® –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### ‚ö†Ô∏è Webhook –í–°–ï–ì–î–ê –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK
–î–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö! –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è retry loop –æ—Ç AmoCRM.

### ‚ö†Ô∏è Body Parsers –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –î–û express.json()
AmoCRM –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `application/x-www-form-urlencoded`, –ø–æ—ç—Ç–æ–º—É parsers –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–Ω—å—à–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ `express.json()`.

### ‚ö†Ô∏è Pipeline Filtering
Webhook –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `pipeline_id` –ò `status_id`. –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç (skip).

### ‚ö†Ô∏è Phone-based Attribution
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç `getOriginalUTM()` –∏–∑ `amocrm-utils.ts` –¥–ª—è —Ç–æ—á–Ω–æ–π –∞—Ç—Ä–∏–±—É—Ü–∏–∏ –ø–µ—Ä–≤–æ–≥–æ –∫–∞—Å–∞–Ω–∏—è.

---

## üìû –°–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è

1. **[CRITICAL]** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å 2 webhook –≤ AmoCRM (—Å–º. –®–∞–≥ 1)
   - Webhook #1: Sales (–ø—Ä–æ–¥–∞–∂–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 142)
   - Webhook #2: All Leads (–≤—Å–µ –∑–∞—è–≤–∫–∏)
2. **[IMPORTANT]** –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ (—Å–º. –®–∞–≥ 2)
   - –°–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤, –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
3. **[OPTIONAL]** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ Traffic Dashboard (—Å–º. –®–∞–≥ 3)
4. **[OPTIONAL]** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Vakas Tools (—Å–º. –®–∞–≥ 4)

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞:**
- ‚úÖ –ë–î —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞ (`challenge3d_sales`)
- ‚úÖ 2 Webhook endpoints —Ä–∞–±–æ—Ç–∞—é—Ç (sales + leads)
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ server.ts –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- ‚úÖ –°–∫—Ä–∏–ø—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω
- ‚úÖ Product type differentiation —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ Phone-based attribution —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞

**–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhooks –≤ AmoCRM:**
- –ù–æ–≤—ã–µ –ø—Ä–æ–¥–∞–∂–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ `challenge3d_sales`
- –í—Å–µ –ª–∏–¥—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ `landing_leads`
- –ü–æ–ª–Ω–∞—è UTM –∞—Ç—Ä–∏–±—É—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (first-touch + last-touch)
- Express Course –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è
- –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-02
**–í–µ—Ä—Å–∏—è:** 1.0.0
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û—Å–Ω–æ–≤–∞ –≥–æ—Ç–æ–≤–∞, —Ç—Ä–µ–±—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —à–∞–≥–æ–≤
