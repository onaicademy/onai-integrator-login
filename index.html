<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="build-timestamp" content="1766938476" />
    <title>onAI Academy - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –æ–±—É—á–µ–Ω–∏—è AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- üéØ CYBER-ARCHITECTURE: 3-Font System (Display + Body + Mono) -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Manrope:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <meta name="description" content="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–º—É –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ AI —Ä–µ—à–µ–Ω–∏–π">
    <meta name="author" content="onAI Academy" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta property="og:image" content="/favicon.svg" />
    <meta name="twitter:image" content="/favicon.svg" />
</head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- üî• SMART CACHE CLEAR SCRIPT (Preserves User Data) -->
    <script>
    (function() {
      const BUILD_ID = '20260105-0115-TRAFFIC-FIX';
      const STORED_BUILD = localStorage.getItem('app_build_id');
      
      if (STORED_BUILD !== BUILD_ID) {
        console.log('üßπ [CACHE CLEAR] New build detected:', BUILD_ID);
        
        // 1. Clear Service Workers
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(registrations => {
            registrations.forEach(reg => {
              console.log('üóëÔ∏è Unregistering SW:', reg.scope);
              reg.unregister();
            });
          });
        }
        
        // 2. Clear Cache Storage API
        if ('caches' in window) {
          caches.keys().then(names => {
            names.forEach(name => {
              console.log('üóëÔ∏è Deleting cache:', name);
              caches.delete(name);
            });
          });
        }
        
        // 3. Clear ONLY Vite cache keys (preserve auth & settings)
        try {
          const preserveKeys = [
            'sb-arqhkacellqbhjhbebfh-auth-token',  // Main DB auth
            'sb-pjmvxecykysfrzppdcto-auth-token',  // Tripwire DB auth
            'sb-xikaiavwqinamgolmtcy-auth-token',  // Landing DB auth
            'user_settings',
            'dashboard_filters',
            'traffic_utm_source',
            'traffic_team_id'
          ];
          
          // Save important data
          const savedData = {};
          preserveKeys.forEach(key => {
            savedData[key] = localStorage.getItem(key);
          });
          
          // Clear all localStorage
          localStorage.clear();
          sessionStorage.clear();
          
          // Restore important data
          Object.entries(savedData).forEach(([key, value]) => {
            if (value !== null) {
              localStorage.setItem(key, value);
            }
          });
          
          console.log('üóëÔ∏è Cleared cache (preserved auth & settings)');
        } catch (e) {
          console.warn('Failed to clear storage:', e);
        }
        
        // 4. Clear IndexedDB (Vite cache only)
        if ('indexedDB' in window) {
          try {
            indexedDB.databases().then(dbs => {
              dbs.forEach(db => {
                if (db.name && db.name.includes('vite')) {
                  console.log('üóëÔ∏è Deleting IndexedDB:', db.name);
                  indexedDB.deleteDatabase(db.name);
                }
              });
            });
          } catch (e) {
            console.warn('Failed to clear IndexedDB:', e);
          }
        }
        
        // 5. Set new build ID
        localStorage.setItem('app_build_id', BUILD_ID);
        
        // 6. Force reload without cache
        setTimeout(() => {
          console.log('üîÑ Reloading page...');
          window.location.reload(true);
        }, 500);
      } else {
        console.log('‚úÖ [CACHE] Build ID matches:', BUILD_ID);
      }
    })();
    </script>
  </body>
</html>
