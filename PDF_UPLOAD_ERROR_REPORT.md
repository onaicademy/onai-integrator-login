# üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: PDF –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–µ–∫—Ç:** onAI Academy Integrator  
**–î–∞—Ç–∞:** 15 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô - PDF —Ñ–∞–π–ª—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

---

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ PDF —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:

```
Failed to parse PDF: pdfParse is not a function! Type: object
```

**–§–∞–π–ª –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è**, —Ç–µ–∫—Å—Ç –Ω–µ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è, AI –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

---

## üéØ –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç PDF —Ñ–∞–π–ª —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª –Ω–∞ backend (`POST /api/files/process`)
3. Backend –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ PDF —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `pdf-parse`
4. –¢–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Supabase Storage + Database
5. –¢–µ–∫—Å—Ç –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ OpenAI Assistant –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
6. AI –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞

---

## ‚ùå –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

1. ‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (98504 bytes)
2. ‚úÖ FormData –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞ backend
3. ‚úÖ Multer middleware –ø–æ–ª—É—á–∞–µ—Ç —Ñ–∞–π–ª
4. ‚ùå **PDF –ø–∞—Ä—Å–∏–Ω–≥ –õ–û–ú–ê–ï–¢–°–Ø** - `pdfParse is not a function`
5. ‚ùå –¢–µ–∫—Å—Ç –Ω–µ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è
6. ‚ùå AI –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–∫—Ä—É–∂–µ–Ω–∏–µ

**Backend:**
- Node.js (version: —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, –º–∏–Ω–∏–º—É–º 20.16.0 –∏–ª–∏ 22.3.0+)
- TypeScript 5.9.3
- Express 5.1.0
- –ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: **CommonJS** (`"module": "commonjs"`)
- –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: `C:\onai-integrator-login\backend`

**Frontend:**
- Vite + React + TypeScript
- Port: 8080
- –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: `C:\onai-integrator-login`

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è PDF:**
- –ü–∞–∫–µ—Ç: `pdf-parse`
- –í–µ—Ä—Å–∏—è: **2.4.5** (–ù–û–í–ê–Ø –≤–µ—Ä—Å–∏—è —Å –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π)
- –ú–µ—Å—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏: `backend/node_modules/pdf-parse`

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ pdf-parse@2.4.5

–ò–∑ `backend/node_modules/pdf-parse/package.json`:

```json
{
  "name": "pdf-parse",
  "version": "2.4.5",
  "type": "module",
  "main": "dist/pdf-parse/cjs/index.cjs",
  "exports": {
    ".": {
      "require": {
        "types": "./dist/pdf-parse/cjs/index.d.cts",
        "default": "./dist/pdf-parse/cjs/index.cjs"
      }
    },
    "./node": {
      "require": {
        "types": "./dist/node/cjs/index.d.cts",
        "default": "./dist/node/cjs/index.cjs"
      }
    },
    "./worker": {
      "require": {
        "types": "./dist/worker/cjs/index.d.cts",
        "default": "./dist/worker/cjs/index.cjs"
      }
    }
  },
  "engines": {
    "node": ">=20.16.0 <21 || >=22.3.0"
  }
}
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
1. `"type": "module"` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —è–≤–ª—è–µ—Ç—Å—è ES Module
2. –ï—Å—Ç—å 3 entry points: `.` (–æ—Å–Ω–æ–≤–Ω–æ–π), `./node`, `./worker`
3. –¢—Ä–µ–±—É–µ—Ç Node.js >= 20.16.0 –∏–ª–∏ >= 22.3.0

---

## üõ† –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø—ã—Ç–æ–∫ —Ä–µ—à–µ–Ω–∏—è

### –ü–æ–ø—ã—Ç–∫–∞ 1: ES Module import

**–ö–æ–¥:**
```typescript
import pdfParse from 'pdf-parse';

const data = await pdfParse(buffer);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå `pdfParse is not a function`

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ñ–ª–∏–∫—Ç ES Module –≤ CommonJS –ø—Ä–æ–µ–∫—Ç–µ (`"module": "commonjs"`)

---

### –ü–æ–ø—ã—Ç–∫–∞ 2: CommonJS require

**–ö–æ–¥:**
```typescript
const pdfParse = require('pdf-parse');

const data = await pdfParse(buffer);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå `pdfParse is not a function`

**–õ–æ–≥ –æ—à–∏–±–∫–∏:**
```
Type: undefined
Keys: AbortException, FormatError, InvalidPDFException, Line, 
      LineDirection, LineStore, PDFParser, PasswordException, 
      Point, Rectangle, ResponseException, Shape, Table, 
      UnknownErrorException, VerbosityLevel, getException
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–æ–¥—É–ª—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç **–æ–±—ä–µ–∫—Ç —Å –∫–ª–∞—Å—Å–∞–º–∏**, –∞ –Ω–µ —Ñ—É–Ω–∫—Ü–∏—é –ø–∞—Ä—Å–∏–Ω–≥–∞

---

### –ü–æ–ø—ã—Ç–∫–∞ 3: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π import

**–ö–æ–¥:**
```typescript
const pdfParseModule = await import('pdf-parse');
const pdfParse = pdfParseModule.default || pdfParseModule;

const data = await pdfParse(buffer);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå `pdfParse is not a function`

**–ü—Ä–∏—á–∏–Ω–∞:** `await import()` –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ CommonJS –æ–∫—Ä—É–∂–µ–Ω–∏–∏

---

### –ü–æ–ø—ã—Ç–∫–∞ 4: CommonJS —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π .default

**–ö–æ–¥:**
```typescript
const pdfParseModule = require('pdf-parse');
const pdfParse = typeof pdfParseModule === 'function' 
  ? pdfParseModule 
  : pdfParseModule.default;

const data = await pdfParse(buffer);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå `pdfParse is not a function`

**–ü—Ä–∏—á–∏–Ω–∞:** `pdfParseModule.default` —Ç–æ–∂–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é

---

### –ü–æ–ø—ã—Ç–∫–∞ 5: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ entry point ./node

**–ö–æ–¥:**
```typescript
const pdfParseModule = require('pdf-parse/node');
const pdfParse = pdfParseModule.default || pdfParseModule;

const data = await pdfParse(buffer);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå `pdfParse is not a function! Type: object`

**–õ–æ–≥:**
```
‚ùå API Error: Failed to parse PDF: pdfParse is not a function! Type: object
```

**–ü—Ä–∏—á–∏–Ω–∞:** –î–∞–∂–µ Node.js entry point –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç, –∞ –Ω–µ —Ñ—É–Ω–∫—Ü–∏—é

---

## üìù –¢–µ–∫—É—â–∏–π –∫–æ–¥

### –§–∞–π–ª: `backend/src/services/fileProcessingService.ts`

```typescript
import * as mammoth from 'mammoth';

// pdf-parse v2.4.5 –∏–º–µ–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π entry point –¥–ª—è Node.js!
const pdfParseModule = require('pdf-parse/node');
const pdfParse = pdfParseModule.default || pdfParseModule;

/**
 * –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ PDF
 */
export async function extractTextFromPDF(buffer: Buffer): Promise<string> {
  try {
    console.log('[FileProcessing] –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ PDF...');
    console.log('[FileProcessing] Buffer size:', buffer.length, 'bytes');
    console.log('[FileProcessing] üì¶ pdfParse –º–æ–¥—É–ª—å:', typeof pdfParse);
    
    if (buffer.length === 0) {
      throw new Error('PDF buffer is empty!');
    }
    
    if (typeof pdfParse !== 'function') {
      console.error('[FileProcessing] ‚ùå pdfParse –Ω–µ —Ñ—É–Ω–∫—Ü–∏—è!');
      console.error('[FileProcessing] Type:', typeof pdfParse);
      console.error('[FileProcessing] Module keys:', Object.keys(pdfParseModule).join(', '));
      throw new Error(`pdfParse is not a function! Type: ${typeof pdfParse}`);
    }
    
    const data = await pdfParse(buffer);
    console.log(`[FileProcessing] ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ ${data.text.length} —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ PDF`);
    return data.text;
  } catch (error: any) {
    console.error('[FileProcessing] ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø–∞—Ä—Å–∏–Ω–≥–∞ PDF:');
    console.error('[FileProcessing] –¢–∏–ø –æ—à–∏–±–∫–∏:', error.constructor.name);
    console.error('[FileProcessing] –°–æ–æ–±—â–µ–Ω–∏–µ:', error.message);
    console.error('[FileProcessing] –°—Ç–µ–∫:', error.stack);
    console.error('[FileProcessing] Buffer —Ä–∞–∑–º–µ—Ä:', buffer?.length || 0);
    throw new Error(`Failed to parse PDF: ${error.message}`);
  }
}

/**
 * –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ DOCX
 */
export async function extractTextFromDOCX(buffer: Buffer): Promise<string> {
  try {
    console.log('[FileProcessing] –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ DOCX...');
    console.log('[FileProcessing] Buffer size:', buffer.length, 'bytes');
    
    if (buffer.length === 0) {
      throw new Error('DOCX buffer is empty!');
    }
    
    const result = await mammoth.extractRawText({ buffer });
    console.log(`[FileProcessing] ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ ${result.value.length} —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ DOCX`);
    return result.value;
  } catch (error: any) {
    console.error('[FileProcessing] ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø–∞—Ä—Å–∏–Ω–≥–∞ DOCX:');
    console.error('[FileProcessing] –¢–∏–ø –æ—à–∏–±–∫–∏:', error.constructor.name);
    console.error('[FileProcessing] –°–æ–æ–±—â–µ–Ω–∏–µ:', error.message);
    console.error('[FileProcessing] –°—Ç–µ–∫:', error.stack);
    console.error('[FileProcessing] Buffer —Ä–∞–∑–º–µ—Ä:', buffer?.length || 0);
    throw new Error(`Failed to parse DOCX: ${error.message}`);
  }
}
```

### –§–∞–π–ª: `backend/tsconfig.json`

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "moduleResolution": "node"
  },
  "include": ["src"],
  "exclude": ["node_modules"]
}
```

### –§–∞–π–ª: `backend/package.json`

```json
{
  "name": "backend",
  "version": "1.0.0",
  "type": "commonjs",
  "dependencies": {
    "@supabase/supabase-js": "^2.81.1",
    "@types/multer": "^2.0.0",
    "cors": "^2.8.5",
    "dotenv": "^17.2.3",
    "express": "^5.1.0",
    "express-validator": "^7.3.0",
    "helmet": "^8.1.0",
    "jsonwebtoken": "^9.0.2",
    "mammoth": "^1.11.0",
    "multer": "^2.0.2",
    "openai": "^4.28.0",
    "pdf-parse": "^2.4.5"
  },
  "devDependencies": {
    "@types/cors": "^2.8.19",
    "@types/express": "^5.0.5",
    "@types/jsonwebtoken": "^9.0.10",
    "@types/node": "^24.10.1",
    "nodemon": "^3.1.11",
    "ts-node": "^10.9.2",
    "typescript": "^5.9.3"
  }
}
```

---

## üìä –õ–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–ø—ã—Ç–∫–∏

### Frontend console (–±—Ä–∞—É–∑–µ—Ä)

```
üìé [processFile] –ü–æ–ª—É—á–µ–Ω —Ñ–∞–π–ª: {name: '–ö–≤–∏—Ç–∞–Ω—Ü–∏—è.pdf', size: 98504, type: 'application/pdf'}
üìé [processFile] FormData —Å–æ–∑–¥–∞–Ω, —Ñ–∞–π–ª –¥–æ–±–∞–≤–ª–µ–Ω
üìé [processFile] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ Backend: /api/files/process
üåê API Request: POST http://localhost:3000/api/files/process

‚ùå POST http://localhost:3000/api/files/process 500 (Internal Server Error)
‚ùå API Error: Failed to parse PDF: pdfParse is not a function! Type: object
{error: 'Failed to parse PDF: pdfParse is not a function! Type: object', type: 'Error'}

‚ùå API Request Failed: POST http://localhost:3000/api/files/process
Error: Failed to parse PDF: pdfParse is not a function! Type: object

‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞: Failed to parse PDF: pdfParse is not a function! Type: object
‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∞–π–ª –ö–≤–∏—Ç–∞–Ω—Ü–∏—è.pdf: 
Error: –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∞–π–ª: Failed to parse PDF: pdfParse is not a function! Type: object
```

### Backend logs (–æ–∂–∏–¥–∞–µ–º—ã–µ)

```
[FileController] üîç –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞ (–ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê)...
[FileController] üìÑ –§–∞–π–ª –ø–æ–ª—É—á–µ–Ω: {filename: '–ö–≤–∏—Ç–∞–Ω—Ü–∏—è.pdf', mimetype: 'application/pdf', size: 98504}
[FileController] üìÑ –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ PDF...
[FileProcessing] –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ PDF...
[FileProcessing] Buffer size: 98504 bytes
[FileProcessing] üì¶ pdfParse –º–æ–¥—É–ª—å: object  ‚Üê –ü–†–û–ë–õ–ï–ú–ê –ó–î–ï–°–¨!
[FileProcessing] ‚ùå pdfParse –Ω–µ —Ñ—É–Ω–∫—Ü–∏—è!
[FileProcessing] Type: object
[FileProcessing] Module keys: (–Ω—É–∂–Ω—ã –∫–ª—é—á–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)
[FileProcessing] ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø–∞—Ä—Å–∏–Ω–≥–∞ PDF:
[FileProcessing] –¢–∏–ø –æ—à–∏–±–∫–∏: Error
[FileProcessing] –°–æ–æ–±—â–µ–Ω–∏–µ: pdfParse is not a function! Type: object
```

---

## üî¨ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. **–í–µ—Ä—Å–∏—è Node.js:**
```bash
node --version
```
–¢—Ä–µ–±—É–µ—Ç—Å—è: `>= 20.16.0` –∏–ª–∏ `>= 22.3.0`

2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è pdf-parse:**
```bash
cd backend/node_modules/pdf-parse/dist/node/cjs
ls -la
cat index.cjs
```
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ `index.cjs`

3. **–õ–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∞:**
–î–æ–±–∞–≤–∏—Ç—å –≤ `fileProcessingService.ts`:
```typescript
const pdfParseModule = require('pdf-parse/node');
console.log('pdfParseModule type:', typeof pdfParseModule);
console.log('pdfParseModule keys:', Object.keys(pdfParseModule));
console.log('pdfParseModule.default type:', typeof pdfParseModule.default);
console.log('pdfParseModule.default keys:', pdfParseModule.default ? Object.keys(pdfParseModule.default) : 'undefined');
```

4. **–¢–∏–ø—ã TypeScript:**
```bash
cd backend
npx tsc --showConfig
```

---

## üí° –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –û—Ç–∫–∞—Ç–∏—Ç—å –≤–µ—Ä—Å–∏—é pdf-parse

**–°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è `pdf-parse@1.1.1` —Ä–∞–±–æ—Ç–∞–ª–∞ –ø–æ-–¥—Ä—É–≥–æ–º—É:**

```bash
cd backend
npm uninstall pdf-parse
npm install pdf-parse@1.1.1
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏:**
```typescript
const pdfParse = require('pdf-parse');
const data = await pdfParse(buffer);
console.log(data.text);
```

---

### –†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É

#### –í–∞—Ä–∏–∞–Ω—Ç A: `pdf2json`

```bash
npm install pdf2json
```

```typescript
import PDFParser from 'pdf2json';

export async function extractTextFromPDF(buffer: Buffer): Promise<string> {
  return new Promise((resolve, reject) => {
    const pdfParser = new PDFParser();
    
    pdfParser.on('pdfParser_dataReady', (pdfData: any) => {
      const text = pdfParser.getRawTextContent();
      resolve(text);
    });
    
    pdfParser.on('pdfParser_dataError', (error: any) => {
      reject(error);
    });
    
    pdfParser.parseBuffer(buffer);
  });
}
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: `pdfjs-dist` (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ PDF.js –æ—Ç Mozilla)

```bash
npm install pdfjs-dist
```

```typescript
import * as pdfjsLib from 'pdfjs-dist/legacy/build/pdf';

export async function extractTextFromPDF(buffer: Buffer): Promise<string> {
  const loadingTask = pdfjsLib.getDocument({ data: buffer });
  const pdf = await loadingTask.promise;
  
  let fullText = '';
  
  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const content = await page.getTextContent();
    const pageText = content.items.map((item: any) => item.str).join(' ');
    fullText += pageText + '\n';
  }
  
  return fullText;
}
```

#### –í–∞—Ä–∏–∞–Ω—Ç C: `pdf-lib`

```bash
npm install pdf-lib
```

```typescript
import { PDFDocument } from 'pdf-lib';

export async function extractTextFromPDF(buffer: Buffer): Promise<string> {
  const pdfDoc = await PDFDocument.load(buffer);
  const pages = pdfDoc.getPages();
  
  let fullText = '';
  
  for (const page of pages) {
    const { width, height } = page.getSize();
    const textContent = await page.getTextContent();
    fullText += textContent;
  }
  
  return fullText;
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `pdf-lib` –±–æ–ª—å—à–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è PDF, –∞ –Ω–µ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞.

---

### –†–µ—à–µ–Ω–∏–µ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑ child_process

#### –í–∞—Ä–∏–∞–Ω—Ç A: `pdftk` (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ)

```typescript
import { exec } from 'child_process';
import { promisify } from 'util';
import * as fs from 'fs';
import * as path from 'path';

const execAsync = promisify(exec);

export async function extractTextFromPDF(buffer: Buffer): Promise<string> {
  const tempFilePath = path.join(__dirname, `temp_${Date.now()}.pdf`);
  const outputPath = path.join(__dirname, `temp_${Date.now()}.txt`);
  
  try {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±—É—Ñ–µ—Ä –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
    await fs.promises.writeFile(tempFilePath, buffer);
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º pdftk –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
    await execAsync(`pdftk ${tempFilePath} output ${outputPath} uncompress`);
    
    // –ß–∏—Ç–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    const text = await fs.promises.readFile(outputPath, 'utf-8');
    
    // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
    await fs.promises.unlink(tempFilePath);
    await fs.promises.unlink(outputPath);
    
    return text;
  } catch (error) {
    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ
    if (fs.existsSync(tempFilePath)) await fs.promises.unlink(tempFilePath);
    if (fs.existsSync(outputPath)) await fs.promises.unlink(outputPath);
    throw error;
  }
}
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: Python script —Å `PyPDF2`

**–°–æ–∑–¥–∞—Ç—å:** `backend/scripts/extract_pdf.py`

```python
import sys
import PyPDF2

def extract_text(pdf_path):
    with open(pdf_path, 'rb') as file:
        reader = PyPDF2.PdfReader(file)
        text = ''
        for page in reader.pages:
            text += page.extract_text()
    return text

if __name__ == '__main__':
    pdf_path = sys.argv[1]
    text = extract_text(pdf_path)
    print(text)
```

**–í TypeScript:**

```typescript
import { exec } from 'child_process';
import { promisify } from 'util';
import * as fs from 'fs';
import * as path from 'path';

const execAsync = promisify(exec);

export async function extractTextFromPDF(buffer: Buffer): Promise<string> {
  const tempFilePath = path.join(__dirname, `temp_${Date.now()}.pdf`);
  
  try {
    await fs.promises.writeFile(tempFilePath, buffer);
    
    const scriptPath = path.join(__dirname, '../../scripts/extract_pdf.py');
    const { stdout } = await execAsync(`python ${scriptPath} ${tempFilePath}`);
    
    await fs.promises.unlink(tempFilePath);
    
    return stdout;
  } catch (error) {
    if (fs.existsSync(tempFilePath)) await fs.promises.unlink(tempFilePath);
    throw error;
  }
}
```

---

### –†–µ—à–µ–Ω–∏–µ 4: –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É pdf-parse@2.4.5

**–ù—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –ü–†–ê–í–ò–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é:**

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:**
   - GitHub: https://github.com/mehmet-kozan/pdf-parse
   - Docs: https://mehmet-kozan.github.io/pdf-parse/

2. **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:**
```bash
cd backend/node_modules/pdf-parse
cat README.md
# –ò–ª–∏
cd examples
ls -la
```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å TypeScript —Ç–∏–ø—ã:**
```bash
cd backend/node_modules/pdf-parse/dist/node/cjs
cat index.d.cts
```

4. **–î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```typescript
const pdfParseModule = require('pdf-parse/node');

console.log('=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê pdf-parse ===');
console.log('Module type:', typeof pdfParseModule);
console.log('Module keys:', Object.keys(pdfParseModule));
console.log('Module.default:', pdfParseModule.default);
console.log('Module.default type:', typeof pdfParseModule.default);

if (pdfParseModule.default) {
  console.log('Module.default keys:', Object.keys(pdfParseModule.default));
}

// –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
const variants = [
  pdfParseModule,
  pdfParseModule.default,
  pdfParseModule.parse,
  pdfParseModule.PDFParser,
  pdfParseModule.extractText,
];

for (let i = 0; i < variants.length; i++) {
  console.log(`–í–∞—Ä–∏–∞–Ω—Ç ${i}:`, typeof variants[i]);
}
console.log('=== –ö–û–ù–ï–¶ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ===');
```

---

### –†–µ—à–µ–Ω–∏–µ 5: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ ES Modules

**–ï—Å–ª–∏ pdf-parse v2.4.5 —Ä–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û –∫–∞–∫ ES Module:**

1. **–ò–∑–º–µ–Ω–∏—Ç—å `package.json`:**
```json
{
  "type": "module"
}
```

2. **–ò–∑–º–µ–Ω–∏—Ç—å `tsconfig.json`:**
```json
{
  "compilerOptions": {
    "module": "ES2020",
    "target": "ES2020"
  }
}
```

3. **–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã:**
- `server.ts` ‚Üí `server.mts`
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è `.js` –≤–æ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã

4. **–ò–∑–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã:**
```typescript
import pdfParse from 'pdf-parse/node';

const data = await pdfParse(buffer);
```

**‚ö†Ô∏è –≠—Ç–æ –º–∞—Å—à—Ç–∞–±–Ω–∞—è –ø–µ—Ä–µ–¥–µ–ª–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞!**

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –®–∞–≥ 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (5 –º–∏–Ω—É—Ç)

```bash
cd C:\onai-integrator-login\backend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é Node.js
node --version

# –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ fileProcessingService.ts
# (–∫–æ–¥ –∏–∑ "–†–µ—à–µ–Ω–∏–µ 4" –≤—ã—à–µ)

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend
npm run dev
```

–ó–∞–≥—Ä—É–∑–∏—Ç—å PDF –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å **–í–°–ï –ª–æ–≥–∏** –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ backend.

---

### –®–∞–≥ 2: –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ (10 –º–∏–Ω—É—Ç)

**–û—Ç–∫–∞—Ç–∏—Ç—å –Ω–∞ —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é pdf-parse:**

```bash
cd C:\onai-integrator-login\backend
npm uninstall pdf-parse
npm install pdf-parse@1.1.1
```

**–ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–¥:**
```typescript
const pdfParse = require('pdf-parse');

export async function extractTextFromPDF(buffer: Buffer): Promise<string> {
  const data = await pdfParse(buffer);
  return data.text;
}
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.

---

### –®–∞–≥ 3: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (30 –º–∏–Ω—É—Ç)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pdfjs-dist` (–Ω–∞–¥–µ–∂–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ—Ç Mozilla):**

```bash
npm install pdfjs-dist
```

```typescript
import * as pdfjsLib from 'pdfjs-dist/legacy/build/pdf';

export async function extractTextFromPDF(buffer: Buffer): Promise<string> {
  const loadingTask = pdfjsLib.getDocument({ data: buffer });
  const pdf = await loadingTask.promise;
  
  let fullText = '';
  
  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const content = await page.getTextContent();
    const pageText = content.items.map((item: any) => item.str).join(' ');
    fullText += pageText + '\n';
  }
  
  return fullText;
}
```

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è pdf-parse:**
- GitHub: https://github.com/mehmet-kozan/pdf-parse
- Issues: https://github.com/mehmet-kozan/pdf-parse/issues
- Docs: https://mehmet-kozan.github.io/pdf-parse/

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
- pdfjs-dist: https://github.com/mozilla/pdf.js
- pdf2json: https://github.com/modesty/pdf2json
- pdf-lib: https://pdf-lib.js.org/

---

## üìé –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
C:\onai-integrator-login\
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fileProcessingService.ts  ‚Üê –ü–†–û–ë–õ–ï–ú–ê –ó–î–ï–°–¨
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fileController.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ files.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.ts
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îî‚îÄ‚îÄ node_modules/
‚îÇ       ‚îî‚îÄ‚îÄ pdf-parse/  ‚Üê –í–ï–†–°–ò–Ø 2.4.5
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ openai-assistant.ts
‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ       ‚îî‚îÄ‚îÄ profile/v2/AIChatDialog.tsx
‚îî‚îÄ‚îÄ package.json
```

### –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞

1. `backend/src/services/fileProcessingService.ts` - –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ PDF
2. `backend/package.json` - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
3. `backend/tsconfig.json` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TypeScript
4. `backend/node_modules/pdf-parse/package.json` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é Node.js (`node --version`)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞ pdf-parse
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª—è
- [ ] –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ—Ç–∫–∞—Ç–∏—Ç—å –Ω–∞ `pdf-parse@1.1.1`
- [ ] –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ - –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `pdfjs-dist`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É PDF —Ñ–∞–π–ª–∞
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–µ–∫—Å—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ AI –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞:** 15.11.2025  
**–ê–≤—Ç–æ—Ä:** AI Assistant (Claude Sonnet 4.5)  
**–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤:** –ü–µ—Ä–µ–¥–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É

---

## üî• –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–µ–∫—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

**PDF –∑–∞–≥—Ä—É–∑–∫–∞ - –∫–ª—é—á–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.**  
**–ë–µ–∑ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø—Ä–æ–µ–∫—Ç –Ω–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω.**  

**–¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ!**

