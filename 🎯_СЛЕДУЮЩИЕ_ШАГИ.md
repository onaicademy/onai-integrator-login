# üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò - –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –î–ï–ü–õ–û–Æ

**–î–∞—Ç–∞:** 14 –¥–µ–∫–∞–±—Ä—è 2025  
**Git –∫–æ–º–º–∏—Ç:** ‚úÖ 18a6f2e (–∑–∞–ø—É—à–µ–Ω –Ω–∞ main)  
**–°—Ç–∞—Ç—É—Å:** –ì–û–¢–û–í–û –ö –î–ï–ü–õ–û–Æ –ù–ê –ü–†–û–î–ê–ö–®–ù

---

## ‚úÖ –ß–¢–û –£–ñ–ï –°–î–ï–õ–ê–ù–û

1. ‚úÖ –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞ AmoCRM deduplication
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ TypeScript
4. ‚úÖ –°–æ–∑–¥–∞–Ω—ã checkpoint —Ñ–∞–π–ª—ã –¥–ª—è –Ω–æ–≤—ã—Ö —á–∞—Ç–æ–≤
5. ‚úÖ Git commit + push –Ω–∞ GitHub

---

## üöÄ –®–ê–ì 1: –î–ï–ü–õ–û–ô –ù–ê –ü–†–û–î–ê–ö–®–ù (10 –º–∏–Ω—É—Ç)

### –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É:

```bash
ssh root@178.124.206.52
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π:

```bash
cd /var/www/onai-integrator-login-main
./deploy-production.sh
```

**–ß—Ç–æ —Å–¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
1. –ó–∞–≥—Ä—É–∑–∏—Ç –Ω–æ–≤—ã–π –∫–æ–¥ —Å GitHub (`git reset --hard origin/main`)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm install --legacy-peer-deps`)
3. –°–æ–±–µ—Ä–µ—Ç TypeScript (`npm run build`)
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç PM2 (`pm2 restart onai-backend`)
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç —Å—Ç–∞—Ç—É—Å (`pm2 status`)
6. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç API endpoint (`curl https://api.onai.academy/health`)

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
==========================================
‚úÖ DEPLOYMENT SUCCESSFUL
==========================================

Backend Status: online
API URL: https://api.onai.academy

Recent logs:
... (–±–µ–∑ –æ—à–∏–±–æ–∫)

‚úÖ API is responding
```

---

## üîß –®–ê–ì 2: –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï 50+ –õ–ò–î–û–í (5 –º–∏–Ω—É—Ç)

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:**

### –ó–∞–ø—É—Å—Ç–∏—Ç—å recovery —Å–∫—Ä–∏–ø—Ç:

```bash
# –£–∂–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (ssh root@178.124.206.52)
cd /var/www/onai-integrator-login-main/backend
npx tsx src/scripts/recover-lost-leads.ts
```

### –ß—Ç–æ —Å–¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:

```
üîÑ Starting lost leads recovery...

üìä Found 50 lost leads to recover:

üîß Processing: –ò—Ä–∏–Ω–∞ (irina@example.com)
   Phone: +77773886880
   Source: proftest_muha
   Created: 13/12/2025, 15:30:00
   ‚úÖ AmoCRM: created (Lead ID: 21129401)
   ‚úÖ Database updated
   ‚úÖ Notifications scheduled (10 min delay)

üîß Processing: –î–∞—É—Ä–µ–Ω (dauren@example.com)
   ...

‚úÖ Recovery completed! Processed 50 leads.
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Email/SMS –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å
pm2 logs onai-backend --lines 100 | grep "Email sent\|SMS sent"

# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# ‚úÖ [Lead xxx] Email sent successfully
# ‚úÖ [Lead xxx] SMS sent successfully
```

---

## üìä –®–ê–ì 3: –ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í (5 –º–∏–Ω—É—Ç)

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î (Supabase):

```sql
-- –û—Ç–∫—Ä—ã—Ç—å https://app.supabase.com (leadland project)
-- SQL Editor:

SELECT name, email, phone, amocrm_lead_id, email_sent, sms_sent, created_at
FROM landing_leads
WHERE created_at >= '2025-12-13 12:00:00'
ORDER BY created_at DESC
LIMIT 20;

-- ‚úÖ –û–∂–∏–¥–∞–µ–º:
-- - amocrm_lead_id –∑–∞–ø–æ–ª–Ω–µ–Ω –¥–ª—è –í–°–ï–• –ª–∏–¥–æ–≤
-- - email_sent = true
-- - sms_sent = true
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å AmoCRM:

- –û—Ç–∫—Ä—ã—Ç—å: https://onaiagencykz.amocrm.ru
- –í–æ—Ä–æ–Ω–∫–∞: **Tripwire** (ID: 10350882)
- –≠—Ç–∞–ø: **–∑–∞—è–≤–∫–∞ —Å –ø—Ä–æ—Ñ—Ç–µ—Å—Ç–∞**

**‚úÖ –û–∂–∏–¥–∞–µ–º:** 50+ –Ω–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫ (–∫–∞–∂–¥—ã–π –ª–∏–¥ = –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å–¥–µ–ª–∫–∞)

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Dashboard:

- –û—Ç–∫—Ä—ã—Ç—å: https://onai.academy/target
- **‚úÖ –û–∂–∏–¥–∞–µ–º:** –°—á–µ—Ç—á–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ 0)

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
pm2 logs onai-backend --lines 50

# ‚úÖ –û–∂–∏–¥–∞–µ–º:
# - –ù–µ—Ç –æ—à–∏–±–æ–∫ (‚ùå AmoCRM: Failed)
# - –ï—Å—Ç—å —É—Å–ø–µ—à–Ω—ã–µ —Å–æ–∑–¥–∞–Ω–∏—è: ‚úÖ AmoCRM: Lead created (ID: xxx)
# - –ï—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î: ‚úÖ Database updated with AmoCRM ID
```

---

## üéØ –®–ê–ì 4: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ù–û–í–û–ì–û –õ–ò–î–ê (3 –º–∏–Ω—É—Ç—ã)

### –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞—è–≤–∫—É:

1. –û—Ç–∫—Ä—ã—Ç—å: https://onai.academy/integrator/proftest
2. –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É:
   - –ò–º—è: Test 14 Dec
   - Email: test14dec@example.com
   - –¢–µ–ª–µ—Ñ–æ–Ω: +77777777777

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ª–∏–¥ —Å–æ–∑–¥–∞–ª—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs onai-backend --lines 20

# ‚úÖ –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# üìù Processing proftest lead submission: Test 14 Dec
# ‚úÖ Lead saved to Supabase: xxx
# ‚úÖ AmoCRM: Lead created (ID: xxx, isNew: true)
# ‚úÖ Database updated with AmoCRM ID
# ‚úÖ Notifications scheduled
```

**–ß–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Email/SMS –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å
pm2 logs onai-backend | grep "Test 14 Dec"

# ‚úÖ –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# ‚úÖ [Lead xxx] Email sent successfully
# ‚úÖ [Lead xxx] SMS sent successfully
```

**AmoCRM:**
- –û—Ç–∫—Ä—ã—Ç—å: https://onaiagencykz.amocrm.ru
- –ù–∞–π—Ç–∏ —Å–¥–µ–ª–∫—É: "Test 14 Dec"
- ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Å–æ–∑–¥–∞–ª–∞—Å—å –û–¢–î–ï–õ–¨–ù–ê–Ø —Å–¥–µ–ª–∫–∞ (–Ω–µ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å —Å—Ç–∞—Ä–∞—è)

---

## üìà –®–ê–ì 5: –ú–û–ù–ò–¢–û–†–ò–ù–ì 24 –ß–ê–°–ê

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—ã–µ 2-3 —á–∞—Å–∞:

#### 1. Backend —Ä–∞–±–æ—Ç–∞–µ—Ç:
```bash
ssh root@178.124.206.52
pm2 status

# ‚úÖ –û–∂–∏–¥–∞–µ–º: status: online, restart: 0-1
```

#### 2. –ù–æ–≤—ã–µ –ª–∏–¥—ã —Å–æ–∑–¥–∞—é—Ç—Å—è:
```bash
pm2 logs onai-backend --lines 30 | grep "AmoCRM: Lead created"

# ‚úÖ –î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–µ —Å–¥–µ–ª–∫–∏
```

#### 3. –ù–µ—Ç –æ—à–∏–±–æ–∫:
```bash
pm2 logs onai-backend --err --lines 20

# ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫: "‚ùå AmoCRM: Failed"
```

#### 4. API –æ—Ç–≤–µ—á–∞–µ—Ç:
```bash
curl https://api.onai.academy/health

# ‚úÖ –û–∂–∏–¥–∞–µ–º: {"status":"ok","timestamp":"..."}
```

---

## üö® –ï–°–õ–ò –ß–¢–û-–¢–û –ü–û–®–õ–û –ù–ï –¢–ê–ö

### Backend —É–ø–∞–ª:

```bash
ssh root@178.124.206.52
pm2 restart onai-backend
pm2 logs onai-backend --lines 50
```

### –ù—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```bash
ssh root@178.124.206.52
cd /var/www/onai-integrator-login-main
git log --oneline -5  # –ù–∞–π—Ç–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–º–º–∏—Ç (57c20dd)
git reset --hard 57c20dd
cd backend
npm install --legacy-peer-deps
pm2 restart onai-backend
```

### Recovery —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–ª –¥—É–±–ª–∏–∫–∞—Ç—ã:

**–ù–ï –ü–ê–ù–ò–ö–û–í–ê–¢–¨** - —ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Å–ª–µ –Ω–∞—à–µ–≥–æ —Ñ–∏–∫—Å–∞!  
–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ `findExistingLead` —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–¥–µ–ª–∫–∏ ‚úÖ

---

## ‚úÖ SUCCESS CHECKLIST

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –ø—Ä–æ–≤–µ—Ä—å:

- [ ] Backend –∑–∞–¥–µ–ø–ª–æ–µ–Ω (—Å—Ç–∞—Ç—É—Å: online)
- [ ] Recovery —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω (50+ –ª–∏–¥–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ)
- [ ] –ë–î: –≤—Å–µ –ª–∏–¥—ã –∏–º–µ—é—Ç `amocrm_lead_id`
- [ ] –ë–î: –≤—Å–µ –ª–∏–¥—ã –∏–º–µ—é—Ç `email_sent = true`, `sms_sent = true`
- [ ] AmoCRM: 50+ –Ω–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫ (–∫–∞–∂–¥–∞—è –æ—Ç–¥–µ–ª—å–Ω–∞—è)
- [ ] Dashboard `/target`: —Å—á–µ—Ç—á–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –ª–∏–¥: —Å–æ–∑–¥–∞–µ—Ç—Å—è –û–¢–î–ï–õ–¨–ù–ê–Ø —Å–¥–µ–ª–∫–∞ ‚úÖ
- [ ] –õ–æ–≥–∏: –Ω–µ—Ç –æ—à–∏–±–æ–∫ ‚ùå
- [ ] API: –æ—Ç–≤–µ—á–∞–µ—Ç 200 OK

---

## üìû –ö–û–ù–¢–ê–ö–¢–´

**Email:** mcwin.marketing@gmail.com  
**Phone:** +77773886880

**–°—É–ø–ø–æ—Ä—Ç:**
- AmoCRM: https://onaiagencykz.amocrm.ru
- Supabase: https://app.supabase.com (leadland project)
- Vercel: https://vercel.com/onai/onai-integrator-login

---

## üéâ –§–ò–ù–ê–õ

**–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:**

1. ‚úÖ 50+ –ª–∏–¥–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
2. ‚úÖ –ù–æ–≤—ã–µ –ª–∏–¥—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. ‚úÖ Email/SMS –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
4. ‚úÖ Dashboard —Ä–∞–±–æ—Ç–∞–µ—Ç
5. ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞

**–¢—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–µ–Ω - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç! üöÄ**

---

**–£–¥–∞—á–∏ —Å –¥–µ–ø–ª–æ–µ–º!**
