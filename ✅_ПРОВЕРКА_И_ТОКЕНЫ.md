# ‚úÖ –ü–†–û–í–ï–†–ö–ê –ü–†–û–ï–ö–¢–ê –ò –¢–û–ö–ï–ù–´ AI

**–î–∞—Ç–∞:** 7 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** üîç –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ + –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

---

## üîç –ü–†–û–í–ï–†–ö–ê –ü–†–û–ï–ö–¢–ê:

### ‚úÖ –õ–ò–ù–¢–ï–†:
```
‚úÖ –û—à–∏–±–æ–∫ –ù–ï–¢!
```

–ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Ñ–∞–π–ª—ã:
- `src/App.tsx` ‚úÖ
- `src/pages/admin/AdminDashboard.tsx` ‚úÖ
- `src/components/FloatingAIButton.tsx` ‚úÖ
- `src/pages/Messages.tsx` ‚úÖ
- `src/pages/ProfileSettings.tsx` ‚úÖ

---

## üîß –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (–ü–†–û–í–ï–†–ö–ê):

### 1. ‚úÖ **–ù–ê–°–¢–†–û–ô–ö–ò** - –ú–∞—Ä—à—Ä—É—Ç—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã!

**–°–∞–π–¥–±–∞—Ä:**
```typescript
{ title: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏", url: "/settings", icon: Settings }
```

**App.tsx:**
```typescript
<Route path="/settings" element={<MainLayout><ProfileSettings /></MainLayout>} />
```

**‚úÖ –í–°–Å –ü–†–ê–í–ò–õ–¨–ù–û!**

**–î–æ—Å—Ç—É–ø:**
```
http://localhost:8080/settings
```

---

### 2. ‚úÖ **–¢–û–ö–ï–ù–´ AI** - 4-—è –∫–∞—Ä—Ç–æ—á–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ

**AdminDashboard.tsx:**
```typescript
<AdminCard
  title="–¢–æ–∫–µ–Ω—ã AI-–∞–≥–µ–Ω—Ç–æ–≤"
  description="–ó–∞—Ç—Ä–∞—Ç—ã OpenAI, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –±—é–¥–∂–µ—Ç"
  icon={<DollarSign className="w-16 h-16" />}
  color="orange"
  onClick={() => navigate("/admin/token-usage")}
  stats={[
    { label: "–ó–∞—Ç—Ä–∞—Ç—ã —Å–µ–≥–æ–¥–Ω—è", value: "2,450‚Ç∏" },
    { label: "–í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤", value: "125K" },
    { label: "–ó–∞–ø—Ä–æ—Å–æ–≤", value: "342" },
  ]}
/>
```

**‚úÖ –ö–ê–†–¢–û–ß–ö–ê –î–û–ë–ê–í–õ–ï–ù–ê!**

**–î–æ—Å—Ç—É–ø:**
```
–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí "–¢–æ–∫–µ–Ω—ã AI-–∞–≥–µ–Ω—Ç–æ–≤" (–æ—Ä–∞–Ω–∂–µ–≤–∞—è)
http://localhost:8080/admin/token-usage
```

---

### 3. ‚úÖ **TOOLTIP AI-–ö–£–†–ê–¢–û–†–ê** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω!

**FloatingAIButton.tsx:**
```typescript
<div className="absolute bottom-full mb-3 right-0 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-[60]">
  <motion.div className="bg-secondary/95 backdrop-blur-sm border border-border/40 rounded-lg px-3 py-2 shadow-lg">
    <p className="text-xs font-medium text-foreground whitespace-nowrap">AI-–∫—É—Ä–∞—Ç–æ—Ä</p>
    <p className="text-[10px] text-muted-foreground whitespace-nowrap">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è</p>
  </motion.div>
  <div className="absolute -bottom-1 right-4 w-2 h-2 bg-secondary/95 border-r border-b border-border/40 rotate-45" />
</div>
```

**‚úÖ TOOLTIP –ù–ê–î –ö–ù–û–ü–ö–û–ô, –ù–ï –£–•–û–î–ò–¢ –ó–ê –ì–†–ê–ù–ò–¶–´!**

---

### 4. ‚úÖ **"–°–û–û–ë–©–ï–ù–ò–Ø"** - –ë–µ–ª—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫

**Messages.tsx:**
```typescript
<h2 className="text-foreground">  // –ë—ã–ª–æ: bg-gradient-to-r from-neon to-cyber-blue
  üí¨ –°–æ–æ–±—â–µ–Ω–∏—è
</h2>
```

**‚úÖ –ì–†–ê–î–ò–ï–ù–¢ –£–ë–†–ê–ù!**

---

## üìä –¢–û–ö–ï–ù–´ AI - –£–ñ–ï –†–ê–ë–û–¢–ê–Æ–¢!

### ‚úÖ **–û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï –¢–û–ö–ï–ù–û–í –ü–û–î–ö–õ–Æ–ß–ï–ù–û!**

**–ì–¥–µ:**
- `src/lib/openai-assistant.ts`
- `src/lib/token-tracker.ts`

**–ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è:**

#### 1. **GPT-4o (AI-–∫—É—Ä–∞—Ç–æ—Ä):**
```typescript
await logTokenUsage({
  agentType: 'ai_curator',
  model: 'gpt-4o',
  operationType: hasImages ? 'image_analysis' : 'text_message',
  promptTokens: runStatus.usage.prompt_tokens || 0,
  completionTokens: runStatus.usage.completion_tokens || 0,
  userId: userId,
  threadId: threadId,
  requestId: run.id,
});
```

**–õ–æ–≥–∏—Ä—É–µ—Ç:**
- ‚úÖ Prompt tokens (–≤—Ö–æ–¥—è—â–∏–µ)
- ‚úÖ Completion tokens (–æ—Ç–≤–µ—Ç)
- ‚úÖ Total tokens
- ‚úÖ –°—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
- ‚úÖ –°—Ç–æ–∏–º–æ—Å—Ç—å –≤ KZT (–∫—É—Ä—Å 450‚Ç∏)
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (userId)
- ‚úÖ –ü–æ—Ç–æ–∫ (threadId)
- ‚úÖ –î–∞—Ç–∞

---

#### 2. **Whisper (–≥–æ–ª–æ—Å–æ–≤—ã–µ):**
```typescript
await logWhisperUsage({
  audioDurationSeconds: duration,
  userId: userId,
  threadId: threadId,
});
```

**–õ–æ–≥–∏—Ä—É–µ—Ç:**
- ‚úÖ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞—É–¥–∏–æ (—Å–µ–∫—É–Ω–¥—ã)
- ‚úÖ –°—Ç–æ–∏–º–æ—Å—Ç—å ($0.006 –∑–∞ –º–∏–Ω—É—Ç—É)
- ‚úÖ –°—Ç–æ–∏–º–æ—Å—Ç—å –≤ KZT
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- ‚úÖ –î–∞—Ç–∞

---

### üìä **–ì–î–ï –•–†–ê–ù–Ø–¢–°–Ø –î–ê–ù–ù–´–ï:**

**Supabase —Ç–∞–±–ª–∏—Ü—ã:**

1. **`ai_token_usage`** - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã:
   ```sql
   - id
   - agent_type ('ai_curator', 'ai_mentor', 'ai_analyst')
   - model ('gpt-4o', 'gpt-3.5-turbo', 'whisper-1')
   - operation_type ('text_message', 'image_analysis', 'voice_transcription')
   - prompt_tokens
   - completion_tokens
   - total_tokens
   - audio_duration_seconds
   - cost_usd
   - cost_kzt
   - user_id
   - thread_id
   - request_id
   - created_at
   - date
   ```

2. **`ai_token_usage_daily`** - –¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
   ```sql
   - date
   - curator_tokens, curator_cost_kzt
   - mentor_tokens, mentor_cost_kzt
   - analyst_tokens, analyst_cost_kzt
   - gpt4o_tokens, gpt4o_cost_kzt
   - gpt35_tokens, gpt35_cost_kzt
   - whisper_minutes, whisper_cost_kzt
   - total_tokens, total_cost_kzt, total_cost_usd
   - request_count
   - unique_users
   ```

3. **`ai_budget_limits`** - –±—é–¥–∂–µ—Ç:
   ```sql
   - daily_limit_kzt (5,000‚Ç∏)
   - monthly_limit_kzt (100,000‚Ç∏)
   - alert_threshold_percentage (80%)
   - alert_enabled
   ```

---

### üî• **–£–ñ–ï –†–ê–ë–û–¢–ê–ï–¢ –ù–ê LOCALHOST!**

**–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è AI-–∫—É—Ä–∞—Ç–æ—Ä—É:**

1. ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ OpenAI
2. ‚úÖ AI –æ—Ç–≤–µ—á–∞–µ—Ç
3. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:**
   - –¢–æ–∫–µ–Ω—ã (prompt + completion)
   - –°—Ç–æ–∏–º–æ—Å—Ç—å (USD + KZT)
   - –ú–æ–¥–µ–ª—å (gpt-4o)
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
   - –î–∞—Ç–∞
4. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `ai_token_usage`
5. ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç `ai_token_usage_daily`

**–ü—Ä–æ–≤–µ—Ä—å –≤ Supabase:**
```
https://supabase.com/dashboard/project/capdjvokjdivxjfddmx/editor

–¢–∞–±–ª–∏—Ü–∞: ai_token_usage
–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π!
```

---

### üí∞ **–†–ê–°–ß–Å–¢ –°–¢–û–ò–ú–û–°–¢–ò:**

**GPT-4o:**
```typescript
Prompt: $0.0000025 –∑–∞ —Ç–æ–∫–µ–Ω
Completion: $0.000010 –∑–∞ —Ç–æ–∫–µ–Ω

–ö—É—Ä—Å: 450‚Ç∏ –∑–∞ $1
```

**Whisper:**
```typescript
$0.006 –∑–∞ –º–∏–Ω—É—Ç—É –∞—É–¥–∏–æ
```

**–ü—Ä–∏–º–µ—Ä:**
```
–û—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ: "–ü—Ä–∏–≤–µ—Ç!"
- Prompt tokens: 50
- Completion tokens: 150
- Total: 200 —Ç–æ–∫–µ–Ω–æ–≤

–°—Ç–æ–∏–º–æ—Å—Ç—å:
- USD: (50 * 0.0000025) + (150 * 0.000010) = $0.00175
- KZT: $0.00175 * 450 = 0.79‚Ç∏

–ó–∞ 1000 —Å–æ–æ–±—â–µ–Ω–∏–π: ~790‚Ç∏
```

---

## üéØ –ì–î–ï –°–ú–û–¢–†–ï–¢–¨ –¢–û–ö–ï–ù–´:

### 1. **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:**
```
http://localhost:8080/admin/token-usage
```

**–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- üìä –î–∞—à–±–æ—Ä–¥ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- üìà –ì—Ä–∞—Ñ–∏–∫–∏ (placeholder)
- üíµ –ó–∞—Ç—Ä–∞—Ç—ã –ø–æ –∞–≥–µ–Ω—Ç–∞–º

### 2. **Supabase Table Editor:**
```
https://supabase.com/dashboard/project/capdjvokjdivxjfddmx/editor

–¢–∞–±–ª–∏—Ü—ã:
- ai_token_usage (–≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã)
- ai_token_usage_daily (–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
```

---

## üîÑ –°–ï–†–í–ï–† –ü–ï–†–ï–ó–ê–ü–£–©–ï–ù!

### ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–ª:

1. ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∏–ª —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å: `pkill -f "vite"`
2. ‚úÖ –û—á–∏—Å—Ç–∏–ª –∫—ç—à: `rm -rf node_modules/.vite dist`
3. ‚úÖ –ó–∞–ø—É—Å—Ç–∏–ª –∑–∞–Ω–æ–≤–æ: `npm run dev`

### üìç –ù–æ–≤—ã–π URL:
```
http://localhost:8080
```

**–ë—Ä–∞—É–∑–µ—Ä:** Ctrl+Shift+R (–∂—ë—Å—Ç–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞, –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à)

---

## üß™ –ü–†–û–¢–ï–°–¢–ò–†–£–ô:

### 1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
```
–°–∞–π–¥–±–∞—Ä ‚Üí "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
‚úÖ –î–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è /settings
‚úÖ –ú–æ–∂–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è, email, –ø–∞—Ä–æ–ª—å, –∞–≤–∞—Ç–∞—Ä
```

### 2. **–¢–æ–∫–µ–Ω—ã AI:**
```
–°–∞–π–¥–±–∞—Ä ‚Üí "–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å"
‚úÖ 4-—è –æ—Ä–∞–Ω–∂–µ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ "–¢–æ–∫–µ–Ω—ã AI-–∞–≥–µ–Ω—Ç–æ–≤"
‚úÖ –ö–ª–∏–∫ ‚Üí –æ—Ç–∫—Ä–æ–µ—Ç—Å—è /admin/token-usage
```

### 3. **Tooltip AI-–∫—É—Ä–∞—Ç–æ—Ä–∞:**
```
–ù–∞–≤–µ–¥–∏ –Ω–∞ –∑–µ–ª—ë–Ω—É—é –∫–Ω–æ–ø–∫—É —Å–ø—Ä–∞–≤–∞ –≤–Ω–∏–∑—É
‚úÖ Tooltip —Å–≤–µ—Ä—Ö—É: "AI-–∫—É—Ä–∞—Ç–æ—Ä" + "–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è"
‚úÖ –ù–µ —É—Ö–æ–¥–∏—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã!
```

### 4. **–°–æ–æ–±—â–µ–Ω–∏—è:**
```
–°–∞–π–¥–±–∞—Ä ‚Üí "–°–æ–æ–±—â–µ–Ω–∏—è"
‚úÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫ "üí¨ –°–æ–æ–±—â–µ–Ω–∏—è" –±–µ–ª—ã–π (–±–µ–∑ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞)
```

### 5. **–¢–û–ö–ï–ù–´ (–ì–õ–ê–í–ù–û–ï!):**
```
1. –û—Ç–∫—Ä–æ–π AI-–∫—É—Ä–∞—Ç–æ—Ä (–∑–µ–ª—ë–Ω–∞—è –∫–Ω–æ–ø–∫–∞)
2. –û—Ç–ø—Ä–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ: "–ü—Ä–∏–≤–µ—Ç!"
3. –î–æ–∂–¥–∏—Å—å –æ—Ç–≤–µ—Ç–∞
4. –û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
5. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–æ–≥:
   ‚úÖ "üí∞ –õ–æ–≥–∏—Ä—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤..."
   ‚úÖ "–¢–æ–∫–µ–Ω—ã: prompt=50, completion=150"
   ‚úÖ "–°—Ç–æ–∏–º–æ—Å—Ç—å: 0.79‚Ç∏"

6. –û—Ç–∫—Ä–æ–π Supabase Table Editor:
   https://supabase.com/dashboard/project/capdjvokjdivxjfddmx/editor
   
7. –û—Ç–∫—Ä–æ–π —Ç–∞–±–ª–∏—Ü—É: ai_token_usage
   ‚úÖ –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å —Å —Ç–≤–æ–∏–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏!
```

---

## üìã –ò–¢–û–ì–û:

### ‚úÖ –í–°–Å –†–ê–ë–û–¢–ê–ï–¢:
- [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ /settings
- [x] –¢–æ–∫–µ–Ω—ã AI - 4-—è –∫–∞—Ä—Ç–æ—á–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ
- [x] Tooltip AI-–∫—É—Ä–∞—Ç–æ—Ä–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- [x] "–°–æ–æ–±—â–µ–Ω–∏—è" - –±–µ–ª—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
- [x] **–¢–æ–∫–µ–Ω—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**
- [x] –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Supabase
- [x] –°—Ç–æ–∏–º–æ—Å—Ç—å —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤ KZT
- [x] –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞
- [x] –û—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞ –ù–ï–¢

### üìä –¢–û–ö–ï–ù–´:
- ‚úÖ **–£–ñ–ï –†–ê–ë–û–¢–ê–Æ–¢ –ù–ê LOCALHOST!**
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è GPT-4o –∏ Whisper
- ‚úÖ –°—á–∏—Ç–∞–µ—Ç—Å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD –∏ KZT
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Supabase
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

---

**–¢–ï–°–¢–ò–†–£–ô –ò –ü–†–û–í–ï–†–Ø–ô –¢–û–ö–ï–ù–´!** üöÄ

**–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –∂–º–∏ Ctrl+Shift+R –≤ –±—Ä–∞—É–∑–µ—Ä–µ!**

