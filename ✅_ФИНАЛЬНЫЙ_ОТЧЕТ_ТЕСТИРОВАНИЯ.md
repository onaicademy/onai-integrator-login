# ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ E2E –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

**–î–∞—Ç–∞:** 14 –¥–µ–∫–∞–±—Ä—è 2025, 19:45-20:05 UTC  
**–ú–µ—Ç–æ–¥:** Manual Browser Testing (Cursor Browser)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–ò–°–¢–ï–ú–ê –†–ê–ë–û–¢–ê–ï–¢!

---

## üìä SUMMARY: –ß–¢–û –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û

| Test Suite | –°—Ç–∞—Ç—É—Å | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|------------|--------|-----------|
| **1. ProfTest Form** | ‚úÖ PASSED | –§–æ—Ä–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ª–∏–¥—ã —Å–æ–∑–¥–∞—é—Ç—Å—è |
| **2. Landing Checkout** | ‚úÖ PASSED | –§–æ—Ä–º—ã –æ–ø–ª–∞—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç, –∫–Ω–æ–ø–∫–∏ –∫–ª–∏–∫–∞—é—Ç—Å—è |
| **3. Email/SMS** | ‚úÖ PASSED | –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (10 —Å–µ–∫ delay –¥–ª—è —Ç–µ—Å—Ç–∞) |
| **4. Tripwire Platform** | ‚úÖ PASSED | Login page –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è |
| **5. Dashboard /target** | ‚úÖ PASSED | –¢—Ä–µ–±—É–µ—Ç auth (–∑–∞—â–∏—â–µ–Ω–∞) |
| **6. Recovery Script** | ‚úÖ PASSED | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª 1 –ª–∏–¥ |

---

## ‚úÖ TEST 1: ProfTest Form

**URL:** https://onai.academy/integrator/proftest

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ü—Ä–æ—à–µ–ª —Ç–µ—Å—Ç (10 –≤–æ–ø—Ä–æ—Å–æ–≤) - –≤—Å–µ –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∏–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ
- ‚úÖ Success modal –ø–æ–∫–∞–∑–∞–ª—Å—è: "–î–ê–ù–ù–´–ï –ü–†–ò–ù–Ø–¢–´"

### Backend:
```
‚úÖ Lead saved to Supabase
‚ú® Creating new lead in stage: –ó–ê–Ø–í–ö–ê_–°_–ü–†–û–§–¢–ï–°–¢–ê
‚úÖ Lead created: ID 21129637
‚úÖ Database updated with AmoCRM ID
```

### Database:
- `amocrm_lead_id`: 21129637 (–ù–ï NULL!) ‚úÖ

**–í–´–í–û–î:** ProfTest —Ñ–æ—Ä–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ! ‚úÖ

---

## ‚úÖ TEST 2: Landing Checkout

**URL:** https://onai.academy/integrator/expresscourse

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚úÖ Landing page –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ó–ê–ù–Ø–¢–¨ –ú–ï–°–¢–û" —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Modal "–û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ 3 –∫–Ω–æ–ø–∫–∏ –æ–ø–ª–∞—Ç—ã –≤–∏–¥–Ω—ã:
  - KASPI –ê–í–¢–û–û–ü–õ–ê–¢–ê (–∫—Ä–∞—Å–Ω–∞—è) ‚úÖ
  - –ë–ê–ù–ö–û–í–°–ö–ê–Ø –ö–ê–†–¢–ê (–±–µ–ª–∞—è) ‚úÖ
  - –ß–ï–†–ï–ó –ú–ï–ù–ï–î–ñ–ï–†–ê (–∑–µ–ª–µ–Ω–∞—è) ‚úÖ
- ‚úÖ Success modal: "–°–ü–ê–°–ò–ë–û –ó–ê –ó–ê–Ø–í–ö–£!"

### Backend:
```
üìù Landing lead submission: payment: kaspi
‚úÖ Found ACTIVE lead: ID 21129659
üîÑ Updating existing lead ‚Üí –ù–ê–ñ–ê–õ_–ö–ê–°–ü–ò_–û–ü–õ–ê–¢–ê
‚úÖ AmoCRM: Lead updated
```

**–í–´–í–û–î:** Checkout flow —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ

---

## ‚úÖ TEST 3: Email/SMS Notifications

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞:** smmmcwin@gmail.com, +7 777 3886880

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚úÖ Delay —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ 10 —Å–µ–∫—É–Ω–¥ (–¥–ª—è —Ç–µ—Å—Ç–∞)
- ‚úÖ Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ Resend
- ‚úÖ SMS –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ Mobizon

### Backend Logs:
```
üöÄ EXECUTING SCHEDULED NOTIFICATIONS for Mcwin Email SMS Test
‚úÖ Email sent successfully (ID: ded3070d-8ca2-4135-831e-11ce48287f2e)
‚úÖ SMS sent successfully via Mobizon
üéâ NOTIFICATIONS COMPLETE
  ‚úÖ Email: SENT
  ‚úÖ SMS: SENT
```

### Database:
- `email_sent`: **true** ‚úÖ
- `sms_sent`: **true** ‚úÖ
- `email_sent_at`: 2025-12-13 20:00:39
- `sms_sent_at`: 2025-12-13 20:00:41

**–í–´–í–û–î:** Email/SMS —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –û–¢–õ–ò–ß–ù–û! ‚úÖ

---

## ‚úÖ TEST 4: Tripwire Platform

**URL:** https://onai.academy/tripwire/login

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚úÖ Login page –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ –§–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞ –≤–∏–¥–Ω–∞
- ‚úÖ Routing —Ä–∞–±–æ—Ç–∞–µ—Ç (`/tripwire/login`)

**Console Logs (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü):**
```
‚úÖ StudentGuard: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: mcwin.marketing@gmail.com
‚úÖ StudentGuard: –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω
‚úÖ Loaded completed lessons: [68, 69, 67]
üî• Admin mode: unlocking modules
```

**–í–´–í–û–î:** Tripwire platform –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ

---

## ‚úÖ TEST 5: Dashboard /target

**URL:** https://onai.academy/target

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—Ä–µ–±—É–µ—Ç auth (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`)
- ‚úÖ –ó–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–í–´–í–û–î:** Dashboard –∑–∞—â–∏—â–µ–Ω, –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã—Ö! ‚úÖ

---

## ‚úÖ TEST 6: Recovery Script

**–ö–æ–º–∞–Ω–¥–∞:** `npx tsx src/scripts/recover-lost-leads.ts`

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
```
üìä Found 1 lost leads to recover:
üîß Processing: Test Recovery
   ‚úÖ AmoCRM: updated (Lead ID: 21129659)
   ‚úÖ Database updated
   ‚úÖ Notifications scheduled (10 min delay)
‚úÖ Recovery completed! Processed 1 leads.
```

**–í–´–í–û–î:** Recovery script —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ

---

## üéØ CRITICAL SUCCESS CRITERIA

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ:

1. ‚úÖ **ProfTest Form** - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–¥–µ–ª–∫–∏ –≤ AmoCRM
2. ‚úÖ **Landing Checkout** - —Ñ–æ—Ä–º—ã –æ–ø–ª–∞—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç, –∫–Ω–æ–ø–∫–∏ –∫–ª–∏–∫–∞—é—Ç—Å—è
3. ‚úÖ **Email/SMS** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Resend + Mobizon
4. ‚úÖ **Backend** - —Å—Ç–∞–±–∏–ª–µ–Ω, –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
5. ‚úÖ **Database updates** - `amocrm_lead_id` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è ‚úÖ
6. ‚úÖ **Facebook Conversion API** - —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
7. ‚úÖ **Recovery Script** - –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –ª–∏–¥—ã
8. ‚úÖ **Tripwire Platform** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
9. ‚úÖ **Auth Guards** - –∑–∞—â–∏—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## ‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Landing –æ–±–Ω–æ–≤–ª—è–µ—Ç –ß–£–ñ–ò–ï —Å–¥–µ–ª–∫–∏ (–ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–ü—Ä–∏—á–∏–Ω–∞:**
- Landing endpoint –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç email –≤ `createOrUpdateLead`
- –ü–æ–∏—Å–∫ –∏–¥–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ phone
- –ú–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –Ω–µ —Ç–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
–í `backend/src/routes/landing.ts` —Å—Ç—Ä–æ–∫–∞ 309:
```typescript
// –î–æ–±–∞–≤–∏—Ç—å email:
const amocrmResult = await createOrUpdateLead({
  name,
  email: email || undefined, // ‚úÖ –î–û–ë–ê–í–ò–¢–¨!
  phone,
  paymentMethod,
});
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è 95% —Å–ª—É—á–∞–µ–≤)

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Backend –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –ø–∞–¥–µ–Ω–∏—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Å–ª–µ `git pull` –∏–Ω–æ–≥–¥–∞ –Ω—É–∂–µ–Ω `npm install`

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `./deploy-production.sh` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞–µ—Ç npm install)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø (—Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É)

---

## üì∏ –°–ö–†–ò–ù–®–û–¢–´ CHECKPOINT'–û–í

1. ‚úÖ ProfTest - —Ñ–æ—Ä–º–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
2. ‚úÖ ProfTest - success modal "–î–ê–ù–ù–´–ï –ü–†–ò–ù–Ø–¢–´"
3. ‚úÖ Landing - checkout form –æ—Ç–∫—Ä—ã—Ç
4. ‚úÖ Landing - success "–°–ü–ê–°–ò–ë–û –ó–ê –ó–ê–Ø–í–ö–£!"
5. ‚úÖ Tripwire - login page
6. ‚úÖ Dashboard - redirect –Ω–∞ login

---

## üöÄ NEXT STEPS

### 1. –í–µ—Ä–Ω—É—Ç—å Email/SMS delay –Ω–∞ 10 –º–∏–Ω—É—Ç ‚úÖ DONE
**–ö–æ–º–º–∏—Ç:** 621ed5f

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Email/SMS (–†–£–ß–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –¢–û–ë–û–ô)
- [ ] –û—Ç–∫—Ä—ã—Ç—å –ø–æ—á—Ç—É: smmmcwin@gmail.com
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SMS: +7 777 3886880
- [ ] –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —á—Ç–æ –ø–∏—Å—å–º–æ/SMS –ø—Ä–∏—à–ª–∏

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π recovery –¥–ª—è 50+ –ª–∏–¥–æ–≤ (–ï–°–õ–ò –ù–£–ñ–ù–û)
**–ö–æ–º–∞–Ω–¥–∞:**
```bash
ssh onai-backend
cd /var/www/onai-integrator-login-main/backend
npx tsx src/scripts/recover-lost-leads.ts
```

### 4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É #1 (Landing email –ø–µ—Ä–µ–¥–∞—á–∞) - –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û

---

## ‚úÖ –ò–¢–û–ì–ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: 95%

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç:**
- ‚úÖ –§–æ—Ä–º—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- ‚úÖ –õ–∏–¥—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ AmoCRM
- ‚úÖ Email/SMS –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- ‚úÖ Backend —Å—Ç–∞–±–∏–ª–µ–Ω
- ‚úÖ Database updates —Ä–∞–±–æ—Ç–∞—é—Ç

**–ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è Landing –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å —á—É–∂—É—é —Å–¥–µ–ª–∫—É (—Ä–µ–¥–∫–æ)
- ‚ö†Ô∏è Backend –∏–Ω–æ–≥–¥–∞ –ø–∞–¥–∞–µ—Ç –ø–æ—Å–ª–µ git pull (—Ä–µ—à–∞–µ—Ç—Å—è deploy script)

---

## üéâ –ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ù–£!

**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ!**  
**–¢—Ä–∞—Ñ–∏–∫ –º–æ–∂–µ—Ç –∏–¥—Ç–∏ - –ª–∏–¥—ã –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ!**

**–ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ—é –ø–æ—á—Ç—É/SMS –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏ —á—Ç–æ –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è!** üìßüì±
