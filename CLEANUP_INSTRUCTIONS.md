# üóëÔ∏è –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –û–ß–ò–°–¢–ö–ê –õ–ò–®–ù–ò–• –£–†–û–ö–û–í

**–¶–µ–ª—å:** –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ª–∏—à–Ω–∏–µ —É—Ä–æ–∫–∏, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ **1 —É—Ä–æ–∫** –≤ –∫–∞–∂–¥–æ–º –º–æ–¥—É–ª–µ.

---

## üìã –î–í–ê –°–ü–û–°–û–ë–ê –û–ß–ò–°–¢–ö–ò

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Supabase SQL Editor (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ Backend API

---

## üî• –°–ü–û–°–û–ë 1: Supabase SQL Editor

### –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å Supabase Dashboard
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://supabase.com/dashboard
2. –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç **onAI Academy**
3. –í –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é –≤—ã–±—Ä–∞—Ç—å **SQL Editor**

### –®–∞–≥ 2: –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
–°–∫–æ–ø–∏—Ä—É–π –∏ –≤—ã–ø–æ–ª–Ω–∏ —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å:

```sql
-- –ü–æ–∫–∞–∑–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —É—Ä–æ–∫–æ–≤ –≤ –∫–∞–∂–¥–æ–º –º–æ–¥—É–ª–µ
SELECT 
  m.id as module_id,
  m.title as module_title,
  COUNT(l.id) as lessons_count,
  string_agg(l.id::text, ', ' ORDER BY l.id) as lesson_ids,
  string_agg(l.title, ', ' ORDER BY l.id) as lesson_titles
FROM course_modules m
LEFT JOIN lessons l ON l.module_id = m.id
GROUP BY m.id, m.title
ORDER BY m.id;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–º:**
```
module_id | module_title   | lessons_count | lesson_ids      | lesson_titles
----------|----------------|---------------|-----------------|------------------
1         | –í–≤–µ–¥–µ–Ω–∏–µ       | 13            | 1,2,3,...,15,16 | –£—Ä–æ–∫ 1, –ù–æ–≤—ã–π —É—Ä–æ–∫, ...
2         | –û—Å–Ω–æ–≤—ã         | 5             | 17,18,19,20,21  | –£—Ä–æ–∫ –ê, –ù–æ–≤—ã–π —É—Ä–æ–∫, ...
```

### –®–∞–≥ 3: –£–î–ê–õ–ò–¢–¨ –õ–ò–®–ù–ò–ï –£–†–û–ö–ò
–°–∫–æ–ø–∏—Ä—É–π –∏ –≤—ã–ø–æ–ª–Ω–∏ —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å:

```sql
-- –£–î–ê–õ–Ø–ï–ú –í–°–ï –£–†–û–ö–ò –ö–†–û–ú–ï –ü–ï–†–í–û–ì–û (—Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º ID) –≤ –∫–∞–∂–¥–æ–º –º–æ–¥—É–ª–µ
DELETE FROM lessons
WHERE id NOT IN (
  SELECT MIN(id)
  FROM lessons
  GROUP BY module_id
);
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:**
- –í –º–æ–¥—É–ª–µ 1: –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —É—Ä–æ–∫ —Å `id=1`, —É–¥–∞–ª—è—Ç—Å—è `id=2,3,4,...,16`
- –í –º–æ–¥—É–ª–µ 2: –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —É—Ä–æ–∫ —Å `id=17`, —É–¥–∞–ª—è—Ç—Å—è `id=18,19,20,21`
- –ò —Ç–∞–∫ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–í—ã–ø–æ–ª–Ω–∏ —Å–Ω–æ–≤–∞ –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å:

```sql
SELECT 
  m.id as module_id,
  m.title as module_title,
  COUNT(l.id) as lessons_count,
  l.id as lesson_id,
  l.title as lesson_title
FROM course_modules m
LEFT JOIN lessons l ON l.module_id = m.id
GROUP BY m.id, m.title, l.id, l.title
ORDER BY m.id;
```

**–¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
module_id | module_title   | lessons_count | lesson_id | lesson_title
----------|----------------|---------------|-----------|-------------
1         | –í–≤–µ–¥–µ–Ω–∏–µ       | 1             | 1         | –£—Ä–æ–∫ 1
2         | –û—Å–Ω–æ–≤—ã         | 1             | 17        | –£—Ä–æ–∫ –ê
```

‚úÖ **–ì–æ—Ç–æ–≤–æ!** –ü–æ –æ–¥–Ω–æ–º—É —É—Ä–æ–∫—É –≤ –∫–∞–∂–¥–æ–º –º–æ–¥—É–ª–µ.

---

## üî• –°–ü–û–°–û–ë 2: –ß–µ—Ä–µ–∑ Backend API (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è)

### –°–æ–∑–¥–∞–º endpoint –¥–ª—è –æ—á–∏—Å—Ç–∫–∏:

1. **Backend —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–π route:** `DELETE /api/admin/cleanup-lessons`
2. **–õ–æ–≥–∏–∫–∞:**
   - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è –Ω–∞–π—Ç–∏ –≤—Å–µ —É—Ä–æ–∫–∏
   - –û—Å—Ç–∞–≤–∏—Ç—å —É—Ä–æ–∫ —Å MIN(id)
   - –£–¥–∞–ª–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —á–µ—Ä–µ–∑ `DELETE /api/lessons/:id` (–∫–∞—Å–∫–∞–¥–Ω–æ)

### –ï—Å–ª–∏ —Ö–æ—á–µ—à—å —ç—Ç–æ—Ç —Å–ø–æ—Å–æ–± - —Å–∫–∞–∂–∏, —è —Å–æ–∑–¥–∞–º endpoint!

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ß–¢–û –£–î–ê–õ–ò–¢–°–Ø

–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—Ä–æ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—Å—è (CASCADE):
- ‚úÖ –í–∏–¥–µ–æ –∏–∑ `video_content` (–µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –µ—Å—Ç—å)
- ‚úÖ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∏–∑ `lesson_materials` + —Ñ–∞–π–ª—ã –∏–∑ Supabase Storage
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏–∑ `video_analytics`
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–∑ `progress`

**–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!** –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—á–∏—â–µ–Ω—ã.

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–û–°–õ–ï –û–ß–ò–°–¢–ö–ò

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Frontend
```
http://localhost:8080/course/1/module/1
```
–î–æ–ª–∂–µ–Ω –±—ã—Ç—å **–û–î–ò–ù** —É—Ä–æ–∫ –≤ —Å–ø–∏—Å–∫–µ.

### 2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —É—Ä–æ–∫
```
1. –ù–∞–∂–∞—Ç—å "–î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫"
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ: "–¢–µ—Å—Ç–æ–≤—ã–π —É—Ä–æ–∫"
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ
4. –ù–∞–∂–∞—Ç—å "–°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ"
5. ‚úÖ –î–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å—Å—è –ù–û–í–´–ô —É—Ä–æ–∫ (–Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å ID)
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
```sql
-- –í—Å–µ –º–æ–¥—É–ª–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å >=1 —É—Ä–æ–∫
SELECT m.id, m.title, COUNT(l.id) as lessons 
FROM course_modules m 
LEFT JOIN lessons l ON l.module_id = m.id 
GROUP BY m.id, m.title;
```

---

## üìä –°–ö–û–õ–¨–ö–û –ë–£–î–ï–¢ –£–î–ê–õ–ï–ù–û?

–ï—Å–ª–∏ —É —Ç–µ–±—è –±—ã–ª–æ:
```
–ú–æ–¥—É–ª—å 1: 13 —É—Ä–æ–∫–æ–≤ (ID 1-15, –ø—Ä–æ–ø—É—Å–∫–∏ –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫)
–ú–æ–¥—É–ª—å 2: 5 —É—Ä–æ–∫–æ–≤
–ú–æ–¥—É–ª—å 3: 3 —É—Ä–æ–∫–∞
...
–ú–æ–¥—É–ª—å 9: 2 —É—Ä–æ–∫–∞
```

**–ò—Ç–æ–≥–æ:** ~50-60 —É—Ä–æ–∫–æ–≤

–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:
```
–ú–æ–¥—É–ª—å 1: 1 —É—Ä–æ–∫ (ID 1)
–ú–æ–¥—É–ª—å 2: 1 —É—Ä–æ–∫ (ID 17)
–ú–æ–¥—É–ª—å 3: 1 —É—Ä–æ–∫ (ID ...)
...
–ú–æ–¥—É–ª—å 9: 1 —É—Ä–æ–∫ (ID ...)
```

**–ò—Ç–æ–≥–æ:** 9 —É—Ä–æ–∫–æ–≤ (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –º–æ–¥—É–ª–µ–π)

**–ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ:** ~40-50 —É—Ä–æ–∫–æ–≤

---

## üîÑ ROLLBACK (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

**–ü–ï–†–ï–î —É–¥–∞–ª–µ–Ω–∏–µ–º —Å–¥–µ–ª–∞–π backup:**

```sql
-- –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
CREATE TABLE lessons_backup AS 
SELECT * FROM lessons;

-- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å:
DELETE FROM lessons;
INSERT INTO lessons SELECT * FROM lessons_backup;
DROP TABLE lessons_backup;
```

---

## üöÄ –ì–û–¢–û–í? –î–ï–ô–°–¢–í–£–ô!

1. ‚úÖ –û—Ç–∫—Ä–æ–π Supabase SQL Editor
2. ‚úÖ –í—ã–ø–æ–ª–Ω–∏ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ **–®–∞–≥ 2, 3, 4**
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Frontend
4. ‚úÖ –ù–∞–ø–∏—à–∏ –º–Ω–µ: "–û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

---

**–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å –∏–ª–∏ —Ö–æ—á–µ—à—å —Å–ø–æ—Å–æ–± #2 (—á–µ—Ä–µ–∑ API) - —Å–∫–∞–∂–∏!**

