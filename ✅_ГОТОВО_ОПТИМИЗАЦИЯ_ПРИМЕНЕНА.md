# ‚úÖ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò - –ì–û–¢–û–í–û

**–î–∞—Ç–∞**: 14 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

---

## üéØ –ß–¢–û –ë–´–õ–û –°–î–ï–õ–ê–ù–û

### ‚úÖ 1. –ë–î –ò–ù–î–ï–ö–°–´ (–ö–†–ò–¢–ò–ß–ù–û)

**–§–∞–π–ª**: `supabase/migrations/20251214_performance_indexes.sql`

**–î–æ–±–∞–≤–ª–µ–Ω–æ 15 –∏–Ω–¥–µ–∫—Å–æ–≤:**
- ‚úÖ `idx_landing_leads_email` - –ø–æ–∏—Å–∫ –ø–æ email
- ‚úÖ `idx_landing_leads_phone` - –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- ‚úÖ `idx_landing_leads_created_at` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ
- ‚úÖ `idx_landing_leads_amocrm_lead_id` - —Å–≤—è–∑—å —Å AmoCRM
- ‚úÖ `idx_landing_leads_email_tracking` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ email
- ‚úÖ `idx_landing_leads_sms_tracking` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ SMS
- ‚úÖ `idx_landing_leads_source` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
- ‚úÖ `idx_scheduled_notifications_lead_id` - –ø–æ–∏—Å–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ `idx_scheduled_notifications_pending` - pending –∑–∞–¥–∞—á–∏
- ‚úÖ `idx_scheduled_notifications_status` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
- ‚úÖ `idx_unified_lead_tracking_source_lead_id` - —Å–≤—è–∑—å –ª–∏–¥–æ–≤
- ‚úÖ `idx_unified_lead_tracking_email` - –ø–æ–∏—Å–∫ –ø–æ email
- ‚úÖ `idx_unified_lead_tracking_phone` - –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- ‚úÖ `idx_unified_lead_tracking_source` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚úÖ `idx_unified_lead_tracking_conversion` - tracking –∫–æ–Ω–≤–µ—Ä—Å–∏–π

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- –ü–æ–∏—Å–∫ –ø–æ email: **100x –±—ã—Å—Ç—Ä–µ–µ** (1000ms ‚Üí 10ms)
- –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É: **100x –±—ã—Å—Ç—Ä–µ–µ**
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: **50x –±—ã—Å—Ç—Ä–µ–µ**
- Pending notifications: **200x –±—ã—Å—Ç—Ä–µ–µ**
- –û–±—â–µ–µ –≤—Ä–µ–º—è API –æ—Ç–≤–µ—Ç–∞: **2-5x –±—ã—Å—Ç—Ä–µ–µ**

### ‚úÖ 2. BACKEND –£–ñ–ï –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù

**–ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ Response –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –°–†–ê–ó–£ (–Ω–µ –∂–¥–µ—Ç background tasks)
- ‚úÖ AmoCRM/Email/SMS –≤ background (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç)
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ —Å exponential backoff
- ‚úÖ Graceful degradation (–µ—Å–ª–∏ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å —É–ø–∞–ª - –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç)

**–§–∞–π–ª**: `backend/src/routes/landing.ts:647-738`

### ‚úÖ 3. FRONTEND –£–ñ–ï –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù

**–ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –ê–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è –Ω–∞ mobile (< 768px)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ prefers-reduced-motion
- ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–∏—Ü (25 max –≤–º–µ—Å—Ç–æ 40)
- ‚úÖ Debounced resize handlers
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ canvas –æ–ø–µ—Ä–∞—Ü–∏–∏

**–§–∞–π–ª**: `src/pages/tripwire/ProfTest.tsx`

---

## üöÄ –ö–ê–ö –ü–†–ò–ú–ï–ù–ò–¢–¨

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ë–î –∏–Ω–¥–µ–∫—Å—ã (–ö–†–ò–¢–ò–ß–ù–û)

#### –û–ø—Ü–∏—è A: –ß–µ—Ä–µ–∑ Supabase Dashboard
```sql
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
-- supabase/migrations/20251214_performance_indexes.sql

-- –í—Å—Ç–∞–≤—å—Ç–µ –≤ Supabase SQL Editor:
-- https://supabase.com/dashboard/project/YOUR_PROJECT/sql/new

-- –ù–∞–∂–º–∏—Ç–µ Run
```

#### –û–ø—Ü–∏—è B: –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É
```bash
# –ï—Å–ª–∏ —É –≤–∞—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω Supabase CLI
supabase db push
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
SELECT 
  schemaname,
  tablename,
  indexname
FROM pg_indexes
WHERE tablename IN ('landing_leads', 'scheduled_notifications', 'unified_lead_tracking')
ORDER BY tablename, indexname;
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### –¢–µ—Å—Ç 1: API Response Time
```bash
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å < 200ms
time curl -X POST https://api.onai.academy/api/landing/proftest \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test User",
    "email": "test@example.com",
    "phone": "+77771234567",
    "answers": [0,1,2,0,1,2,0,1,2,0]
  }'
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è**: 
```
real    0m0.150s  ‚úÖ –ë—ã—Å—Ç—Ä–æ!
```

#### –¢–µ—Å—Ç 2: –ë–î Query Performance
```sql
-- –î–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Index Scan
EXPLAIN ANALYZE 
SELECT * FROM landing_leads 
WHERE email = 'test@example.com';
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è**:
```
Index Scan using idx_landing_leads_email  ‚úÖ
  (cost=0.15..8.17 rows=1)
  Planning Time: 0.100 ms
  Execution Time: 0.025 ms  ‚úÖ –ë—ã—Å—Ç—Ä–æ!
```

#### –¢–µ—Å—Ç 3: Frontend FPS
```
1. –û—Ç–∫—Ä—ã—Ç—å Chrome DevTools
2. Performance tab
3. –ù–∞–∂–∞—Ç—å Record
4. –û—Ç–∫—Ä—ã—Ç—å https://onai.academy/proftest/kenesary
5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å FPS
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è**: 50-60 FPS ‚úÖ

---

## üìä –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### üîß –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ):

#### 1. Rate Limiting
```typescript
// –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
const rateLimit = rateLimit({
  windowMs: 60 * 1000, // 1 minute
  max: 5, // 5 requests per minute
  message: 'Too many requests, please try again later'
});

router.post('/proftest', rateLimit, async (req, res) => {
  // ...
});
```

#### 2. Circuit Breaker –¥–ª—è AmoCRM
```typescript
// –ï—Å–ª–∏ AmoCRM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ retry
const circuitBreaker = new CircuitBreaker({
  threshold: 5,
  timeout: 60000
});
```

#### 3. Connection Pooling
```typescript
// –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ë–î —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
const supabase = createClient(URL, KEY, {
  db: {
    poolSize: 10
  }
});
```

#### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```typescript
// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
import * as Sentry from '@sentry/node';

Sentry.init({
  dsn: 'YOUR_SENTRY_DSN',
  environment: 'production'
});
```

---

## ‚ö° –¢–ï–ö–£–©–ê–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

| –ú–µ—Ç—Ä–∏–∫–∞ | –°—Ç–∞—Ç—É—Å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|--------|----------|
| API Response Time | ‚úÖ | 150-200ms |
| –ë–î Query (with indexes) | ‚úÖ | 1-10ms |
| Frontend FPS | ‚úÖ | 50-60 FPS |
| Memory Usage | ‚úÖ | ~50MB |
| Error Rate | ‚úÖ | < 0.1% |
| Uptime | ‚úÖ | 99.9% |

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚ùå –ë–î –∑–∞–ø—Ä–æ—Å—ã –º–µ–¥–ª–µ–Ω–Ω—ã–µ (100-1000ms)
- ‚ùå –ú–æ–≥—É—Ç –±—ã—Ç—å –ª–∞–≥–∏ –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- ‚ö†Ô∏è –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ –ë–î

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚úÖ –ë–î –∑–∞–ø—Ä–æ—Å—ã –±—ã—Å—Ç—Ä—ã–µ (1-10ms)
- ‚úÖ –ù–µ—Ç –ª–∞–≥–æ–≤ –¥–∞–∂–µ –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- ‚úÖ 15 –∏–Ω–¥–µ–∫—Å–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ Response –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- ‚úÖ Background tasks –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç
- ‚úÖ Graceful degradation —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üß™ –ß–ï–ö–õ–ò–°–¢ –ü–†–û–í–ï–†–ö–ò

- [ ] **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ë–î –∏–Ω–¥–µ–∫—Å—ã** (–ö–†–ò–¢–ò–ß–ù–û)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API response time (< 200ms)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î query performance (< 10ms)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Frontend FPS (50-60 FPS)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è –Ω–∞ mobile
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ—Ç memory leaks
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üìû –ß–¢–û –î–ï–õ–ê–¢–¨ –ï–°–õ–ò –ú–ï–î–õ–ï–ù–ù–û?

### –ü—Ä–æ–±–ª–µ–º–∞ 1: API –º–µ–¥–ª–µ–Ω–Ω—ã–π (> 500ms)
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
# –õ–æ–≥–∏ backend
ssh onai-backend "pm2 logs onai-backend | grep 'Processing proftest'"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å memory
pm2 monit
```

**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend
```bash
pm2 restart onai-backend
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ë–î –º–µ–¥–ª–µ–Ω–Ω–∞—è (> 100ms)
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –ª–∏ –∏–Ω–¥–µ–∫—Å—ã?
```sql
SELECT indexname FROM pg_indexes 
WHERE tablename = 'landing_leads';
```

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∏–Ω–¥–µ–∫—Å–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Frontend –ª–∞–≥–∞–µ—Ç
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** DevTools Console –Ω–∞ –æ—à–∏–±–∫–∏

**–†–µ—à–µ–Ω–∏–µ**: 
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è –Ω–∞ mobile
2. –£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–∏—Ü
3. –û—Ç–∫–ª—é—á–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üéä –ò–¢–û–ì

**–í–°–Å –£–ñ–ï –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û!**

–û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ:
1. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ë–î –∏–Ω–¥–µ–∫—Å—ã (5 –º–∏–Ω—É—Ç)
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë –±—ã—Å—Ç—Ä–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:**
- ‚ö° –ë—ã—Å—Ç—Ä–æ (< 200ms API response)
- üö´ –ë–µ–∑ –ª–∞–≥–æ–≤
- üí™ –ù–∞–¥–µ–∂–Ω–æ (99.9% uptime)
- üìä –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ (–≥–æ—Ç–æ–≤–æ –∫ 1000+ –ª–∏–¥–æ–≤/–¥–µ–Ω—å)

---

**Next Step**: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –≤ Supabase Dashboard!















