# üìä –°–∏—Å—Ç–µ–º–∞ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –õ–∏–¥–æ–≤ (Lead Tracking Dashboard)

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `lead_tracking` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–∏–¥–∞—Ö
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è Email –∏ SMS —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ 11 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ª–∏–¥–æ–≤ –∏–∑ `tripwire_users`
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∏ (–¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

### 2. Backend API
**–§–∞–π–ª:** `backend/src/routes/lead-tracking.ts`

**Endpoints:**
- `GET /api/lead-tracking/leads` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ª–∏–¥—ã —Å —Å—Ç–∞—Ç—É—Å–∞–º–∏
- `POST /api/lead-tracking/sync` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å AmoCRM
- `POST /api/lead-tracking/update-email-status` - –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å Email
- `POST /api/lead-tracking/update-sms-status` - –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å SMS

### 3. Frontend Dashboard
**–§–∞–π–ª:** `src/pages/admin/LeadTracking.tsx`

**URL:** `/target`

**–§—É–Ω–∫—Ü–∏–∏:**
- üìä –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ª–∏–¥–∞–º
- ‚úâÔ∏è –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã Email (–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ/–æ—Ç–∫—Ä—ã—Ç–æ/–∫–ª–∏–∫–Ω—É—Ç–æ)
- üì± –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã SMS (–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ/–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)
- üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å AmoCRM –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚ö° –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥
```
https://onai.academy/target
```
–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ:
```
http://localhost:5173/target
```

### 2. –ß—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≤–µ—Ä—Ö–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏):
- **–í—Å–µ–≥–æ –ª–∏–¥–æ–≤** - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏–¥–æ–≤
- **–í AmoCRM** - —Å–∫–æ–ª—å–∫–æ –ª–∏–¥–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å AmoCRM
- **Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∏—Å–µ–º
- **Email –æ—Ç–∫—Ä—ã—Ç–æ** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–∏—Å–µ–º
- **SMS –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö SMS
- **SMS –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö SMS

#### –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–æ–≤:
- –ò–º—è –∏ email –ª–∏–¥–∞
- –¢–µ–ª–µ—Ñ–æ–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –°—Ç–∞—Ç—É—Å Email (–∏–∫–æ–Ω–∫–∞: ‚úì –æ—Ç–∫—Ä—ã—Ç, ‚è± –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω, ‚úó –æ—à–∏–±–∫–∞)
- –°—Ç–∞—Ç—É—Å SMS (–∏–∫–æ–Ω–∫–∞: ‚úì –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ, ‚è± –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, ‚úó –æ—à–∏–±–∫–∞)
- ID —Å–¥–µ–ª–∫–∏ –≤ AmoCRM
- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

### 3. –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

- **–û–±–Ω–æ–≤–∏—Ç—å** - –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å AmoCRM** - –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ AmoCRM

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π Email/SMS:

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ Email:

```typescript
await axios.post(`${API_URL}/api/lead-tracking/update-email-status`, {
  leadId: 'uuid-–ª–∏–¥–∞',
  status: 'sent' | 'opened' | 'clicked' | 'error',
  error: '—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏' // —Ç–æ–ª—å–∫–æ –¥–ª—è status: 'error'
});
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ SMS:

```typescript
await axios.post(`${API_URL}/api/lead-tracking/update-sms-status`, {
  leadId: 'uuid-–ª–∏–¥–∞',
  status: 'sent' | 'delivered' | 'error',
  error: '—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏' // —Ç–æ–ª—å–∫–æ –¥–ª—è status: 'error'
});
```

## üìù –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ Email:

```typescript
// –í –≤–∞—à–µ–º —Å–µ—Ä–≤–∏—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ Email
async function sendWelcomeEmail(email: string, name: string) {
  try {
    // 1. –ù–∞—Ö–æ–¥–∏–º –ª–∏–¥–∞ –≤ –±–∞–∑–µ
    const { data: lead } = await supabase
      .from('lead_tracking')
      .select('id')
      .eq('email', email)
      .single();

    // 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º Email
    await resend.emails.send({
      from: 'onai@onai.academy',
      to: email,
      subject: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!',
      html: '<p>–ü—Ä–∏–≤–µ—Ç!</p>'
    });

    // 3. –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    if (lead) {
      await axios.post(`${API_URL}/api/lead-tracking/update-email-status`, {
        leadId: lead.id,
        status: 'sent'
      });
    }
  } catch (error) {
    // 4. –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ —Ç–æ–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    if (lead) {
      await axios.post(`${API_URL}/api/lead-tracking/update-email-status`, {
        leadId: lead.id,
        status: 'error',
        error: error.message
      });
    }
  }
}
```

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AmoCRM:

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å AmoCRM:
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å AmoCRM"
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–¥–µ–ª–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–¥–µ–ª–æ–∫

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:

### –¢–∞–±–ª–∏—Ü–∞: `lead_tracking`

```sql
-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
full_name TEXT              -- –ò–º—è –ª–∏–¥–∞
email TEXT                  -- Email –ª–∏–¥–∞
phone TEXT                  -- –¢–µ–ª–µ—Ñ–æ–Ω –ª–∏–¥–∞
source TEXT                 -- –ò—Å—Ç–æ—á–Ω–∏–∫ (landing, amocrm, manual)

-- AmoCRM
amocrm_deal_id TEXT         -- ID —Å–¥–µ–ª–∫–∏ –≤ AmoCRM
amocrm_contact_id TEXT      -- ID –∫–æ–Ω—Ç–∞–∫—Ç–∞ –≤ AmoCRM
amocrm_status TEXT          -- –°—Ç–∞—Ç—É—Å —Å–¥–µ–ª–∫–∏

-- Email –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
email_sent BOOLEAN          -- Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
email_sent_at TIMESTAMPTZ   -- –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
email_opened BOOLEAN        -- Email –æ—Ç–∫—Ä—ã—Ç
email_opened_at TIMESTAMPTZ -- –ö–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç
email_clicked BOOLEAN       -- –°—Å—ã–ª–∫–∞ –∫–ª–∏–∫–Ω—É—Ç–∞
email_clicked_at TIMESTAMPTZ-- –ö–æ–≥–¥–∞ –∫–ª–∏–∫–Ω—É—Ç–∞
email_error TEXT            -- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

-- SMS –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
sms_sent BOOLEAN            -- SMS –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
sms_sent_at TIMESTAMPTZ     -- –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
sms_delivered BOOLEAN       -- SMS –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
sms_delivered_at TIMESTAMPTZ-- –ö–æ–≥–¥–∞ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
sms_error TEXT              -- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

-- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
metadata JSONB              -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
created_at TIMESTAMPTZ      -- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
updated_at TIMESTAMPTZ      -- –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Email —Å–µ—Ä–≤–∏—Å–æ–º** - –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–∏—Å–µ–º
2. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å SMS —Å–µ—Ä–≤–∏—Å–æ–º** - –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ SMS
3. **Webhook –¥–ª—è Email –æ—Ç–∫—Ä—ã—Ç–∏–π** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –ø–∏—Å—å–º–∞
4. **Webhook –¥–ª—è SMS –¥–æ—Å—Ç–∞–≤–∫–∏** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É SMS

## üî• –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

‚úÖ **11 –ª–∏–¥–æ–≤** —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É
‚úÖ –î–∞—à–±–æ—Ä–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É `/target`
‚úÖ API –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å AmoCRM –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

---

**–°–æ–∑–¥–∞–Ω–æ:** 13 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

