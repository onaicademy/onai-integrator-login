# üî• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ë–ï–°–ö–û–ù–ï–ß–ù–û–ô –ó–ê–ì–†–£–ó–ö–ò

**–î–∞—Ç–∞:** 11 –Ω–æ—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É AdminGuard –∏ MainLayout

---

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:

```
‚è≥ MainLayout: –ñ–¥—ë–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–∏...
üîê AdminGuard: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤...
(–±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
```

### –ü–æ—á–µ–º—É:

1. **AdminGuard** –ø—Ä–æ–≤–µ—Ä—è–ª —Å–µ—Å—Å–∏—é –ò —Ä–æ–ª—å –∏–∑ `profiles`
2. **MainLayout** —Ç–æ–∂–µ –ø—Ä–æ–≤–µ—Ä—è–ª —Å–µ—Å—Å–∏—é –ò —Ä–æ–ª—å –∏–∑ `profiles`
3. –û–Ω–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–∏ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞
4. –†–æ–ª—å **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–ª–∞—Å—å ‚Üí –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –ª–æ–∞–¥–µ—Ä

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:

1. **AdminGuard** ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¢–û–õ–¨–ö–û –Ω–∞–ª–∏—á–∏–µ —Å–µ—Å—Å–∏–∏
2. **MainLayout** ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–æ–ª—å –ò –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ `/admin/*`

---

## üîß –ß–¢–û –ò–ó–ú–ï–ù–ï–ù–û

### 1. **–£–ø—Ä–æ—â—ë–Ω AdminGuard** (src/components/AdminGuard.tsx)

**–ë–´–õ–û:**
```typescript
// –ü—Ä–æ–≤–µ—Ä—è–ª —Å–µ—Å—Å–∏—é
// –ß–∏—Ç–∞–ª —Ä–æ–ª—å –∏–∑ profiles
// –°—Ä–∞–≤–Ω–∏–≤–∞–ª role === 'admin'
// 70+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
```

**–°–¢–ê–õ–û:**
```typescript
export function AdminGuard({ children }: AdminGuardProps) {
  const [isLoading, setIsLoading] = useState(true);
  const [hasSession, setHasSession] = useState(false);

  async function checkSession() {
    console.log('üîê AdminGuard: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏...');
    
    const { data: { session }, error } = await supabase.auth.getSession();
    
    console.log('üìä AdminGuard session:', !!session);

    if (error || !session) {
      console.log('‚ùå AdminGuard: –ù–µ—Ç —Å–µ—Å—Å–∏–∏ ‚Üí /login');
      setHasSession(false);
    } else {
      console.log('‚úÖ AdminGuard: –°–µ—Å—Å–∏—è –µ—Å—Ç—å, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
      setHasSession(true);
    }
  }

  if (!hasSession) {
    return <Navigate to="/login" replace />;
  }

  console.log('‚úÖ AdminGuard: –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω');
  return <>{children}</>;
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¢–û–õ–¨–ö–û –Ω–∞–ª–∏—á–∏–µ —Å–µ—Å—Å–∏–∏
- ‚úÖ –ù–ï —á–∏—Ç–∞–µ—Ç —Ä–æ–ª—å –∏–∑ `profiles`
- ‚úÖ –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `role === 'admin'`
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞: –µ—Å—Ç—å —Å–µ—Å—Å–∏—è ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ–º

---

### 2. **MainLayout –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å** (src/components/layouts/MainLayout.tsx)

**–î–û–ë–ê–í–õ–ï–ù–û:**

```typescript
import { useLocation, useNavigate } from "react-router-dom";

export function MainLayout({ children }: MainLayoutProps) {
  const location = useLocation();
  const navigate = useNavigate();

  async function loadUserRole() {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–∏ ...

    const finalRole = profile?.role === 'admin' ? 'admin' : 'student';
    console.log('‚úÖ MainLayout: –†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞:', finalRole);

    // –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
    if (finalRole !== 'admin' && location.pathname.startsWith('/admin')) {
      console.log('üö´ MainLayout: –†–æ–ª—å –Ω–µ admin, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /courses');
      navigate('/courses', { replace: true });
      return;
    }

    setUserRole(finalRole);
    setIsLoading(false);
  }
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã `useLocation()` –∏ `useNavigate()`
- ‚úÖ –ü–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ `/admin/*`
- ‚úÖ –ï—Å–ª–∏ —Ä–æ–ª—å –Ω–µ `admin` ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/courses`

---

## üìä –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê

### –ü—Ä–∏ –∑–∞—Ö–æ–¥–µ –Ω–∞ `/admin/students-activity`:

```
1. AdminGuard –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –µ—Å—Ç—å –ª–∏ —Å–µ—Å—Å–∏—è?
   ‚îú‚îÄ –ù–µ—Ç ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login
   ‚îî‚îÄ –î–∞ ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–∞–ª—å—à–µ (‚úÖ AdminGuard: –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω)

2. MainLayout –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–æ–ª—å
   ‚îú‚îÄ –ß–∏—Ç–∞–µ—Ç profiles
   ‚îî‚îÄ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç finalRole

3. MainLayout –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: —Ä–æ–ª—å === 'admin'?
   ‚îú‚îÄ –ù–µ—Ç ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /courses
   ‚îî‚îÄ –î–∞ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É

4. AppSidebar –ø–æ–ª—É—á–∞–µ—Ç —Ä–æ–ª—å –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è
```

---

## üìã –û–ñ–ò–î–ê–ï–ú–´–ï –õ–û–ì–ò

### ‚úÖ –ï—Å–ª–∏ –∞–¥–º–∏–Ω:

```
üîê AdminGuard: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏...
üìä AdminGuard session: true
‚úÖ AdminGuard: –°–µ—Å—Å–∏—è –µ—Å—Ç—å, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
‚úÖ AdminGuard: –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω
üîç MainLayout: –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–æ–ª–∏...
üìä SESSION: { user: {...} }
üì§ –ó–∞–ø—Ä–æ—Å –∫ profiles —Å headers...
üì• –û—Ç–≤–µ—Ç profiles: [{ role: 'admin' }]
‚úÖ MainLayout: –†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞: admin
üìã AppSidebar —Ä–æ–ª—å: admin
‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É–Ω–∫—Ç–æ–≤: 7 –¥–ª—è —Ä–æ–ª–∏: admin
```

### üö´ –ï—Å–ª–∏ —Å—Ç—É–¥–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–π—Ç–∏ –Ω–∞ /admin:

```
üîê AdminGuard: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏...
‚úÖ AdminGuard: –°–µ—Å—Å–∏—è –µ—Å—Ç—å, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
‚úÖ AdminGuard: –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω
üîç MainLayout: –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–æ–ª–∏...
‚úÖ MainLayout: –†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞: student
üö´ MainLayout: –†–æ–ª—å –Ω–µ admin, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /courses
(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç)
```

### ‚ùå –ï—Å–ª–∏ –Ω–µ—Ç —Å–µ—Å—Å–∏–∏:

```
üîê AdminGuard: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏...
üìä AdminGuard session: false
‚ùå AdminGuard: –ù–µ—Ç —Å–µ—Å—Å–∏–∏ ‚Üí /login
üö´ AdminGuard: –ù–µ—Ç —Å–µ—Å—Å–∏–∏, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login
(—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login)
```

---

## üìÇ –ò–ó–ú–ï–ù–Å–ù–ù–´–ï –§–ê–ô–õ–´

1. **`src/components/AdminGuard.tsx`**
   - –£–ø—Ä–æ—â—ë–Ω: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å–µ—Å—Å–∏—é
   - –£–¥–∞–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏
   - –£–¥–∞–ª–µ–Ω–æ —á—Ç–µ–Ω–∏–µ –∏–∑ `profiles`

2. **`src/components/layouts/MainLayout.tsx`**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã `useLocation` –∏ `useNavigate`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ `/admin/*`
   - –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/courses` –µ—Å–ª–∏ —Ä–æ–ª—å –Ω–µ `admin`

---

## üéØ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø

### –®–ê–ì 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ dev server

```bash
# Ctrl+C
npm run dev
```

### –®–ê–ì 2: –ó–∞–ª–æ–≥–∏–Ω—å—Å—è

- Email: `saint@onaiacademy.kz`
- Password: (—Ç–≤–æ–π)

### –®–ê–ì 3: –ó–∞–π–¥–∏ –Ω–∞ `/admin/students-activity`

### –®–ê–ì 4: –ù–∞–∂–º–∏ `Ctrl+R` (–æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É)

### –®–ê–ì 5: –°–∫–æ–ø–∏—Ä—É–π –ª–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
üîê AdminGuard: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏...
‚úÖ AdminGuard: –°–µ—Å—Å–∏—è –µ—Å—Ç—å, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
‚úÖ AdminGuard: –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω
üîç MainLayout: –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–æ–ª–∏...
‚úÖ MainLayout: –†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞: admin
üìã AppSidebar —Ä–æ–ª—å: admin
```

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
‚ùå ‚è≥ MainLayout: –ñ–¥—ë–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–∏... (–±–µ—Å–∫–æ–Ω–µ—á–Ω–æ)
```

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

1. ‚úÖ –ù–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
2. ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/admin/*` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∑–∞ 1-2 —Å–µ–∫—É–Ω–¥—ã
3. ‚úÖ –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
4. ‚úÖ –°—Ç—É–¥–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/courses`
5. ‚úÖ –ë–µ–∑ —Å–µ—Å—Å–∏–∏ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`

---

**–ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ! üöÄ**

