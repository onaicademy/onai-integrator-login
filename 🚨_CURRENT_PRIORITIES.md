# üö® –¢–ï–ö–£–©–ò–ï –ü–†–ò–û–†–ò–¢–ï–¢–´ –ü–†–û–ï–ö–¢–ê

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 14 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –í –ü–†–û–¶–ï–°–°–ï –§–ò–ö–°–û–í

---

## ‚ö° –ö–û–ù–¢–ï–ö–°–¢

–ü—Ä–æ–µ–∫—Ç: **Tripwire Platform** (onai.academy)  
–ü—Ä–æ–±–ª–µ–º–∞: **50+ –ª–∏–¥–æ–≤ –ø–æ—Ç–µ—Ä—è–Ω—ã** –≤ AmoCRM –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ deduplication  
–¢—Ä–∞—Ñ–∏–∫: **–ê–ö–¢–ò–í–ï–ù** - –ª–∏–¥—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –ø–æ—Å—Ç—É–ø–∞—Ç—å

---

## üî¥ –ö–†–ò–¢–ò–ß–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ (FIXING NOW)

### 1. AmoCRM Deduplication - –ü–û–¢–ï–†–Ø –õ–ò–î–û–í ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è

**–§–∞–π–ª:** `backend/src/lib/amocrm.ts`  
**–§—É–Ω–∫—Ü–∏—è:** `findExistingLead` (—Å—Ç—Ä–æ–∫–∏ 103-150)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§—É–Ω–∫—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç **–ª—é–±—É—é** —Å–¥–µ–ª–∫—É –∫–æ–Ω—Ç–∞–∫—Ç–∞ (–¥–∞–∂–µ –∑–∞–∫—Ä—ã—Ç—É—é)
- –í—Å–µ –Ω–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç –û–î–ù–£ —Å—Ç–∞—Ä—É—é —Å–¥–µ–ª–∫—É
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 50+ –ª–∏–¥–æ–≤ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã –≤ AmoCRM

**–§–∏–∫—Å:**
```typescript
// –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ê–ö–¢–ò–í–ù–´–ï (–Ω–µ –∑–∞–∫—Ä—ã—Ç—ã–µ) —Å–¥–µ–ª–∫–∏
const CLOSED_STAGES = [
  AMOCRM_CONFIG.STAGES.–£–°–ü–ï–®–ù–û_–†–ï–ê–õ–ò–ó–û–í–ê–ù–û,
  AMOCRM_CONFIG.STAGES.–ó–ê–ö–†–´–¢–û_–ò_–ù–ï_–†–ï–ê–õ–ò–ó–û–í–ê–ù–û
];

const activeLead = leads.find(lead => !CLOSED_STAGES.includes(lead.status_id));

if (!activeLead) {
  return null; // –°–æ–∑–¥–∞—Å—Ç—Å—è –Ω–æ–≤–∞—è —Å–¥–µ–ª–∫–∞
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (—Å–º. –∫–æ–º–º–∏—Ç –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞)

---

### 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ 50+ –ü–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –õ–∏–¥–æ–≤

**–§–∞–π–ª:** `backend/src/scripts/recover-lost-leads.ts`

**–ö–æ–º–∞–Ω–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
ssh root@178.124.206.52
cd /var/www/onai-integrator-login-main/backend
npx tsx src/scripts/recover-lost-leads.ts
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ù–∞—Ö–æ–¥–∏—Ç –ª–∏–¥—ã —Å `amocrm_lead_id: null` (–ø–æ—Å–ª–µ 12:00 13 –¥–µ–∫–∞–±—Ä—è)
2. –°–æ–∑–¥–∞–µ—Ç –û–¢–î–ï–õ–¨–ù–£–Æ —Å–¥–µ–ª–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤ AmoCRM
3. –û–±–Ω–æ–≤–ª—è–µ—Ç `amocrm_lead_id` –≤ –ë–î
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Email/SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–ñ–ò–î–ê–ï–¢ –ó–ê–ü–£–°–ö–ê (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è —Ñ–∏–∫—Å–∞ #1)

---

## üü° –í–ê–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ (NEXT)

### 3. Email/SMS –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –Ω–æ–≤—ã—Ö –ª–∏–¥–æ–≤, –ù–û 50+ —Å—Ç–∞—Ä—ã—Ö –Ω–µ –ø–æ–ª—É—á–∏–ª–∏  
**–†–µ—à–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –ø–æ—Å–ª–µ recovery —Å–∫—Ä–∏–ø—Ç–∞  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** `pm2 logs onai-backend | grep "Email sent\|SMS sent"`

### 4. Dashboard `/target` - –ü—É—Å—Ç—ã–µ —Å—á–µ—Ç—á–∏–∫–∏

**–°—Ç–∞—Ç—É—Å:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 (–∏–∑-–∑–∞ `amocrm_lead_id: null`)  
**–†–µ—à–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ recovery  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –û—Ç–∫—Ä—ã—Ç—å https://onai.academy/target

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì (24 –ß–ê–°–ê –ü–û–°–õ–ï –§–ò–ö–°–û–í)

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:

**1. –ù–æ–≤—ã–µ –ª–∏–¥—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend
pm2 logs onai-backend --lines 50

# –ò—Å–∫–∞—Ç—å —Å—Ç—Ä–æ–∫–∏:
# ‚úÖ AmoCRM: Lead created (ID: XXXXX)
# ‚úÖ Database updated with AmoCRM ID
```

**2. AmoCRM - –∫–∞–∂–¥—ã–π –ª–∏–¥ = –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å–¥–µ–ª–∫–∞:**
- –û—Ç–∫—Ä—ã—Ç—å https://onaiagencykz.amocrm.ru
- –í–æ—Ä–æ–Ω–∫–∞: Tripwire (ID: 10350882)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

**3. Email/SMS –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Supabase (leadland)
SELECT name, email, email_sent, sms_sent, amocrm_lead_id 
FROM landing_leads 
WHERE created_at >= '2025-12-13 12:00:00'
ORDER BY created_at DESC 
LIMIT 20;
```

**4. Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- https://onai.academy/target
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å > 0)

---

## üöÄ –î–ï–ü–õ–û–ô CHECKLIST

### Pre-deploy:
- [x] –§–∏–∫—Å AmoCRM deduplication –ø—Ä–∏–º–µ–Ω–µ–Ω
- [x] –ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] Git commit + push

### Backend deploy:
```bash
ssh root@178.124.206.52
cd /var/www/onai-integrator-login-main
./deploy-production.sh
```

### Post-deploy:
- [ ] `pm2 logs onai-backend` - –Ω–µ—Ç –æ—à–∏–±–æ–∫
- [ ] `curl https://api.onai.academy/health` - 200 OK
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å recovery —Å–∫—Ä–∏–ø—Ç
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å 24 —á–∞—Å–∞

---

## üîó –ö–†–ò–¢–ò–ß–ù–´–ï –§–ê–ô–õ–´

### Backend:
- `backend/src/lib/amocrm.ts` - AmoCRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ò–°–ü–†–ê–í–õ–ï–ù)
- `backend/src/routes/landing.ts` - endpoints `/proftest`, `/submit`
- `backend/src/scripts/recover-lost-leads.ts` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–¥–æ–≤

### Frontend:
- `src/pages/tripwire/ProfTest.tsx` - —Ñ–æ—Ä–º–∞ –ø—Ä–æ—Ñ—Ç–µ—Å—Ç–∞
- `src/components/landing/CheckoutForm.tsx` - —Ñ–æ—Ä–º–∞ –ø–æ–∫—É–ø–∫–∏

### Database:
- Supabase: `leadland` project
- –¢–∞–±–ª–∏—Ü–∞: `landing_leads`
- –í–∞–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏: `amocrm_lead_id`, `email_sent`, `sms_sent`

---

## üìû –≠–ö–°–¢–†–ï–ù–ù–´–ï –ö–û–ú–ê–ù–î–´

**Backend —É–ø–∞–ª:**
```bash
ssh root@178.124.206.52
pm2 restart onai-backend
pm2 logs onai-backend
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î:**
```sql
-- –°–∫–æ–ª—å–∫–æ –ª–∏–¥–æ–≤ –±–µ–∑ AmoCRM ID
SELECT COUNT(*) FROM landing_leads 
WHERE amocrm_lead_id IS NULL 
AND created_at >= '2025-12-13 00:00:00';

-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ª–∏–¥–æ–≤
SELECT name, email, phone, amocrm_lead_id, created_at 
FROM landing_leads 
ORDER BY created_at DESC 
LIMIT 10;
```

---

## ‚úÖ SUCCESS CRITERIA

**–§–∏–∫—Å—ã —Å—á–∏—Ç–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω—ã–º–∏ –∫–æ–≥–¥–∞:**
1. ‚úÖ –ù–æ–≤—ã–µ ProfTest –∑–∞—è–≤–∫–∏ ‚Üí –û–¢–î–ï–õ–¨–ù–ê–Ø —Å–¥–µ–ª–∫–∞ –≤ AmoCRM
2. ‚úÖ 50+ —Å—Ç–∞—Ä—ã—Ö –ª–∏–¥–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (–∫–∞–∂–¥—ã–π = –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å–¥–µ–ª–∫–∞)
3. ‚úÖ `amocrm_lead_id` –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –ë–î –¥–ª—è –≤—Å–µ—Ö –ª–∏–¥–æ–≤
4. ‚úÖ Email/SMS –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ–º –ª–∏–¥–∞–º
5. ‚úÖ Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏
6. ‚úÖ 24 —á–∞—Å–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ - –Ω–µ—Ç –Ω–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º

---

**–¢–†–ê–§–ò–ö –ê–ö–¢–ò–í–ï–ù - –ù–£–ñ–ù–û –§–ò–ö–°–ò–¢–¨ –°–†–û–ß–ù–û!** üöÄ
