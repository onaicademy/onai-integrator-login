# üê∞ BunnyCDN Stream - Production Setup Guide

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û:

### 1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `hls.js`
```bash
npm install hls.js
```

### 2. –°–æ–∑–¥–∞–Ω Pro VideoPlayer (`src/components/VideoPlayer/VideoPlayer.tsx`)

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üé¨ **HLS Streaming** —á–µ—Ä–µ–∑ BunnyCDN
- üéõÔ∏è **Quality Selector** (480p, 720p, 1080p, Auto)
- ‚ö°Ô∏è **Speed Control** (0.5x - 2x)
- üìä **Netflix-style Progress Bar** (2px ‚Üí 6px –Ω–∞ hover)
- üñ•Ô∏è **True Fullscreen** (–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –∫–æ–Ω—Ç—Ä–æ–ª—ã –≤–∏–¥–Ω—ã)
- ‚öôÔ∏è **Settings Menu** (–∫–∞—á–µ—Å—Ç–≤–æ + —Å–∫–æ—Ä–æ—Å—Ç—å –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ)
- üõ°Ô∏è **–ó–∞—â–∏—Ç–∞:** No context menu, no download
- üé® **Glassmorphism Play Button**

### 3. –û–±–Ω–æ–≤–ª—ë–Ω `TripwireLesson.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```tsx
// –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±:
<VideoPlayer src={video.video_url} />

// –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± (BunnyCDN):
<VideoPlayer 
  videoId={video.bunny_video_id || 'TEST_VIDEO_ID'}
  poster={video.thumbnail_url}
  onTimeUpdate={trackVideoTime}
  autoPlay={false}
/>
```

---

## üéØ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:

### Props –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

```typescript
interface VideoPlayerProps {
  videoId: string;           // BunnyCDN Video ID (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  poster?: string;           // URL –ø–æ—Å—Ç–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  onTimeUpdate?: (current: number, duration: number) => void;
  onEnded?: () => void;
  autoPlay?: boolean;        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é false
}
```

### URL —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
https://video.onai.academy/{videoId}/playlist.m3u8
```

---

## üîß –ù–ê–°–¢–†–û–ô–ö–ê BUNNYCDN:

### –®–ê–ì 1: –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –≤ BunnyCDN
1. –ó–∞–π–¥–∏ –≤ **BunnyCDN Dashboard ‚Üí Stream**
2. –°–æ–∑–¥–∞–π –Ω–æ–≤—É—é **Stream Library** (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç)
3. –ó–∞–≥—Ä—É–∑–∏ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ UI –∏–ª–∏ API
4. –°–∫–æ–ø–∏—Ä—É–π **Video ID** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `9d82c6f0-7a16-41ad-b11b-e28e1d84f769`)

### –®–ê–ì 2: –î–æ–±–∞–≤—å Video ID –≤ –±–∞–∑—É
–í —Ç–∞–±–ª–∏—Ü–µ `lessons` –∏–ª–∏ `video_content` –¥–æ–±–∞–≤—å –ø–æ–ª–µ:
```sql
ALTER TABLE lessons 
ADD COLUMN bunny_video_id TEXT;

-- –ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
UPDATE lessons 
SET bunny_video_id = '9d82c6f0-7a16-41ad-b11b-e28e1d84f769'
WHERE id = 29;
```

### –®–ê–ì 3: –û–±–Ω–æ–≤–∏ API endpoint
–í `backend/src/routes/tripwire.ts` –¥–æ–±–∞–≤—å `bunny_video_id` –≤ SELECT:
```typescript
const { data: video } = await supabase
  .from('video_content')
  .select('*, bunny_video_id')  // ‚¨ÖÔ∏è –î–æ–±–∞–≤—å —ç—Ç–æ –ø–æ–ª–µ
  .eq('lesson_id', lessonId)
  .single();
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:

### 1. –ü—Ä–æ–≤–µ—Ä—å UI –ø–ª–µ–µ—Ä–∞:
```
http://localhost:8080/tripwire/module/1/lesson/29
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- ‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ HLS?
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Ç–æ–Ω–∫–∏–π (2-3px)?
- ‚úÖ –ü—Ä–∏ hover ‚Üí 6px –∏ –∫—Ä—É–∂–æ–∫?
- ‚úÖ –ö–ª–∏–∫ –ø–æ Settings (‚öôÔ∏è) –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–µ–Ω—é?
- ‚úÖ –í –º–µ–Ω—é –µ—Å—Ç—å Quality + Speed?
- ‚úÖ Fullscreen —Ä–∞–±–æ—Ç–∞–µ—Ç (–∫–æ–Ω—Ç—Ä–æ–ª—ã –≤–∏–¥–Ω—ã)?
- ‚úÖ –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω?

### 2. –ü—Ä–æ–≤–µ—Ä—å Quality Selector:
- –û—Ç–∫—Ä–æ–π Settings ‚Üí –ö–∞—á–µ—Å—Ç–≤–æ
- –ü–µ—Ä–µ–∫–ª—é—á–∏ –º–µ–∂–¥—É 480p/720p/1080p
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤–∏–¥–µ–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

### 3. –ü—Ä–æ–≤–µ—Ä—å Speed Control:
- –û—Ç–∫—Ä–æ–π Settings ‚Üí –°–∫–æ—Ä–æ—Å—Ç—å
- –ò–∑–º–µ–Ω–∏ –Ω–∞ 1.5x –∏–ª–∏ 2x
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∞—É–¥–∏–æ —Ç–æ–∂–µ —É—Å–∫–æ—Ä—è–µ—Ç—Å—è

### 4. –ü—Ä–æ–≤–µ—Ä—å Fullscreen:
- –ù–∞–∂–º–∏ –Ω–∞ –∏–∫–æ–Ω–∫—É Maximize
- –£–±–µ–¥–∏—Å—å —á—Ç–æ **–≤—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã –≤–∏–¥–Ω—ã** –≤ fullscreen
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ Settings menu —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 5. –ü—Ä–æ–≤–µ—Ä—å —Ç—Ä–µ–∫–∏–Ω–≥:
- –ü–æ—Å–º–æ—Ç—Ä–∏ 30 —Å–µ–∫—É–Ω–¥ –≤–∏–¥–µ–æ
- –û—Ç–∫—Ä–æ–π **Supabase ‚Üí Table Editor ‚Üí video_tracking**
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

---

## üêõ TROUBLESHOOTING:

### –í–∏–¥–µ–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è?
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å Network tab –≤ DevTools
2. –£–±–µ–¥–∏—Å—å —á—Ç–æ URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: `https://video.onai.academy/{videoId}/playlist.m3u8`
3. –ü—Ä–æ–≤–µ—Ä—å CORS –Ω–∞ BunnyCDN (–¥–æ–ª–∂–µ–Ω —Ä–∞–∑—Ä–µ—à–∞—Ç—å —Ç–≤–æ–π –¥–æ–º–µ–Ω)

### Quality Selector –ø—É—Å—Ç–æ–π?
**–†–µ—à–µ–Ω–∏–µ:**
- HLS manifest –º–æ–∂–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—å ABR —É—Ä–æ–≤–Ω–∏
- –ü—Ä–æ–≤–µ—Ä—å –≤ BunnyCDN —á—Ç–æ –≤–∏–¥–µ–æ –±—ã–ª–æ **transcoded** –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—á–µ—Å—Ç–≤

### –ö–æ–Ω—Ç—Ä–æ–ª—ã –Ω–µ –≤–∏–¥–Ω—ã –≤ Fullscreen?
**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Å—å —á—Ç–æ fullscreen –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ **containerRef**, –∞ –Ω–µ –∫ **videoRef**
```tsx
containerRef.current?.requestFullscreen(); // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
videoRef.current?.requestFullscreen();     // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

---

## üìä –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò:

### HLS Events:
```typescript
hls.on(Hls.Events.MANIFEST_PARSED, ...) // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤
hls.on(Hls.Events.ERROR, ...)           // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```

### Adaptive Bitrate:
```typescript
hls.currentLevel = -1;    // Auto (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
hls.currentLevel = 0;     // –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
hls.currentLevel = 1;     // –°—Ä–µ–¥–Ω–µ–µ
hls.currentLevel = 2;     // –í—ã—Å–æ–∫–æ–µ
```

### Safari Native HLS:
```typescript
// Safari –Ω–µ —Ç—Ä–µ–±—É–µ—Ç hls.js
if (video.canPlayType('application/vnd.apple.mpegurl')) {
  video.src = videoUrl;
}
```

---

## üé® UI –ö–û–ú–ü–û–ù–ï–ù–¢–´:

### Settings Menu Structure:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ö–∞—á–µ—Å—Ç–≤–æ        ‚îÇ
‚îÇ ‚úì –ê–≤—Ç–æ         ‚îÇ
‚îÇ   480p         ‚îÇ
‚îÇ   720p         ‚îÇ
‚îÇ   1080p        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –°–∫–æ—Ä–æ—Å—Ç—å       ‚îÇ
‚îÇ   0.5x         ‚îÇ
‚îÇ   1x           ‚îÇ
‚îÇ ‚úì 1.5x         ‚îÇ
‚îÇ   2x           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Progress Bar Animation:
```
Normal:  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê (2px)
Hover:   ‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚óè (6px + thumb)
```

---

## üöÄ PRODUCTION CHECKLIST:

- [ ] –í—Å–µ –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ BunnyCDN
- [ ] `bunny_video_id` –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ë–î –¥–ª—è –≤—Å–µ—Ö —É—Ä–æ–∫–æ–≤
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ BunnyCDN –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –¥–æ–º–µ–Ω–∞
- [ ] CDN –¥–æ–º–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω: `video.onai.academy`
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (iOS Safari, Android Chrome)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ fullscreen –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–∞—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–ø–∞—É–∑—ã –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ Sentry/LogRocket

---

## üìà –ê–ù–ê–õ–ò–¢–ò–ö–ê:

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
1. **Buffer Events** - —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è?
2. **Quality Changes** - –∫–∞–∫ —á–∞—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –∫–∞—á–µ—Å—Ç–≤–æ?
3. **Completion Rate** - —Å–∫–æ–ª—å–∫–æ % —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–æ—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç?
4. **Average Speed** - –∫–∞–∫—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã–±–∏—Ä–∞—é—Ç?
5. **Error Rate** - —Å–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫ HLS?

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `onContextMenu` –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫
- `controlsList="nodownload"` —Å–∫—Ä—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- `playsInline` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ iOS

üîú **–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- Signed URLs (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏)
- DRM (Widevine/FairPlay)
- Watermarking (–Ω–∞–ª–æ–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞)
- –ì–µ–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

---

**üéâ –ì–û–¢–û–í–û! –¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è professional-grade HLS –ø–ª–µ–µ—Ä!** üê∞

