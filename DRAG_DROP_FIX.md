# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: Drag & Drop —É—Ä–æ–∫–æ–≤

**–î–∞—Ç–∞:** 2025-11-18 06:41 UTC  
**–ö–æ–º–º–∏—Ç:** 34fae42  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ó–ê–î–ï–ü–õ–û–ï–ù–û

---

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê:

```
PUT /api/lessons/reorder ‚Üí 500 Internal Server Error

Backend Error:
{
  code: 'PGRST116',
  details: 'The result contains 0 rows',
  message: 'Cannot coerce the result to a single JSON object'
}
```

**–ü—Ä–∏—á–∏–Ω–∞:** Supabase `.update()` –±–µ–∑ `.select()` –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –Ω–æ —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –æ—à–∏–±–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï:

### Backend (`lessons.ts`)

**–ë—ã–ª–æ:**
```typescript
const updates = lessons.map((lesson) =>
  supabase
    .from('lessons')
    .update({ order_index: lesson.order_index })
    .eq('id', parseInt(lesson.id.toString()))
);

await Promise.all(updates);
```

**–°—Ç–∞–ª–æ:**
```typescript
const updates = lessons.map(async (lesson) => {
  const { error } = await supabase
    .from('lessons')
    .update({ order_index: lesson.order_index })
    .eq('id', parseInt(lesson.id.toString()));
  
  if (error) {
    console.error(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É—Ä–æ–∫–∞ ${lesson.id}:`, error);
    throw error;
  }
});

await Promise.all(updates);
```

---

## üöÄ –î–ï–ü–õ–û–ô:

```bash
‚úÖ Git commit: 34fae42
‚úÖ Git push: main ‚Üí GitHub
‚úÖ Backend pull: —É—Å–ø–µ—à–Ω–æ
‚úÖ Backend build: —É—Å–ø–µ—à–Ω–æ
‚úÖ PM2 restart: —É—Å–ø–µ—à–Ω–æ
‚úÖ Status: ONLINE
```

---

## üß™ –ö–ê–ö –¢–ï–°–¢–ò–†–û–í–ê–¢–¨:

### 1. –û—Ç–∫—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—É –º–æ–¥—É–ª—è
```
https://onai.academy/course/1/module/1
```

### 2. –ü–æ–ø—Ä–æ–±—É–π –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å —É—Ä–æ–∫
1. –ù–∞–≤–µ–¥–∏ –Ω–∞ —É—Ä–æ–∫
2. –ü–æ—è–≤–∏—Ç—Å—è –∏–∫–æ–Ω–∫–∞ –∑–∞—Ö–≤–∞—Ç–∞ (||)
3. –ó–∞–∂–º–∏ –∏ –ø–µ—Ä–µ—Ç–∞—â–∏ —É—Ä–æ–∫ –≤–≤–µ—Ä—Ö –∏–ª–∏ –≤–Ω–∏–∑
4. –û—Ç–ø—É—Å—Ç–∏

### 3. –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è alert "–ü–æ—Ä—è–¥–æ–∫ —É—Ä–æ–∫–æ–≤ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!"
- ‚úÖ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–∫–∏ 500
- ‚úÖ –ü–æ—Ä—è–¥–æ–∫ –¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω–∏—Ç—å—Å—è —Å—Ä–∞–∑—É
- ‚úÖ –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã (F5) –ø–æ—Ä—è–¥–æ–∫ –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è

---

## üîç –õ–û–ì–ò BACKEND:

**–£—Å–ø–µ—à–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
```
PUT /api/lessons/reorder
üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ —É—Ä–æ–∫–æ–≤: [ {id: 24, order_index: 0}, {id: 25, order_index: 1} ]
‚úÖ –ü–æ—Ä—è–¥–æ–∫ —É—Ä–æ–∫–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω
```

**–û—à–∏–±–∫–∞ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫):**
```
PUT /api/lessons/reorder
üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ —É—Ä–æ–∫–æ–≤: [...]
‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É—Ä–æ–∫–∞ 24: {...}
‚ùå Reorder lessons error: {...}
```

---

## üìä –°–¢–ê–¢–£–°:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| Backend Fix | ‚úÖ DONE |
| Git Push | ‚úÖ DONE |
| Production Deploy | ‚úÖ DONE |
| Frontend | ‚úÖ –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô |
| Testing | ‚è≥ –¢–ï–°–¢–ò–†–£–ô –°–ï–ô–ß–ê–°! |

---

## üéØ –¢–ï–°–¢ –°–ï–ô–ß–ê–°:

1. –û—Ç–∫—Ä–æ–π: https://onai.academy/course/1/module/1
2. –ü–µ—Ä–µ—Ç–∞—â–∏ —É—Ä–æ–∫
3. **–ü—Ä–æ–≤–µ—Ä—å:**
   - –ù–µ—Ç –æ—à–∏–±–∫–∏ 500?
   - –ü–æ—Ä—è–¥–æ–∫ –∏–∑–º–µ–Ω–∏–ª—Å—è?
   - –ü–æ—Å–ª–µ F5 –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω?

**–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚Üí üéâ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê!  
**–ï—Å–ª–∏ –µ—â—ë –æ—à–∏–±–∫–∞** ‚Üí –°–∫–∞–∂–∏ –º–Ω–µ, —Å–∫–∏–Ω—É –Ω–æ–≤—ã–µ –ª–æ–≥–∏!

---

**–ö–æ–º–º–∏—Ç:** 34fae42  
**Backend:** ONLINE ‚úÖ  
**Ready to test:** –î–ê ‚úÖ




