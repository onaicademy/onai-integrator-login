# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ MainLayout.tsx

**–î–∞—Ç–∞:** 11 –Ω–æ—è–±—Ä—è 2025  
**–¶–µ–ª—å:** –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏ 406 –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ `profiles`

---

## ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ 1: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SESSION –∏ ACCESS_TOKEN

### –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
```typescript
// MainLayout.tsx, —Å—Ç—Ä–æ–∫–∞ 25-28
const { data: { session }, error: sessionError } = await supabase.auth.getSession();

console.log('üìä SESSION:', session);
console.log('üîë ACCESS TOKEN:', session?.access_token);
console.log('‚ùå SESSION ERROR:', sessionError);
```

### –ó–∞—á–µ–º:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å **—Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Å–µ—Å—Å–∏—è** –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å **–µ—Å—Ç—å –ª–∏ access_token** (JWT)
- –í—ã—è–≤–∏—Ç—å **–æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏**

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- `SESSION:` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏ `user`, `access_token`, `refresh_token`
- `ACCESS TOKEN:` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–ª–∏–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (JWT)
- `SESSION ERROR:` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `null`

### –ï—Å–ª–∏ session = null:
‚Üí –ü—Ä–æ–±–ª–µ–º–∞ –≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, —Ç–æ–∫–µ–Ω –ø—Ä–æ—Ç—É—Ö –∏–ª–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è –≤ localStorage

---

## ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ 2: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ profiles

### –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
```typescript
// MainLayout.tsx, —Å—Ç—Ä–æ–∫–∞ 41-49
console.log('üì§ –ó–∞–ø—Ä–æ—Å –∫ profiles —Å headers...');

const { data: profiles, error: profileError } = await supabase
  .from('profiles')
  .select('role')
  .eq('id', user.id)
  .limit(1);

console.log('üì• –û—Ç–≤–µ—Ç profiles:', profiles);
console.log('‚ùå –û—à–∏–±–∫–∞ profiles:', profileError);
```

### –ó–∞—á–µ–º:
- –£–≤–∏–¥–µ—Ç—å **—á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Supabase**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å **–ø—É—Å—Ç–æ–π –ª–∏ –º–∞—Å—Å–∏–≤** `profiles` (–µ—Å–ª–∏ –¥–∞ ‚Üí RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç)
- –£–≤–∏–¥–µ—Ç—å **–¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ 406** (–∫–æ–¥, —Å–æ–æ–±—â–µ–Ω–∏–µ, hint)

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

**–í–∞—Ä–∏–∞–Ω—Ç A (—É—Å–ø–µ—Ö):**
```
üì• –û—Ç–≤–µ—Ç profiles: [{ role: 'admin' }]
‚ùå –û—à–∏–±–∫–∞ profiles: null
```

**–í–∞—Ä–∏–∞–Ω—Ç B (RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç):**
```
üì• –û—Ç–≤–µ—Ç profiles: []
‚ùå –û—à–∏–±–∫–∞ profiles: null
```

**–í–∞—Ä–∏–∞–Ω—Ç C (–æ—à–∏–±–∫–∞ 406):**
```
üì• –û—Ç–≤–µ—Ç profiles: null
‚ùå –û—à–∏–±–∫–∞ profiles: { code: '406', message: '...', hint: '...' }
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ headers

**–ù–ï –ü–†–ò–ú–ï–ù–ï–ù–û:** –ú–µ—Ç–æ–¥ `.headers()` –≤ Supabase JS SDK –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç headers:
- `Content-Type: application/json`
- `apikey: <ANON_KEY>`
- `Authorization: Bearer <ACCESS_TOKEN>`

–Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ `Accept: application/vnd.pgrst.object+json` –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑:
1. –ü—Ä—è–º–æ–π `fetch()` –∑–∞–ø—Ä–æ—Å
2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Supabase –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É** (`Ctrl + R`)
2. **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –∫–æ–Ω—Å–æ–ª–∏:**
   - `üìä SESSION:`
   - `üîë ACCESS TOKEN:`
   - `‚ùå SESSION ERROR:`
   - `üì• –û—Ç–≤–µ—Ç profiles:`
   - `‚ùå –û—à–∏–±–∫–∞ profiles:`
3. **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:**
   - –ï—Å–ª–∏ `SESSION = null` ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –ï—Å–ª–∏ `profiles = []` ‚Üí RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø
   - –ï—Å–ª–∏ `profileError` —Å–æ–¥–µ—Ä–∂–∏—Ç `code: 406` ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ PostgREST

---

## üìÇ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/components/layouts/MainLayout.tsx` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã 5 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á—ë—Ç–∞**

