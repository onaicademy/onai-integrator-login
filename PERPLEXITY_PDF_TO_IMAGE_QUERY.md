# PDF to Image Conversion for OpenAI Vision API (Node.js)

## –ó–ê–î–ê–ß–ê:
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å PDF —Ñ–∞–π–ª—ã (–≤–∫–ª—é—á–∞—è –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏) –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ OpenAI Vision API –≤ Node.js/Express –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

## –¢–ï–ö–£–©–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `pdf-parse` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
- **–ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç** –¥–ª—è –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö PDF (—Å–æ–¥–µ—Ä–∂–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∞ –Ω–µ —Ç–µ–∫—Å—Ç)
- pdf-parse –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç: `textLength: 2`
- –ù—É–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å PDF ‚Üí –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí Vision API

## –¢–†–ï–ë–û–í–ê–ù–ò–Ø:

### 1. Backend (Node.js/Express):
```typescript
// –¢–µ–∫—É—â–∏–π –∫–æ–¥:
export async function processFileUpload(userId: string, file: Express.Multer.File, userQuestion?: string) {
  if (file.mimetype === 'application/pdf') {
    // ‚ùå pdf-parse –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ PDF
    const pdfData = await pdfParse(file.buffer);
    
    if (pdfData.text.length < 10) {
      // ‚úÖ –ù–£–ñ–ù–û: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å PDF ‚Üí –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      // ‚úÖ –ù–£–ñ–ù–û: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Vision API
    }
  }
}
```

### 2. –ß—Ç–æ –Ω—É–∂–Ω–æ:
- ‚úÖ **–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å PDF —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** (PNG/JPG)
- ‚úÖ **–†–∞–±–æ—Ç–∞—Ç—å —Å Buffer** (–Ω–µ —Å —Ñ–∞–π–ª–∞–º–∏ –Ω–∞ –¥–∏—Å–∫–µ)
- ‚úÖ **–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ OpenAI Vision API**
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ multi-page PDF** (—Ö–æ—Ç—è –±—ã –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
- ‚úÖ **–ë–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** (–±–µ–∑ ImageMagick, Poppler –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- ‚úÖ **Pure Node.js** —Ä–µ—à–µ–Ω–∏–µ

### 3. OpenAI Vision API —Ñ–æ—Ä–º–∞—Ç:
```typescript
const response = await openai.chat.completions.create({
  model: 'gpt-4o',
  messages: [{
    role: 'user',
    content: [
      { type: 'text', text: userQuestion },
      { 
        type: 'image_url', 
        image_url: { 
          url: `data:image/png;base64,${base64Image}` 
        }
      }
    ]
  }]
});
```

## –í–û–ü–†–û–°–´ –î–õ–Ø PERPLEXITY:

**Q1:** –ö–∞–∫–∏–µ Node.js –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –º–æ–≥—É—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å PDF ‚Üí –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ **–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**?
- `pdf-to-img`?
- `pdf2pic`?
- `pdf-img-convert`?
- `pdfjs-dist` (Mozilla PDF.js)?
- –î—Ä—É–≥–∏–µ?

**Q2:** –ö–∞–∫ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å PDF Buffer ‚Üí PNG/JPG Buffer –≤ Node.js?

**Q3:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –∫–∞–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è **–æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã** PDF?

**Q4:** –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ PDF ‚Üí base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí Vision API?

**Q5:** –ö–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å **multi-page PDF**? –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é?

**Q6:** –ï—Å—Ç—å –ª–∏ –≥–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è **OCR –Ω–∞ PDF** –≤ Node.js –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤?
- Tesseract.js?
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è?

**Q7:** –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –º–æ–∂–Ω–æ –ª–∏ **–Ω–∞–ø—Ä—è–º—É—é** –æ—Ç–ø—Ä–∞–≤–∏—Ç—å PDF –≤ OpenAI API?

## –ü–†–ò–ú–ï–† –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:

```typescript
// Input: PDF Buffer (182KB, 1 page, scanned document)
const pdfBuffer = file.buffer;

// –ù—É–∂–Ω–æ:
const imageBuffer = await convertPdfToImage(pdfBuffer, { page: 1 });
const base64Image = imageBuffer.toString('base64');

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Vision API:
const response = await openai.chat.completions.create({
  model: 'gpt-4o',
  messages: [{
    role: 'user',
    content: [
      { type: 'text', text: '–ß—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ –≤ —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ?' },
      { type: 'image_url', image_url: { url: `data:image/png;base64,${base64Image}` }}
    ]
  }]
});
```

## TECH STACK:
- Node.js 20
- TypeScript
- Express
- Multer (–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤)
- OpenAI SDK (`openai` npm package)

## –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
- ‚ùå **–ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: ImageMagick, GraphicsMagick, Poppler (—Ç—Ä–µ–±—É—é—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- ‚úÖ **–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –¢–æ–ª—å–∫–æ npm –ø–∞–∫–µ—Ç—ã
- ‚úÖ **–ü–∞–º—è—Ç—å**: –§–∞–π–ª—ã –¥–æ 25MB

## PERFORMANCE GOAL:
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PDF (1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞) ‚Üí –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: **< 3 —Å–µ–∫—É–Ω–¥—ã**
- Vision API response: ~5-10 —Å–µ–∫—É–Ω–¥ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)

---

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:
1. **–õ—É—á—à—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É** –¥–ª—è PDF ‚Üí –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Node.js
2. **–†–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞** —Å TypeScript
3. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫** (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ä–∞–∑–º–µ—Ä, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
4. **Production-ready —Ä–µ—à–µ–Ω–∏–µ** —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

–°–ø–∞—Å–∏–±–æ! üôè
