# üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: "–£—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω"

## ‚ùì –ü–†–û–ë–õ–ï–ú–ê:
–í Tripwire –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–£—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω" –¥–ª—è –≤—Å–µ—Ö 3 –º–æ–¥—É–ª–µ–π.

## ‚úÖ –ß–¢–û –ü–†–û–í–ï–†–ò–õ–ò:

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - –í–°–Å –ù–û–†–ú–ê–õ–¨–ù–û ‚úÖ
```sql
SELECT * FROM lessons WHERE id IN (67, 68, 69);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ ID 67: "–í–≤–µ–¥–µ–Ω–∏–µ –≤ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏" (module_id: 16, bunny_video_id: 9d9fe01c...)
- ‚úÖ ID 68: "–°–æ–∑–¥–∞–Ω–∏–µ GPT-–±–æ—Ç–∞" (module_id: 17, bunny_video_id: f68ff8f3...)
- ‚úÖ ID 69: "–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—É—Å–Ω–æ–≥–æ Reels" (module_id: 18, bunny_video_id: 7a045a57...)

–í—Å–µ —É—Ä–æ–∫–∏ **–ù–ï** archived, —É –≤—Å–µ—Ö –µ—Å—Ç—å –≤–∏–¥–µ–æ ID.

### 2. Backend API - –ü–†–ê–í–ò–õ–¨–ù–´–ô ‚úÖ
**–§–∞–π–ª:** `backend/src/routes/tripwire-lessons.ts`

```typescript
// GET /api/tripwire/lessons/:id
router.get('/lessons/:id', async (req, res) => {
  const { data: lesson, error } = await tripwireAdminSupabase
    .from('lessons')
    .select('*')
    .eq('id', id)
    .single();
  // ...
});
```

–ö–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `lessons`.

### 3. Frontend - –ü–†–ê–í–ò–õ–¨–ù–´–ô ‚úÖ
**–§–∞–π–ª:** `src/pages/tripwire/TripwireProductPage.tsx`

```typescript
// –°—Ç—Ä–æ–∫–∞ 220
const response = await api.get(`/api/tripwire/lessons/${id}`);
```

–ó–∞–ø—Ä–æ—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫ API endpoint.

---

## üî¨ –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´:

### 1. API –ù–ï –û–¢–í–ï–ß–ê–ï–¢ (–≤–µ—Ä–æ—è—Ç–Ω–µ–µ –≤—Å–µ–≥–æ)
- Backend –Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω
- PM2 –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- –†–æ—É—Ç –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

### 2. –ü–†–û–ë–õ–ï–ú–ê –° –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ï–ô
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ Tripwire –ë–î
- Session expired
- Cookie –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è

### 3. RLS –ü–û–õ–ò–¢–ò–ö–ò –ë–õ–û–ö–ò–†–£–Æ–¢
- –¢–∞–±–ª–∏—Ü–∞ `lessons` –∏–º–µ–µ—Ç RLS enabled
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —á—Ç–µ–Ω–∏–µ

---

## üöÄ –†–ï–®–ï–ù–ò–ï:

### –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä—å API endpoint (curl)
```bash
curl https://onai.academy/api/tripwire/lessons/67
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
```json
{
  "lesson": {
    "id": 67,
    "title": "–í–≤–µ–¥–µ–Ω–∏–µ –≤ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏",
    "module_id": 16,
    "bunny_video_id": "9d9fe01c-e060-4182-b382-65ddc52b67ed",
    ...
  }
}
```

**–ï—Å–ª–∏ 404/500:** Backend –Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –∏–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∞.

### –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏
```sql
-- –í Supabase SQL Editor (TRIPWIRE DB)
SELECT 
  tablename,
  policyname,
  permissive,
  roles,
  cmd,
  qual
FROM pg_policies
WHERE tablename = 'lessons';
```

**–ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è authenticated:** –°–æ–∑–¥–∞–π –ø–æ–ª–∏—Ç–∏–∫—É:
```sql
CREATE POLICY "Allow authenticated read lessons"
ON lessons
FOR SELECT
TO authenticated
USING (true);
```

### –®–ê–ì 3: –ó–∞–¥–µ–ø–ª–æ–π backend (–µ—Å–ª–∏ –Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω)
```bash
ssh root@207.154.231.30
cd /var/www/onai-integrator-login/backend
git pull origin main
pm2 restart backend
pm2 logs backend --lines 50
```

### –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ backend
```bash
pm2 logs backend | grep -E "tripwire/lessons|ERROR|404"
```

---

## üìã –ß–ï–ö–õ–ò–°–¢:

- [ ] –ó–∞–¥–µ–ø–ª–æ–µ–Ω –ª–∏ backend? (git pull + pm2 restart)
- [ ] –û—Ç–≤–µ—á–∞–µ—Ç –ª–∏ API? (curl test)
- [ ] –ï—Å—Ç—å –ª–∏ RLS –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è authenticated?
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å?
- [ ] –ï—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏ –≤ browser console?
- [ ] –ï—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏ –≤ pm2 logs?

---

## üéØ –ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï:

**–ï—Å–ª–∏ –Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω backend –ø–æ—Å–ª–µ unified tracking:**

```bash
ssh root@207.154.231.30
cd /var/www/onai-integrator-login/backend
git pull origin main
pm2 restart backend
```

–≠—Ç–æ –Ω–∞ 99% —Ä–µ—à–∏—Ç –ø—Ä–æ–±–ª–µ–º—É! üöÄ







