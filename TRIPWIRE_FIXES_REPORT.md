# üîß –î–ï–¢–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ –ü–û –§–ò–ö–°–ê–ú TRIPWIRE –ü–†–û–î–£–ö–¢–ê

**–î–∞—Ç–∞:** 2025-11-29  
**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ—Ç AI-–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** HIGH  

---

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï

1. [UI/UX –ü—Ä–æ–±–ª–µ–º—ã](#1-uiux-–ø—Ä–æ–±–ª–µ–º—ã)
2. [–í–∏–¥–µ–æ-–ø–ª–µ–µ—Ä](#2-–≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä)
3. [–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –º–æ–¥—É–ª–µ–π](#3-—Å–∏—Å—Ç–µ–º–∞-–ø—Ä–æ–≥—Ä–µ—Å—Å–∞-–∏-–º–æ–¥—É–ª–µ–π)
4. [–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](#4-–ø—Ä–æ—Ñ–∏–ª—å-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
5. [–°–∏—Å—Ç–µ–º–∞ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π –∏ AI –ö—É—Ä–∞—Ç–æ—Ä](#5-—Å–∏—Å—Ç–µ–º–∞-–¥–æ–º–∞—à–Ω–∏—Ö-–∑–∞–¥–∞–Ω–∏–π-–∏-ai-–∫—É—Ä–∞—Ç–æ—Ä)
6. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è](#6-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-—Ä–µ—à–µ–Ω–∏—è)

---

## 1. UI/UX –ü–†–û–ë–õ–ï–ú–´

### 1.1 –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –±–ª–æ–∫–∞ "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 14 –º–∏–Ω"

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ–∫—Å—Ç "—Å–ª–∏–ø–∞–µ—Ç—Å—è" –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
<motion.div 
  className="bg-[#0A0A0A]/80 backdrop-blur-xl border border-white/5 rounded-2xl p-6 shadow-xl"
>
  –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 14 –º–∏–Ω
</motion.div>

<div className="flex items-center justify-between p-3 bg-black/30 rounded-lg border border-white/5">
  –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 14 –º–∏–Ω
</div>
```

**–õ–æ–∫–∞—Ü–∏—è:**
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: `src/pages/tripwire/TripwireLesson.tsx`
- –†–æ—É—Ç: `/tripwire/module/:moduleId/lesson/:lessonId`

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö (sm:, md:, lg:)
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ padding –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö
- –í–æ–∑–º–æ–∂–Ω–æ, –ø–µ—Ä–µ–Ω–æ—Å —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**
```tsx
<div className="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3 p-3 sm:p-4 bg-black/30 rounded-lg border border-white/5">
  <span className="text-sm sm:text-base">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</span>
  <span className="text-[#00FF88] font-semibold text-base sm:text-lg">14 –º–∏–Ω</span>
</div>
```

---

### 1.2 –®—Ä–∏—Ñ—Ç –±–ª–æ–∫–∞ "–ó–ê–í–ï–†–®–ï–ù–û"

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —à—Ä–∏—Ñ—Ç –Ω–∞ `font-mono` –∫–∞–∫ –≤ "PREMIUM LEARNING PLATFORM"

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
<motion.div className="flex items-center gap-3 px-6 py-3 bg-[#00FF88]/10 border border-[#00FF88]/30 rounded-xl backdrop-blur-sm">
  –ó–ê–í–ï–†–®–ï–ù–û
</motion.div>
```

**–≠—Ç–∞–ª–æ–Ω–Ω—ã–π —Å—Ç–∏–ª—å:**
```tsx
<p className="text-[10px] font-mono font-medium text-gray-600 tracking-wide">
  PREMIUM LEARNING PLATFORM
</p>
```

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
```tsx
<motion.div className="flex items-center gap-3 px-6 py-3 bg-[#00FF88]/10 border border-[#00FF88]/30 rounded-xl backdrop-blur-sm">
  <span className="font-mono font-semibold tracking-wider">–ó–ê–í–ï–†–®–ï–ù–û</span>
</motion.div>
```

**–õ–æ–∫–∞—Ü–∏—è:** `src/pages/tripwire/TripwireLesson.tsx`

---

### 1.3 –ö—É—Ä—Å–∏–≤ –≤ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤–∏–¥–µ–æ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫" –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫—É—Ä—Å–∏–≤ –≤ –±–ª–æ–∫–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ (0.5x, 0.75x, 1x –∏ —Ç.–¥.)

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
<div className="flex items-center gap-2">
  0.5x 0.75x 1x 1.25x 1.5x 1.75x 2x
</div>
```

**–õ–æ–∫–∞—Ü–∏—è:** `src/pages/tripwire/TripwireLesson.tsx` - –≤–∏–¥–µ–æ –ø–ª–µ–µ—Ä

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- –£–±—Ä–∞—Ç—å –∫–ª–∞—Å—Å `italic` –∏–ª–∏ `font-italic` –∏–∑ –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∏–ª–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞

---

### 1.4 –ö—É—Ä—Å–∏–≤ –≤ –∫–Ω–æ–ø–∫–µ "–î–ê–õ–ï–ï"

**–ü—Ä–æ–±–ª–µ–º–∞:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø.1.3 - –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫—É—Ä—Å–∏–≤

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
<motion.button 
  className="group px-6 py-4 bg-transparent border-2 border-[#00FF88]/30 text-[#00FF88] hover:bg-[#00FF88]/10 hover:border-[#00FF88] font-sans font-semibold uppercase tracking-wider text-sm"
>
  –î–ê–õ–ï–ï
</motion.button>
```

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- –£–±—Ä–∞—Ç—å –≤—Å–µ `italic` –∫–ª–∞—Å—Å—ã
- –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω–æ `not-italic` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

**–õ–æ–∫–∞—Ü–∏—è:** `src/pages/tripwire/TripwireLesson.tsx`

---

### 1.5 Z-index –ø—Ä–æ–±–ª–µ–º–∞ —Å sidebar

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ–∫—Å—Ç "–ù–ï–ô–†–û–°–ï–¢–Ø–ú" –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –Ω–∞ sidebar, –∫–Ω–æ–ø–∫–∏ –Ω–µ –∫–ª–∏–∫–∞—é—Ç—Å—è

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–º–µ–µ—Ç –≤—ã—Å–æ–∫–∏–π z-index
- Sidebar –∏–º–µ–µ—Ç –Ω–∏–∑–∫–∏–π z-index
- –ü—Ä–∏ –Ω–∞–ª–æ–∂–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç sidebar

**–õ–æ–∫–∞—Ü–∏—è:**
- Sidebar: `src/components/tripwire/TripwireLayout.tsx`
- –ö–æ–Ω—Ç–µ–Ω—Ç: —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ `src/pages/tripwire/`

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- Sidebar: `z-index: 1000` (–º–∏–Ω–∏–º—É–º)
- –ö–æ–Ω—Ç–µ–Ω—Ç: `z-index: 1` (–±–∞–∑–æ–≤—ã–π)
- –î–æ–±–∞–≤–∏—Ç—å `padding` –∫–æ–Ω—Ç–µ–Ω—Ç—É, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –∑–∞—Ö–æ–¥–∏–ª –ø–æ–¥ sidebar

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**
```tsx
// TripwireLayout.tsx
<aside className="fixed left-0 top-0 h-screen w-64 bg-black/90 border-r border-white/10 z-[1000]">
  {/* Sidebar content */}
</aside>

<main className="ml-64 p-6 relative z-0">
  {/* Page content */}
</main>
```

---

### 1.6 –£–±—Ä–∞—Ç—å —ç–º–æ–¥–∑–∏ üíæ —Å –∫–Ω–æ–ø–∫–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
<button className="bg-[#00FF88] text-black hover:bg-[#00cc88] font-semibold flex-1">
  üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
</button>
```

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
```tsx
<button className="bg-[#00FF88] text-black hover:bg-[#00cc88] font-semibold flex-1">
  –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
</button>
```

**–õ–æ–∫–∞—Ü–∏—è:** 
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Ä–æ–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ
- –í–æ–∑–º–æ–∂–Ω–æ: `src/components/tripwire/TripwireLessonEditDialog.tsx`

---

## 2. –í–ò–î–ï–û-–ü–õ–ï–ï–†

### 2.1 –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ù—É–∂–µ–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∫–∞–∫ –≤ YouTube:
- –ù–∞–∂–∞–ª –Ω–∞ –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω ‚Üí –≤–∏–¥–µ–æ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ —ç–∫—Ä–∞–Ω–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö/–ø–ª–∞–Ω—à–µ—Ç–∞—Ö
- –†–∞–±–æ—Ç–∞ –Ω–∞ iPhone, iPad

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –í–µ—Ä–æ—è—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `<video>` —Ç–µ–≥ –±–µ–∑ Fullscreen API

**–õ–æ–∫–∞—Ü–∏—è:** `src/pages/tripwire/TripwireLesson.tsx`

**–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:**

```typescript
// Fullscreen API
const handleFullscreen = async () => {
  const videoElement = videoRef.current;
  
  if (!document.fullscreenElement) {
    // Enter fullscreen
    if (videoElement.requestFullscreen) {
      await videoElement.requestFullscreen();
    } else if (videoElement.webkitRequestFullscreen) { // Safari
      await videoElement.webkitRequestFullscreen();
    } else if (videoElement.mozRequestFullScreen) { // Firefox
      await videoElement.mozRequestFullScreen();
    } else if (videoElement.msRequestFullscreen) { // IE/Edge
      await videoElement.msRequestFullscreen();
    }
  } else {
    // Exit fullscreen
    if (document.exitFullscreen) {
      await document.exitFullscreen();
    }
  }
};

// Orientation lock –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
screen.orientation?.lock('landscape').catch(() => {
  // Fallback –µ—Å–ª–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
});
```

**API –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- [Fullscreen API](https://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API)
- [Screen Orientation API](https://developer.mozilla.org/en-US/docs/Web/API/Screen_Orientation_API)

---

### 2.2 –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–∞ –µ–¥–∏–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–∞ –¥–ª—è:
- Tripwire –ø—Ä–æ–¥—É–∫—Ç–∞ (`/tripwire/*`)
- –û—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (`/course/*`)

**–¢–µ–∫—É—â–∏–µ –ø–ª–µ–µ—Ä—ã:**
1. `src/pages/tripwire/TripwireLesson.tsx` - Tripwire
2. `src/pages/Lesson.tsx` - –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `VideoPlayer.tsx`
- –ï–¥–∏–Ω—ã–µ —Å—Ç–∏–ª–∏, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –∫–æ–Ω—Ç—Ä–æ–ª—ã
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –æ–±–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ —á–µ—Ä–µ–∑ props

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:**

```typescript
// src/components/VideoPlayer/VideoPlayer.tsx
interface VideoPlayerProps {
  videoUrl: string;
  poster?: string;
  onProgress?: (progress: number) => void;
  onComplete?: () => void;
  onSeek?: (time: number, direction: 'forward' | 'backward') => void;
  autoPlay?: boolean;
  variant?: 'tripwire' | 'platform'; // –î–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
}

export const VideoPlayer = ({ 
  videoUrl, 
  onProgress, 
  onComplete,
  variant = 'platform' 
}: VideoPlayerProps) => {
  // –û–±—â–∞—è –ª–æ–≥–∏–∫–∞ –ø–ª–µ–µ—Ä–∞
  // –¢—Ä–µ–∫–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏
  // Fullscreen API
  // –ö–æ–Ω—Ç—Ä–æ–ª—ã
};
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```tsx
// Tripwire
<VideoPlayer 
  videoUrl={lessonVideo.url}
  variant="tripwire"
  onProgress={handleProgress}
/>

// –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
<VideoPlayer 
  videoUrl={videoUrl}
  variant="platform"
  onProgress={handleProgress}
/>
```

---

## 3. –°–ò–°–¢–ï–ú–ê –ü–†–û–ì–†–ï–°–°–ê –ò –ú–û–î–£–õ–ï–ô

### 3.1 –ù—É–º–µ—Ä–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–∏–∑—É–∞–ª—å–Ω–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫–æ–π –º–æ–¥—É–ª—å –ø–µ—Ä–≤—ã–π, –≤—Ç–æ—Ä–æ–π –∏ —Ç.–¥.

**–¢–µ–∫—É—â–∏–µ –º–æ–¥—É–ª–∏:**
1. AI Foundation - –û—Å–Ω–æ–≤—ã AI
2. [Module 2] - –Ω–∞–∑–≤–∞–Ω–∏–µ
3. [Module 3] - –Ω–∞–∑–≤–∞–Ω–∏–µ
4. [Module 4] - –Ω–∞–∑–≤–∞–Ω–∏–µ

**–õ–æ–∫–∞—Ü–∏—è:** `src/pages/tripwire/TripwireProductPage.tsx`

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
```tsx
<div className="relative rounded-[20px] p-6 lg:p-8">
  {/* –ù–æ–º–µ—Ä –º–æ–¥—É–ª—è */}
  <div className="absolute top-6 left-6 w-12 h-12 bg-[#00FF88]/20 border-2 border-[#00FF88] rounded-full flex items-center justify-center">
    <span className="font-mono font-bold text-2xl text-[#00FF88]">1</span>
  </div>
  
  {/* –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –º–æ–¥—É–ª—è */}
</div>
```

**–ü—Ä–∏–º–µ—Ä –¥–∏–∑–∞–π–Ω–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚≠ï 1   AI FOUNDATION        ‚îÇ
‚îÇ         –û–°–ù–û–í–´ AI           ‚îÇ
‚îÇ         45 –º–∏–Ω ‚Ä¢ 1 —É—Ä–æ–∫     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### 3.2 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥—É–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ú–æ–¥—É–ª—å 1 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 45 –º–∏–Ω (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 14 –º–∏–Ω –∏–∑ —É—Ä–æ–∫–∞)
- –ú–æ–¥—É–ª—å 2 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 60 –º–∏–Ω (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
- –ù—É–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å –∏–∑ —Å—á–µ—Ç—á–∏–∫–∞ —É—Ä–æ–∫–æ–≤
- –ï—Å–ª–∏ —É—Ä–æ–∫–æ–≤ –Ω–µ—Ç ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å "0 –º–∏–Ω"

**–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```typescript
// –í–µ—Ä–æ—è—Ç–Ω–æ —Ö–∞—Ä–¥–∫–æ–¥
<span>45 –º–∏–Ω</span>
```

**–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:**

```typescript
// 1. –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ –µ—Å—Ç—å duration –≤ video_content
// –¢–∞–±–ª–∏—Ü–∞: video_content
// –ü–æ–ª—è: lesson_id, duration_seconds

// 2. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–¥—Å—á–µ—Ç–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥—É–ª—è
const calculateModuleDuration = async (moduleId: string) => {
  // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —É—Ä–æ–∫–∏ –º–æ–¥—É–ª—è
  const { data: lessons } = await supabase
    .from('tripwire_lessons')
    .select('id')
    .eq('module_id', moduleId);
  
  if (!lessons?.length) return 0;
  
  // –ü–æ–ª—É—á–∏—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –≤–∏–¥–µ–æ –≤ —ç—Ç–∏—Ö —É—Ä–æ–∫–∞—Ö
  const lessonIds = lessons.map(l => l.id);
  const { data: videos } = await supabase
    .from('video_content')
    .select('duration_seconds')
    .in('lesson_id', lessonIds);
  
  // –°—É–º–º–∏—Ä–æ–≤–∞—Ç—å
  const totalSeconds = videos?.reduce((sum, v) => sum + (v.duration_seconds || 0), 0) || 0;
  const totalMinutes = Math.round(totalSeconds / 60);
  
  return totalMinutes;
};

// 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
const [moduleDuration, setModuleDuration] = useState(0);

useEffect(() => {
  calculateModuleDuration(moduleId).then(setModuleDuration);
}, [moduleId]);

// 4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
<span className="text-gray-400">
  {moduleDuration > 0 ? `${moduleDuration} –º–∏–Ω` : '0 –º–∏–Ω'}
</span>
```

**–õ–æ–∫–∞—Ü–∏—è:**
- UI: `src/pages/tripwire/TripwireProductPage.tsx`
- –õ–æ–≥–∏–∫–∞: —Å–æ–∑–¥–∞—Ç—å `src/services/tripwireModuleService.ts`

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
- –¢–∞–±–ª–∏—Ü–∞: `tripwire_modules` (id, title, order)
- –¢–∞–±–ª–∏—Ü–∞: `tripwire_lessons` (id, module_id, title)
- –¢–∞–±–ª–∏—Ü–∞: `video_content` (id, lesson_id, duration_seconds)

---

### 3.3 –¢—Ä–µ–∫–∏–Ω–≥ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ

**–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:** 
–°–∏—Å—Ç–µ–º–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–º–æ—Ç—Ä–µ–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–æ. –ú–æ–∂–Ω–æ –Ω–∞–∂–∞—Ç—å "–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫" –Ω–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—è.

**–¢—Ä–µ–±—É–µ–º–∞—è –ª–æ–≥–∏–∫–∞:**

1. **–¢—Ä–µ–∫–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:**
   - –°–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –ø–æ—Å–º–æ—Ç—Ä–µ–Ω–æ
   - –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–µ—Ä–µ–º–æ—Ç–∞–Ω–æ –≤–ø–µ—Ä–µ–¥
   - –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–µ—Ä–µ–º–æ—Ç–∞–Ω–æ –Ω–∞–∑–∞–¥
   - –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

2. **–£—Å–ª–æ–≤–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞:**
   - –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ –º–∏–Ω–∏–º—É–º 80% –≤–∏–¥–µ–æ
   - –ï—Å–ª–∏ –±—ã–ª–æ –º–Ω–æ–≥–æ –ø–µ—Ä–µ–º–æ—Ç–æ–∫ –≤–ø–µ—Ä–µ–¥ ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
   - –ï—Å–ª–∏ –Ω–µ –¥–æ—Å–º–æ—Ç—Ä–µ–ª ‚Üí –∫–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫" disabled

3. **–ú–µ—Ç—Ä–∏–∫–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
   - –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (1-100%)
   - –£—á–µ—Ç –ø–∞—É–∑, –ø–µ—Ä–µ–º–æ—Ç–æ–∫, —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

```typescript
// 1. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É video_tracking
CREATE TABLE video_tracking (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  lesson_id INTEGER REFERENCES tripwire_lessons(id),
  
  -- –¢—Ä–µ–∫–∏–Ω–≥ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  total_watch_time_seconds INTEGER DEFAULT 0, -- –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  video_duration_seconds INTEGER NOT NULL, -- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ
  watch_percentage DECIMAL(5,2) DEFAULT 0, -- –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  
  -- –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è
  seek_forward_count INTEGER DEFAULT 0, -- –ü–µ—Ä–µ–º–æ—Ç–∫–∏ –≤–ø–µ—Ä–µ–¥
  seek_backward_count INTEGER DEFAULT 0, -- –ü–µ—Ä–µ–º–æ—Ç–∫–∏ –Ω–∞–∑–∞–¥
  pause_count INTEGER DEFAULT 0, -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—É–∑
  playback_speed DECIMAL(3,2) DEFAULT 1.0, -- –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å
  
  -- –û—Ü–µ–Ω–∫–∞ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  attention_score INTEGER DEFAULT 0, -- 0-100
  is_qualified_for_completion BOOLEAN DEFAULT FALSE, -- –ú–æ–∂–Ω–æ –ª–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫
  
  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  started_at TIMESTAMP DEFAULT NOW(),
  last_position_seconds INTEGER DEFAULT 0, -- –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–∑–∏—Ü–∏—è
  updated_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(user_id, lesson_id)
);

// 2. –•—É–∫ –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞
const useVideoTracking = (lessonId: number, videoDuration: number) => {
  const { user } = useAuth();
  const [tracking, setTracking] = useState<VideoTracking | null>(null);
  
  // –û–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
  const updateTracking = async (currentTime: number, event: 'progress' | 'seek_forward' | 'seek_backward' | 'pause') => {
    const response = await api.post('/api/video-tracking/update', {
      userId: user.id,
      lessonId,
      currentTime,
      videoDuration,
      event
    });
    
    setTracking(response.data);
  };
  
  return { tracking, updateTracking };
};

// 3. –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞ backend
const calculateAttentionScore = (tracking: VideoTracking) => {
  let score = 100;
  
  // –®—Ç—Ä–∞—Ñ –∑–∞ –ø–µ—Ä–µ–º–æ—Ç–∫–∏ –≤–ø–µ—Ä–µ–¥ (–ø—Ä–æ–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞)
  score -= tracking.seek_forward_count * 5;
  
  // –ë–æ–Ω—É—Å –∑–∞ –ø–µ—Ä–µ–º–æ—Ç–∫–∏ –Ω–∞–∑–∞–¥ (–ø–µ—Ä–µ—Å–º–æ—Ç—Ä)
  score += tracking.seek_backward_count * 2;
  
  // –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–∏–∑–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  if (tracking.watch_percentage < 80) {
    score -= (80 - tracking.watch_percentage) * 2;
  }
  
  // –ë–æ–Ω—É—Å –∑–∞ —Å–∫–æ—Ä–æ—Å—Ç—å 1x (–≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä)
  if (tracking.playback_speed === 1.0) {
    score += 10;
  }
  
  return Math.max(0, Math.min(100, score));
};

// 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
const canCompleteLesson = (tracking: VideoTracking) => {
  return tracking.watch_percentage >= 80 && 
         tracking.attention_score >= 50;
};
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ UI:**

```tsx
const TripwireLesson = () => {
  const { tracking, updateTracking } = useVideoTracking(lessonId, videoDuration);
  const [canComplete, setCanComplete] = useState(false);
  
  useEffect(() => {
    if (tracking) {
      setCanComplete(tracking.is_qualified_for_completion);
    }
  }, [tracking]);
  
  const handleCompleteLesson = () => {
    if (!canComplete) {
      toast({
        title: "‚ö†Ô∏è –î–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —É—Ä–æ–∫",
        description: `–í—ã –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∏ —Ç–æ–ª—å–∫–æ ${tracking.watch_percentage}% —É—Ä–æ–∫–∞. –ú–∏–Ω–∏–º—É–º 80% –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.`,
        variant: "destructive"
      });
      return;
    }
    
    // –ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫
    completeLesson();
  };
  
  return (
    <>
      {/* –í–∏–¥–µ–æ –ø–ª–µ–µ—Ä —Å —Ç—Ä–µ–∫–∏–Ω–≥–æ–º */}
      <VideoPlayer 
        onProgress={(time) => updateTracking(time, 'progress')}
        onSeek={(direction) => updateTracking(currentTime, direction)}
      />
      
      {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */}
      <div className="flex items-center gap-3">
        <span>–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ: {tracking?.watch_percentage}%</span>
        <span>–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {tracking?.attention_score}/100</span>
      </div>
      
      {/* –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è */}
      <button 
        disabled={!canComplete}
        onClick={handleCompleteLesson}
      >
        –ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫
      </button>
    </>
  );
};
```

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `backend/src/routes/video-tracking.ts`
- `backend/src/services/videoTrackingService.ts`
- `src/hooks/useVideoTracking.ts`
- SQL –º–∏–≥—Ä–∞—Ü–∏—è: `backend/migrations/add_video_tracking.sql`

---

### 3.4 –ß–µ–∫–ø–æ–∏–Ω—Ç—ã –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–ª–µ–¥—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è —Å –æ—Ç–∫—Ä—ã—Ç–∏–µ–º —Å–ª–µ–¥—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ

**–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–≤–µ—Ä–æ—è—Ç–Ω–æ):**
- –¢–∞–±–ª–∏—Ü–∞ `tripwire_module_unlocks` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ù–æ –ª–æ–≥–∏–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

**–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

1. **–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ª–∏, —á—Ç–æ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–∫ –≤ –º–æ–¥—É–ª–µ?
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –ª–∏ –∑–∞–ø–∏—Å—å –≤ `module_unlocks` –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–æ–¥—É–ª—è?

2. **–ü—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ –º–æ–¥—É–ª–µ–π:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ª–∏ —Å—Ç–∞—Ç—É—Å unlock?
   - –ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ª–∏ –º–æ–¥—É–ª–∏ —Å –∑–∞–º–∫–æ–º?

**–õ–æ–≥–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:**

```typescript
// 1. –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞
const handleLessonComplete = async (lessonId: number) => {
  // –ü–æ–ª—É—á–∏—Ç—å –º–æ–¥—É–ª—å —É—Ä–æ–∫–∞
  const { data: lesson } = await supabase
    .from('tripwire_lessons')
    .select('module_id')
    .eq('id', lessonId)
    .single();
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—Å–µ –ª–∏ —É—Ä–æ–∫–∏ –º–æ–¥—É–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã
  const { data: moduleLessons } = await supabase
    .from('tripwire_lessons')
    .select('id')
    .eq('module_id', lesson.module_id);
  
  const { data: completedLessons } = await supabase
    .from('lesson_progress')
    .select('lesson_id')
    .eq('user_id', userId)
    .eq('completed', true)
    .in('lesson_id', moduleLessons.map(l => l.id));
  
  // –ï—Å–ª–∏ –≤—Å–µ —É—Ä–æ–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã ‚Üí –æ—Ç–∫—Ä—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –º–æ–¥—É–ª—å
  if (completedLessons.length === moduleLessons.length) {
    await unlockNextModule(userId, lesson.module_id);
  }
};

// 2. –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–æ–¥—É–ª—è
const unlockNextModule = async (userId: string, currentModuleId: number) => {
  // –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –º–æ–¥—É–ª—è
  const { data: currentModule } = await supabase
    .from('tripwire_modules')
    .select('order')
    .eq('id', currentModuleId)
    .single();
  
  // –ù–∞–π—Ç–∏ —Å–ª–µ–¥—É—é—â–∏–π –º–æ–¥—É–ª—å
  const { data: nextModule } = await supabase
    .from('tripwire_modules')
    .select('id')
    .eq('order', currentModule.order + 1)
    .single();
  
  if (nextModule) {
    // –°–æ–∑–¥–∞—Ç—å unlock
    await supabase
      .from('tripwire_module_unlocks')
      .insert({
        user_id: userId,
        module_id: nextModule.id,
        unlocked_at: new Date().toISOString()
      });
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    toast({
      title: "üéâ –ù–æ–≤—ã–π –º–æ–¥—É–ª—å –æ—Ç–∫—Ä—ã—Ç!",
      description: "–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –º–æ–¥—É–ª—å –∏ –æ—Ç–∫—Ä—ã–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π",
    });
  }
};

// 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–æ–¥—É–ª—é
const isModuleUnlocked = async (userId: string, moduleId: number) => {
  // –ú–æ–¥—É–ª—å 1 –≤—Å–µ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç
  const { data: module } = await supabase
    .from('tripwire_modules')
    .select('order')
    .eq('id', moduleId)
    .single();
  
  if (module.order === 1) return true;
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å unlock
  const { data: unlock } = await supabase
    .from('tripwire_module_unlocks')
    .select('id')
    .eq('user_id', userId)
    .eq('module_id', moduleId)
    .single();
  
  return !!unlock;
};
```

**UI –∏–Ω–¥–∏–∫–∞—Ü–∏—è:**

```tsx
{!isUnlocked && (
  <div className="absolute inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center rounded-[20px]">
    <div className="text-center">
      <Lock className="w-12 h-12 text-white/50 mx-auto mb-4" />
      <p className="text-white/70">–ó–∞–≤–µ—Ä—à–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–æ–¥—É–ª—å</p>
    </div>
  </div>
)}
```

**–§–∞–π–ª—ã:**
- `backend/src/services/tripwireProgressService.ts`
- `src/hooks/useTripwireProgress.ts`

---

## 4. –ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø

### 4.1 –†–∞–∑–¥–µ–ª "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å" –¥–ª—è Tripwire

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)

**–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å –æ—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:**
1. –°–º–µ–Ω–∞ –∏–º–µ–Ω–∏
2. –°–º–µ–Ω–∞ –ø–æ—á—Ç—ã
3. –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
4. –ê–≤–∞—Ç–∞—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ù–ï –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å:**
- –£—Ä–æ–≤–Ω–∏
- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è

**–î–æ–±–∞–≤–∏—Ç—å –¥–ª—è Tripwire:**
1. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:**
   - –ü—Ä–æ–π–¥–µ–Ω–æ –º–æ–¥—É–ª–µ–π: X –∏–∑ 4
   - –ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤: X –∏–∑ Y
   - –û–±—â–µ–µ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è: X —á–∞—Å–æ–≤

2. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
   - –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: 85/100
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–æ–≤: 12
   - –õ—é–±–∏–º–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: 1.25x

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```typescript
// 1. API endpoint –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
GET /api/tripwire/profile/stats?userId={userId}

Response:
{
  "modules_completed": 2,
  "modules_total": 4,
  "lessons_completed": 8,
  "lessons_total": 16,
  "total_watch_time_seconds": 7200,
  "average_attention_score": 85,
  "total_reviews": 12,
  "favorite_playback_speed": 1.25
}

// 2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ—Ñ–∏–ª—è
interface TripwireProfileStats {
  modulesCompleted: number;
  modulesTotal: number;
  lessonsCompleted: number;
  lessonsTotal: number;
  totalWatchTimeSeconds: number;
  averageAttentionScore: number;
}

const TripwireProfile = () => {
  const [stats, setStats] = useState<TripwireProfileStats | null>(null);
  
  useEffect(() => {
    fetchProfileStats().then(setStats);
  }, []);
  
  return (
    <div className="p-8">
      <h1>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
      
      {/* –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */}
      <ProfileBasicInfo /> {/* –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –æ—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã */}
      
      {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */}
      <div className="grid grid-cols-2 gap-4 mt-6">
        <StatCard 
          title="–ú–æ–¥—É–ª–∏"
          value={`${stats.modulesCompleted}/${stats.modulesTotal}`}
        />
        <StatCard 
          title="–£—Ä–æ–∫–∏"
          value={`${stats.lessonsCompleted}/${stats.lessonsTotal}`}
        />
        <StatCard 
          title="–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è"
          value={formatTime(stats.totalWatchTimeSeconds)}
        />
        <StatCard 
          title="–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å"
          value={`${stats.averageAttentionScore}/100`}
        />
      </div>
      
      {/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è */}
      <ProfileSettings /> {/* –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å */}
    </div>
  );
};
```

**–õ–æ–∫–∞—Ü–∏—è:**
- –°–æ–∑–¥–∞—Ç—å: `src/pages/tripwire/TripwireProfile.tsx`
- –†–æ—É—Ç: `/tripwire/profile`
- Backend: `backend/src/routes/tripwire-profile.ts`

**–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `src/pages/ProfileSettings.tsx` - —Å–º–µ–Ω–∞ –∏–º–µ–Ω–∏, –ø–æ—á—Ç—ã, –ø–∞—Ä–æ–ª—è
- –ù–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ Tripwire –¥–∏–∑–∞–π–Ω

---

## 5. –°–ò–°–¢–ï–ú–ê –î–û–ú–ê–®–ù–ò–• –ó–ê–î–ê–ù–ò–ô –ò AI –ö–£–†–ê–¢–û–†

### 5.1 –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**

1. **–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —É—Ä–æ–∫–∞–º:**
   - –ù–µ –≤—Å–µ —É—Ä–æ–∫–∏ –∏–º–µ—é—Ç –î–ó
   - –ê–¥–º–∏–Ω –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç, –∫–∞–∫–∏–µ —É—Ä–æ–∫–∏ —Ç—Ä–µ–±—É—é—Ç –î–ó

2. **–õ–æ–≥–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞:**
   ```
   –£—Å–ª–æ–≤–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫":
   1. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ 80%+ –≤–∏–¥–µ–æ (—Ç—Ä–µ–∫–∏–Ω–≥)
   2. –ï—Å–ª–∏ —É—Ä–æ–∫ –∏–º–µ–µ—Ç –î–ó ‚Üí –î–ó –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–¥–∞–Ω–æ –∏ –ø—Ä–∏–Ω—è—Ç–æ AI –∫—É—Ä–∞—Ç–æ—Ä–æ–º
   3. –ï—Å–ª–∏ –î–ó –Ω–µ—Ç ‚Üí –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
   ```

3. **AI –ö—É—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –î–ó:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç/—Ñ–∞–π–ª—ã AI –∫—É—Ä–∞—Ç–æ—Ä—É
   - AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç
   - AI –ª–∏–±–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç, –ª–∏–±–æ –ø—Ä–æ—Å–∏—Ç –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å

4. **–¢—Ä–∏–≥–≥–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
   - –ü–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è –î–ó ‚Üí —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ–∫–ø–æ–∏–Ω—Ç
   - –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫" —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**

```sql
-- 1. –¢–∞–±–ª–∏—Ü–∞ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π –∫ —É—Ä–æ–∫–∞–º
CREATE TABLE tripwire_lesson_homeworks (
  id SERIAL PRIMARY KEY,
  lesson_id INTEGER REFERENCES tripwire_lessons(id),
  
  -- –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
  title TEXT NOT NULL,
  description TEXT NOT NULL,
  requirements TEXT[], -- –ú–∞—Å—Å–∏–≤ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
  
  -- AI –ö—É—Ä–∞—Ç–æ—Ä
  ai_curator_prompt TEXT NOT NULL, -- –ü—Ä–æ–º–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
  ai_assistant_id TEXT NOT NULL, -- ID OpenAI Assistant
  
  -- –ù–∞—Å—Ç—Ä–æ–π–∫–∏
  is_required BOOLEAN DEFAULT TRUE, -- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ª–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞
  max_attempts INTEGER DEFAULT 3, -- –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ —Å–¥–∞—á–∏
  
  created_at TIMESTAMP DEFAULT NOW()
);

-- 2. –¢–∞–±–ª–∏—Ü–∞ —Å–¥–∞—á–∏ –î–ó –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
CREATE TABLE tripwire_homework_submissions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  homework_id INTEGER REFERENCES tripwire_lesson_homeworks(id),
  user_id UUID REFERENCES auth.users(id),
  
  -- –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  submission_text TEXT,
  submission_files JSONB, -- [{url, name, type}]
  
  -- –°—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏
  status TEXT CHECK (status IN ('pending', 'accepted', 'rejected', 'needs_revision')),
  ai_feedback TEXT, -- –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ—Ç AI
  ai_score INTEGER, -- –û—Ü–µ–Ω–∫–∞ 0-100
  
  -- –ü–æ–ø—ã—Ç–∫–∏
  attempt_number INTEGER DEFAULT 1,
  
  -- Timestamps
  submitted_at TIMESTAMP DEFAULT NOW(),
  reviewed_at TIMESTAMP,
  
  UNIQUE(homework_id, user_id, attempt_number)
);

-- 3. –¢—Ä–∏–≥–≥–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞
CREATE TABLE tripwire_lesson_completion_requirements (
  id SERIAL PRIMARY KEY,
  lesson_id INTEGER REFERENCES tripwire_lessons(id),
  user_id UUID REFERENCES auth.users(id),
  
  -- –ß–µ–∫–ø–æ–∏–Ω—Ç—ã
  video_watched BOOLEAN DEFAULT FALSE, -- 80%+ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ
  homework_accepted BOOLEAN DEFAULT FALSE, -- –î–ó –ø—Ä–∏–Ω—è—Ç–æ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
  
  -- –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
  can_complete BOOLEAN GENERATED ALWAYS AS (
    video_watched AND (
      NOT EXISTS (
        SELECT 1 FROM tripwire_lesson_homeworks 
        WHERE lesson_id = tripwire_lesson_completion_requirements.lesson_id 
        AND is_required = TRUE
      ) OR homework_accepted
    )
  ) STORED,
  
  updated_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(lesson_id, user_id)
);
```

**Backend API:**

```typescript
// backend/src/routes/tripwire-homework.ts

// 1. –ü–æ–ª—É—á–∏—Ç—å –î–ó –¥–ª—è —É—Ä–æ–∫–∞
router.get('/homework/:lessonId', async (req, res) => {
  const { lessonId } = req.params;
  
  const { data: homework } = await supabase
    .from('tripwire_lesson_homeworks')
    .select('*')
    .eq('lesson_id', lessonId)
    .single();
  
  res.json(homework);
});

// 2. –°–¥–∞—Ç—å –î–ó
router.post('/homework/:homeworkId/submit', async (req, res) => {
  const { homeworkId } = req.params;
  const { userId, submissionText, submissionFiles } = req.body;
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
  const { data: attempts } = await supabase
    .from('tripwire_homework_submissions')
    .select('attempt_number')
    .eq('homework_id', homeworkId)
    .eq('user_id', userId)
    .order('attempt_number', { ascending: false })
    .limit(1);
  
  const attemptNumber = (attempts?.[0]?.attempt_number || 0) + 1;
  
  // –°–æ–∑–¥–∞—Ç—å submission
  const { data: submission } = await supabase
    .from('tripwire_homework_submissions')
    .insert({
      homework_id: homeworkId,
      user_id: userId,
      submission_text: submissionText,
      submission_files: submissionFiles,
      status: 'pending',
      attempt_number: attemptNumber
    })
    .select()
    .single();
  
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É AI –∫—É—Ä–∞—Ç–æ—Ä—É
  const result = await checkHomeworkWithAI(submission.id);
  
  res.json(result);
});

// 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –î–ó —á–µ—Ä–µ–∑ AI
const checkHomeworkWithAI = async (submissionId: string) => {
  // –ü–æ–ª—É—á–∏—Ç—å submission –∏ homework
  const { data: submission } = await supabase
    .from('tripwire_homework_submissions')
    .select(`
      *,
      homework:tripwire_lesson_homeworks(*)
    `)
    .eq('id', submissionId)
    .single();
  
  // –°–æ–∑–¥–∞—Ç—å thread —Å OpenAI Assistant
  const thread = await openai.beta.threads.create();
  
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å submission AI –∫—É—Ä–∞—Ç–æ—Ä—É
  await openai.beta.threads.messages.create(thread.id, {
    role: 'user',
    content: `–ó–∞–¥–∞–Ω–∏–µ: ${submission.homework.description}\n\n–û—Ç–≤–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞: ${submission.submission_text}`
  });
  
  // –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
  const run = await openai.beta.threads.runs.create(thread.id, {
    assistant_id: submission.homework.ai_assistant_id
  });
  
  // –î–æ–∂–¥–∞—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  let runStatus = await openai.beta.threads.runs.retrieve(thread.id, run.id);
  while (runStatus.status !== 'completed') {
    await new Promise(resolve => setTimeout(resolve, 1000));
    runStatus = await openai.beta.threads.runs.retrieve(thread.id, run.id);
  }
  
  // –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç AI
  const messages = await openai.beta.threads.messages.list(thread.id);
  const aiFeedback = messages.data[0].content[0].text.value;
  
  // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ (–æ–∂–∏–¥–∞–µ–º JSON —Ñ–æ—Ä–º–∞—Ç)
  const aiResult = JSON.parse(aiFeedback);
  // { status: 'accepted', score: 85, feedback: '...' }
  
  // –û–±–Ω–æ–≤–∏—Ç—å submission
  await supabase
    .from('tripwire_homework_submissions')
    .update({
      status: aiResult.status,
      ai_feedback: aiResult.feedback,
      ai_score: aiResult.score,
      reviewed_at: new Date().toISOString()
    })
    .eq('id', submissionId);
  
  // –ï—Å–ª–∏ –ø—Ä–∏–Ω—è—Ç–æ ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å —á–µ–∫–ø–æ–∏–Ω—Ç
  if (aiResult.status === 'accepted') {
    await supabase
      .from('tripwire_lesson_completion_requirements')
      .update({ homework_accepted: true })
      .eq('lesson_id', submission.homework.lesson_id)
      .eq('user_id', submission.user_id);
  }
  
  return aiResult;
};
```

**Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**

```tsx
const TripwireLesson = () => {
  const [homework, setHomework] = useState(null);
  const [canComplete, setCanComplete] = useState(false);
  
  useEffect(() => {
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –î–ó
    fetchHomework(lessonId).then(setHomework);
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ–∫–ø–æ–∏–Ω—Ç—ã
    checkCompletionRequirements(lessonId, userId).then(setCanComplete);
  }, [lessonId]);
  
  const handleCompleteLesson = () => {
    if (!canComplete) {
      if (!videoTracking.is_qualified) {
        toast.error("–î–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —É—Ä–æ–∫ –¥–æ –∫–æ–Ω—Ü–∞");
      } else if (homework && !homework.is_accepted) {
        toast.error("–°–¥–∞–π—Ç–µ –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ AI –∫—É—Ä–∞—Ç–æ—Ä—É");
      }
      return;
    }
    
    // –ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫
    completeLesson();
  };
  
  return (
    <div>
      {/* –í–∏–¥–µ–æ */}
      <VideoPlayer />
      
      {/* –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ */}
      {homework && (
        <HomeworkSection homework={homework} />
      )}
      
      {/* –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è */}
      <button 
        disabled={!canComplete}
        onClick={handleCompleteLesson}
      >
        –ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫
      </button>
    </div>
  );
};
```

---

### 5.2 –ö–Ω–æ–ø–∫–∞ AI –ö—É—Ä–∞—Ç–æ—Ä

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "AI –ö—É—Ä–∞—Ç–æ—Ä" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Tripwire

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ + sidebar

**–î–∏–∑–∞–π–Ω –∫–Ω–æ–ø–∫–∏:**

```tsx
// –í TripwireProductPage.tsx
<motion.div
  whileHover={{ scale: 1.02 }}
  className="fixed bottom-8 right-8 z-50"
>
  <button
    onClick={() => setAICuratorOpen(true)}
    className="group relative px-6 py-4 bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl shadow-2xl hover:shadow-purple-500/50 transition-all duration-300"
  >
    {/* –ò–∫–æ–Ω–∫–∞ */}
    <div className="flex items-center gap-3">
      <Bot className="w-6 h-6 text-white" />
      <span className="font-semibold text-white">AI –ö—É—Ä–∞—Ç–æ—Ä</span>
    </div>
    
    {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */}
    {unreadMessages > 0 && (
      <div className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center">
        <span className="text-xs font-bold text-white">{unreadMessages}</span>
      </div>
    )}
  </button>
</motion.div>

// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–∞—Ç–∞
<AICuratorDialog 
  open={aiCuratorOpen}
  onClose={() => setAICuratorOpen(false)}
/>
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ß–∞—Ç —Å AI –∫—É—Ä–∞—Ç–æ—Ä–æ–º
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- –°–¥–∞—á–∞ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π
- –í–æ–ø—Ä–æ—Å—ã –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª—É

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —á–∞—Ç–∞:**

```tsx
// src/components/tripwire/AICuratorDialog.tsx
const AICuratorDialog = ({ open, onClose }) => {
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState('');
  
  const sendMessage = async () => {
    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ AI –∫—É—Ä–∞—Ç–æ—Ä—É
    const response = await api.post('/api/ai-curator/message', {
      userId: user.id,
      message: input
    });
    
    setMessages([...messages, 
      { role: 'user', content: input },
      { role: 'assistant', content: response.data.message }
    ]);
  };
  
  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent className="max-w-2xl h-[600px]">
        <DialogHeader>
          <DialogTitle>AI –ö—É—Ä–∞—Ç–æ—Ä</DialogTitle>
        </DialogHeader>
        
        {/* –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π */}
        <div className="flex-1 overflow-y-auto space-y-4 p-4">
          {messages.map((msg, i) => (
            <MessageBubble key={i} message={msg} />
          ))}
        </div>
        
        {/* –í–≤–æ–¥ */}
        <div className="flex gap-2">
          <Input 
            value={input}
            onChange={(e) => setInput(e.target.value)}
            placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ —Å–¥–∞–π—Ç–µ –î–ó..."
          />
          <Button onClick={sendMessage}>
            –û—Ç–ø—Ä–∞–≤–∏—Ç—å
          </Button>
        </div>
      </DialogContent>
    </Dialog>
  );
};
```

---

### 5.3 –ü—Ä–æ–º–ø—Ç –¥–ª—è AI –ö—É—Ä–∞—Ç–æ—Ä–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –ù–∞–ø–∏—Å–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è OpenAI Assistant

**–ü—Ä–æ–º–ø—Ç –¥–ª—è AI –ö—É—Ä–∞—Ç–æ—Ä–∞:**

```
# –†–æ–ª—å
–í—ã ‚Äî AI –ö—É—Ä–∞—Ç–æ—Ä –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã onAI Academy, –ø—Ä–æ–¥—É–∫—Ç "Integrator V3.0". –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–º–æ–≥–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞–º –æ—Å–≤–∞–∏–≤–∞—Ç—å AI-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫ –æ–±—É—á–µ–Ω–∏—é.

# –ö–æ–Ω—Ç–µ–∫—Å—Ç
- –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: onAI Academy Tripwire Product
- –ö—É—Ä—Å: Integrator V3.0 - –æ—Ç –Ω—É–ª—è –¥–æ –ø–µ—Ä–≤—ã—Ö $1000 —Å AI
- –§–æ—Ä–º–∞—Ç: 4 –º–æ–¥—É–ª—è, –∫–∞–∂–¥—ã–π —Å —É—Ä–æ–∫–∞–º–∏ –∏ –¥–æ–º–∞—à–Ω–∏–º–∏ –∑–∞–¥–∞–Ω–∏—è–º–∏

# –í–∞—à–∏ —Ñ—É–Ω–∫—Ü–∏–∏

## 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π
–ö–æ–≥–¥–∞ —Å—Ç—É–¥–µ–Ω—Ç –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –î–ó:
1. –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∑–∞–¥–∞–Ω–∏—é
2. –û—Ü–µ–Ω–∏—Ç–µ –æ—Ç–≤–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º:
   - –ü–æ–ª–Ω–æ—Ç–∞ –æ—Ç–≤–µ—Ç–∞ (0-30 –±–∞–ª–ª–æ–≤)
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è (0-40 –±–∞–ª–ª–æ–≤)
   - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (0-30 –±–∞–ª–ª–æ–≤)
3. –î–∞–π—Ç–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å:
   - –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ —Ö–æ—Ä–æ—à–æ
   - –ß—Ç–æ –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å
   - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
4. –ü—Ä–∏–º–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ:
   - "accepted" (85+ –±–∞–ª–ª–æ–≤) - –∑–∞–¥–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ
   - "needs_revision" (50-84 –±–∞–ª–ª–∞) - —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞
   - "rejected" (<50 –±–∞–ª–ª–æ–≤) - –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å

## 2. –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
- –û—Ç–≤–µ—á–∞–π—Ç–µ –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É
- –î–∞–≤–∞–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏
- –ú–æ—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ

## 3. –ú–æ—Ç–∏–≤–∞—Ü–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –•–≤–∞–ª–∏—Ç–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –≤ —Å–ª–æ–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–∞—Ö
- –ù–∞–ø–æ–º–∏–Ω–∞–π—Ç–µ –æ —Ü–µ–ª–∏: –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –ø–µ—Ä–≤—ã–µ $1000 —Å AI

# –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –î–ó
–í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ JSON:
{
  "status": "accepted | needs_revision | rejected",
  "score": 0-100,
  "feedback": "–ü–æ–¥—Ä–æ–±–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å",
  "praise": "–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ —Ö–æ—Ä–æ—à–æ",
  "improvements": ["–ß—Ç–æ —É–ª—É—á—à–∏—Ç—å 1", "–ß—Ç–æ —É–ª—É—á—à–∏—Ç—å 2"],
  "next_steps": "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞"
}

# –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è
- –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π
- –ù–∞ "—Ç—ã"
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–º–æ–¥–∑–∏ –¥–ª—è —ç–º–æ—Ü–∏–π (–Ω–æ —É–º–µ—Ä–µ–Ω–Ω–æ)
- –ì–æ–≤–æ—Ä–∏—Ç–µ –ø—Ä–æ—Å—Ç–æ, –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤

# –ü—Ä–∏–º–µ—Ä—ã

## –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–∏–Ω—è—Ç–æ
{
  "status": "accepted",
  "score": 90,
  "feedback": "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –¢—ã –¥–µ—Ç–∞–ª—å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞–ª –≤—Å–µ —ç—Ç–∞–ø—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ChatGPT API, –ø—Ä–∏–≤–µ–ª —Ä–∞–±–æ—á–∏–π –∫–æ–¥ –∏ –æ–ø–∏—Å–∞–ª –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏.",
  "praise": "–û—Å–æ–±–µ–Ω–Ω–æ –≤–ø–µ—á–∞—Ç–ª–∏–ª —Ä–∞–∑–¥–µ–ª –ø—Ä–æ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ - —ç—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥.",
  "improvements": ["–ú–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API"],
  "next_steps": "–ü–µ—Ä–µ—Ö–æ–¥–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–∫—É –ø—Ä–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é —Å Make.com"
}

## –ü—Ä–∏–º–µ—Ä 2: –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞
{
  "status": "needs_revision",
  "score": 65,
  "feedback": "–¢—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏, –Ω–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤. –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.",
  "praise": "–•–æ—Ä–æ—à–æ –æ–ø–∏—Å–∞–ª –±–∞–∑–æ–≤—É—é –ª–æ–≥–∏–∫—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.",
  "improvements": [
    "–î–æ–±–∞–≤—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ API (try-catch –±–ª–æ–∫–∏)",
    "–ü—Ä–∏–≤–µ–¥–∏ 2-3 –ø—Ä–∏–º–µ—Ä–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è",
    "–û–ø–∏—à–∏, –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç"
  ],
  "next_steps": "–î–æ—Ä–∞–±–æ—Ç–∞–π —ç—Ç–∏ –º–æ–º–µ–Ω—Ç—ã –∏ –ø—Ä–∏—à–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é. –£ —Ç–µ–±—è –≤—Å–µ –ø–æ–ª—É—á–∏—Ç—Å—è!"
}

# –í–∞–∂–Ω–æ
- –í—Å–µ–≥–¥–∞ –±—É–¥—å—Ç–µ –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã –≤ –æ—Ü–µ–Ω–∫–µ
- –î–∞–≤–∞–π—Ç–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—É—é –∫—Ä–∏—Ç–∏–∫—É
- –ú–æ—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ —Ä–∞—Å—Ç–∏
- –ü–æ–º–Ω–∏—Ç–µ: —Ü–µ–ª—å –∫—É—Ä—Å–∞ - –ø–µ—Ä–≤—ã–µ $1000 —Å AI
```

**–°–æ–∑–¥–∞–Ω–∏–µ Assistant –≤ OpenAI:**

```typescript
// backend/src/scripts/create-ai-curator-assistant.ts
const assistant = await openai.beta.assistants.create({
  name: "AI –ö—É—Ä–∞—Ç–æ—Ä onAI Academy",
  instructions: `${–ü–†–û–ú–ü–¢_–í–´–®–ï}`,
  model: "gpt-4-turbo-preview",
  tools: [
    {
      type: "function",
      function: {
        name: "check_homework",
        description: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞",
        parameters: {
          type: "object",
          properties: {
            homework_requirements: {
              type: "string",
              description: "–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–æ–º–∞—à–Ω–µ–º—É –∑–∞–¥–∞–Ω–∏—é"
            },
            student_answer: {
              type: "string",
              description: "–û—Ç–≤–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞"
            }
          },
          required: ["homework_requirements", "student_answer"]
        }
      }
    }
  ]
});

console.log("AI –ö—É—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω:", assistant.id);
// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å assistant.id –≤ .env –∫–∞–∫ AI_CURATOR_ASSISTANT_ID
```

**–î–æ–±–∞–≤–∏—Ç—å –≤ .env:**
```bash
AI_CURATOR_ASSISTANT_ID=asst_xxxxxxxxxxxxx
```

---

## 6. –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –†–ï–®–ï–ù–ò–Ø

### 6.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

**–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ video-tracking.ts         # NEW: –¢—Ä–µ–∫–∏–Ω–≥ –≤–∏–¥–µ–æ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tripwire-homework.ts      # NEW: –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tripwire-profile.ts       # NEW: –ü—Ä–æ—Ñ–∏–ª—å Tripwire
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai-curator.ts             # NEW: AI –ö—É—Ä–∞—Ç–æ—Ä —á–∞—Ç
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ videoTrackingService.ts   # NEW
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ homeworkService.ts        # NEW
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aiCuratorService.ts       # NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tripwireModuleService.ts  # NEW: –†–∞—Å—á–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ scripts/
‚îÇ       ‚îî‚îÄ‚îÄ create-ai-curator-assistant.ts # NEW

frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VideoPlayer/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VideoPlayer.tsx       # NEW: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VideoControls.tsx     # NEW
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FullscreenButton.tsx  # NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tripwire/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AICuratorDialog.tsx   # NEW: –ß–∞—Ç —Å –∫—É—Ä–∞—Ç–æ—Ä–æ–º
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ HomeworkSection.tsx   # NEW: –ë–ª–æ–∫ –î–ó
‚îÇ   ‚îú‚îÄ‚îÄ pages/tripwire/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TripwireProfile.tsx       # NEW: –ü—Ä–æ—Ñ–∏–ª—å
‚îÇ   ‚îî‚îÄ‚îÄ hooks/
‚îÇ       ‚îú‚îÄ‚îÄ useVideoTracking.ts       # NEW: –¢—Ä–µ–∫–∏–Ω–≥ –≤–∏–¥–µ–æ
‚îÇ       ‚îú‚îÄ‚îÄ useHomework.ts            # NEW: –î–ó
‚îÇ       ‚îî‚îÄ‚îÄ useAICurator.ts           # NEW: –ß–∞—Ç —Å –∫—É—Ä–∞—Ç–æ—Ä–æ–º
```

---

### 6.2 –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã

**SQL –º–∏–≥—Ä–∞—Ü–∏–∏:**

```sql
-- backend/migrations/add_video_tracking.sql
CREATE TABLE video_tracking (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  lesson_id INTEGER,
  
  total_watch_time_seconds INTEGER DEFAULT 0,
  video_duration_seconds INTEGER NOT NULL,
  watch_percentage DECIMAL(5,2) DEFAULT 0,
  
  seek_forward_count INTEGER DEFAULT 0,
  seek_backward_count INTEGER DEFAULT 0,
  pause_count INTEGER DEFAULT 0,
  playback_speed DECIMAL(3,2) DEFAULT 1.0,
  
  attention_score INTEGER DEFAULT 0,
  is_qualified_for_completion BOOLEAN DEFAULT FALSE,
  
  started_at TIMESTAMP DEFAULT NOW(),
  last_position_seconds INTEGER DEFAULT 0,
  updated_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(user_id, lesson_id)
);

-- backend/migrations/add_homework_system.sql
CREATE TABLE tripwire_lesson_homeworks (
  id SERIAL PRIMARY KEY,
  lesson_id INTEGER REFERENCES tripwire_lessons(id),
  title TEXT NOT NULL,
  description TEXT NOT NULL,
  requirements TEXT[],
  ai_curator_prompt TEXT NOT NULL,
  ai_assistant_id TEXT NOT NULL,
  is_required BOOLEAN DEFAULT TRUE,
  max_attempts INTEGER DEFAULT 3,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE tripwire_homework_submissions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  homework_id INTEGER REFERENCES tripwire_lesson_homeworks(id),
  user_id UUID REFERENCES auth.users(id),
  submission_text TEXT,
  submission_files JSONB,
  status TEXT CHECK (status IN ('pending', 'accepted', 'rejected', 'needs_revision')),
  ai_feedback TEXT,
  ai_score INTEGER,
  attempt_number INTEGER DEFAULT 1,
  submitted_at TIMESTAMP DEFAULT NOW(),
  reviewed_at TIMESTAMP,
  UNIQUE(homework_id, user_id, attempt_number)
);

CREATE TABLE tripwire_lesson_completion_requirements (
  id SERIAL PRIMARY KEY,
  lesson_id INTEGER,
  user_id UUID REFERENCES auth.users(id),
  video_watched BOOLEAN DEFAULT FALSE,
  homework_accepted BOOLEAN DEFAULT FALSE,
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(lesson_id, user_id)
);

-- backend/migrations/add_ai_curator_chat.sql
CREATE TABLE ai_curator_conversations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  openai_thread_id TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE ai_curator_messages (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  conversation_id UUID REFERENCES ai_curator_conversations(id),
  role TEXT CHECK (role IN ('user', 'assistant')),
  content TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

### 6.3 API Endpoints

**–ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**

```typescript
// Video Tracking
POST   /api/video-tracking/update           # –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
GET    /api/video-tracking/:lessonId        # –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

// Homework
GET    /api/tripwire/homework/:lessonId     # –ü–æ–ª—É—á–∏—Ç—å –î–ó –¥–ª—è —É—Ä–æ–∫–∞
POST   /api/tripwire/homework/:id/submit    # –°–¥–∞—Ç—å –î–ó
GET    /api/tripwire/homework/my-submissions # –ò—Å—Ç–æ—Ä–∏—è —Å–¥–∞—á–∏

// AI Curator
POST   /api/ai-curator/message               # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
GET    /api/ai-curator/conversation          # –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞
POST   /api/ai-curator/check-homework        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –î–ó

// Tripwire Profile
GET    /api/tripwire/profile/stats           # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
PUT    /api/tripwire/profile/settings        # –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

// Module Duration
GET    /api/tripwire/modules/:id/duration    # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–¥—É–ª—è
```

---

### 6.4 –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**PHASE 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):**
1. ‚úÖ UI —Ñ–∏–∫—Å—ã (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å, –∫—É—Ä—Å–∏–≤, z-index) - 2 —á–∞—Å–∞
2. ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä —Å fullscreen - 4 —á–∞—Å–∞
3. ‚úÖ –¢—Ä–µ–∫–∏–Ω–≥ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ - 6 —á–∞—Å–æ–≤
4. ‚úÖ –†–∞—Å—á–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥—É–ª–µ–π - 2 —á–∞—Å–∞

**PHASE 2 (–í–∞–∂–Ω–æ):**
5. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π (–±–∞–∑–∞ + API) - 8 —á–∞—Å–æ–≤
6. ‚úÖ AI –ö—É—Ä–∞—Ç–æ—Ä (Assistant + –ø—Ä–æ–º–ø—Ç) - 4 —á–∞—Å–∞
7. ‚úÖ –ß–µ–∫–ø–æ–∏–Ω—Ç—ã –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥—É–ª–µ–π - 4 —á–∞—Å–∞

**PHASE 3 (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ):**
8. ‚úÖ –†–∞–∑–¥–µ–ª "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å" –¥–ª—è Tripwire - 4 —á–∞—Å–∞
9. ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - 3 —á–∞—Å–∞
10. ‚úÖ –ö–Ω–æ–ø–∫–∞ AI –ö—É—Ä–∞—Ç–æ—Ä –≤ UI - 2 —á–∞—Å–∞

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** 39 —á–∞—Å–æ–≤ —á–∏—Å—Ç–æ–π —Ä–∞–±–æ—Ç—ã (‚âà 5-7 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π)

---

## 7. –í–û–ü–†–û–°–´ –ö AI –ê–†–•–ò–¢–ï–ö–¢–û–†–£

1. **–í–∏–¥–µ–æ-–ø–ª–µ–µ—Ä:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É (video.js, plyr.js) –∏–ª–∏ –ø–∏—Å–∞—Ç—å —Å –Ω—É–ª—è?
   - –ö–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥ –º–µ–∂–¥—É Tripwire –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π?

2. **–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è:**
   - –ù—É–∂–Ω–∞ –ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–π–ª–æ–≤ (—Å–∫—Ä–∏–Ω—à–æ—Ç—ã, PDF)?
   - –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª—ã? (Cloudflare R2 –∏–ª–∏ Supabase Storage)

3. **AI –ö—É—Ä–∞—Ç–æ—Ä:**
   - –û–¥–∏–Ω Assistant –Ω–∞ –≤—Å–µ—Ö –∏–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ Thread'—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞?
   - –õ–∏–º–∏—Ç—ã –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–µ–Ω—å?

4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –ù—É–∂–µ–Ω –ª–∏ –∫–µ—à –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥—É–ª–µ–π?
   - –ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥ –≤–∏–¥–µ–æ (–Ω–µ —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã)?

5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü?
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –∏–ª–∏ backend?

---

## 8. –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

**–ß–µ–∫-–ª–∏—Å—Ç –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

- [ ] –í–∏–¥–µ–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–∞—Ö (–º–æ–±–∏–ª—å–Ω—ã–π, –ø–ª–∞–Ω—à–µ—Ç, –¥–µ—Å–∫—Ç–æ–ø)
- [ ] Fullscreen —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ iOS Safari
- [ ] –¢—Ä–µ–∫–∏–Ω–≥ —Ç–æ—á–Ω–æ —Å—á–∏—Ç–∞–µ—Ç –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
- [ ] –ù–µ–ª—å–∑—è –∑–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫ –±–µ–∑ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ 80% –≤–∏–¥–µ–æ
- [ ] –î–ó –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è AI –∫—É—Ä–∞—Ç–æ—Ä–æ–º
- [ ] –°–ª–µ–¥—É—é—â–∏–π –º–æ–¥—É–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ
- [ ] –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–¥—É–ª–µ–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- [ ] –ö–Ω–æ–ø–∫–∞ AI –ö—É—Ä–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
- [ ] –í—Å–µ —Ç–µ–∫—Å—Ç—ã –±–µ–∑ –∫—É—Ä—Å–∏–≤–∞
- [ ] Sidebar –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

---

## 9. –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é —Ñ–∏–∫—Å–æ–≤ –¥–ª—è Tripwire –ø—Ä–æ–¥—É–∫—Ç–∞. –í—Å–µ –∑–∞–¥–∞—á–∏ —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã, –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. AI –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –∏–∑—É—á–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
2. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 7
3. –î–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
4. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–æ—ç—Ç–∞–ø–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (Phase 1 ‚Üí Phase 2 ‚Üí Phase 3)

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2025-11-29  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ –ø–µ—Ä–µ–¥–∞—á–µ AI –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—É

