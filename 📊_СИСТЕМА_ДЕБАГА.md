# üõ°Ô∏è –°–ò–°–¢–ï–ú–ê –ó–ê–©–ò–¢–´ –ò –î–ï–ë–ê–ì–ê TELEGRAM –ë–û–¢–ê

## üéØ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ –ü–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∫—Ä–∞—à–µ–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫** –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –±–æ—Ç–∞ (–¥–æ 5 –ø–æ–ø—ã—Ç–æ–∫)
- **Try-catch** –¥–ª—è –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫** –¥–ª—è polling/webhook
- **Graceful error handling** —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 2. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- **ErrorTrackingService** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î** - –≤—Å–µ –æ—à–∏–±–∫–∏ –ø–∏—à—É—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `error_logs`
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫** –ø–æ —Ç–∏–ø—É –∏ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—à–∏–±–æ–∫** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –¥–µ–±–∞–≥–∞

### 3. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **Healthcheck endpoint** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞
- **Dashboard** - –ø–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∏—Å—Ç–æ—Ä–∏—è –æ—à–∏–±–æ–∫
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è** –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –≥—Ä—É–ø–ø
- **–¢—Ä–µ–∫–∏–Ω–≥ uptime** –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤

---

## üì° API ENDPOINTS

### 1. üè• Healthcheck
**GET** `/api/telegram-leads/health`

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

**Response:**
```json
{
  "success": true,
  "status": {
    "bot_running": true,
    "bot_start_time": "2025-12-16T03:20:00.000Z",
    "uptime_seconds": 3600,
    "restart_count": 0,
    "last_error": null,
    "environment": "development",
    "polling_mode": true,
    "database_connected": true,
    "active_groups_count": 1
  }
}
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl http://localhost:3000/api/telegram-leads/health
```

---

### 2. üìä Dashboard
**GET** `/api/telegram-leads/dashboard`

–ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞: –∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä—É–ø–ø—ã, –æ—à–∏–±–∫–∏, uptime.

**Response:**
```json
{
  "success": true,
  "data": {
    "bot_status": {
      "running": true,
      "start_time": "2025-12-16T03:20:00.000Z",
      "uptime_hours": "2.5",
      "restart_count": 0,
      "last_error": null
    },
    "group_stats": {
      "total": 5,
      "active": 3,
      "inactive": 2
    },
    "active_groups": [
      {
        "chat_id": "-1003505301432",
        "chat_title": "–õ–∏–¥—ã –¢—Ä–∏–ø–≤–∞–µ—Ä",
        "activated_by": "saint4ai",
        "activated_at": "2025-12-16T03:16:02.821Z"
      }
    ],
    "recent_errors": [],
    "error_stats": {
      "total": 0,
      "by_severity": {},
      "by_category": {}
    }
  }
}
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl http://localhost:3000/api/telegram-leads/dashboard
```

---

### 3. üîÑ Manual Restart
**POST** `/api/telegram-leads/restart`

–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫).

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl -X POST http://localhost:3000/api/telegram-leads/restart
```

---

### 4. üìã Active Groups
**GET** `/api/telegram-leads/active-groups`

–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä—É–ø–ø –¥–ª—è –ª–∏–¥–æ–≤.

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl http://localhost:3000/api/telegram-leads/active-groups
```

---

### 5. üß™ Test Notification
**POST** `/api/telegram-leads/test`

–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤–æ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä—É–ø–ø—ã.

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl -X POST http://localhost:3000/api/telegram-leads/test
```

---

## üîç –ö–ê–ö –°–ú–û–¢–†–ï–¢–¨ –õ–û–ì–ò –û–®–ò–ë–û–ö

### 1. –ß–µ—Ä–µ–∑ Dashboard API
```bash
curl http://localhost:3000/api/telegram-leads/dashboard | jq '.data.recent_errors'
```

### 2. –ù–∞–ø—Ä—è–º—É—é –≤ –ë–î (Supabase)
```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 –æ—à–∏–±–æ–∫
SELECT * FROM error_logs 
ORDER BY timestamp DESC 
LIMIT 20;

-- –û—à–∏–±–∫–∏ Telegram –±–æ—Ç–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
SELECT * FROM error_logs 
WHERE category = 'telegram' 
  AND timestamp > now() - interval '24 hours'
ORDER BY timestamp DESC;

-- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
SELECT * FROM error_logs 
WHERE severity = 'critical' 
  AND resolved = false
ORDER BY timestamp DESC;
```

### 3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫
```sql
-- –í—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
SELECT * FROM get_error_stats(now() - interval '24 hours');
```

---

## üö® –£–†–û–í–ù–ò –ö–†–ò–¢–ò–ß–ù–û–°–¢–ò

| Severity | Emoji | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|-------|----------|--------|
| **LOW** | üü¢ | –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ | –ö–æ–º–∞–Ω–¥–∞ /help –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞ |
| **MEDIUM** | üü° | –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–±–ª–µ–º–∞ | –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ–¥–Ω—É –≥—Ä—É–ø–ø—É |
| **HIGH** | üü† | –°–µ—Ä—å—ë–∑–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ | Polling error, –ø—Ä–æ–±–ª–µ–º—ã —Å –ë–î |
| **CRITICAL** | üî¥ | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ | –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è, –ø–æ–ª–Ω—ã–π –∫—Ä–∞—à |

---

## üìÇ –ö–ê–¢–ï–ì–û–†–ò–ò –û–®–ò–ë–û–ö

- `telegram` üì± - –û—à–∏–±–∫–∏ Telegram API
- `database` üóÑÔ∏è - –ü—Ä–æ–±–ª–µ–º—ã —Å –ë–î
- `api` üåê - –û—à–∏–±–∫–∏ API endpoints
- `amocrm` üíº - –ü—Ä–æ–±–ª–µ–º—ã —Å AmoCRM
- `queue` üìã - –û—à–∏–±–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π
- `validation` ‚úÖ - –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- `network` üåç - –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- `authentication` üîê - –ü—Ä–æ–±–ª–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## üõ†Ô∏è TROUBLESHOOTING

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å healthcheck
curl http://localhost:3000/api/telegram-leads/health

# 2. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å dashboard
curl http://localhost:3000/api/telegram-leads/dashboard

# 3. –ï—Å–ª–∏ bot_running: false - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
curl -X POST http://localhost:3000/api/telegram-leads/restart
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–∞–¥–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `restart_count` –≤ healthcheck
2. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å `last_error` –≤ dashboard
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ –≤ –ë–î:
   ```sql
   SELECT * FROM error_logs 
   WHERE category = 'telegram' 
   ORDER BY timestamp DESC 
   LIMIT 10;
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä—É–ø–ø—ã:
   ```bash
   curl http://localhost:3000/api/telegram-leads/active-groups
   ```
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
   ```bash
   curl -X POST http://localhost:3000/api/telegram-leads/test
   ```
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–æ—Ç –∞–¥–º–∏–Ω –≤ –≥—Ä—É–ø–ø–µ

---

## üîß –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –§–ò–ß–ò

### 1. –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
- –ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 10 —Å–µ–∫—É–Ω–¥
- –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –ë–î

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –≥—Ä—É–ø–ø
- –ï—Å–ª–∏ –±–æ—Ç –∑–∞–±–∞–Ω–µ–Ω (403) - –≥—Ä—É–ø–ø–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è
- –ï—Å–ª–∏ —á–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω (400) - –≥—Ä—É–ø–ø–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è
- –ó–∞–ø–∏—Å—å –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –ë–î –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

### 3. Graceful Error Handling
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –û—à–∏–±–∫–∏ –Ω–µ –ª–æ–º–∞—é—Ç —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

---

## üìã –ü–†–ò–ú–ï–ù–ò–¢–¨ SQL –ú–ò–ì–†–ê–¶–ò–Æ

–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ `error_logs` –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω–∞:

1. –û—Ç–∫—Ä–æ–π Supabase SQL Editor
2. –í—ã–±–µ—Ä–∏ –ø—Ä–æ–µ–∫—Ç **Landing DB** (`xikaiavwqinamgolmtcy`)
3. –°–∫–æ–ø–∏—Ä—É–π –∏ –≤—ã–ø–æ–ª–Ω–∏ SQL –∏–∑ —Ñ–∞–π–ª–∞:
   ```
   backend/supabase/migrations/create_error_logs.sql
   ```

**–ò–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
```bash
cd backend
node -e "
const { createClient } = require('@supabase/supabase-js');
const fs = require('fs');
const client = createClient(
  process.env.LANDING_SUPABASE_URL,
  process.env.LANDING_SUPABASE_SERVICE_KEY
);
const sql = fs.readFileSync('./supabase/migrations/create_error_logs.sql', 'utf8');
console.log('Applying migration...');
// Note: Supabase –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä—è–º–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ DDL —á–µ—Ä–µ–∑ REST API
// –ò—Å–ø–æ–ª—å–∑—É–π SQL Editor –≤ Supabase Dashboard
"
```

---

## üéØ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:**
   ```bash
   curl http://localhost:3000/api/telegram-leads/health
   ```

2. **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞—à–±–æ—Ä–¥:**
   ```bash
   curl http://localhost:3000/api/telegram-leads/dashboard | jq
   ```

3. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ª–∏–¥:**
   ```bash
   curl -X POST http://localhost:3000/api/telegram-leads/test
   ```

4. **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:**
   ```bash
   tail -f /tmp/backend-new.log | grep -E "Telegram|Error|‚ùå"
   ```

---

## ‚úÖ –ò–¢–û–ì–û

–¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è –µ—Å—Ç—å:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∫—Ä–∞—à–µ–π
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ Dashboard —Å –ø–æ–ª–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚úÖ API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω—É!** üöÄ
