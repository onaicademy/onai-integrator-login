# üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ß–ï–¢: –ß—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–ª–∞ –ò–î–ï–ê–õ–¨–ù–û –¥–æ "—É–ª—É—á—à–µ–Ω–∏–π"

### ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–õ–û –î–û –ò–ó–ú–ï–ù–ï–ù–ò–ô:

1. **Telegram Leads Bot - 100% —Ä–∞–±–æ—á–∏–π**
   - –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–ª—Å—è –≤ polling mode
   - –û—Ç–≤–µ—á–∞–ª –Ω–∞ –∫–æ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ "2134"
   - –ì—Ä—É–ø–ø–∞ —Å–æ—Ö—Ä–∞–Ω—è–ª–∞—Å—å –≤ –ë–î (`telegram_groups`)
   - –¢–µ—Å—Ç–æ–≤—ã–µ –ª–∏–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –≤ Telegram ‚úÖ

2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
   - –¢–∞–±–ª–∏—Ü–∞ `telegram_groups` —Å–æ–∑–¥–∞–Ω–∞
   - RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
   - –ì—Ä—É–ø–ø–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞:
     ```json
     {
       "chat_id": "-1003505301432",
       "chat_title": "–õ–∏–¥—ã –¢—Ä–∏–ø–≤–∞–µ—Ä",
       "is_active": true,
       "activated_by": "saint4ai"
     }
     ```

3. **Backend —Å–µ—Ä–≤–µ—Ä**
   - –ó–∞–ø—É—Å–∫–∞–ª—Å—è –Ω–∞ `localhost:3000`
   - Endpoints –æ—Ç–≤–µ—á–∞–ª–∏
   - –í—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ

---

## ‚ùå –ß–¢–û –°–õ–û–ú–ê–õ–û–°–¨ –ü–û–°–õ–ï "–£–õ–£–ß–®–ï–ù–ò–ô"

### –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è):

#### 1Ô∏è‚É£ –ò–∑–º–µ–Ω–µ–Ω–∏–µ: `backend/src/config/redis.ts`
**–ß—Ç–æ —Å–¥–µ–ª–∞–ª–∏:** –ü–µ—Ä–µ–ø–∏—Å–∞–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ "production-ready" –≤–µ—Ä—Å–∏—é —Å:
- `lazyConnect: true`
- `setImmediate()` –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- Strict retry limits (3 –ø–æ–ø—ã—Ç–∫–∏)
- `initRedisOptional()` —Ñ—É–Ω–∫—Ü–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Redis –ø–µ—Ä–µ—Å—Ç–∞–ª –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ...

#### 2Ô∏è‚É£ –ò–∑–º–µ–Ω–µ–Ω–∏–µ: `backend/src/services/errorTrackingService.ts`
**–ß—Ç–æ —Å–¥–µ–ª–∞–ª–∏:** –ò–∑–º–µ–Ω–∏–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é pino logger:
- –î–æ–±–∞–≤–∏–ª–∏ try-catch
- –£—Å–ª–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è pino-pretty

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Logger —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ...

#### 3Ô∏è‚É£ –ò–∑–º–µ–Ω–µ–Ω–∏–µ: `backend/src/utils/supabaseHelpers.ts`
**–ß—Ç–æ —Å–¥–µ–ª–∞–ª–∏:** –°–æ–∑–¥–∞–ª–∏ –Ω–æ–≤—ã–π —Ñ–∞–π–ª —Å:
- `withTimeout()` wrapper
- `safeSupabaseQuery()` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞–Ω, –Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã

#### 4Ô∏è‚É£ –ò–∑–º–µ–Ω–µ–Ω–∏–µ: `backend/src/routes/telegram-leads.ts`
**–ß—Ç–æ —Å–¥–µ–ª–∞–ª–∏:**
- –î–æ–±–∞–≤–∏–ª–∏ –∏–º–ø–æ—Ä—Ç—ã: `checkRedisHealth`, `getRedisState`, `safeSupabaseQuery`
- –û–±–Ω–æ–≤–∏–ª–∏ healthcheck endpoint —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
- –ò–∑–º–µ–Ω–∏–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –±–æ—Ç–∞ –Ω–∞ `setImmediate()`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ö†Ô∏è **–í–°–ï ENDPOINTS –ü–ï–†–ï–°–¢–ê–õ–ò –û–¢–í–ï–ß–ê–¢–¨**

#### 5Ô∏è‚É£ –ò–∑–º–µ–Ω–µ–Ω–∏–µ: `backend/src/server.ts`
**–ß—Ç–æ —Å–¥–µ–ª–∞–ª–∏:**
- –û–±–µ—Ä–Ω—É–ª–∏ background tasks –≤ `setImmediate()`
- –£–±—Ä–∞–ª–∏ `await` –∏–∑ `app.listen()` callback

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –Ω–æ endpoints –Ω–µ –æ—Ç–≤–µ—á–∞—é—Ç

---

## üêõ –¢–ï–ö–£–©–ò–ï –°–ò–ú–ü–¢–û–ú–´

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è: `üöÄ Backend API –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:3000`
- ‚úÖ –ü–æ—Ä—Ç 3000 –æ—Ç–∫—Ä—ã—Ç –∏ —Å–ª—É—à–∞–µ—Ç
- ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å—ã Node.js —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Telegram –±–æ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è: `‚úÖ All message handlers installed`
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π endpoint `/ping` —Ä–∞–±–æ—Ç–∞–µ—Ç: `{"status":"pong"}`

### –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚ùå `/api/telegram-leads/health` - timeout
- ‚ùå `/api/telegram-leads/active-groups` - timeout
- ‚ùå `/api/telegram-leads/test` - timeout
- ‚ùå –õ—é–±—ã–µ endpoints —Ä–æ—É—Ç–µ—Ä–∞ `telegram-leads`

### –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:
```
‚úÖ Backend API –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:3000
‚úÖ Telegram Leads Bot started in POLLING mode
‚úÖ All message handlers installed
GET /api/telegram-leads/health  ‚Üê –ó–∞–ø—Ä–æ—Å –¥–æ—Ö–æ–¥–∏—Ç
[no response]  ‚Üê –û—Ç–≤–µ—Ç–∞ –Ω–µ—Ç (timeout)
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
```bash
# –ü—Ä–æ—Å—Ç–æ–π endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç
$ curl http://localhost:3000/ping
{"status":"pong","timestamp":"2025-12-16T03:36:52.909Z"} ‚úÖ

# telegram-leads endpoints –ù–ï —Ä–∞–±–æ—Ç–∞—é—Ç
$ curl http://localhost:3000/api/telegram-leads/health
[timeout after 30 seconds] ‚ùå
```

---

## üî¨ –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´

### –ì–∏–ø–æ—Ç–µ–∑–∞ 1: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–≥–¥–∞ Express –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ä–æ—É—Ç–µ—Ä `telegram-leads.ts`, —á—Ç–æ-—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop.

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:**
1. –ü—Ä–æ—Å—Ç–æ–π test endpoint –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ —Ä–æ—É—Ç–µ—Ä–∞ —Ç–æ–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. –ó–∞–ø—Ä–æ—Å—ã –¥–æ—Ö–æ–¥—è—Ç –¥–æ —Ä–æ—É—Ç–µ—Ä–∞ (–≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö)
3. –ù–æ –Ω–∏ –æ–¥–∏–Ω handler –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –ò–º–ø–æ—Ä—Ç—ã –±–ª–æ–∫–∏—Ä—É—é—Ç (`errorTrackingService`, `supabaseHelpers`, `redis`)
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è –±–ª–æ–∫–∏—Ä—É–µ—Ç
- `createClient()` –¥–ª—è Supabase –±–ª–æ–∫–∏—Ä—É–µ—Ç
- –ß—Ç–æ-—Ç–æ –≤ —Ü–µ–ø–æ—á–∫–µ –∏–º–ø–æ—Ä—Ç–æ–≤ –∑–∞–≤–∏—Å–ª–æ

### –ì–∏–ø–æ—Ç–µ–∑–∞ 2: –ü—Ä–æ–±–ª–µ–º–∞ —Å async –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
**–ü—Ä–æ–±–ª–µ–º–∞:** `initializeLeadsBot()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `setImmediate()`, –Ω–æ —á—Ç–æ-—Ç–æ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç.

**–ö–æ–¥:**
```typescript
// –°—Ç—Ä–æ–∫–∞ 208-212 –≤ telegram-leads.ts
setImmediate(() => {
  initializeLeadsBot().catch(err => {
    console.error('‚ùå Failed to initialize leads bot:', err);
  });
});
```

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- `new TelegramBot()` –¥–µ–ª–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –î–∞–∂–µ —Å `lazyConnect: true` —á—Ç–æ-—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç

### –ì–∏–ø–æ—Ç–µ–∑–∞ 3: –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã
**–ü—Ä–æ–±–ª–µ–º–∞:** –í–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–ª–∏ —Ü–∏–∫–ª–∏—á–µ—Å–∫—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–æ–≤.

**–¶–µ–ø–æ—á–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤:**
```
server.ts
  ‚Üí telegram-leads.ts
      ‚Üí errorTrackingService.ts
          ‚Üí redis.ts?
          ‚Üí supabase?
      ‚Üí supabaseHelpers.ts
      ‚Üí redis.ts
```

---

## üìã –†–ê–ë–û–ß–ò–ï –í–ï–†–°–ò–ò –§–ê–ô–õ–û–í (–î–û –ò–ó–ú–ï–ù–ï–ù–ò–ô)

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–ª–∏ —ç—Ç–∏ –≤–µ—Ä—Å–∏–∏:

#### `backend/src/config/redis.ts` (–†–ê–ë–û–ß–ê–Ø –í–ï–†–°–ò–Ø)
```typescript
import Redis from 'ioredis';
import pino from 'pino';

const logger = pino();

const REDIS_URL = process.env.REDIS_URL || 'redis://localhost:6379';

export const redis = new Redis(REDIS_URL, {
  maxRetriesPerRequest: null, // Required for BullMQ
  enableReadyCheck: false,
  retryStrategy: (times) => {
    const delay = Math.min(times * 50, 2000);
    logger.warn(`Redis retry ${times}, waiting ${delay}ms`);
    return delay;
  },
});

// ... event handlers ...

export default redis;
```

#### `backend/src/routes/telegram-leads.ts` (–†–ê–ë–û–ß–ê–Ø –í–ï–†–°–ò–Ø - —É–ø—Ä–æ—â–µ–Ω–Ω–æ)
```typescript
import { Router } from 'express';
import TelegramBot from 'node-telegram-bot-api';
import { createClient } from '@supabase/supabase-js';

const router = Router();

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const LEADS_BOT_TOKEN = process.env.TELEGRAM_LEADS_BOT_TOKEN || '';
const landingSupabase = createClient(/* ... */);

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
let leadsBot: TelegramBot | null = null;

if (LEADS_BOT_TOKEN) {
  leadsBot = new TelegramBot(LEADS_BOT_TOKEN, { 
    polling: {
      params: {
        allowed_updates: ['message', 'my_chat_member']
      }
    }
  });
  console.log('‚úÖ Telegram Leads Bot started in POLLING mode');
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
if (leadsBot) {
  leadsBot.on('message', async (msg) => {
    // ... –∫–æ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ ...
  });
  // ... –¥—Ä—É–≥–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ...
}

// Endpoints
router.get('/health', async (req, res) => {
  res.json({ status: 'ok', bot_running: !!leadsBot });
});

// ... –¥—Ä—É–≥–∏–µ endpoints ...

export default router;
```

---

## ‚ùì –í–û–ü–†–û–°–´ –î–õ–Ø PERPLEXITY AI

### –ì–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å:
**–ü–æ—á–µ–º—É –ø–æ—Å–ª–µ "production-ready" –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π Express router –ø–µ—Ä–µ—Å—Ç–∞–ª –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã, —Ö–æ—Ç—è –ø—Ä–æ—Å—Ç–æ–π `/ping` endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç?**

### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã:

1. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª—è**
   - –ú–æ–∂–µ—Ç –ª–∏ `createClient()` –æ—Ç Supabase –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª—è?
   - –ú–æ–∂–µ—Ç –ª–∏ `new TelegramBot()` –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–∞–∂–µ —Å `polling: true`?
   - –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—è–∂–µ–ª—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ Express router?

2. **setImmediate vs setTimeout vs Promise**
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `setImmediate()` –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏?
   - –ú–æ–∂–µ—Ç –ª–∏ `setImmediate()` –≤ –º–æ–¥—É–ª–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å Express router?
   - –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –±–æ—Ç–∞?

3. **–ò–º–ø–æ—Ä—Ç—ã –∏ side effects**
   - –ú–æ–≥—É—Ç –ª–∏ –∏–º–ø–æ—Ä—Ç—ã (`import { checkRedisHealth }`) –≤—ã–∑–≤–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É?
   - –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å side effects –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–∞—Ö?
   - –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ - –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å?

4. **node-telegram-bot-api**
   - –ö–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ `TelegramBot` –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏?
   - –ë–ª–æ–∫–∏—Ä—É–µ—Ç –ª–∏ `polling: true` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é?
   - Best practices –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞ –≤ Express –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏?

5. **–û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π**
   - –ö–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏?
   - –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é?
   - Git –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞?

---

## üéØ –ñ–ï–õ–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

### Option 1: –û—Ç–∫–∞—Ç –∫ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏
**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –¢–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–∫–∞—Ç–∞ —Ñ–∞–π–ª–æ–≤
- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Option 2: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ production-ready —Ä–µ—à–µ–Ω–∏—è
**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –ü–æ–Ω—è—Ç—å –ü–û–ß–ï–ú–£ —Ç–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ —É–ª—É—á—à–µ–Ω–∏—è (Redis, error tracking, healthcheck)

### Option 3: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –∑–∞—â–∏—Ç–æ–π
**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- –ë–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- –ü—Ä–æ—Å—Ç–æ —Ä–∞–±–æ—á–∞—è —Å–∏—Å—Ç–µ–º–∞

---

## üìä –§–ê–ô–õ–´ –ö–û–¢–û–†–´–ï –ë–´–õ–ò –ò–ó–ú–ï–ù–ï–ù–´

### –ò–∑–º–µ–Ω–µ–Ω–æ (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–æ–º–∞–Ω–æ):
1. ‚úèÔ∏è `backend/src/config/redis.ts` - –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞
2. ‚úèÔ∏è `backend/src/services/errorTrackingService.ts` - –∏–∑–º–µ–Ω–µ–Ω logger
3. ‚úèÔ∏è `backend/src/routes/telegram-leads.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã, –∏–∑–º–µ–Ω–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
4. ‚úèÔ∏è `backend/src/server.ts` - –∏–∑–º–µ–Ω–µ–Ω app.listen callback
5. ‚ûï `backend/src/utils/supabaseHelpers.ts` - —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª

### –°–æ–∑–¥–∞–Ω–æ (–Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã):
- `backend/supabase/migrations/create_error_logs.sql`
- `üìä_–°–ò–°–¢–ï–ú–ê_–î–ï–ë–ê–ì–ê.md`
- `üîç_–ü–†–û–ú–ü–¢_–î–õ–Ø_PERPLEXITY.md`

### –ù–ï –∏–∑–º–µ–Ω–µ–Ω–æ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–±–æ—á–∏–µ):
- ‚úÖ `backend/src/services/telegramService.ts`
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã)
- ‚úÖ `.env` —Ñ–∞–π–ª—ã

---

## üö® –ü–†–ò–û–†–ò–¢–ï–¢: –°–†–û–ß–ù–û

**–°–æ—Å—Ç–æ—è–Ω–∏–µ:** Production –±–æ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç  
**–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ:** –õ–∏–¥—ã –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Telegram  
**–í—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è:** ~2 —á–∞—Å–∞  

**–ù—É–∂–Ω–æ:**
1. –ù–∞–π—Ç–∏ –¢–û–ß–ù–£–Æ –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–æ—É—Ç–µ—Ä–∞
2. –õ–∏–±–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∫ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏
3. –õ–∏–±–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üí° –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

### Environment:
- Node.js v22.17.0
- TypeScript
- macOS (development)
- Express.js
- node-telegram-bot-api
- @supabase/supabase-js
- ioredis

### –†–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä `/ping`:
```typescript
// –í server.ts - –†–ê–ë–û–¢–ê–ï–¢
app.get('/ping', (req, res) => {
  res.json({ status: 'pong' });
});
```

### –ù–ï —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä:
```typescript
// –í telegram-leads.ts - –ù–ï –†–ê–ë–û–¢–ê–ï–¢
router.get('/test-simple', (req, res) => {
  res.json({ status: 'test' });
});
```

**–†–∞–∑–Ω–∏—Ü–∞:** –¢–æ–ª—å–∫–æ –≤ —Ç–æ–º, —á—Ç–æ –≤—Ç–æ—Ä–æ–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ä–æ—É—Ç–µ—Ä–µ —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏.

---

## üîç –ß–¢–û –ò–°–ö–ê–¢–¨ –í PERPLEXITY:

1. **"Express router stops responding after adding imports"**
2. **"node-telegram-bot-api blocks event loop"**
3. **"setImmediate in Express router module"**
4. **"Supabase createClient blocking module load"**
5. **"How to debug Express router timeout with requests reaching server"**

---

**–í–ê–ñ–ù–û:** –ù–∞–º –Ω—É–∂–Ω–æ –ª–∏–±–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏, –ª–∏–±–æ –ø–æ–Ω—è—Ç—å –¢–û–ß–ù–£–Æ –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –µ—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ. Production —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –∂–¥–∞—Ç—å!
