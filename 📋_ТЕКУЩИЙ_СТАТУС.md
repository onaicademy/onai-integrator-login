# üìã –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢

### 1. Telegram –ë–æ—Ç –¥–ª—è –õ–∏–¥–æ–≤
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –≤ polling mode (development)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≥—Ä—É–ø–ø—ã –ø–æ –∫–æ–¥—É "2134" - –†–ê–ë–û–¢–ê–ï–¢
- ‚úÖ –ì—Ä—É–ø–ø–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î (`telegram_groups` —Ç–∞–±–ª–∏—Ü–∞)
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –ª–∏–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram –≥—Ä—É–ø–ø—É

**–ì—Ä—É–ø–ø–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞:**
```json
{
  "chat_id": "-1003505301432",
  "chat_title": "–õ–∏–¥—ã –¢—Ä–∏–ø–≤–∞–µ—Ä",
  "is_active": true,
  "activated_by": "saint4ai",
  "activated_at": "2025-12-16T03:16:02.821Z"
}
```

### 2. –°–∏—Å—Ç–µ–º–∞ –ó–∞—â–∏—Ç—ã –∏ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ ErrorTrackingService –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ–±–µ—Ä–Ω—É—Ç—ã –≤ try-catch
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î (`error_logs` —Ç–∞–±–ª–∏—Ü–∞)
- ‚úÖ Healthcheck endpoint —Å–æ–∑–¥–∞–Ω
- ‚úÖ Dashboard endpoint —Å–æ–∑–¥–∞–Ω

### 3. –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `telegram_groups` —Å–æ–∑–¥–∞–Ω–∞ –≤ Landing DB
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `error_logs` —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã

### 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `üìä_–°–ò–°–¢–ï–ú–ê_–î–ï–ë–ê–ì–ê.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- ‚úÖ `üîç_–ü–†–û–ú–ü–¢_–î–õ–Ø_PERPLEXITY.md` - –ø—Ä–æ–º–ø—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ—à–µ–Ω–∏—è

---

## ‚ùå –ß–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢

### 1. üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø: Redis –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–µ—Ä–≤–µ—Ä
**–ü—Ä–æ–±–ª–µ–º–∞:** ioredis –¥–µ–ª–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop.

**–°–∏–º–ø—Ç–æ–º—ã:**
- –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (–ø–æ—Ä—Ç 3000 –æ—Ç–∫—Ä—ã—Ç)
- –ë–æ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ù–û —Å–µ—Ä–≤–µ—Ä –ù–ï –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ HTTP –∑–∞–ø—Ä–æ—Å—ã (timeout)

**–õ–æ–≥–∏:**
```
‚úÖ Telegram Leads Bot started in POLLING mode
‚úÖ All message handlers installed
Redis retry 105/10 in 2000ms
[–±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è]
GET /api/telegram-leads/health  [no response]
```

### 2. üêõ Healthcheck endpoint –∑–∞–≤–∏—Å–∞–µ—Ç
**–ü—Ä–æ–±–ª–µ–º–∞:** Supabase –∑–∞–ø—Ä–æ—Å –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è.

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ó–∞–ø—Ä–æ—Å –¥–æ—Ö–æ–¥–∏—Ç –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö)
- –ö–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ –∑–∞–ø—Ä–æ—Å–∞ –≤ Supabase
- –ó–∞–ø—Ä–æ—Å –∑–∞–≤–∏—Å–∞–µ—Ç –∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç timeout

### 3. ‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã
**–ü—Ä–æ–±–ª–µ–º–∞:** Event loop –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω Redis –ø–æ–ø—ã—Ç–∫–∞–º–∏.

**–ß—Ç–æ –≤–∏–¥–∏–º:**
```bash
$ curl http://localhost:3000/api/telegram-leads/health
[timeout after 30 seconds]

$ lsof -i :3000
node   TCP *:hbci (LISTEN)  ‚úÖ –ü–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç

$ ps aux | grep node
node ... src/server.ts  ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç–∞–µ—Ç
```

---

## üéØ –ß–¢–û –ù–£–ñ–ù–û –ò–°–ü–†–ê–í–ò–¢–¨

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä
- –°–¥–µ–ª–∞—Ç—å Redis –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º
- –£–±—Ä–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É event loop
- –°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –ë–ï–ó Redis

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å Supabase timeout
- –î–æ–±–∞–≤–∏—Ç—å working timeout –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
- Graceful fallback –µ—Å–ª–∏ –ë–î –º–µ–¥–ª–µ–Ω–Ω–∞—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É
- Healthcheck –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å
- Dashboard –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å
- Telegram –±–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ª–∏–¥—ã

---

## üîß –§–ê–ô–õ–´ –î–õ–Ø –ò–ó–ú–ï–ù–ï–ù–ò–Ø

1. `/backend/src/config/redis.ts` - Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
2. `/backend/src/routes/telegram-leads.ts` - Healthcheck endpoint
3. –í–æ–∑–º–æ–∂–Ω–æ: `/backend/src/server.ts` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞

---

## üìû –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç –≤ Perplexity** ‚Üí –Ω–∞–π—Ç–∏ —Ä–∞–±–æ—á–µ–µ —Ä–µ—à–µ–Ω–∏–µ
2. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ** ‚Üí –∏—Å–ø—Ä–∞–≤–∏—Ç—å Redis –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** ‚Üí —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
4. **–ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å** ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üìä –ú–ï–¢–†–ò–ö–ò

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–∞:**

```bash
# 1. Healthcheck –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ < 1 —Å–µ–∫—É–Ω–¥—É
$ curl http://localhost:3000/api/telegram-leads/health
{
  "success": true,
  "status": {
    "bot_running": true,
    "uptime_seconds": 3600
  }
}

# 2. Dashboard –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
$ curl http://localhost:3000/api/telegram-leads/dashboard
{
  "success": true,
  "data": {
    "bot_status": {...},
    "active_groups": [...]
  }
}

# 3. Telegram –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å "2134" –≤ –≥—Ä—É–ø–ø—É ‚Üí –±–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –≥—Ä—É–ø–ø—É

# 4. –õ–∏–¥—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Telegram
POST /api/landing/submit ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –≥—Ä—É–ø–ø—É
```

---

**–î–∞—Ç–∞:** 16 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** üü° –í –ø—Ä–æ—Ü–µ—Å—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è  
**–ë–ª–æ–∫–µ—Ä:** Redis –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop
