# üöÄ –î–µ–ø–ª–æ–π —Å–∏—Å—Ç–µ–º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ª–∏–¥–æ–≤

## ‚ö†Ô∏è –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°: –ù–ï –ó–ê–î–ï–ü–õ–û–ï–ù–û

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–¥–µ–ª–∞–Ω—ã **–õ–û–ö–ê–õ–¨–ù–û**. –î–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–ø–ª–æ–π.

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å:

### 1. Backend API (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
**–§–∞–π–ª—ã:**
- `backend/src/routes/lead-tracking.ts` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
- `backend/src/server.ts` (–¥–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –∏ —Ä–æ—É—Ç)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–∏–¥–æ–≤ `/api/lead-tracking/leads`
- API –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å amoCRM `/api/lead-tracking/sync`
- API –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–ª–∏–∫–æ–≤ `/api/lead-tracking/track-click`
- API –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ Email/SMS

### 2. Frontend Dashboard
**–§–∞–π–ª—ã:**
- `src/pages/admin/LeadTracking.tsx` (–Ω–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
- `src/App.tsx` (–¥–æ–±–∞–≤–ª–µ–Ω —Ä–æ—É—Ç `/target`)

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ª–∏–¥–∞–º
- –¢–∞–±–ª–∏—Ü—É –ª–∏–¥–æ–≤ —Å Email/SMS —Å—Ç–∞—Ç—É—Å–∞–º–∏
- –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ –ø–µ—Ä–µ—Ö–æ–¥–∞–º –∏ –∫–ª–∏–∫–∞–º

### 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–ñ–ï –ü–†–ò–ú–ï–ù–ï–ù–û

–ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:
- –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `lead_tracking`
- –î–æ–±–∞–≤–ª–µ–Ω—ã UTM –ø–æ–ª—è
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∏

## üîß –ö–∞–∫ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
git add .
git commit -m "feat: add lead tracking dashboard with UTM analytics"

# 2. –ü—É—à –Ω–∞ GitHub
git push origin main

# 3. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (SSH):
cd /var/www/onai-integrator-login
git pull origin main

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend
pm2 restart backend

# 5. Rebuild frontend (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
npm run build
pm2 restart frontend
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –¢–æ–ª—å–∫–æ backend (–±—ã—Å—Ç—Ä–µ–µ)

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /var/www/onai-integrator-login/backend
git pull origin main
pm2 restart backend
```

Frontend –º–æ–∂–Ω–æ –Ω–µ –¥–µ–ø–ª–æ–∏—Ç—å —Å—Ä–∞–∑—É - –¥–∞—à–±–æ—Ä–¥ `/target` –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –±–∏–ª–¥–∞.

## üìä –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ backend API:
```bash
curl https://onai.academy/api/lead-tracking/leads
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON —Å –ª–∏–¥–∞–º–∏.

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å amoCRM:
```bash
curl -X POST https://onai.academy/api/lead-tracking/sync
```

–î–æ–ª–∂–µ–Ω –ø–æ–¥—Ç—è–Ω—É—Ç—å 4 –ª–∏–¥–∞ –∏–∑ amoCRM.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ frontend:
–û—Ç–∫—Ä—ã—Ç—å: `https://onai.academy/target`

–î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –¥–∞—à–±–æ—Ä–¥ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏.

## ‚ö° –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

### –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å:

```bash
# AmoCRM –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
AMOCRM_DOMAIN=onaiagencykz.amocrm.ru
AMOCRM_ACCESS_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
AMOCRM_PIPELINE_ID=10350882

# Supabase (Tripwire –±–∞–∑–∞)
TRIPWIRE_SUPABASE_URL=–≤–∞—à_url
TRIPWIRE_SUPABASE_SERVICE_KEY=–≤–∞—à_–∫–ª—é—á
```

## üéØ –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

1. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π 4 –ª–∏–¥–∞ –∏–∑ amoCRM:**
   - –û—Ç–∫—Ä–æ–π `/target`
   - –ù–∞–∂–º–∏ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å AmoCRM"
   - –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ç—è–Ω–µ—Ç –¥–∞–Ω–Ω—ã–µ

2. **–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ª–∏–¥—ã –ø–æ—è–≤–∏–ª–∏—Å—å:**
   - –í —Ç–∞–±–ª–∏—Ü–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 4 –∑–∞–ø–∏—Å–∏
   - –° amoCRM Deal ID
   - –°–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏

3. **–ù–∞—Å—Ç—Ä–æ–π Email/SMS —Å UTM:**
   - –ò—Å–ø–æ–ª—å–∑—É–π `UTM_TRACKING_GUIDE.md`
   - –î–æ–±–∞–≤—å UTM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Å—Å—ã–ª–∫–∏
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### Backend –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç:
```bash
pm2 logs backend
```

–ü—Ä–æ–≤–µ—Ä—å –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ `lead-tracking.ts`

### API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404:
–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ä–æ—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ `server.ts`:
```typescript
import leadTrackingRouter from './routes/lead-tracking';
app.use('/api/lead-tracking', leadTrackingRouter);
```

### amoCRM –Ω–µ –æ—Ç–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:
–ü—Ä–æ–≤–µ—Ä—å —Ç–æ–∫–µ–Ω –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ amoCRM.

---

**–í–∞–∂–Ω–æ:** –ë–µ–∑ –¥–µ–ø–ª–æ—è —Å–∏—Å—Ç–µ–º–∞ –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –Ω–∞ –ø—Ä–æ–¥–µ! 

–•–æ—á–µ—à—å —á—Ç–æ–±—ã —è —Å–æ–∑–¥–∞–ª pull request –∏–ª–∏ –∫–æ–º–º–∏—Ç –¥–ª—è –¥–µ–ø–ª–æ—è? üöÄ

