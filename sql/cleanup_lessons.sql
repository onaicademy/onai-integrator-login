-- ===============================================
-- üßπ –û–ß–ò–°–¢–ö–ê –õ–ò–®–ù–ò–• –£–†–û–ö–û–í
-- ===============================================
-- –í—ã–ø–æ–ª–Ω–∏ –≤ Supabase SQL Editor
-- https://supabase.com/dashboard/project/arqhkacellqbhjhbebfh/sql

-- 1Ô∏è‚É£ –ü–æ–∫–∞–∑–∞—Ç—å –í–°–ï —É—Ä–æ–∫–∏ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º)
SELECT 
  id, 
  title, 
  video_url,
  module_id,
  created_at,
  CASE 
    WHEN video_url IS NOT NULL THEN '‚úÖ –° –≤–∏–¥–µ–æ'
    ELSE '‚ùå –ë–µ–∑ –≤–∏–¥–µ–æ'
  END as status
FROM lessons
WHERE module_id = 1
ORDER BY id DESC;

-- 2Ô∏è‚É£ –ü–æ—Å—á–∏—Ç–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —É—Ä–æ–∫–æ–≤ –≤ –º–æ–¥—É–ª–µ 1
SELECT 
  '–í—Å–µ–≥–æ —É—Ä–æ–∫–æ–≤ –≤ –º–æ–¥—É–ª–µ 1' as info,
  COUNT(*) as count
FROM lessons
WHERE module_id = 1;

-- 3Ô∏è‚É£ –ù–∞–π—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–æ–∑–¥–∞–Ω–Ω—ã–π —É—Ä–æ–∫ (–∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –û–°–¢–ê–í–ò–¢–¨)
SELECT 
  id as last_lesson_id,
  title,
  video_url,
  '–û–°–¢–ê–í–ò–¢–¨ –≠–¢–û–¢ –£–†–û–ö' as action
FROM lessons
WHERE module_id = 1
ORDER BY id DESC
LIMIT 1;

-- 4Ô∏è‚É£ –ü–æ–∫–∞–∑–∞—Ç—å —É—Ä–æ–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –£–î–ê–õ–ï–ù–´ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)
SELECT 
  id,
  title,
  video_url,
  '‚ùå –ë–£–î–ï–¢ –£–î–ê–õ–Å–ù' as action
FROM lessons
WHERE module_id = 1
AND id < (
  SELECT id FROM lessons 
  WHERE module_id = 1 
  ORDER BY id DESC 
  LIMIT 1
)
ORDER BY id DESC;

-- 5Ô∏è‚É£ –£–î–ê–õ–ò–¢–¨ –≤—Å–µ –ª–∏—à–Ω–∏–µ —É—Ä–æ–∫–∏ (–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π)
-- ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞!
-- –°–∫–æ–ø–∏—Ä—É–π –∏ –≤—ã–ø–æ–ª–Ω–∏ –û–¢–î–ï–õ–¨–ù–û –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —à–∞–≥–∞ 4Ô∏è‚É£

DELETE FROM lessons
WHERE module_id = 1
AND id < (
  SELECT id FROM lessons 
  WHERE module_id = 1 
  ORDER BY id DESC 
  LIMIT 1
);

-- 6Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è –û–î–ò–ù —É—Ä–æ–∫)
SELECT 
  id, 
  title, 
  video_url,
  CASE 
    WHEN video_url IS NOT NULL THEN '‚úÖ –° –≤–∏–¥–µ–æ'
    ELSE '‚ùå –ë–µ–∑ –≤–∏–¥–µ–æ'
  END as status,
  created_at
FROM lessons
WHERE module_id = 1
ORDER BY id DESC;

-- 7Ô∏è‚É£ –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT 
  '–û—Å—Ç–∞–ª–æ—Å—å —É—Ä–æ–∫–æ–≤ –≤ –º–æ–¥—É–ª–µ 1' as info,
  COUNT(*) as count
FROM lessons
WHERE module_id = 1;

-- ===============================================
-- üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ:
-- ===============================================
-- 1. –í—ã–ø–æ–ª–Ω–∏ –∑–∞–ø—Ä–æ—Å—ã 1-4 –¥–ª—è –ü–†–û–í–ï–†–ö–ò
-- 2. –£–±–µ–¥–∏—Å—å —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —É—Ä–æ–∫ –±—É–¥–µ—Ç –æ—Å—Ç–∞–≤–ª–µ–Ω
-- 3. –í—ã–ø–æ–ª–Ω–∏ –∑–∞–ø—Ä–æ—Å 5 (DELETE) –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
-- 4. –í—ã–ø–æ–ª–Ω–∏ –∑–∞–ø—Ä–æ—Å—ã 6-7 –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
-- ===============================================

-- ===============================================
-- üîÑ –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê: –£–¥–∞–ª–∏—Ç—å –í–°–ï —É—Ä–æ–∫–∏ –≤ –º–æ–¥—É–ª–µ 1
-- ===============================================
-- –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –Ω–∞—á–∞—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞:

-- DELETE FROM lessons WHERE module_id = 1;

-- ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï —É—Ä–æ–∫–∏!
-- ===============================================
