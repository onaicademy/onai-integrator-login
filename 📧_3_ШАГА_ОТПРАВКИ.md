# 📧 3 ШАГА ДЛЯ ОТПРАВКИ EMAIL

**Время:** 2 минуты  
**Сложность:** Очень легко  
**Студентов:** 62

---

## 🚀 **ШАГ 1: ПОЛУЧИ ТОКЕН АДМИНА (1 минута)**

1. Открой браузер → https://onai.academy/integrator/admin
2. Залогинься как админ (если ещё не залогинен)
3. Нажми `F12` (откроется DevTools)
4. Вкладка **Application**
5. Слева: **Local Storage** → `https://onai.academy`
6. Найди ключ: `tripwire_supabase_token`
7. Кликни на значение → **Скопируй** (Ctrl+C / Cmd+C)

```
Токен выглядит так:
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJhdXRoZ...
                         ^^^^^ начинается с eyJ
```

---

## 🚀 **ШАГ 2: ВСТАВЬ ТОКЕН В СКРИПТ (30 секунд)**

1. Открой файл:
```bash
nano 📧_ОТПРАВИТЬ_ПРЯМО_СЕЙЧАС.sh
```

2. Найди строку **15**:
```bash
ADMIN_TOKEN="ВСТАВЬ_СЮДА_ТОКЕН"
```

3. Замени на (вставь свой токен):
```bash
ADMIN_TOKEN="eyJхххххххххх..."
```

4. Сохрани: `Ctrl+X` → `Y` → `Enter`

---

## 🚀 **ШАГ 3: ЗАПУСТИ ОТПРАВКУ (30 секунд)**

```bash
./📧_ОТПРАВИТЬ_ПРЯМО_СЕЙЧАС.sh
```

**Подтверди:** `y`

---

## ✅ **РЕЗУЛЬТАТ:**

```
═══════════════════════════════════════════════════════════════
📧 ОТПРАВКА EMAIL ВСЕМ СТУДЕНТАМ ЧЕРЕЗ RESEND
═══════════════════════════════════════════════════════════════

🔑 Токен админа: eyJhbGciOiJIUzI1NiIs...
📨 Тема: ✅ Технические работы завершены
📤 API: https://api.onai.academy

▶️  Отправить email ВСЕМ студентам? (y/n): y

📧 Отправляю через Resend...

═══════════════════════════════════════════════════════════════
📊 РЕЗУЛЬТАТ:
═══════════════════════════════════════════════════════════════
HTTP Code: 200

{
  "success": true,
  "emailsSent": 62,
  "totalRecipients": 62,
  "channel": "email"
}

✅ УСПЕХ! Email отправлены через Resend!

📧 Отправлено: 62
📧 Всего студентов: 62

🎉 Все студенты получат письмо в течение нескольких минут!
═══════════════════════════════════════════════════════════════
```

---

## 📧 **ЧТО ОТПРАВИТСЯ:**

### **Тема:**
```
✅ Технические работы завершены - Платформа работает стабильно
```

### **Текст:**
- 🔧 Что произошло (технические сложности)
- ✅ Что сделано (всё исправлено)
- 🎓 Что дальше (можно учиться)

### **Формат:**
- ✅ HTML (красивый дизайн)
- ✅ Text (для старых почтовиков)
- ✅ Кнопка "Продолжить обучение"

### **Кому:**
- 62 реальных студента
- Исключены: админы, менеджеры, тестовые

---

## ❌ **ЕСЛИ ОШИБКА:**

### **"Токен не указан"**
```bash
✅ Решение: Вставь токен на строке 15
```

### **"401 Unauthorized"**
```bash
✅ Решение: 
1. Токен устарел или неверный
2. Получи новый токен (см. Шаг 1)
3. Вставь в скрипт
4. Запусти снова
```

### **"403 Forbidden"**
```bash
✅ Решение: 
1. Нет прав админа
2. Залогинься как админ на https://onai.academy/integrator/admin
3. Проверь роль в БД (должна быть 'admin')
```

### **"500 Internal Server Error"**
```bash
✅ Решение: 
1. Проверь логи backend:
   ssh root@onai.academy
   pm2 logs tripwire-backend --lines 50

2. Проверь Resend API key в .env
3. Перезапусти backend: pm2 restart tripwire-backend
```

### **"jq: command not found"**
```bash
# Установи jq (опционально, для красивого вывода):
brew install jq  # macOS
sudo apt install jq  # Linux

# Или запусти без jq - всё равно будет работать
```

---

## 🎯 **АЛЬТЕРНАТИВНЫЙ СПОСОБ (БЕЗ СКРИПТА):**

### **Через curl вручную:**
```bash
ADMIN_TOKEN="твой_токен_здесь"

curl -X POST "https://api.onai.academy/api/tripwire/admin/mass-broadcast" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -d '{
    "channel": "email",
    "subject": "✅ Технические работы завершены",
    "message": "Привет!\n\nВсе технические проблемы решены...",
    "testMode": false
  }'
```

---

## 📊 **ПРОВЕРКА ОТПРАВКИ:**

### **1. Resend Dashboard:**
1. Зайди на https://resend.com/emails
2. Увидишь 62 отправленных письма
3. Проверь статус: Delivered, Opened, Clicked

### **2. Проверь свой email:**
1. Добавь свой email в список студентов (временно)
2. Отправь письмо
3. Проверь что пришло и выглядит хорошо
4. Удали свой email из студентов

### **3. Спроси студентов:**
1. Выбери 2-3 студентов
2. Напиши в Telegram: "Пришло письмо?"
3. Если да - всё ок!

---

## 🎉 **ГОТОВО!**

**Скрипт готов к запуску:**
```bash
./📧_ОТПРАВИТЬ_ПРЯМО_СЕЙЧАС.sh
```

**Время выполнения:** ~10 секунд  
**Студентов:** 62  
**Результат:** Все получат email! ✅

---

**Создано:** 19.12.2024  
**Статус:** ✅ Готово к использованию  
**Backend:** Production (api.onai.academy)  
**Email Service:** Resend
