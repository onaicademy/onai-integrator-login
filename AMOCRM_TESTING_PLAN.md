# üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ amoCRM

## üéØ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º

‚úÖ **–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ email —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**  
‚úÖ **–°–¥–µ–ª–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞**  
‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**  
‚úÖ **Refresh Token –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**

---

## üìã –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### –ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ?

```
1. –ó–∞—è–≤–∫–∞ –Ω–∞ –ª–µ–Ω–¥–∏–Ω–≥–µ
   ‚Üì
   Email: student@example.com
   ‚Üì
   amoCRM —Å–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ç–∞–∫—Ç + —Å–¥–µ–ª–∫—É –≤ –≤–æ—Ä–æ–Ω–∫–µ "onAI Academy"

2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
   ‚Üì
   Email: student@example.com (–¢–û–¢ –ñ–ï!)
   ‚Üì
   –°–æ–∑–¥–∞—ë—Ç—Å—è –∞–∫–∫–∞—É–Ω—Ç –≤ Supabase

3. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —É—Ä–æ–∫–∞
   ‚Üì
   Backend –ø–æ–ª—É—á–∞–µ—Ç email –∏–∑ –ë–î: student@example.com
   ‚Üì
   amoCRM API: –ø–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –ø–æ email
   ‚Üì
   –ù–∞—Ö–æ–¥–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç ‚Üí –ù–∞—Ö–æ–¥–∏—Ç —Å–¥–µ–ª–∫—É –≤ –≤–æ—Ä–æ–Ω–∫–µ
   ‚Üì
   –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Å–¥–µ–ª–∫—É –Ω–∞ –Ω—É–∂–Ω—ã–π —ç—Ç–∞–ø
```

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** Email –¥–æ–ª–∂–µ–Ω –¢–û–ß–ù–û —Å–æ–≤–ø–∞–¥–∞—Ç—å –≤ amoCRM –∏ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ!

---

## üîß –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### –ê. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
npx ts-node backend/src/scripts/test-amocrm.ts
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ AMOCRM_SUBDOMAIN: yoursubdomain
‚úÖ AMOCRM_ACCESS_TOKEN: ***—Å–∫—Ä—ã—Ç–æ***
‚úÖ AMOCRM_PIPELINE_ID: 10350882
‚úÖ AMOCRM_STAGE_LESSON_1: 12345678
‚úÖ AMOCRM_STAGE_LESSON_2: 23456789
‚úÖ AMOCRM_STAGE_LESSON_3: 34567890

‚úÖ AMOCRM_CLIENT_ID: ***—Å–∫—Ä—ã—Ç–æ***
‚úÖ AMOCRM_CLIENT_SECRET: ***—Å–∫—Ä—ã—Ç–æ***
‚úÖ AMOCRM_REFRESH_TOKEN: ***—Å–∫—Ä—ã—Ç–æ***

‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ amoCRM —É—Å–ø–µ—à–Ω–æ!
üìä –í–æ—Ä–æ–Ω–∫–∞: onAI Academy (ID: 10350882)
   –≠—Ç–∞–ø—ã:
   - –ü–†–û–®–ï–õ –ü–ï–†–í–´–ô –£–†–û–ö (ID: 12345678)
   - –ü–†–û–®–ï–õ –í–¢–û–†–û–ô –£–†–û–ö (ID: 23456789)
   - –ü–†–û–®–ï–õ 3–ô –£–†–û–ö (ID: 34567890)
```

### –ë. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∞–ø–ø–∏–Ω–≥ —É—Ä–æ–∫–æ–≤

–û—Ç–∫—Ä–æ–π—Ç–µ `backend/src/routes/tripwire-lessons.ts` –∏ –Ω–∞–π–¥–∏—Ç–µ –º–∞–ø–ø–∏–Ω–≥ (—Å—Ç—Ä–æ–∫–∞ ~340):

```typescript
// –ú–∞–ø–ø–∏–Ω–≥ lesson_id –Ω–∞ –Ω–æ–º–µ—Ä —É—Ä–æ–∫–∞ –¥–ª—è Tripwire –≤–æ—Ä–æ–Ω–∫–∏
const lessonNumberMap: Record<number, number> = {
  67: 1,  // Module 16 ‚Üí –£—Ä–æ–∫ 1
  68: 2,  // Module 17 ‚Üí –£—Ä–æ–∫ 2
  69: 3,  // Module 18 ‚Üí –£—Ä–æ–∫ 3
};
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ë–î:**
```sql
SELECT id, title, module_id FROM lessons WHERE id IN (67, 68, 69);
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
```
id | title              | module_id
67 | Tripwire –£—Ä–æ–∫ 1   | 16
68 | Tripwire –£—Ä–æ–∫ 2   | 17
69 | Tripwire –£—Ä–æ–∫ 3   | 18
```

---

## üßπ –®–∞–≥ 2: –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ê. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```sql
-- –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Tripwire –∏ –∏—Ö –ø—Ä–æ–≥—Ä–µ—Å—Å!
-- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö!

-- 1. –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
DELETE FROM tripwire_progress WHERE tripwire_user_id IN (
  SELECT id FROM tripwire_users
);

-- 2. –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏
DELETE FROM tripwire_user_profile WHERE user_id IN (
  SELECT user_id FROM tripwire_users
);

-- 3. –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å–∏ tripwire_users
DELETE FROM tripwire_users;

-- 4. –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ auth.users (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
-- –ò–ª–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É Supabase
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ):**
- –ó–∞–π–¥–∏—Ç–µ –≤ Supabase Dashboard ‚Üí Authentication ‚Üí Users
- –£–¥–∞–ª–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤—Ä—É—á–Ω—É—é

### –ë. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—á–∏—Å—Ç–∫—É

```sql
-- –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 0
SELECT COUNT(*) FROM tripwire_users;
SELECT COUNT(*) FROM tripwire_progress;
```

---

## üß™ –®–∞–≥ 3: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç-–∫–µ–π—Å 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –Ω—É–ª—è

#### 1Ô∏è‚É£ –°–æ–∑–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É –≤ amoCRM

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ –ª–µ–Ω–¥–∏–Ω–≥**
- –û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ –ª–µ–Ω–¥–∏–Ω–≥–µ —Å email: `test-student@example.com`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ amoCRM —Å–æ–∑–¥–∞–ª—Å—è –∫–æ–Ω—Ç–∞–∫—Ç –∏ —Å–¥–µ–ª–∫–∞

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –í—Ä—É—á–Ω—É—é –≤ amoCRM (–¥–ª—è —Ç–µ—Å—Ç–∞)**
1. –ó–∞–π–¥–∏—Ç–µ –≤ amoCRM
2. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç:
   - –ò–º—è: Test Student
   - Email: `test-student@example.com`
3. –°–æ–∑–¥–∞–π—Ç–µ —Å–¥–µ–ª–∫—É:
   - –í–æ—Ä–æ–Ω–∫–∞: "onAI Academy"
   - –≠—Ç–∞–ø: –ù–∞—á–∞–ª—å–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞")
   - –ü—Ä–∏–≤—è–∂–∏—Ç–µ –∫ –∫–æ–Ω—Ç–∞–∫—Ç—É
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID —Å–¥–µ–ª–∫–∏ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)

#### 2Ô∏è‚É£ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ `https://onai.academy/tripwire/login`
2. –ù–∞–∂–º–∏—Ç–µ "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–¢–û–¢ –ñ–ï EMAIL**: `test-student@example.com`
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ:
   - –ò–º—è: Test
   - –§–∞–º–∏–ª–∏—è: Student
   - Email: `test-student@example.com`
   - –ü–∞—Ä–æ–ª—å: –ª—é–±–æ–π
5. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å

#### 3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–ª—Å—è
SELECT 
  tu.id,
  u.email,
  tup.full_name
FROM tripwire_users tu
JOIN users u ON u.id = tu.user_id
JOIN tripwire_user_profile tup ON tup.user_id = tu.user_id
WHERE u.email = 'test-student@example.com';
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
```
id                  | email                      | full_name
uuid-–∑–¥–µ—Å—å         | test-student@example.com  | Test Student
```

#### 4Ô∏è‚É£ –ó–∞–≤–µ—Ä—à–∏—Ç–µ –£—Ä–æ–∫ 1 (lesson_id: 67)

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –ø–æ–¥ `test-student@example.com`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ú–æ–¥—É–ª—å 16 (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω)
3. –û—Ç–∫—Ä–æ–π—Ç–µ –£—Ä–æ–∫ 1 (lesson_id: 67)
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–∏–¥–µ–æ (–∏–ª–∏ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–æ 80%+)
5. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫"**

#### 5Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞

```bash
pm2 logs backend --lines 50 | grep -E "AMOCRM|AmoCRM"
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
[AMOCRM] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ amoCRM –¥–ª—è test-student@example.com, —É—Ä–æ–∫ 1
üéØ [AmoCRM] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å test-student@example.com –∑–∞–≤–µ—Ä—à–∏–ª —É—Ä–æ–∫ 1. –û–±–Ω–æ–≤–ª—è–µ–º CRM...
[AmoCRM] –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –ø–æ email: test-student@example.com
[AmoCRM] –ù–∞–π–¥–µ–Ω –∫–æ–Ω—Ç–∞–∫—Ç: ID 123456, –∏–º—è "Test Student"
[AmoCRM] –ù–∞–π–¥–µ–Ω–∞ —Å–¥–µ–ª–∫–∞: ID 789012, —Å—Ç–∞—Ç—É—Å 65432100
[AmoCRM] –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Å–¥–µ–ª–∫—É 789012 –Ω–∞ —ç—Ç–∞–ø 12345678
‚úÖ [AmoCRM] –°–¥–µ–ª–∫–∞ 789012 —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –Ω–∞ —ç—Ç–∞–ø 12345678
```

#### 6Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ amoCRM

1. –û—Ç–∫—Ä–æ–π—Ç–µ amoCRM
2. –ù–∞–π–¥–∏—Ç–µ —Å–¥–µ–ª–∫—É –¥–ª—è `test-student@example.com`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:** –°–¥–µ–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ **"–ü–†–û–®–ï–õ –ü–ï–†–í–´–ô –£–†–û–ö"**

‚úÖ **–ï—Å–ª–∏ —Å–¥–µ–ª–∫–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∞—Å—å ‚Üí –®–ê–ì 1 –†–ê–ë–û–¢–ê–ï–¢!**

---

### –¢–µ—Å—Ç-–∫–µ–π—Å 2: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –£—Ä–æ–∫–∞ 2

#### 1Ô∏è‚É£ –ó–∞–≤–µ—Ä—à–∏—Ç–µ –£—Ä–æ–∫ 2 (lesson_id: 68)

1. –ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –æ—Ç–∫—Ä–æ–π—Ç–µ –ú–æ–¥—É–ª—å 17 (–¥–æ–ª–∂–µ–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ú–æ–¥—É–ª—è 16)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –£—Ä–æ–∫ 2 (lesson_id: 68)
3. –ó–∞–≤–µ—Ä—à–∏—Ç–µ —É—Ä–æ–∫

#### 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

```bash
pm2 logs backend --lines 50 | grep "—É—Ä–æ–∫ 2"
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
üéØ [AmoCRM] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å test-student@example.com –∑–∞–≤–µ—Ä—à–∏–ª —É—Ä–æ–∫ 2
‚úÖ [AmoCRM] –°–¥–µ–ª–∫–∞ 789012 —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –Ω–∞ —ç—Ç–∞–ø 23456789
```

#### 3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ amoCRM

–°–¥–µ–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –Ω–∞ —ç—Ç–∞–ø **"–ü–†–û–®–ï–õ –í–¢–û–†–û–ô –£–†–û–ö"**

‚úÖ **–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∞—Å—å ‚Üí –®–ê–ì 2 –†–ê–ë–û–¢–ê–ï–¢!**

---

### –¢–µ—Å—Ç-–∫–µ–π—Å 3: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –£—Ä–æ–∫–∞ 3

#### 1Ô∏è‚É£ –ó–∞–≤–µ—Ä—à–∏—Ç–µ –£—Ä–æ–∫ 3 (lesson_id: 69)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ú–æ–¥—É–ª—å 18
2. –û—Ç–∫—Ä–æ–π—Ç–µ –£—Ä–æ–∫ 3 (lesson_id: 69)
3. –ó–∞–≤–µ—Ä—à–∏—Ç–µ —É—Ä–æ–∫

#### 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

```bash
pm2 logs backend --lines 50 | grep "—É—Ä–æ–∫ 3"
```

#### 3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ amoCRM

–°–¥–µ–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –Ω–∞ —ç—Ç–∞–ø **"–ü–†–û–®–ï–õ 3–ô –£–†–û–ö"**

‚úÖ **–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∞—Å—å ‚Üí –®–ê–ì 3 –†–ê–ë–û–¢–ê–ï–¢!**

---

## üîÑ –®–∞–≥ 4: –¢–µ—Å—Ç –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤

### –°–∏–º—É–ª—è—Ü–∏—è –∏—Å—Ç—ë–∫—à–µ–≥–æ —Ç–æ–∫–µ–Ω–∞

#### 1Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω

–û—Ç–∫—Ä–æ–π—Ç–µ `backend/.env` –∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ:
```bash
AMOCRM_ACCESS_TOKEN=invalid_token_for_testing_12345
```

#### 2Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥

```bash
pm2 restart backend
```

#### 3Ô∏è‚É£ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫

–ó–∞–≤–µ—Ä—à–∏—Ç–µ –ª—é–±–æ–π —É—Ä–æ–∫ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ

#### 4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

```bash
pm2 logs backend --lines 100 | grep -E "–¢–æ–∫–µ–Ω|refresh"
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
üîÑ [AmoCRM] –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —á–µ—Ä–µ–∑ Refresh Token...
‚úÖ [AmoCRM] –¢–æ–∫–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!
   - Access Token: eyJ0eXAiOiJKV1QiLCJh...
   - Refresh Token: def50200a1b2c3d4e5...
üíæ [AmoCRM] –¢–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ –ø–∞–º—è—Ç–∏
‚úÖ [AmoCRM] –°–¥–µ–ª–∫–∞ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞
```

‚úÖ **–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –æ–±–Ω–æ–≤–∏–ª—Å—è –∏ –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è ‚Üí REFRESH TOKEN –†–ê–ë–û–¢–ê–ï–¢!**

#### 5Ô∏è‚É£ –í–µ—Ä–Ω–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω

–û—Ç–∫—Ä–æ–π—Ç–µ `backend/.env` –∏ –≤–µ—Ä–Ω–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω

---

## üö¶ –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö

### –°–æ–∑–¥–∞–π—Ç–µ 3 —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1: `student1@test.com`
1. –°–æ–∑–¥–∞–π—Ç–µ —Å–¥–µ–ª–∫—É –≤ amoCRM
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
3. –ó–∞–≤–µ—Ä—à–∏—Ç–µ –£—Ä–æ–∫ 1
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 2: `student2@test.com`
1. –°–æ–∑–¥–∞–π—Ç–µ —Å–¥–µ–ª–∫—É –≤ amoCRM
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
3. –ó–∞–≤–µ—Ä—à–∏—Ç–µ –£—Ä–æ–∫–∏ 1 –∏ 2
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –Ω–∞ –æ–±–∞ —ç—Ç–∞–ø–∞

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 3: `student3@test.com`
1. –°–æ–∑–¥–∞–π—Ç–µ —Å–¥–µ–ª–∫—É –≤ amoCRM
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
3. –ó–∞–≤–µ—Ä—à–∏—Ç–µ –≤—Å–µ 3 —É—Ä–æ–∫–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –¥–ª—è –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ Node.js –∫–æ–Ω—Å–æ–ª—å
node

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
const { adminSupabase } = require('./backend/src/config/supabase');
const amoCrm = require('./backend/src/services/amoCrmService');

// –ü–æ–ª—É—á–∏—Ç–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Tripwire
const { data: users } = await adminSupabase
  .from('users')
  .select('email')
  .in('id', 
    (await adminSupabase.from('tripwire_users').select('user_id')).data.map(u => u.user_id)
  );

// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–∂–¥–æ–≥–æ
for (const user of users) {
  console.log(`\n–ü—Ä–æ–≤–µ—Ä–∫–∞: ${user.email}`);
  const leadId = await amoCrm.findLeadIdByEmail(user.email);
  console.log(leadId ? `‚úÖ –ù–∞–π–¥–µ–Ω–∞ —Å–¥–µ–ª–∫–∞: ${leadId}` : `‚ùå –°–¥–µ–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
}
```

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –°–¥–µ–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

**–õ–æ–≥–∏:**
```
[AmoCRM] –ö–æ–Ω—Ç–∞–∫—Ç —Å email student@example.com –Ω–µ –Ω–∞–π–¥–µ–Ω
```

**–ü—Ä–∏—á–∏–Ω—ã:**
1. Email –≤ amoCRM ‚â† email –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ (–æ–ø–µ—á–∞—Ç–∫–∞, —Ä–µ–≥–∏—Å—Ç—Ä)
2. –ö–æ–Ω—Ç–∞–∫—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω –≤ amoCRM
3. Email –≤ amoCRM –≤ –¥—Ä—É–≥–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –≤ amoCRM (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –≤ –ë–î:
   ```sql
   SELECT email FROM users WHERE email ILIKE '%student%';
   ```
3. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º email

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –°–¥–µ–ª–∫–∞ –Ω–µ –≤ –Ω—É–∂–Ω–æ–π –≤–æ—Ä–æ–Ω–∫–µ

**–õ–æ–≥–∏:**
```
[AmoCRM] –°–¥–µ–ª–∫–∏ –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ 123456 –≤ –≤–æ—Ä–æ–Ω–∫–µ 10350882 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –≤ –¥—Ä—É–≥–æ–π –≤–æ—Ä–æ–Ω–∫–µ
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `AMOCRM_PIPELINE_ID`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID –≤–æ—Ä–æ–Ω–∫–∏ –≤ amoCRM
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–¥–µ–ª–∫–∞ –≤ –≤–æ—Ä–æ–Ω–∫–µ "onAI Academy"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `AMOCRM_PIPELINE_ID` –≤ `.env`

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫, –Ω–æ –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è

**–õ–æ–≥–∏:**
```
‚ùå [AmoCRM] –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
üí° Refresh Token –∏—Å—Ç—ë–∫ –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- Refresh Token –∏—Å—Ç—ë–∫ (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è 3 –º–µ—Å—è—Ü–∞)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –≤ amoCRM
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ OAuth credentials

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ amoCRM
2. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ OAuth Flow –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
3. –û–±–Ω–æ–≤–∏—Ç–µ –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –≤ `.env`

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –£—Ä–æ–∫ –Ω–µ —Ç–æ—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ

**–õ–æ–≥–∏:**
```
[AMOCRM] Lesson 70 –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ Tripwire –≤–æ—Ä–æ–Ω–∫–µ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º amoCRM
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –£—Ä–æ–∫ –Ω–µ –∏–∑ Tripwire –º–æ–¥—É–ª–µ–π (16, 17, 18)
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ lesson_id

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É—Ä–æ–∫ –∏–∑ –º–æ–¥—É–ª–µ–π 16, 17 –∏–ª–∏ 18
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∞–ø–ø–∏–Ω–≥ –≤ `tripwire-lessons.ts`:
   ```typescript
   const lessonNumberMap: Record<number, number> = {
     67: 1,  // –í–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ ID
     68: 2,
     69: 3,
   };
   ```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- [ ] –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env` –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –¢–µ—Å—Ç `test-amocrm.ts` ‚Üí —É—Å–ø–µ—à–Ω–æ
- [ ] OAuth credentials –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] ID —ç—Ç–∞–ø–æ–≤ –∑–∞–º–µ–Ω–µ–Ω—ã —Å –∑–∞–≥–ª—É—à–µ–∫ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ

### –ú–∞–ø–ø–∏–Ω–≥
- [ ] Lesson IDs —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–º (67, 68, 69)
- [ ] Module IDs —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–º (16, 17, 18)
- [ ] Stage IDs —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–º —ç—Ç–∞–ø–∞–º –≤ amoCRM

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –¢–µ—Å—Ç-–∫–µ–π—Å 1: –£—Ä–æ–∫ 1 ‚Üí —ç—Ç–∞–ø –æ–±–Ω–æ–≤–∏–ª—Å—è ‚úÖ
- [ ] –¢–µ—Å—Ç-–∫–µ–π—Å 2: –£—Ä–æ–∫ 2 ‚Üí —ç—Ç–∞–ø –æ–±–Ω–æ–≤–∏–ª—Å—è ‚úÖ
- [ ] –¢–µ—Å—Ç-–∫–µ–π—Å 3: –£—Ä–æ–∫ 3 ‚Üí —ç—Ç–∞–ø –æ–±–Ω–æ–≤–∏–ª—Å—è ‚úÖ
- [ ] –¢–µ—Å—Ç Refresh Token ‚Üí —Ç–æ–∫–µ–Ω –æ–±–Ω–æ–≤–∏–ª—Å—è ‚úÖ
- [ ] –¢–µ—Å—Ç 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û—à–∏–±–∫–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç UX —Å—Ç—É–¥–µ–Ω—Ç–∞
- [ ] Refresh Token –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ë–î
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ç–æ–∫–µ–Ω–æ–≤
- [ ] –°–æ–∑–¥–∞–Ω –∞–ª–µ—Ä—Ç –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å amoCRM

---

## üéâ –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# 1. –¢–µ—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
npx ts-node backend/src/scripts/test-amocrm.ts

# 2. –†—É—á–Ω–æ–π refresh —Ç–æ–∫–µ–Ω–∞
node -e "require('./backend/src/services/amoCrmService').manualRefreshToken()"

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
node -e "
const { adminSupabase } = require('./backend/src/config/supabase');
const amoCrm = require('./backend/src/services/amoCrmService');

(async () => {
  const { data: users } = await adminSupabase
    .from('users')
    .select('email')
    .in('id', 
      (await adminSupabase.from('tripwire_users').select('user_id')).data.map(u => u.user_id)
    );
  
  for (const user of users) {
    const leadId = await amoCrm.findLeadIdByEmail(user.email);
    console.log(\`\${user.email}: \${leadId ? '‚úÖ' : '‚ùå'}\`);
  }
})();
"

# 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
pm2 logs backend --lines 200 | grep -E "AMOCRM|AmoCRM"
```

---

## üìû –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:** `npx ts-node backend/src/scripts/test-amocrm.ts`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:** `pm2 logs backend | grep AmoCRM`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ email —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ:** amoCRM vs –ë–î
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID –≤–æ—Ä–æ–Ω–∫–∏ –∏ —ç—Ç–∞–ø–æ–≤**
5. **–°–º. —Ä–∞–∑–¥–µ–ª "–ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã"** –≤—ã—à–µ

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-10  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–ù–∞—á–Ω–∏—Ç–µ —Å –¢–µ—Å—Ç-–∫–µ–π—Å–∞ 1 –∏ –¥–≤–∏–≥–∞–π—Ç–µ—Å—å –ø–æ –ø–æ—Ä—è–¥–∫—É!** üöÄ




