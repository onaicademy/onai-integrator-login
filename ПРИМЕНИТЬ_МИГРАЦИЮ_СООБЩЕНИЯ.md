# üì® –ü–†–ò–ú–ï–ù–ò–¢–¨ –ú–ò–ì–†–ê–¶–ò–Æ –î–õ–Ø –°–û–û–ë–©–ï–ù–ò–ô

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —á–∞—Ç–æ–≤ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≥–æ—Ç–æ–≤–∞!**

---

## üìã –§–ê–ô–õ –ú–ò–ì–†–ê–¶–ò–ò:

```
supabase/migrations/20250110_student_messaging.sql
```

**–°–æ–∑–¥–∞—ë—Ç:**
- ‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã (1-–Ω–∞-1)
- ‚úÖ –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è (—Ç–µ–∫—Å—Ç + –≥–æ–ª–æ—Å–æ–≤—ã–µ + —Ñ–∞–π–ª—ã)
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üöÄ –ö–ê–ö –ü–†–ò–ú–ï–ù–ò–¢–¨:

### –°–ü–û–°–û–ë 1: –ß–µ—Ä–µ–∑ Dashboard (–†–µ–∫–æ–º–µ–Ω–¥—É—é)

```
1. –û—Ç–∫—Ä–æ–π: https://supabase.com/dashboard/project/capdjvokjdivxjfddmx
2. SQL Editor ‚Üí New Query
3. –°–∫–æ–ø–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
   supabase/migrations/20250110_student_messaging.sql
4. –í—Å—Ç–∞–≤—å –≤ SQL Editor
5. –ù–∞–∂–º–∏ "Run"
6. –ì–û–¢–û–í–û! ‚úÖ
```

### –°–ü–û–°–û–ë 2: –ß–µ—Ä–µ–∑ CLI

```bash
# –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Supabase CLI
supabase db push
```

---

## üìä –ß–¢–û –ë–£–î–ï–¢ –°–û–ó–î–ê–ù–û:

### –¢–∞–±–ª–∏—Ü—ã:

**1. student_private_chats**
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã –º–µ–∂–¥—É —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏
- –•—Ä–∞–Ω–∏—Ç user1_id, user2_id
- –°—á—ë—Ç—á–∏–∫–∏ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö

**2. student_private_messages**
- –°–æ–æ–±—â–µ–Ω–∏—è –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–∞—Ö
- –¢–∏–ø—ã: text, voice, file
- voice_url –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö
- file_url –¥–ª—è —Ñ–∞–π–ª–æ–≤

**3. student_group_chats**
- –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã
- –ù–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, –∞–≤–∞—Ç–∞—Ä

**4. student_group_members**
- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤
- –†–æ–ª–∏ (owner, admin, member)

**5. student_group_messages**
- –°–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–∞—Ö
- –í—Å–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**6. student_group_message_reads**
- –°—Ç–∞—Ç—É—Å—ã –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ—Å—Ç–∏ –≤ –≥—Ä—É–ø–ø–∞—Ö

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:

**RLS (Row Level Security) –ø–æ–ª–∏—Ç–∏–∫–∏:**
- ‚úÖ –°—Ç—É–¥–µ–Ω—Ç—ã –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —á–∞—Ç—ã
- ‚úÖ –ú–æ–≥—É—Ç –ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Å–≤–æ–∏ —á–∞—Ç—ã
- ‚úÖ –ù–µ–ª—å–∑—è —á–∏—Ç–∞—Ç—å —á—É–∂–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≤—Å—ë (–¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏)

---

## üíæ –ì–û–õ–û–°–û–í–´–ï –°–û–û–ë–©–ï–ù–ò–Ø:

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è:

```
1. –ó–∞–ø–∏—Å—ã–≤–∞–µ—à—å –≥–æ–ª–æ—Å–æ–≤–æ–µ
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ Supabase Storage (bucket: voice-messages)
3. –ü–æ–ª—É—á–∞–µ–º URL
4. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ student_private_messages:
   - type: 'voice'
   - voice_url: 'https://...'
   - duration: 15 (—Å–µ–∫—É–Ω–¥—ã)
5. –î—Ä—É–≥–æ–π —Å—Ç—É–¥–µ–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–æ—Å–ª—É—à–∞—Ç—å
```

---

## ‚úÖ –ü–û–°–õ–ï –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø:

–ß–∞—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î:
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- ‚úÖ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

**–ü–†–ò–ú–ï–ù–ò –ú–ò–ì–†–ê–¶–ò–Æ –ò –ß–ê–¢–´ –ó–ê–†–ê–ë–û–¢–ê–Æ–¢!** üöÄ

