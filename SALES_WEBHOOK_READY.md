# üéâ SALES WEBHOOK –ì–û–¢–û–í –ö –ó–ê–í–¢–†–ê!

## ‚úÖ –ß–¢–û –£–ñ–ï –°–î–ï–õ–ê–ù–û:

### 1Ô∏è‚É£ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `sales_notifications`**
```sql
‚úÖ –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–¥–∞–∂
‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∞–º
‚úÖ UTM –º–µ—Ç–∫–∏
‚úÖ –°—Ç–∞—Ç—É—Å—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
```

**SQL —Ñ–∞–π–ª:** `backend/database/sales_notifications.sql`

---

### 2Ô∏è‚É£ **Backend Webhook Endpoints**

#### üéØ –û—Å–Ω–æ–≤–Ω–æ–π webhook:
```
POST /api/amocrm/sales-webhook
```
- –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ–± –æ–ø–ª–∞—Ç–µ –∏–∑ AmoCRM
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∞ –ø–æ UTM
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î

#### üìä –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂:
```
GET /api/amocrm/sales-history?targetologist=Kenesary&start=2024-12-01&end=2024-12-31
```
- –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥—É
- –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–∞–º
- –°—É–º–º–∞—Ä–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

#### üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º:
```
GET /api/amocrm/sales-stats?start=2024-12-01&end=2024-12-31
```
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∞–º
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–∂
- –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞
- –°—Ä–µ–¥–Ω–∏–π —á–µ–∫

#### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```
POST /api/amocrm/test-sale-notification
```
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ë–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î

---

### 3Ô∏è‚É£ **Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**

–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
```
üéâ –ù–û–í–ê–Ø –ü–†–û–î–ê–ñ–ê!

üëë –¢–∞—Ä–≥–µ—Ç–æ–ª–æ–≥: Kenesary
üë§ –ö–ª–∏–µ–Ω—Ç: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
üí∞ –°—É–º–º–∞: 5 000 ‚Ç∏
üì¶ –ü—Ä–æ–¥—É–∫—Ç: Tripwire
üè∑Ô∏è –ö–∞–º–ø–∞–Ω–∏—è: tripwire_17.12

Kenesary, –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –ü–û –í–ê–ú –°–î–ï–õ–ê–õ–ò –ü–†–û–î–ê–ñ–£! üî•
```

**–û—Ç–ø—Ä–∞–≤–∫–∞:** –í–æ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ Telegram –≥—Ä—É–ø–ø—ã (–≥–¥–µ –±–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∫–æ–¥–æ–º 2134)

---

### 4Ô∏è‚É£ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∞**

–ú–∞–ø–ø–∏–Ω–≥ –ø–æ UTM –∫–∞–º–ø–∞–Ω–∏—è–º:

| –¢–∞—Ä–≥–µ—Ç–æ–ª–æ–≥ | Patterns | Emoji |
|------------|----------|-------|
| **Kenesary** | tripwire, nutcab | üëë |
| **Arystan** | arystan | ü¶Å |
| **Muha** | on ai, onai, –∑–∞–ø—É—Å–∫ | üöÄ |
| **Traf4** | alex, traf4, proftest | ‚ö° |

**–ü—Ä–∏–º–µ—Ä—ã:**
- `utm_campaign=tripwire_17.12` ‚Üí **Kenesary** üëë
- `utm_campaign=arystan_16.12` ‚Üí **Arystan** ü¶Å
- `utm_source=facebook` + `utm_campaign=–ó–∞–ø—É—Å–∫ –Ω–∞ On AI` ‚Üí **Muha** üöÄ
- `utm_campaign=Proftest/alex` ‚Üí **Traf4** ‚ö°

---

## üöÄ –ß–¢–û –ù–£–ñ–ù–û –ó–ê–í–¢–†–ê:

### üìã SETUP CHECKLIST:

#### 1. **–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ Supabase Tripwire**
- [ ] –ó–∞–π—Ç–∏ –≤ https://supabase.com/dashboard/project/pjmvxecykysfrzppdcto
- [ ] SQL Editor ‚Üí New Query
- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å `backend/database/sales_notifications.sql`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞

#### 2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Webhook –≤ AmoCRM**
- [ ] –ó–∞–π—Ç–∏ –≤ AmoCRM: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí API ‚Üí Webhooks
- [ ] –°–æ–∑–¥–∞—Ç—å webhook –Ω–∞ URL: `https://api.onai.academy/api/amocrm/sales-webhook`
- [ ] –°–æ–±—ã—Ç–∏–µ: "–°–¥–µ–ª–∫–∞ - —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω" –Ω–∞ "–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ"
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –ø–æ–ª–µ–π:
  - `lead_id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  - `lead_name`
  - `contact_name`
  - `contact_phone`
  - `sale_amount` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  - `product_name`
  - **UTM –º–µ—Ç–∫–∏ –∏–∑ custom fields:**
    - `utm_source`
    - `utm_medium`
    - `utm_campaign`
    - `utm_content`
    - `utm_term`

#### 3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

**A) –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–±–µ–∑ –ë–î):**
```bash
curl -X POST https://api.onai.academy/api/amocrm/test-sale-notification \
  -H "Content-Type: application/json" \
  -d '{
    "targetologist": "Kenesary",
    "contact_name": "–ò–≤–∞–Ω –¢–µ—Å—Ç–æ–≤—ã–π",
    "sale_amount": 5000,
    "product_name": "Tripwire"
  }'
```
‚úÖ –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram!

**B) –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î):**
```bash
curl -X POST https://api.onai.academy/api/amocrm/sales-webhook \
  -H "Content-Type: application/json" \
  -d '{
    "lead_id": 99999999,
    "lead_name": "–¢–ï–°–¢ - –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "contact_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "sale_amount": 5000,
    "product_name": "Tripwire",
    "utm_campaign": "tripwire_17.12"
  }'
```
‚úÖ –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ë–î!

**C) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Supabase:**
```sql
SELECT * FROM sales_notifications ORDER BY created_at DESC LIMIT 10;
```

#### 4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–µ—Ä–µ–∑ API:**
```bash
curl "https://api.onai.academy/api/amocrm/sales-history?targetologist=Kenesary&start=2024-12-01&end=2024-12-31"
```

---

## üìä –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢:

```
AmoCRM (–û–ø–ª–∞—Ç–∞) 
    ‚Üì
Webhook ‚Üí https://api.onai.academy/api/amocrm/sales-webhook
    ‚Üì
1. –ò–∑–≤–ª–µ—á—å UTM –º–µ—Ç–∫–∏
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∞ (Kenesary/Arystan/Muha/Traf4)
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î (sales_notifications)
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram:
   "üëë Kenesary, –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –ü–û –í–ê–ú –°–î–ï–õ–ê–õ–ò –ü–†–û–î–ê–ñ–£! üî•"
```

---

## üéØ –ü–†–ò–ú–ï–†–´ –£–í–ï–î–û–ú–õ–ï–ù–ò–ô:

### Kenesary (üëë):
```
üéâ –ù–û–í–ê–Ø –ü–†–û–î–ê–ñ–ê!

üëë –¢–∞—Ä–≥–µ—Ç–æ–ª–æ–≥: Kenesary
üë§ –ö–ª–∏–µ–Ω—Ç: –ê—Å—Ö–∞—Ç –ù—É—Ä–ª–∞–Ω–æ–≤
üí∞ –°—É–º–º–∞: 5 000 ‚Ç∏
üì¶ –ü—Ä–æ–¥—É–∫—Ç: Tripwire
üè∑Ô∏è –ö–∞–º–ø–∞–Ω–∏—è: tripwire_17.12

Kenesary, –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –ü–û –í–ê–ú –°–î–ï–õ–ê–õ–ò –ü–†–û–î–ê–ñ–£! üî•
```

### Arystan (ü¶Å):
```
üéâ –ù–û–í–ê–Ø –ü–†–û–î–ê–ñ–ê!

ü¶Å –¢–∞—Ä–≥–µ—Ç–æ–ª–æ–≥: Arystan
üë§ –ö–ª–∏–µ–Ω—Ç: –î–∏–∞–Ω–∞ –ö–∞—Å—ã–º–æ–≤–∞
üí∞ –°—É–º–º–∞: 5 000 ‚Ç∏
üì¶ –ü—Ä–æ–¥—É–∫—Ç: Tripwire
üè∑Ô∏è –ö–∞–º–ø–∞–Ω–∏—è: arystan_16.12

Arystan, –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –ü–û –í–ê–ú –°–î–ï–õ–ê–õ–ò –ü–†–û–î–ê–ñ–£! üî•
```

### Muha (üöÄ):
```
üéâ –ù–û–í–ê–Ø –ü–†–û–î–ê–ñ–ê!

üöÄ –¢–∞—Ä–≥–µ—Ç–æ–ª–æ–≥: Muha
üë§ –ö–ª–∏–µ–Ω—Ç: –ï—Ä–ª–∞–Ω –°–∞–≥—ã–Ω–¥—ã–∫–æ–≤
üí∞ –°—É–º–º–∞: 5 000 ‚Ç∏
üì¶ –ü—Ä–æ–¥—É–∫—Ç: Tripwire
üè∑Ô∏è –ö–∞–º–ø–∞–Ω–∏—è: –ó–∞–ø—É—Å–∫ –Ω–∞ On AI 15.12

Muha, –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –ü–û –í–ê–ú –°–î–ï–õ–ê–õ–ò –ü–†–û–î–ê–ñ–£! üî•
```

---

## üìà –ê–ù–ê–õ–ò–¢–ò–ö–ê:

### SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤:

#### 1. –ü—Ä–æ–¥–∞–∂–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è:
```sql
SELECT 
  targetologist,
  COUNT(*) as sales_today,
  SUM(sale_amount) as revenue_today
FROM sales_notifications
WHERE sale_date::date = CURRENT_DATE
GROUP BY targetologist;
```

#### 2. –¢–æ–ø —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–æ–≤ –∑–∞ –¥–µ–∫–∞–±—Ä—å:
```sql
SELECT 
  targetologist,
  COUNT(*) as sales_count,
  SUM(sale_amount) as total_revenue,
  AVG(sale_amount) as avg_sale
FROM sales_notifications
WHERE sale_date BETWEEN '2024-12-01' AND '2024-12-31'
GROUP BY targetologist
ORDER BY sales_count DESC;
```

#### 3. –ò—Å—Ç–æ—Ä–∏—è –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥—É:
```sql
SELECT 
  contact_name,
  sale_amount,
  product_name,
  utm_campaign,
  sale_date
FROM sales_notifications
WHERE targetologist = 'Kenesary'
ORDER BY sale_date DESC
LIMIT 20;
```

---

## üî• –†–ï–ó–£–õ–¨–¢–ê–¢:

### –î–û:
- ‚ùå –ü—Ä–æ–¥–∞–∂–∏ –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤ AmoCRM
- ‚ùå –ù–µ–ø–æ–Ω—è—Ç–Ω–æ –∫—Ç–æ –ø—Ä–∏–≤–µ–ª –∫–ª–∏–µ–Ω—Ç–∞
- ‚ùå –ù–µ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã
- ‚ùå –ù–µ—Ç real-time —Ç—Ä–µ–∫–∏–Ω–≥–∞

### –ü–û–°–õ–ï:
- ‚úÖ Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∞
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –ø—Ä–æ–¥–∞–∂ –≤ –ë–î
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º
- ‚úÖ –ú–û–¢–ò–í–ê–¶–ò–Ø –ò –ê–ó–ê–†–¢! üî•

---

## üìÇ –§–ê–ô–õ–´:

```
‚úÖ backend/database/sales_notifications.sql - SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
‚úÖ backend/src/routes/amocrm-sales-webhook.ts - Backend webhook –ª–æ–≥–∏–∫–∞
‚úÖ AMOCRM_SALES_SETUP.md - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ setup
‚úÖ SALES_WEBHOOK_READY.md - –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç (—Å—Ç–∞—Ç—É—Å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏)
```

---

## üöÄ COMMITS –ù–ê PRODUCTION:

```
98f4c96 - üéâ AmoCRM Sales Webhook - Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
dae723d - üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ setup Supabase —Ç–∞–±–ª–∏—Ü—ã
7fe1ef9 - üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤ + –ò—Å—Ç–æ—Ä–∏—è –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏
```

---

## ‚úÖ –ì–û–¢–û–í–û –ö –ó–ê–ü–£–°–ö–£ –ó–ê–í–¢–†–ê!

**–ë–†–ê–¢–ê–ù, –í–°–Å –ì–û–¢–û–í–û! –ó–ê–í–¢–†–ê –ù–ê–°–¢–†–ê–ò–í–ê–ï–ú AMOCRM ‚Üí –ó–ê–ü–£–°–ö–ê–ï–ú ‚Üí –ö–û–ú–ê–ù–î–ê –ù–ê–ß–ò–ù–ê–ï–¢ –ü–û–õ–£–ß–ê–¢–¨ REAL-TIME –ü–û–ó–î–†–ê–í–õ–ï–ù–ò–Ø! üéâüî•**

**–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** `AMOCRM_SALES_SETUP.md`
