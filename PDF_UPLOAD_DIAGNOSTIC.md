# üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê PDF UPLOAD - –ü–û–®–ê–ì–û–í–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø

## ‚úÖ –ú–û–î–£–õ–ò –£–°–¢–ê–ù–û–í–õ–ï–ù–´

```bash
‚úÖ pdf-parse@2.4.5
‚úÖ mammoth@1.11.0
‚úÖ multer@2.0.2
```

–í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ `backend/node_modules`.

---

## üìã –ü–û–®–ê–ì–û–í–´–ô –ü–õ–ê–ù –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò

### –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ `pdf-parse` –ª–æ–∫–∞–ª—å–Ω–æ

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –º–æ–¥—É–ª—å `pdf-parse` –≤–æ–æ–±—â–µ –º–æ–∂–µ—Ç –ø–∞—Ä—Å–∏—Ç—å PDF —Ñ–∞–π–ª—ã.

1. **–ü–æ–ª–æ–∂–∏ —Ç–µ—Å—Ç–æ–≤—ã–π PDF —Ñ–∞–π–ª** –≤ –ø–∞–ø–∫—É `backend/` –∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π –µ–≥–æ –≤ `test.pdf`
   - –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ—Å—Ç–æ–π PDF (–Ω–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–π –ø–∞—Ä–æ–ª–µ–º, —Å —Ç–µ–∫—Å—Ç–æ–º)
   
2. **–ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:**
   ```bash
   cd backend
   node test-pdf-parse.js
   ```

3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   ```
   ‚úÖ PDF –£–°–ü–ï–®–ù–û –†–ê–°–ü–û–ó–ù–ê–ù!
   üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
     - –°—Ç—Ä–∞–Ω–∏—Ü: 1
     - –°–∏–º–≤–æ–ª–æ–≤: 1234
   üìù –°–æ–¥–µ—Ä–∂–∏–º–æ–µ (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤):
   ...
   ```

4. **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:**
   - –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Å–∞–º–æ–º `pdf-parse` –∏–ª–∏ PDF —Ñ–∞–π–ª–µ (–∑–∞—â–∏—â—ë–Ω/–ø–æ–≤—Ä–µ–∂–¥—ë–Ω)
   - –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π PDF —Ñ–∞–π–ª
   - –û–±–Ω–æ–≤–∏ Node.js –¥–æ LTS –≤–µ—Ä—Å–∏–∏ (>18)

---

### –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä—å Backend –ª–æ–≥–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

**–¶–µ–ª—å:** –ü–æ–Ω—è—Ç—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –ª–∏ —Ñ–∞–π–ª –Ω–∞ Backend –∏ –∫–∞–∫–æ–π —É –Ω–µ–≥–æ —Ä–∞–∑–º–µ—Ä.

1. **–£–±–µ–¥–∏—Å—å —á—Ç–æ Backend –∑–∞–ø—É—â–µ–Ω:**
   ```bash
   cd backend
   npm run dev
   ```

2. **–û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å Backend** (—Ç–µ—Ä–º–∏–Ω–∞–ª –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `npm run dev`)

3. **–í –±—Ä–∞—É–∑–µ—Ä–µ:** –∑–∞–≥—Ä—É–∑–∏ PDF —á–µ—Ä–µ–∑ AI-–ö—É—Ä–∞—Ç–æ—Ä

4. **–°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ Backend:**

**‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô –í–´–î (—Ñ–∞–π–ª –ø—Ä–∏—à—ë–ª):**
```
[FileController] üîç –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞...
[FileController] req.file: true
[FileController] ‚úÖ –§–∞–π–ª –ø–æ–ª—É—á–µ–Ω: { filename: 'test.pdf', mimetype: 'application/pdf', size: 54257, bufferLength: 54257 }
[FileProcessing] –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ PDF...
[FileProcessing] Buffer size: 54257 bytes
[FileProcessing] ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ 1234 —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ PDF
```

**‚ùå –û–®–ò–ë–ö–ê 1 (—Ñ–∞–π–ª –ù–ï –ø—Ä–∏—à—ë–ª):**
```
[FileController] req.file: false
[FileController] ‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∑–∞–ø—Ä–æ—Å–µ
```
**–ü—Ä–∏—á–∏–Ω–∞:** Multer –Ω–µ –ø–æ–ª—É—á–∏–ª —Ñ–∞–π–ª ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ Frontend/FormData

**‚ùå –û–®–ò–ë–ö–ê 2 (—Ñ–∞–π–ª –ø—É—Å—Ç–æ–π):**
```
[FileController] ‚úÖ –§–∞–π–ª –ø–æ–ª—É—á–µ–Ω: { size: 0, bufferLength: 0 }
[FileProcessing] Buffer size: 0 bytes
[FileProcessing] ‚ùå PDF buffer is empty!
```
**–ü—Ä–∏—á–∏–Ω–∞:** File object –ø—É—Å—Ç–æ–π ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ Frontend (–∫–∞–∫ —á–∏—Ç–∞–µ—Ç—Å—è —Ñ–∞–π–ª)

**‚ùå –û–®–ò–ë–ö–ê 3 (pdf-parse –Ω–µ –º–æ–∂–µ—Ç —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å):**
```
[FileProcessing] Buffer size: 54257 bytes
[FileProcessing] ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø–∞—Ä—Å–∏–Ω–≥–∞ PDF:
[FileProcessing] –¢–∏–ø –æ—à–∏–±–∫–∏: Error
[FileProcessing] –°–æ–æ–±—â–µ–Ω–∏–µ: Invalid PDF structure
```
**–ü—Ä–∏—á–∏–Ω–∞:** PDF —Ñ–∞–π–ª –∑–∞—â–∏—â—ë–Ω/–ø–æ–≤—Ä–µ–∂–¥—ë–Ω/–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç

---

### –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä—å Frontend –ª–æ–≥–∏

**–¶–µ–ª—å:** –ü–æ–Ω—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è FormData –Ω–∞ Frontend.

1. **–û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** (F12 ‚Üí Console)

2. **–ó–∞–≥—Ä—É–∑–∏ PDF —Ñ–∞–π–ª** —á–µ—Ä–µ–∑ AI-–ö—É—Ä–∞—Ç–æ—Ä

3. **–°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ Frontend:**

**‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô –í–´–î:**
```
üìé [processFile] –ü–æ–ª—É—á–µ–Ω —Ñ–∞–π–ª: { name: 'test.pdf', size: 54257, type: 'application/pdf' }
üìé [processFile] FormData —Å–æ–∑–¥–∞–Ω, —Ñ–∞–π–ª –¥–æ–±–∞–≤–ª–µ–Ω
üìé [processFile] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ Backend: /api/files/process
‚úÖ –§–∞–π–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω: { type: 'text', content: '...' }
```

**‚ùå –û–®–ò–ë–ö–ê 1 (—Ñ–∞–π–ª –ø—É—Å—Ç–æ–π –î–û –æ—Ç–ø—Ä–∞–≤–∫–∏):**
```
üìé [processFile] –ü–æ–ª—É—á–µ–Ω —Ñ–∞–π–ª: { name: 'test.pdf', size: 0, type: 'application/pdf' }
‚ùå –§–∞–π–ª test.pdf –ø—É—Å—Ç–æ–π –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω!
```
**–ü—Ä–∏—á–∏–Ω–∞:** File input —á–∏—Ç–∞–µ—Ç –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å `<input type="file">`

**‚ùå –û–®–ò–ë–ö–ê 2 (Backend –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É):**
```
‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞: Failed to process file
```
**–ü—Ä–∏—á–∏–Ω–∞:** Backend –ø–æ–ª—É—á–∏–ª —Ñ–∞–π–ª –Ω–æ –Ω–µ —Å–º–æ–≥ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å ‚Üí —Å–º. –ª–æ–≥–∏ Backend

---

## üîß –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞ 1: `pdf-parse` –Ω–µ –º–æ–∂–µ—Ç —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Ñ–∞–π–ª

**–°–∏–º–ø—Ç–æ–º—ã:**
- –®–ê–ì 1 (`test-pdf-parse.js`) –ø—Ä–æ–≤–∞–ª–∏–≤–∞–µ—Ç—Å—è
- –û—à–∏–±–∫–∞: "Invalid PDF structure" –∏–ª–∏ "Failed to parse PDF"

**–†–µ—à–µ–Ω–∏—è:**
1. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π PDF —Ñ–∞–π–ª (–ø—Ä–æ—Å—Ç–æ–π, –±–µ–∑ –∑–∞—â–∏—Ç—ã)
2. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ñ–∞–π–ª –Ω–µ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω (–æ—Ç–∫—Ä–æ–π –µ–≥–æ –≤ Adobe Reader)
3. –û–±–Ω–æ–≤–∏ Node.js: `node --version` (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å >=18)
4. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏ `pdf-parse`:
   ```bash
   cd backend
   npm uninstall pdf-parse
   npm install pdf-parse@2.4.5
   ```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: File object –ø—É—Å—Ç–æ–π (size: 0)

**–°–∏–º–ø—Ç–æ–º—ã:**
- Backend –ª–æ–≥–∏: `Buffer size: 0 bytes`
- Frontend –ª–æ–≥–∏: `size: 0`

**–†–µ—à–µ–Ω–∏—è:**

**–ê) Frontend: –ü—Ä–æ–≤–µ—Ä—å –∫–∞–∫ —á–∏—Ç–∞–µ—Ç—Å—è —Ñ–∞–π–ª –∏–∑ input**

–í `src/lib/openai-assistant.ts` —Ñ—É–Ω–∫—Ü–∏—è `processFile`:
```typescript
// ‚úÖ –ü–†–û–í–ï–†–¨ –ß–¢–û –§–ê–ô–õ –ù–ï –ü–£–°–¢–û–ô
if (!file || file.size === 0) {
  throw new Error(`–§–∞–π–ª ${file?.name || 'Unknown'} –ø—É—Å—Ç–æ–π –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω!`);
}

console.log(`üìé [processFile] –§–∞–π–ª: size=${file.size}, type=${file.type}`);
```

**–ë) Frontend: –ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π Content-Type –≤—Ä—É—á–Ω—É—é!**

–í `src/utils/apiClient.ts` —Ñ—É–Ω–∫—Ü–∏—è `apiRequest`:
```typescript
// ‚ùå –ù–ï –¢–ê–ö:
headers['Content-Type'] = 'multipart/form-data';

// ‚úÖ –¢–ê–ö (–±—Ä–∞—É–∑–µ—Ä —Å–∞–º –¥–æ–±–∞–≤–∏—Ç boundary):
if (!(options.body instanceof FormData)) {
  headers['Content-Type'] = 'application/json';
}
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Multer –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Ñ–∞–π–ª (req.file = undefined)

**–°–∏–º–ø—Ç–æ–º—ã:**
- Backend –ª–æ–≥–∏: `req.file: false`
- –û—à–∏–±–∫–∞: "No file provided"

**–†–µ—à–µ–Ω–∏—è:**

**–ê) –ü—Ä–æ–≤–µ—Ä—å middleware –≤ routes:**

`backend/src/routes/files.ts`:
```typescript
import { uploadMiddleware } from '../controllers/fileController';

router.post('/process', authenticateJWT, uploadMiddleware, processFile);
//                                        ^^^^^^^^^^^^^^^^
//                                        ‚úÖ –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –î–û processFile
```

**–ë) –ü—Ä–æ–≤–µ—Ä—å –∏–º—è –ø–æ–ª—è –≤ FormData:**

Frontend –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–∞–π–ª –ø–æ–¥ –∫–ª—é—á–æ–º **`file`** (–Ω–µ `audio`, –Ω–µ `attachment`):
```typescript
formData.append('file', file);  // ‚úÖ –¢–ê–ö
formData.append('attachment', file); // ‚ùå –ù–ï –¢–ê–ö
```

Multer –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **`.single('file')`**:
```typescript
const upload = multer({ storage: multer.memoryStorage() });
export const uploadMiddleware = upload.single('file'); // ‚úÖ –∫–ª—é—á 'file'
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: PDF –∑–∞—â–∏—â—ë–Ω –ø–∞—Ä–æ–ª–µ–º / –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- pdf-parse –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É "Invalid PDF" –∏–ª–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
- –§–∞–π–ª –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ Adobe Reader –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–æ–ª—å

**–†–µ—à–µ–Ω–∏—è:**
1. –ò—Å–ø–æ–ª—å–∑—É–π PDF –±–µ–∑ –ø–∞—Ä–æ–ª—è
2. –ï—Å–ª–∏ PDF —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Å–∫–∞–Ω—ã) ‚Üí –Ω—É–∂–µ–Ω OCR (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
3. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π PDF —Ñ–∞–π–ª –¥–ª—è —Ç–µ—Å—Ç–∞

---

## üéØ –ö–†–ê–¢–ö–ò–ô –ß–ï–ö–õ–ò–°–¢

```
‚ñ° –®–ê–ì 1: node backend/test-pdf-parse.js ‚Üí ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚ñ° –®–ê–ì 2: Backend –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç size > 0 ‚Üí ‚úÖ —Ñ–∞–π–ª –ø—Ä–∏—à—ë–ª
‚ñ° –®–ê–ì 3: Frontend –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç size > 0 ‚Üí ‚úÖ —Ñ–∞–π–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
‚ñ° –®–ê–ì 4: Content-Type –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤—Ä—É—á–Ω—É—é ‚Üí ‚úÖ FormData –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
‚ñ° –®–ê–ì 5: uploadMiddleware —Å—Ç–æ–∏—Ç –ü–ï–†–ï–î processFile ‚Üí ‚úÖ middleware –ø—Ä–∞–≤–∏–ª—å–Ω–æ
‚ñ° –®–ê–ì 6: FormData.append('file', ...) ‚Üí ‚úÖ –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
```

---

## üìä –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°

- ‚úÖ –ú–æ–¥—É–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`pdf-parse`, `multer`, `mammoth`)
- ‚úÖ –ö–æ–¥ –∏–º–µ–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `backend/test-pdf-parse.js`
- ‚è≥ **–ù–£–ñ–ù–û:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º PDF —Ñ–∞–π–ª–æ–º

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–ü–æ–ª–æ–∂–∏ —Ç–µ—Å—Ç–æ–≤—ã–π PDF** –≤ `backend/test.pdf`
2. **–ó–∞–ø—É—Å—Ç–∏:** `node backend/test-pdf-parse.js`
3. **–ó–∞–≥—Ä—É–∑–∏ PDF** —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –∏ —Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ Backend
4. **–û—Ç–ø—Ä–∞–≤—å –ª–æ–≥–∏** (Backend + Frontend) –µ—Å–ª–∏ –æ—à–∏–±–∫–∞

---

## üí° –í–ê–ñ–ù–û

- **–ù–ï –ù–£–ñ–ù–û** —Å–ª–æ–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Supabase Storage (—ç—Ç–æ "–≤–µ—Ä—Ç—è–≥")
- **–°–ù–ê–ß–ê–õ–ê** –ø—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ `pdf-parse` –ª–æ–∫–∞–ª—å–Ω–æ
- **–ü–û–¢–û–ú** –∏—â–∏ –ø—Ä–æ–±–ª–µ–º—É –≤ –ø–µ—Ä–µ–¥–∞—á–µ —Ñ–∞–π–ª–∞ Frontend ‚Üí Backend
- **–õ–æ–≥–∏** –ø–æ–∫–∞–∂—É—Ç –≥–¥–µ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ–π

---

‚úÖ **–í—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏!**

