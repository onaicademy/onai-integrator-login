# üéØ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ UTM –¢—Ä–µ–∫–∏–Ω–≥—É –∏ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é –ü–µ—Ä–µ—Ö–æ–¥–æ–≤

## ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

1. **–£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –ª–∏–¥—ã** - –æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑ amoCRM
2. **–î–æ–±–∞–≤–ª–µ–Ω UTM —Ç—Ä–µ–∫–∏–Ω–≥** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞
3. **–î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤** - –∫—Ç–æ –ø–µ—Ä–µ—à–µ–ª –ø–æ —Å—Å—ã–ª–∫–µ –∏–∑ Email/SMS
4. **–û–±–Ω–æ–≤–ª–µ–Ω –¥–∞—à–±–æ—Ä–¥** - –Ω–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

## üìä –ù–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ `/target`:

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- **–í—Å–µ–≥–æ –ª–∏–¥–æ–≤** - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- **–í AmoCRM** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
- **Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∏—Å–µ–º
- **Email –æ—Ç–∫—Ä—ã—Ç–æ** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–∏—Å–µ–º
- **SMS –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö SMS
- **SMS –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö SMS

### –ù–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –ø–µ—Ä–µ—Ö–æ–¥–∞–º:
- **–ü–æ—Å–µ—Ç–∏–ª–∏ –ª–µ–Ω–¥–∏–Ω–≥** - —Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ –ª–µ–Ω–¥–∏–Ω–≥
- **–ö–ª–∏–∫–∏ –∏–∑ Email** - –∫—Ç–æ –∫–ª–∏–∫–Ω—É–ª –ø–æ —Å—Å—ã–ª–∫–µ –≤ –ø–∏—Å—å–º–µ (+ CTR %)
- **–ö–ª–∏–∫–∏ –∏–∑ SMS** - –∫—Ç–æ –∫–ª–∏–∫–Ω—É–ª –ø–æ —Å—Å—ã–ª–∫–µ –≤ SMS (+ CTR %)
- **–ü—Ä–∏—à–ª–∏ —Å Email** - –∫—Ç–æ –ø–æ–ø–∞–ª –Ω–∞ –ª–µ–Ω–¥–∏–Ω–≥ —á–µ—Ä–µ–∑ Email
- **–ü—Ä–∏—à–ª–∏ —Å SMS** - –∫—Ç–æ –ø–æ–ø–∞–ª –Ω–∞ –ª–µ–Ω–¥–∏–Ω–≥ —á–µ—Ä–µ–∑ SMS

## üîó –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏:

### 1. –°—Å—ã–ª–∫–∏ –≤ Email:

```
https://onai.academy/integrator/expresscourse?utm_source=email&utm_medium=welcome&utm_campaign=tripwire_dec2024&email={EMAIL_–ê–î–†–ï–°}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `utm_source=email` - –∏—Å—Ç–æ—á–Ω–∏–∫ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
- `utm_medium=welcome` - —Ç–∏–ø –ø–∏—Å—å–º–∞ (welcome, reminder, promo)
- `utm_campaign=tripwire_dec2024` - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏
- `email={EMAIL_–ê–î–†–ï–°}` - email –ª–∏–¥–∞ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 2. –°—Å—ã–ª–∫–∏ –≤ SMS:

```
https://onai.academy/integrator/expresscourse?utm_source=sms&utm_medium=welcome&utm_campaign=tripwire_dec2024&phone={–¢–ï–õ–ï–§–û–ù}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `utm_source=sms` - –∏—Å—Ç–æ—á–Ω–∏–∫ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
- `utm_medium=welcome` - —Ç–∏–ø SMS
- `utm_campaign=tripwire_dec2024` - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏
- `phone={–¢–ï–õ–ï–§–û–ù}` - —Ç–µ–ª–µ—Ñ–æ–Ω –ª–∏–¥–∞ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 3. –ö–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏ (–¥–ª—è SMS):

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫, –Ω–æ –°–û–•–†–ê–ù–Ø–ô–¢–ï UTM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã!

```
bit.ly/onai-trip?utm_source=sms&phone=77001234567
```

## ‚öôÔ∏è –ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ:

### –®–∞–≥ 1: –ù–∞ –ª–µ–Ω–¥–∏–Ω–≥–µ –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥ –∫–æ–¥–∞

–î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –Ω–∞ –ª–µ–Ω–¥–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—É (`TripwireLanding.tsx`):

```typescript
import { useEffect } from 'react';
import { useSearchParams } from 'react-router-dom';
import axios from 'axios';

export default function TripwireLanding() {
  const [searchParams] = useSearchParams();
  const API_URL = import.meta.env.VITE_BACKEND_URL;

  useEffect(() => {
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ª–µ–Ω–¥–∏–Ω–≥
    const trackVisit = async () => {
      const email = searchParams.get('email');
      const phone = searchParams.get('phone');
      const utm_source = searchParams.get('utm_source');
      const utm_medium = searchParams.get('utm_medium');
      const utm_campaign = searchParams.get('utm_campaign');

      // –ï—Å–ª–∏ –µ—Å—Ç—å email –∏–ª–∏ phone –∏ utm_source - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º
      if ((email || phone) && utm_source) {
        try {
          await axios.post(`${API_URL}/api/lead-tracking/track-click`, {
            email,
            phone,
            source: utm_source, // 'email' –∏–ª–∏ 'sms'
            utm: {
              source: utm_source,
              medium: utm_medium,
              campaign: utm_campaign
            }
          });
          console.log('‚úÖ Visit tracked');
        } catch (error) {
          console.error('‚ùå Failed to track visit:', error);
        }
      }
    };

    trackVisit();
  }, [searchParams]);

  return (
    // ... –≤–∞—à –ª–µ–Ω–¥–∏–Ω–≥ –∫–æ–¥
  );
}
```

### –®–∞–≥ 2: –í —Å–µ—Ä–≤–∏—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ Email

–û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ Email:

```typescript
async function sendWelcomeEmail(lead: { email: string; name: string }) {
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É —Å UTM
  const landingUrl = `https://onai.academy/integrator/expresscourse?utm_source=email&utm_medium=welcome&utm_campaign=tripwire_dec2024&email=${encodeURIComponent(lead.email)}`;

  try {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º Email
    await resend.emails.send({
      from: 'onai@onai.academy',
      to: lead.email,
      subject: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Tripwire! üöÄ',
      html: `
        <p>–ü—Ä–∏–≤–µ—Ç, ${lead.name}!</p>
        <p>–¢–≤–æ–π –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É –≥–æ—Ç–æ–≤!</p>
        <a href="${landingUrl}">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É ‚Üí</a>
      `
    });

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    await axios.post(`${API_URL}/api/lead-tracking/update-email-status`, {
      leadId: lead.id,
      status: 'sent'
    });

    console.log(`‚úÖ Email sent to ${lead.email}`);
  } catch (error) {
    // –ü—Ä–∏ –æ—à–∏–±–∫–µ —Ç–æ–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    await axios.post(`${API_URL}/api/lead-tracking/update-email-status`, {
      leadId: lead.id,
      status: 'error',
      error: error.message
    });
  }
}
```

### –®–∞–≥ 3: –í —Å–µ—Ä–≤–∏—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ SMS

```typescript
async function sendWelcomeSMS(lead: { phone: string; name: string }) {
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É —Å UTM
  const landingUrl = `https://onai.academy/integrator/expresscourse?utm_source=sms&utm_medium=welcome&utm_campaign=tripwire_dec2024&phone=${encodeURIComponent(lead.phone)}`;

  try {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º SMS
    await smsService.send({
      to: lead.phone,
      text: `–ü—Ä–∏–≤–µ—Ç, ${lead.name}! –¢–≤–æ–π –¥–æ—Å—Ç—É–ø –≥–æ—Ç–æ–≤: ${landingUrl}`
    });

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    await axios.post(`${API_URL}/api/lead-tracking/update-sms-status`, {
      leadId: lead.id,
      status: 'sent'
    });

    console.log(`‚úÖ SMS sent to ${lead.phone}`);
  } catch (error) {
    // –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    await axios.post(`${API_URL}/api/lead-tracking/update-sms-status`, {
      leadId: lead.id,
      status: 'error',
      error: error.message
    });
  }
}
```

## üìà –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ** —Å–µ–±–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π UTM —Å—Å—ã–ª–∫–æ–π
2. **–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ** –≤ –ø–∏—Å—å–º–µ
3. **–û—Ç–∫—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥** `/target`
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É**:
   - –î–æ–ª–∂–Ω–∞ —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è –º–µ—Ç—Ä–∏–∫–∞ "–ü–æ—Å–µ—Ç–∏–ª–∏ –ª–µ–Ω–¥–∏–Ω–≥"
   - –î–æ–ª–∂–Ω–∞ —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è –º–µ—Ç—Ä–∏–∫–∞ "–ö–ª–∏–∫–∏ –∏–∑ Email"
   - –í —Ç–∞–±–ª–∏—Ü–µ –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤–∞—à –ø–µ—Ä–µ—Ö–æ–¥ —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º "üìß Email"

## üîç API Endpoints:

### 1. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ
```
POST /api/lead-tracking/track-click
Body: {
  "email": "user@example.com",  // –∏–ª–∏ "phone": "77001234567"
  "source": "email",             // –∏–ª–∏ "sms"
  "utm": {
    "source": "email",
    "medium": "welcome",
    "campaign": "tripwire_dec2024"
  }
}
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```
GET /api/lead-tracking/leads
Response: {
  "success": true,
  "stats": {
    "total_leads": 4,
    "landing_visited": 2,
    "email_link_clicked": 1,
    "sms_link_clicked": 1,
    "from_email": 1,
    "from_sms": 1
  },
  "leads": [...]
}
```

## üéØ –ü—Ä–∏–º–µ—Ä—ã UTM –∫–∞–º–ø–∞–Ω–∏–π:

### Welcome Email (–ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏):
```
utm_source=email
utm_medium=welcome
utm_campaign=tripwire_welcome
```

### Reminder Email (–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ):
```
utm_source=email
utm_medium=reminder
utm_campaign=tripwire_reminder_day1
```

### Promo SMS (—Ä–µ–∫–ª–∞–º–Ω–∞—è):
```
utm_source=sms
utm_medium=promo
utm_campaign=tripwire_discount
```

## ‚ö° –í–∞–∂–Ω–æ:

1. **–í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ UTM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** –≤ —Å—Å—ã–ª–∫–∞—Ö –¥–ª—è Email –∏ SMS
2. **–í–°–ï–ì–î–ê –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ email –∏–ª–∏ phone** –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–∏–¥–∞
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–±–æ—Ç—É** —á–µ—Ä–µ–∑ –¥–∞—à–±–æ—Ä–¥ `/target`
4. **–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ** —Å–æ–∫—Ä–∞—â–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è SMS

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 13 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

