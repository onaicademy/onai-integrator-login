# üö® –ù–ê–ß–ù–ò –û–¢–°–Æ–î–ê: –ò–Ω—Ü–∏–¥–µ–Ω—Ç Backend Crash

## üìå –ß–¢–û –ü–†–û–ò–ó–û–®–õ–û?

**22 –¥–µ–∫–∞–±—Ä—è 2025, ~08:00-13:00:** Backend API –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ~3 —á–∞—Å–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù (13:58)

---

## üéØ –ë–´–°–¢–†–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø

### üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã (–≤ –ø–æ—Ä—è–¥–∫–µ —á—Ç–µ–Ω–∏—è):

1. **[–ò–ù–¶–ò–î–ï–ù–¢_–ö–†–ê–¢–ö–ê–Ø_–°–í–û–î–ö–ê.md](./–ò–ù–¶–ò–î–ï–ù–¢_–ö–†–ê–¢–ö–ê–Ø_–°–í–û–î–ö–ê.md)** ‚≠ê
   - üìñ **–ù–ê–ß–ù–ò –û–¢–°–Æ–î–ê!**
   - –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –Ω–∞ 1 —Å—Ç—Ä–∞–Ω–∏—Ü—É
   - –í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è: 2-3 –º–∏–Ω—É—Ç—ã
   - –ö–æ–º—É: –í—Å–µ–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è

2. **[–°–†–û–ß–ù–´–ï_–£–õ–£–ß–®–ï–ù–ò–Ø_–ü–û–°–õ–ï_–ö–†–ê–®–ê.md](./–°–†–û–ß–ù–´–ï_–£–õ–£–ß–®–ï–ù–ò–Ø_–ü–û–°–õ–ï_–ö–†–ê–®–ê.md)** üî•
   - üìñ –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π
   - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 1 —á–∞—Å (P0)
   - –ö–æ–º—É: –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

3. **[POSTMORTEM_BACKEND_CRASH_2025-12-22.md](./POSTMORTEM_BACKEND_CRASH_2025-12-22.md)** üìä
   - üìñ –î–µ—Ç–∞–ª—å–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
   - Timeline, root cause, metrics
   - –ö–æ–º—É: –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞–º –∏ —Ç–µ—Ö–ª–∏–¥–∞–º

---

## üöÄ –ë–´–°–¢–†–´–ï –î–ï–ô–°–¢–í–ò–Ø

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (5-10 –º–∏–Ω—É—Ç)

```bash
./–ë–´–°–¢–†–´–ï_–ö–û–ú–ê–ù–î–´_–ó–ê–©–ò–¢–ê.sh
```

**–ß—Ç–æ —Å–¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç PM2 –∫–æ–Ω—Ñ–∏–≥
- ‚úÖ –í–∫–ª—é—á–∏—Ç Sentry (–µ—Å–ª–∏ –µ—Å—Ç—å DSN)
- ‚úÖ –û—á–∏—Å—Ç–∏—Ç —Å—Ç–∞—Ä—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –∑–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (3 –º–∏–Ω—É—Ç—ã)

```bash
# 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å PM2 –∫–æ–Ω—Ñ–∏–≥
ssh root@207.154.231.30 'cd /var/www/onai-integrator-login-main/backend && \
  sed -i "s/max_restarts: 15/max_restarts: 3/g" ecosystem.config.js && \
  sed -i "s/min_uptime: '\''5s'\''/min_uptime: '\''30s'\''/g" ecosystem.config.js && \
  pm2 restart onai-backend'

# 2. –û—á–∏—Å—Ç–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
ssh root@207.154.231.30 'cd /var/www/onai-integrator-login-main/backend && \
  rm -rf dist/ *.tar.gz'

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
ssh root@207.154.231.30 'pm2 status && pm2 logs onai-backend --lines 20 --nostream'
```

---

## üî• –¢–û–ü-3 –ö–†–ò–¢–ò–ß–ù–´–• –ó–ê–î–ê–ß–ò (–°–ï–ì–û–î–ù–Ø!)

### 1. –ú–û–ù–ò–¢–û–†–ò–ù–ì (30 –º–∏–Ω—É—Ç)

**–ü—Ä—è–º–æ —Å–µ–π—á–∞—Å:** https://uptimerobot.com

```
Monitor Name: OnAI Backend API
Type: HTTP(s)
URL: https://api.onai.academy/health
Interval: 2 minutes
Alert Contacts: Telegram + SMS
```

**–ë–µ–∑ —ç—Ç–æ–≥–æ —Å–ª–µ–¥—É—é—â–∏–π –∫—Ä–∞—à –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –Ω–µ–∑–∞–º–µ—á–µ–Ω–Ω—ã–º!**

---

### 2. –ò–°–ü–†–ê–í–ò–¢–¨ PM2 (5 –º–∏–Ω—É—Ç)

```bash
./–ë–´–°–¢–†–´–ï_–ö–û–ú–ê–ù–î–´_–ó–ê–©–ò–¢–ê.sh
```

–ò–õ–ò –≤—Ä—É—á–Ω—É—é –∏–∑–º–µ–Ω–∏—Ç—å `ecosystem.config.js`:
- `max_restarts: 15` ‚Üí `max_restarts: 3`
- `min_uptime: '5s'` ‚Üí `min_uptime: '30s'`

---

### 3. –í–ö–õ–Æ–ß–ò–¢–¨ SENTRY (10 –º–∏–Ω—É—Ç)

1. –°–æ–∑–¥–∞–π –ø—Ä–æ–µ–∫—Ç: https://sentry.io
2. –°–∫–æ–ø–∏—Ä—É–π DSN
3. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   ```bash
   nano /var/www/onai-integrator-login-main/backend/env.env
   # –î–æ–±–∞–≤—å:
   SENTRY_ENABLED=true
   SENTRY_DSN=<—Ç–≤–æ–π DSN>
   
   pm2 restart onai-backend
   ```

---

## üìä –ú–ï–¢–†–ò–ö–ò

### –î–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞ ‚ùå
- **MTTD** (–≤—Ä–µ–º—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è): 2-3 —á–∞—Å–∞
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ù–ï–¢
- **–ê–ª–µ—Ä—Ç—ã**: –ù–ï–¢
- **Rollback**: –ù–ï–¢

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π ‚úÖ
- **MTTD**: < 5 –º–∏–Ω—É—Ç
- **MTTR**: < 10 –º–∏–Ω—É—Ç
- **Monitoring**: UptimeRobot 24/7
- **Alerting**: Telegram + SMS
- **Rollback**: 1 –∫–æ–º–∞–Ω–¥–∞

---

## üí° –ì–õ–ê–í–ù–´–ô –£–†–û–ö

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                   ‚ïë
‚ïë  "–ï—Å–ª–∏ —Ç—ã –Ω–µ –∑–Ω–∞–µ—à—å —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–ø–∞–ª–∞ -           ‚ïë
‚ïë   –æ–Ω–∞ –¥–ª—è —Ç–µ–±—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"                     ‚ïë
‚ïë                                                   ‚ïë
‚ïë  –ú–û–ù–ò–¢–û–†–ò–ù–ì = –ù–ï –†–û–°–ö–û–®–¨, –ê –ù–ï–û–ë–•–û–î–ò–ú–û–°–¢–¨!       ‚ïë
‚ïë                                                   ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

## üõ°Ô∏è –ó–ê–©–ò–¢–ê –ù–ê –ë–£–î–£–©–ï–ï

### –ß—Ç–æ –º—ã –∏—Å–ø—Ä–∞–≤–∏–ª–∏:
- ‚úÖ Backend –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚úÖ `dist/` —É–¥–∞–ª—ë–Ω
- ‚úÖ PM2 –∫–æ–Ω—Ñ–∏–≥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

### –ß—Ç–æ –ù–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–µ—â—ë):
- ‚ö†Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí **–°–î–ï–õ–ê–ô –°–ï–ì–û–î–ù–Ø**
- ‚ö†Ô∏è Deploy —Å–∫—Ä–∏–ø—Ç—ã —É—Å—Ç–∞—Ä–µ–ª–∏ ‚Üí –≠—Ç–∞ –Ω–µ–¥–µ–ª—è
- ‚ö†Ô∏è –ù–µ—Ç smoke tests ‚Üí –≠—Ç–∞ –Ω–µ–¥–µ–ª—è
- ‚ö†Ô∏è –ù–µ—Ç rollback mechanism ‚Üí –≠—Ç–∞ –Ω–µ–¥–µ–ª—è
- ‚ö†Ô∏è Sentry –æ—Ç–∫–ª—é—á–µ–Ω ‚Üí –°–µ–≥–æ–¥–Ω—è

---

## üìã –ß–ï–ö–õ–ò–°–¢ "–°–î–ï–õ–ê–ù–û?"

### üî• P0 - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–°–ï–ì–û–î–ù–Ø)
- [ ] **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** UptimeRobot –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] **PM2:** max_restarts = 3, min_uptime = 30s
- [ ] **Sentry:** –í–∫–ª—é—á—ë–Ω –≤ production
- [ ] **–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:** dist/ —É–¥–∞–ª—ë–Ω

### ‚ö†Ô∏è P1 - –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–≠–¢–ê –ù–ï–î–ï–õ–Ø)
- [ ] **Deploy scripts:** –£–¥–∞–ª–∏—Ç—å `npm run build`
- [ ] **Smoke tests:** Health check –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- [ ] **Rollback:** Blue-green deployment setup
- [ ] **CI/CD:** GitHub Actions pipeline

### üìä P2 - –°—Ä–µ–¥–Ω–∏–π (2 –ù–ï–î–ï–õ–ò)
- [ ] Structured logging
- [ ] Automated tests
- [ ] Documentation update

---

## üÜò –ï–°–õ–ò –°–ù–û–í–ê –°–õ–£–ß–ò–õ–°–Ø –ö–†–ê–®

### –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å PM2 status
ssh root@207.154.231.30 'pm2 status'

# 2. –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏
ssh root@207.154.231.30 'pm2 logs onai-backend --lines 50'

# 3. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ dist/ –Ω–µ –≤–µ—Ä–Ω—É–ª—Å—è
ssh root@207.154.231.30 'ls -la /var/www/onai-integrator-login-main/backend/ | grep dist'
```

### –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PM2
ssh root@207.154.231.30 'pm2 stop onai-backend && pm2 delete onai-backend'

# 2. –£–¥–∞–ª–∏—Ç—å dist/
ssh root@207.154.231.30 'cd /var/www/onai-integrator-login-main/backend && rm -rf dist/'

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
ssh root@207.154.231.30 'cd /var/www/onai-integrator-login-main/backend && pm2 start ecosystem.config.js'
```

---

## üìû –ö–û–ù–¢–ê–ö–¢–´ / –ü–û–ú–û–©–¨

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [–ü–æ–ª–Ω—ã–π Postmortem](./POSTMORTEM_BACKEND_CRASH_2025-12-22.md)
- [–°—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è](./–°–†–û–ß–ù–´–ï_–£–õ–£–ß–®–ï–ù–ò–Ø_–ü–û–°–õ–ï_–ö–†–ê–®–ê.md)
- [–ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞](./–ò–ù–¶–ò–î–ï–ù–¢_–ö–†–ê–¢–ö–ê–Ø_–°–í–û–î–ö–ê.md)

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- UptimeRobot: https://uptimerobot.com
- Sentry: https://sentry.io
- Better Uptime: https://betteruptime.com

**PM2 Docs:**
- https://pm2.keymetrics.io/docs/usage/process-management/

---

## üéØ ACTION PLAN (TL;DR)

```bash
# 1. –ü–†–Ø–ú–û –°–ï–ô–ß–ê–° (30 –º–∏–Ω)
open https://uptimerobot.com  # –ù–∞—Å—Ç—Ä–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

# 2. –ü–û–¢–û–ú (5 –º–∏–Ω)
./–ë–´–°–¢–†–´–ï_–ö–û–ú–ê–ù–î–´_–ó–ê–©–ò–¢–ê.sh  # –ò—Å–ø—Ä–∞–≤—å PM2 + –æ—á–∏—Å—Ç–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

# 3. –°–ï–ì–û–î–ù–Ø (10 –º–∏–Ω)
# –í–∫–ª—é—á–∏ Sentry

# 4. –≠–¢–ê –ù–ï–î–ï–õ–Ø (7 —á–∞—Å–æ–≤)
# Rollback + CI/CD + Smoke tests

# ‚úÖ DONE!
```

---

## üí∞ –°–¢–û–ò–ú–û–°–¢–¨ vs –¶–ï–ù–ù–û–°–¢–¨

**–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞—â–∏—Ç—ã:**
- UptimeRobot: $0 (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- Sentry: $0 (5k events/–º–µ—Å—è—Ü)
- GitHub Actions: $0 (2000 –º–∏–Ω—É—Ç/–º–µ—Å—è—Ü)
- **–ò–¢–û–ì–û: $0-10/–º–µ—Å—è—Ü**

**–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ—Å—Ç–æ—è:**
- –ü–æ—Ç–µ—Ä—è —Ä–µ–ø—É—Ç–∞—Ü–∏–∏: ???
- –ü–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã: ???
- –í—Ä–µ–º—è –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: 3 —á–∞—Å–∞
- **–ò–¢–û–ì–û: >> $10/–º–µ—Å—è—Ü**

**ROI –∑–∞—â–∏—Ç—ã: ‚àû** üìà

---

## ‚è∞ –í–†–ï–ú–Ø –î–ï–ô–°–¢–í–û–í–ê–¢–¨

–°–ª–µ–¥—É—é—â–∏–π –∫—Ä–∞—à –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è –ó–ê–í–¢–†–ê.  
–ë—É–¥—å –≥–æ—Ç–æ–≤! üõ°Ô∏è

**–ù–∞—á–Ω–∏ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ - —ç—Ç–æ –∑–∞–π–º—ë—Ç 30 –º–∏–Ω—É—Ç.**

---

**Last Updated:** 2025-12-22 16:00 Almaty  
**Status:** DOCUMENTATION COMPLETE ‚úÖ  
**Next Review:** –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è P0 —É–ª—É—á—à–µ–Ω–∏–π
