# üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –ó–ê–í–ï–†–®–ï–ù–ò–Ø TRAFFIC DASHBOARD

## üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

### ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:
1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `FACEBOOK_ADS_TOKEN` –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
2. –°–æ–∑–¥–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º –∑–∞—â–∏—Ç—ã –∫–ª—é—á–µ–π –æ—Ç —Å–ª–µ—Ç–∞ (`deploy-with-env-protection.sh`)
3. –°–æ–±—Ä–∞–Ω –Ω–æ–≤—ã–π build
4. –ó–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
5. Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã:

**1. Build ID –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π: `20251223-2035-FULL-DEPLOY`**
- –ü—Ä–∏—á–∏–Ω–∞: –ö–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (localStorage)
- –§–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–Ω–æ–≤—ã–π timestamp: 1764667500)
- **–†–µ—à–µ–Ω–∏–µ:** –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Application ‚Üí Local Storage ‚Üí —É–¥–∞–ª–∏—Ç—å `app_build_id`)

**2. –ö–ª—é—á–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç placeholder –∑–Ω–∞—á–µ–Ω–∏—è**
- –ü—Ä–∏—á–∏–Ω–∞: .env —Ñ–∞–π–ª –Ω–µ –±—ã–ª –æ–±–Ω–æ–≤–ª–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–ª—é—á–∏:
  - `OPENAI_API_KEY=sk-placeholder`
  - `SUPABASE_URL=https://placeholder.supabase.co`
  - `FACEBOOK_APP_SECRET=placeholder`
  - –ò –¥—Ä—É–≥–∏–µ...
- **–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç `scripts/fix-production-env.sh`

**3. –û—à–∏–±–∫–∏ –≤ backend –ª–æ–≥–∞—Ö:**
- `TypeError: fetch failed` –≤ reminderScheduler (—Å—Ç–∞—Ä–∞—è –ø—Ä–æ–±–ª–µ–º–∞)
- Facebook token validation error (–∏–∑-–∑–∞ placeholder)
- Supabase connection error (–∏–∑-–∑–∞ placeholder URL)

---

## üõ†Ô∏è –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å .env –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
```bash
cd /Users/miso/onai-integrator-login
./scripts/fix-production-env.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
- –ó–∞–º–µ–Ω—è–µ—Ç placeholder –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ .env
- –°–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–≥–æ .env
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç backend
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å backend

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–ª—é—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
```bash
ssh root@207.154.231.30 "pm2 logs onai-backend --lines 50 | grep -E '(OPENAI|Facebook|Supabase|token|API key)'"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ `OPENAI_API_KEY` –∑–∞–≥—Ä—É–∂–µ–Ω (–Ω–µ placeholder)
- ‚úÖ `Facebook` —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π
- ‚úÖ `Supabase` –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ

### –®–∞–≥ 3: –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞
1. –û—Ç–∫—Ä—ã—Ç—å https://traffic.onai.academy/traffic/admin/team-constructor
2. –ù–∞–∂–∞—Ç—å F12 ‚Üí Application ‚Üí Local Storage
3. –ù–∞–π—Ç–∏ –∏ —É–¥–∞–ª–∏—Ç—å `app_build_id`
4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)

### –®–∞–≥ 4: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Team Constructor
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω (–∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –≤ Traffic Dashboard)
TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω_–∏–∑_localStorage"

# –¢–µ—Å—Ç GET teams
curl -X GET https://traffic.onai.academy/api/traffic-constructor/teams \
  -H "Authorization: Bearer $TOKEN"

# –¢–µ—Å—Ç POST team
curl -X POST https://traffic.onai.academy/api/traffic-constructor/teams \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test Team",
    "direction": "flagman",
    "color": "#00FF88",
    "emoji": "üìà"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- GET: 200 OK —Å –º–∞—Å—Å–∏–≤–æ–º –∫–æ–º–∞–Ω–¥
- POST: 201 Created —Å ID –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã

### –®–∞–≥ 5: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
curl -X POST https://traffic.onai.academy/api/traffic-constructor/users \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "fullName": "Test User",
    "team": "Test Team",
    "password": "test123",
    "role": "targetologist",
    "sendEmail": false
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- 201 Created —Å ID –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

---

## üé® –ë–£–î–£–©–ò–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
1. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–¥–Ω–æ –æ–∫–Ω–æ
2. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –£–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
1. –ò–∑–º–µ–Ω–∏—Ç—å `TrafficTeamConstructor.tsx`
2. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å state –¥–ª—è –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –°–æ–∑–¥–∞—Ç—å –æ–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ñ–æ—Ä–º—ã
4. –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏—é "–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–º–µ—Å—Ç–µ —Å –∫–æ–º–∞–Ω–¥–æ–π"
5. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é

---

## üìã CHECKLIST –î–õ–Ø –ó–ê–í–ï–†–®–ï–ù–ò–Ø

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å .env –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (–®–∞–≥ 1)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–ª—é—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (–®–∞–≥ 2)
- [ ] –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (–®–∞–≥ 3)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Team Constructor (–®–∞–≥ 4)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–®–∞–≥ 5)

### –£–ª—É—á—à–µ–Ω–∏—è UI:
- [ ] –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã
- [ ] –£–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–ª—é—á–∏ –Ω–µ —Å–ª–µ—Ç–∞—é—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Facebook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ AmoCRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîß –ò–ù–°–¢–†–£–ö–¶–ò–ò

### –î–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è .env:
```bash
./scripts/fix-production-env.sh
```

### –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª—é—á–µ–π:
```bash
ssh root@207.154.231.30 "pm2 logs onai-backend --lines 50"
```

### –î–ª—è –¥–µ–ø–ª–æ—è —Å –∑–∞—â–∏—Ç–æ–π –∫–ª—é—á–µ–π:
```bash
./scripts/deploy-with-env-protection.sh
```

### –î–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞:
1. F12 ‚Üí Application ‚Üí Local Storage
2. –£–¥–∞–ª–∏—Ç—å `app_build_id`
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å (F5)

---

## üìù –ó–ê–ú–ï–¢–ö–ò

### –ó–∞—â–∏—Ç–∞ –∫–ª—é—á–µ–π:
- –°–∫—Ä–∏–ø—Ç `deploy-with-env-protection.sh` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ –∫–ª—é—á–∏ –Ω–µ —Å–ª–µ—Ç–∞—é—Ç
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è
- –ë—ç–∫–∞–ø—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `/var/www/backups/onai-integrator-login/`

### Build ID:
- Build ID –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ
- –ï—Å–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π ID - —ç—Ç–æ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞
- –û—á–∏—Å—Ç–∏—Ç—å localStorage –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### Backend:
- Backend —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- –ö–ª—é—á–∏ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å (—Å–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤)
- –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π –≤—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∑–∞—Ä–∞–±–æ—Ç–∞—é—Ç

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ **–í—ã–ø–æ–ª–Ω–∏—Ç—å:** –ó–∞–ø—É—Å—Ç–∏—Ç—å `scripts/fix-production-env.sh`
2. ‚è≥ **–í—ã–ø–æ–ª–Ω–∏—Ç—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend
3. ‚è≥ **–í—ã–ø–æ–ª–Ω–∏—Ç—å:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Team Constructor
4. ‚è≥ **–í—ã–ø–æ–ª–Ω–∏—Ç—å:** –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞
5. ‚è≥ **–í—ã–ø–æ–ª–Ω–∏—Ç—å:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
6. ‚è≥ **–í—ã–ø–æ–ª–Ω–∏—Ç—å:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
7. ‚è≥ **–í—ã–ø–æ–ª–Ω–∏—Ç—å:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
8. ‚è≥ **–í—ã–ø–æ–ª–Ω–∏—Ç—å:** –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-28  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô
