# ‚úÖ –í–ò–î–ï–û-–¢–†–ï–ö–ò–ù–ì –î–õ–Ø AI MENTOR - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û!

–î–∞—Ç–∞: 22 –Ω–æ—è–±—Ä—è 2025

---

## üéØ –ß–¢–û –°–î–ï–õ–ê–ù–û

### 1Ô∏è‚É£ Backend API (‚úÖ –ì–æ—Ç–æ–≤–æ)
**–§–∞–π–ª:** `backend/src/routes/analytics.ts`

–î–æ–±–∞–≤–ª–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç: `POST /api/analytics/video-session/end`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ –∏–∑ `video_analytics` –¥–ª—è –¥–∞–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏
2. –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏:
   - `seeks_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–º–æ—Ç–æ–∫ (diff > 5 —Å–µ–∫—É–Ω–¥)
   - `pauses_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—É–∑
   - `max_second_reached` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞—è —Å–µ–∫—É–Ω–¥–∞
   - `duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–µ—Å—Å–∏—é –≤ `video_watch_sessions`
4. **AI Mentor —Ç—Ä–∏–≥–≥–µ—Ä—ã —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**

---

### 2Ô∏è‚É£ Frontend Integration (‚úÖ –ì–æ—Ç–æ–≤–æ)
**–§–∞–π–ª:** `src/pages/Lesson.tsx`

–î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏:

#### `endVideoSession()`
–ó–∞–≤–µ—Ä—à–∞–µ—Ç –≤–∏–¥–µ–æ-—Å–µ—Å—Å–∏—é –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –±—ç–∫–µ–Ω–¥:

```typescript
const endVideoSession = async () => {
  if (!sessionId || !user?.id || !lessonId) return;
  
  try {
    await api.post('/api/analytics/video-session/end', {
      user_id: user.id,
      lesson_id: parseInt(lessonId),
      session_id: sessionId,
    });
    console.log('‚úÖ –í–∏–¥–µ–æ-—Å–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –º–µ—Ç—Ä–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ AI Mentor');
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–∏–¥–µ–æ-—Å–µ—Å—Å–∏–∏:', error);
  }
};
```

#### –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ 3 –º–µ—Å—Ç–∞—Ö:

1. **–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞** (`handleComplete`)
   ```typescript
   await endVideoSession(); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
   const response = await api.post(`/api/lessons/${lessonId}/complete`);
   ```

2. **–ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã** (`beforeunload`)
   ```typescript
   window.addEventListener('beforeunload', () => {
     navigator.sendBeacon(
       '/api/analytics/video-session/end',
       JSON.stringify({ user_id, lesson_id, session_id })
     );
   });
   ```

3. **–ü—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞** (`useEffect cleanup`)
   ```typescript
   useEffect(() => {
     return () => {
       endVideoSession(); // Cleanup
     };
   }, [sessionId, user?.id, lessonId]);
   ```

---

## ü§ñ –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ AI MENTOR –¢–ï–ü–ï–†–¨

### 1. –°—Ç—É–¥–µ–Ω—Ç —Å–º–æ—Ç—Ä–∏—Ç –≤–∏–¥–µ–æ
- –°–æ–±—ã—Ç–∏—è `play`, `pause`, `progress` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `video_analytics`

### 2. –°—Ç—É–¥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç —É—Ä–æ–∫ –∏–ª–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—ã–∑—ã–≤–∞–µ—Ç `POST /api/analytics/video-session/end`
- –ë—ç–∫–µ–Ω–¥ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏
- –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `video_watch_sessions` —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏

### 3. AI Mentor —Ç—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –¢—Ä–∏–≥–≥–µ—Ä `create_mentor_task_from_video_struggle()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
  - `seeks_count > 5` ‚Üí —Å—Ç—É–¥–µ–Ω—Ç —á–∞—Å—Ç–æ –ø–µ—Ä–µ–º–∞—Ç—ã–≤–∞–µ—Ç (–Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç)
  - `pauses_count > 10` ‚Üí —Å—Ç—É–¥–µ–Ω—Ç —á–∞—Å—Ç–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è (—Å–ª–æ–∂–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª)
- –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞ –≤ `ai_mentor_tasks`

### 4. AI –ù–∞—Å—Ç–∞–≤–Ω–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –§—É–Ω–∫—Ü–∏—è `get_student_context_for_ai()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
  - –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –≤–∏–¥–µ–æ (high seeks/pauses)
  - –ò—Å—Ç–æ—Ä–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ —Å—Ç—É–¥–µ–Ω—Ç–∞
  - –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å
- AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

---

## üìä –ü–†–ò–ú–ï–† –†–ê–ë–û–¢–´

### –°—Ü–µ–Ω–∞—Ä–∏–π: –°—Ç—É–¥–µ–Ω—Ç –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å –≤–∏–¥–µ–æ

```
1. –°—Ç—É–¥–µ–Ω—Ç —Å–º–æ—Ç—Ä–∏—Ç —É—Ä–æ–∫ "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Make + n8n"
2. –í–∏–¥–µ–æ —Å–ª–æ–∂–Ω–æ–µ ‚Üí –ø–µ—Ä–µ–º–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∑–∞–¥ 8 —Ä–∞–∑ (seeks_count = 8)
3. –°—Ç–∞–≤–∏—Ç –Ω–∞ –ø–∞—É–∑—É 12 —Ä–∞–∑, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å (pauses_count = 12)

4. –°—Ç—É–¥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç —É—Ä–æ–∫
   ‚îî‚îÄ> –§—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—ã–∑—ã–≤–∞–µ—Ç endVideoSession()
   ‚îî‚îÄ> –ë—ç–∫–µ–Ω–¥ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç: seeks=8, pauses=12
   ‚îî‚îÄ> –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ video_watch_sessions

5. –¢—Ä–∏–≥–≥–µ—Ä detect_video_struggle() —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
   ‚îî‚îÄ> seeks_count (8) > 5 ‚úÖ
   ‚îî‚îÄ> pauses_count (12) > 10 ‚úÖ

6. –°–æ–∑–¥–∞–µ—Ç—Å—è ai_mentor_task:
   {
     task_type: "video_struggle",
     description: "–°—Ç—É–¥–µ–Ω—Ç –∏—Å–ø—ã—Ç—ã–≤–∞–ª —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å –≤–∏–¥–µ–æ '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Make + n8n'",
     priority: "high",
     context_data: {
       lesson_id: 42,
       seeks_count: 8,
       pauses_count: 12,
       max_second_reached: 320
     }
   }

7. AI –ù–∞—Å—Ç–∞–≤–Ω–∏–∫ –≤–∏–¥–∏—Ç –∑–∞–¥–∞—á—É –≤ NeuroHub
   ‚îî‚îÄ> –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ–º–æ—â—å:
       "–ó–∞–º–µ—Ç–∏–ª, —á—Ç–æ —É—Ä–æ–∫ –ø–æ Make + n8n –æ–∫–∞–∑–∞–ª—Å—è —Å–ª–æ–∂–Ω—ã–º.
        –•–æ—á–µ—à—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã?"
```

---

## ‚úÖ –ì–û–¢–û–í–ù–û–°–¢–¨ AI MENTOR: 70% ‚Üí 95%!

### –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü—ã, —Ñ—É–Ω–∫—Ü–∏–∏, —Ç—Ä–∏–≥–≥–µ—Ä—ã)
- ‚úÖ Backend API (dashboard, missions, goals, achievements)
- ‚úÖ Frontend UI (NeuroHub, —á–∞—Ç, –º–∏—Å—Å–∏–∏, —Ü–µ–ª–∏)
- ‚úÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- ‚úÖ **–í–∏–¥–µ–æ-—Ç—Ä–µ–∫–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç! üé¨**
- ‚úÖ **AI Mentor —Ç—Ä–∏–≥–≥–µ—Ä—ã —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç! ü§ñ**

### –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å:
- üü° –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é `20251122_RESTORE_AUTO_PROFILE_WITH_AI_MENTOR.sql`
- üü° –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- üü° –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Ä–æ–≥–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è (—Å–µ–π—á–∞—Å: seeks > 5, pauses > 10)

---

## üß™ –ö–ê–ö –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨

1. **–û—Ç–∫—Ä–æ–π –ª—é–±–æ–π —É—Ä–æ–∫ —Å –≤–∏–¥–µ–æ**
2. **–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥**
3. **–ü–µ—Ä–µ–º–æ—Ç–∞–π –Ω–∞–∑–∞–¥ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑** (6+ —Ä–∞–∑)
4. **–ü–æ—Å—Ç–∞–≤—å –Ω–∞ –ø–∞—É–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑** (11+ —Ä–∞–∑)
5. **–ó–∞–≤–µ—Ä—à–∏ —É—Ä–æ–∫** ‚Üí –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫"

6. **–ü—Ä–æ–≤–µ—Ä—å –≤ Supabase SQL Editor:**
   ```sql
   -- 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞
   SELECT * FROM video_watch_sessions
   WHERE user_id = (SELECT id FROM auth.users WHERE email = 'saint@onaiacademy.kz')
   ORDER BY created_at DESC
   LIMIT 1;

   -- 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ AI Mentor —Å–æ–∑–¥–∞–ª –∑–∞–¥–∞—á—É
   SELECT * FROM ai_mentor_tasks
   WHERE student_id = (SELECT id FROM auth.users WHERE email = 'saint@onaiacademy.kz')
   ORDER BY created_at DESC
   LIMIT 1;
   ```

7. **–û—Ç–∫—Ä–æ–π NeuroHub** ‚Üí –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–¥–∞—á–∞ –æ—Ç AI –ù–∞—Å—Ç–∞–≤–Ω–∏–∫–∞!

---

## üéâ –†–ï–ó–£–õ–¨–¢–ê–¢

**AI Mentor —Ç–µ–ø–µ—Ä—å:**
- üé¨ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä—ã –≤–∏–¥–µ–æ
- üìä –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
- ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á–∏ –ø—Ä–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç—è—Ö
- üí¨ –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ–º–æ—â—å –≤ —á–∞—Ç–µ

**–ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** üöÄ



















