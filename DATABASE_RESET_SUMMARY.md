# ‚úÖ SUPABASE DATABASE RESET SYSTEM - –ì–û–¢–û–í–û!

---

## üì¶ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´

### 1. Scripts –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î:

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `scripts/backup-schema.ts` | –°–æ–∑–¥–∞—ë—Ç JSON –∏ SQL backup –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î |
| `scripts/reset-database.ts` | –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç –ë–î —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º |

### 2. SQL –ú–∏–≥—Ä–∞—Ü–∏–∏:

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `supabase/migrations/0001_init.sql` | –ù–∞—á–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å –Ω—É–ª—è) |
| `supabase/migrations/0001_init_FIXED.sql` | ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫) |

### 3. –£—Ç–∏–ª–∏—Ç—ã:

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `check-current-schema.sql` | SQL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î |
| `DATABASE_RESET_GUIDE.md` | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é |
| `DATABASE_RESET_SUMMARY.md` | –≠—Ç–æ—Ç —Ñ–∞–π–ª (–∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞) |

### 4. –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

| –§–∞–π–ª | –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ |
|------|---------------|
| `package.json` | –ù–æ–≤—ã–µ npm scripts: `db:backup`, `db:reset`, `db:reset:confirm`, `db:reset:full` |
| `package.json` | –ù–æ–≤—ã–µ devDependencies: `ts-node`, `dotenv` |

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

```bash
# 1. –°–æ–∑–¥–∞—Ç—å backup
npm run db:backup

# 2. –û—á–∏—Å—Ç–∏—Ç—å –ë–î (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
npm run db:reset:confirm

# 3. –û—á–∏—Å—Ç–∏—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
npm run db:reset:full
```

---

## üìã NPM SCRIPTS

```json
{
  "db:backup": "ts-node scripts/backup-schema.ts",
  "db:reset": "ts-node scripts/reset-database.ts",
  "db:reset:confirm": "ts-node scripts/reset-database.ts --confirm",
  "db:reset:full": "ts-node scripts/reset-database.ts --confirm --apply-migrations"
}
```

---

## ‚öôÔ∏è –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### .env —Ñ–∞–π–ª:

```env
VITE_SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –ù—É–∂–µ–Ω **service_role** –∫–ª—é—á, –∞ –Ω–µ anon –∫–ª—é—á!

–ì–¥–µ –≤–∑—è—Ç—å:
1. –û—Ç–∫—Ä–æ–π https://supabase.com/dashboard/project/YOUR_PROJECT/settings/api
2. –°–∫–æ–ø–∏—Ä—É–π `service_role` secret key
3. –î–æ–±–∞–≤—å –≤ `.env`

---

## üõ°Ô∏è –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

‚úÖ **–ó–∞—â–∏—Ç–∞:**
- –¢—Ä–µ–±—É–µ—Ç—Å—è —Ñ–ª–∞–≥ `--confirm` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup –ø–µ—Ä–µ–¥ reset
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å service_role –∫–ª—é—á–æ–º

‚ùå **–ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ—Ç—Å—è:**
- –ù–µ —É–¥–∞–ª—è—é—Ç—Å—è Auth –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –ù–µ —É–¥–∞–ª—è—é—Ç—Å—è Edge Functions
- –ù–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
- Storage buckets —Ç–æ–ª—å–∫–æ –æ—á–∏—â–∞—é—Ç—Å—è (–Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è)

---

## üìä –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨

### Backup Script (`scripts/backup-schema.ts`):

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç:
- ‚úÖ –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã + —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–ª–æ–Ω–æ–∫
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã
- ‚úÖ Storage buckets –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- `backups/schema-backup-YYYY-MM-DD.json` (JSON dump)
- `backups/schema-backup-YYYY-MM-DD.sql` (SQL –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è)

### Reset Script (`scripts/reset-database.ts`):

–£–¥–∞–ª—è–µ—Ç:
- üóëÔ∏è –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã (—Å CASCADE)
- üóëÔ∏è –í—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
- üóëÔ∏è –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
- üóëÔ∏è –í—Å–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- üóëÔ∏è –í—Å–µ —Ñ–∞–π–ª—ã –∏–∑ Storage buckets
- üóëÔ∏è –¢–∞–±–ª–∏—Ü—É –º–∏–≥—Ä–∞—Ü–∏–π

–û–ø—Ü–∏–∏:
- `--confirm` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
- `--apply-migrations` - –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏

---

## üéØ –ü–†–ò–ú–ï–ù–Å–ù–ù–ê–Ø –ú–ò–ì–†–ê–¶–ò–Ø

–§–∞–π–ª: `supabase/migrations/0001_init_FIXED.sql`

**–ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ë–î:**

### USERS:
- ‚úÖ `updated_at` (TIMESTAMPTZ)

### COURSES:
- ‚úÖ `cover_image` (TEXT)
- ‚úÖ `total_xp` (INTEGER)

### MODULES:
- ‚úÖ `updated_at` (TIMESTAMPTZ)

### LESSONS:
- ‚úÖ `xp_reward` (INTEGER DEFAULT 10)
- ‚úÖ `updated_at` (TIMESTAMPTZ)

### STUDENT_PROGRESS:
- ‚úÖ `xp_earned` (INTEGER DEFAULT 0)
- ‚úÖ `completion_percentage` (INTEGER DEFAULT 0)

### ACHIEVEMENTS:
- ‚úÖ `created_at` (TIMESTAMPTZ)

### USER_ACHIEVEMENTS:
- ‚úÖ `unlocked_at` (TIMESTAMPTZ)

### INDEXES:
- ‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ Foreign key –∏–Ω–¥–µ–∫—Å—ã

### TRIGGERS:
- ‚úÖ Auto-update `updated_at` –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `update_updated_at_column()`

### SEED DATA:
- ‚úÖ 5 –±–∞–∑–æ–≤—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π (–µ—Å–ª–∏ –∏—Ö –µ—â—ë –Ω–µ—Ç)

---

## üìñ –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `DATABASE_RESET_GUIDE.md`

–°–æ–¥–µ—Ä–∂–∏—Ç:
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- Troubleshooting
- Best practices
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ backup —Ñ–∞–π–ª–æ–≤

---

## ‚úÖ –°–¢–ê–¢–£–°

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å |
|--------|--------|
| Backup script | ‚úÖ –°–æ–∑–¥–∞–Ω |
| Reset script | ‚úÖ –°–æ–∑–¥–∞–Ω |
| –ù–∞—á–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è | ‚úÖ –°–æ–∑–¥–∞–Ω–∞ |
| –§–∏–∫—Å-–º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î | ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ |
| NPM scripts | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã |
| Dependencies | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚úÖ –ì–æ—Ç–æ–≤–∞ |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ |

---

## üéâ –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ!

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ.

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. **–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   ```bash
   npm run db:backup
   ```

2. **–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ (development only!):**
   ```bash
   npm run db:reset:full
   ```

3. **–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π:**
   ```bash
   npx supabase db push
   ```

---

**üí° –í–ê–ñ–ù–û:** –ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ —Å–∫—Ä–∏–ø—Ç—ã —Ç–æ–ª—å–∫–æ –Ω–∞ **development** –æ–∫—Ä—É–∂–µ–Ω–∏–∏!

–î–ª—è **production** –ë–î –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã Supabase:
- Supabase Dashboard ‚Üí Database ‚Üí Migrations
- `npx supabase db push` (–¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π)
- Point-in-time recovery (–¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 18 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

