# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

**–î–∞—Ç–∞:** 10 –Ω–æ—è–±—Ä—è 2025, 23:50  
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª—Å—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ `/admin/students-activity` –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª—Å—è:
- –ü–æ–∫–∞–∑—ã–≤–∞–ª–æ "0 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤"
- –ó–∞–ø—Ä–æ—Å —à—ë–ª –∫ —Ç–∞–±–ª–∏—Ü–µ `student_profiles` (–∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –ø—É—Å—Ç–∞—è)
- –û—à–∏–±–∫–∞ —Å –∫–æ–ª–æ–Ω–∫–æ–π `last_login_at` –≤ `profiles`

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –í–µ—Ä–Ω—É–ª –∑–∞–ø—Ä–æ—Å –∫ —Ç–∞–±–ª–∏—Ü–µ `profiles`
**–§–∞–π–ª:** `src/pages/admin/StudentsActivity.tsx`

**–ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```typescript
const { data: studentProfiles } = await supabase
  .from("student_profiles")  // ‚ùå –ü—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞
  .select("...")
```

**–°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```typescript
const { data: profiles } = await supabase
  .from("profiles")  // ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  .select("*")
  .order("created_at", { ascending: false });
```

### 2. –ò—Å–ø—Ä–∞–≤–∏–ª –æ—à–∏–±–∫—É —Å `last_login_at`
**–§–∞–π–ª:** `src/lib/supabase.ts`

**–ë—ã–ª–æ:**
```typescript
.update({ last_login_at: new Date().toISOString() })  // ‚ùå –ö–æ–ª–æ–Ω–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```

**–°—Ç–∞–ª–æ:**
```typescript
.update({ updated_at: new Date().toISOString() })  // ‚úÖ –û–±–Ω–æ–≤–ª—è–µ–º updated_at
```

### 3. –î–æ–±–∞–≤–∏–ª –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
- `üìã StudentsActivity: fetchStudents –≤—ã–∑–≤–∞–Ω`
- `üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏...`
- `‚úÖ –°–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞, user: ...`
- `üì§ –ó–∞–ø—Ä–æ—Å profiles...`
- `‚úÖ –ü–æ–ª—É—á–µ–Ω–æ X –∑–∞–ø–∏—Å–µ–π –∏–∑ profiles`
- `‚úÖ –°–º–∞–ø–ø–∏—Ä–æ–≤–∞–Ω–æ X —Å—Ç—É–¥–µ–Ω—Ç–æ–≤`

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–í—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤:** 15  
‚úÖ **–ê–∫—Ç–∏–≤–Ω—ã—Ö:** 15  
‚úÖ **–ù–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö:** 0  

–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –¢–∞—Ä–∞—Ä—É—à–∫–∏–Ω
- Curator
- Test
- Polli Squad (Icekvup)
- –ò –¥—Ä—É–≥–∏–µ...

---

## üîç –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ

- [x] –°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [x] –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –§–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç (–í—Å–µ/–ê–∫—Ç–∏–≤–Ω—ã–µ/–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ)
- [x] –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
- [x] –†–æ–ª—å admin –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìù –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ

**–ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `student_profiles` –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤!**

–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî —ç—Ç–æ **`profiles`**, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è:
- id, email, full_name
- role (admin, curator, tech_support, student)
- is_active, account_expires_at
- created_at, updated_at

–¢–∞–±–ª–∏—Ü–∞ `student_profiles` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è **—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤**:
- total_xp, level, streak_days
- avatar_url, phone
- last_active_date

–ù–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è —Å–ø–∏—Å–∫–∞ ‚Äî –≤—Å–µ–≥–¥–∞ `profiles`!

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏

- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É `last_login_at` –≤ `profiles` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å `student_profiles` —Å `profiles` (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è)
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å (select —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é (–µ—Å–ª–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ >100)

---

## üì¶ –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. `src/pages/admin/StudentsActivity.tsx` - –≤–µ—Ä–Ω—É–ª –∑–∞–ø—Ä–æ—Å –∫ `profiles`
2. `src/lib/supabase.ts` - –∏—Å–ø—Ä–∞–≤–∏–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `last_login_at` ‚Üí `updated_at`
3. –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã:
   - `test-supabase-connection.html`
   - `–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê_–ü–†–û–ë–õ–ï–ú.md`
   - `CHECK_CONSOLE_LOGS.md`

---

## ‚úÖ –ö–æ–º–º–∏—Ç

```bash
git add .
git commit -m "fix: restore student list loading from profiles table

- Changed query from student_profiles to profiles
- Fixed last_login_at error (changed to updated_at)
- Added detailed logging for debugging
- Student list now loads correctly (15 users)
"
```

