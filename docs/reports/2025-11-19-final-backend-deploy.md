# üöÄ –§–ò–ù–ê–õ–¨–ù–´–ô –î–ï–ü–õ–û–ô BACKEND –ù–ê PRODUCTION

**–î–∞—Ç–∞:** 2025-11-19  
**–í—Ä–µ–º—è:** 04:36  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–Å–ù

---

## üìã –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –®–ê–ì–ò

### ‚úÖ –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ .env —Ñ–∞–π–ª–∞
- ‚úÖ .env —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω
- ‚úÖ OPENAI_API_KEY –Ω–∞–π–¥–µ–Ω (164 —Å–∏–º–≤–æ–ª–∞)
- ‚úÖ –ü–µ—Ä–≤—ã–µ 20 —Å–∏–º–≤–æ–ª–æ–≤: `sk-proj-5PKzbDZNCeyz...`

### ‚úÖ –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ (Git Pull)
- ‚úÖ Git stash –≤—ã–ø–æ–ª–Ω–µ–Ω
- ‚úÖ Git pull origin main –≤—ã–ø–æ–ª–Ω–µ–Ω
- ‚úÖ –ö–æ–¥ –∞–∫—Ç—É–∞–ª–µ–Ω (Already up to date)

### ‚úÖ –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ npm install --production –≤—ã–ø–æ–ª–Ω–µ–Ω
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ Node.js –≤–µ—Ä—Å–∏–∏ (v18.20.8, —Ç—Ä–µ–±—É–µ—Ç—Å—è >=20.0.0)
- ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (180 packages)

### ‚ö†Ô∏è –®–∞–≥ 4: –°–±–æ—Ä–∫–∞ TypeScript
- ‚ö†Ô∏è `tsc: not found` - TypeScript –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Å–±–æ—Ä–∫–∏
- ‚úÖ –ü—Ä–æ–µ–∫—Ç —Å–æ–±—Ä–∞–Ω (dist/ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

### ‚úÖ –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ PM2 –ø—Ä–æ—Ü–µ—Å—Å–∞
- ‚ÑπÔ∏è –ü—Ä–æ—Ü–µ—Å—Å onai-backend –Ω–µ –Ω–∞–π–¥–µ–Ω (–±—ã–ª —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π)

### ‚úÖ –®–∞–≥ 6: –ó–∞–ø—É—Å–∫ PM2
- ‚úÖ PM2 –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `pm2 start dist/server.js --name onai-backend`
- ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å online

### ‚úÖ –®–∞–≥ 7: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ PM2 –∫–æ–Ω—Ñ–∏–≥–∞
- ‚úÖ PM2 save –≤—ã–ø–æ–ª–Ω–µ–Ω
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ `/root/.pm2/dump.pm2`

### ‚úÖ –®–∞–≥ 8-9: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ PM2 –ø—Ä–æ—Ü–µ—Å—Å online
- ‚úÖ PID: 75141
- ‚úÖ Memory: 80.8mb
- ‚úÖ Uptime: 6s

### ‚ö†Ô∏è –®–∞–≥ 10: –õ–æ–≥–∏
- ‚ö†Ô∏è –û—à–∏–±–∫–∞: "Missing OPENAI_API_KEY environment variable"
- ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: PM2 –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç .env –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ Backend –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:3000
- ‚úÖ Supabase –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- ‚úÖ OpenAI –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

### ‚úÖ –®–∞–≥ 11: Health Endpoint
- ‚úÖ http://localhost:3000/api/health –æ—Ç–≤–µ—á–∞–µ—Ç
- ‚úÖ Response: `{"status":"ok","timestamp":"2025-11-19T04:36:48.163Z"}`

### ‚úÖ –®–∞–≥ 12: Debug/Env Endpoint
- ‚úÖ http://localhost:3000/api/debug/env –æ—Ç–≤–µ—á–∞–µ—Ç
- ‚úÖ OPENAI_API_KEY: SET
- ‚úÖ OPENAI_API_KEY_FIRST_20: sk-proj-5PKzbDZNCeyz
- ‚úÖ OPENAI_API_KEY_LENGTH: 164

### ‚úÖ –®–∞–≥ 13: Production API
- ‚úÖ https://api.onai.academy/api/health –æ—Ç–≤–µ—á–∞–µ—Ç
- ‚úÖ Response: `{"status":"ok","timestamp":"2025-11-19T04:36:48.323Z"}`

---

## üìä –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°

### PM2 Status:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id ‚îÇ name            ‚îÇ namespace   ‚îÇ version ‚îÇ mode    ‚îÇ pid      ‚îÇ uptime ‚îÇ ‚Ü∫    ‚îÇ status    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 0  ‚îÇ onai-backend    ‚îÇ default     ‚îÇ 1.0.0   ‚îÇ fork    ‚îÇ 75141    ‚îÇ 6s     ‚îÇ 0    ‚îÇ online    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### API Endpoints:
- ‚úÖ **Health:** https://api.onai.academy/api/health ‚Üí 200 OK
- ‚úÖ **Debug/Env:** https://api.onai.academy/api/debug/env ‚Üí 200 OK

### Environment Variables:
- ‚úÖ OPENAI_API_KEY: –ó–∞–≥—Ä—É–∂–µ–Ω (164 —Å–∏–º–≤–æ–ª–∞)
- ‚úÖ SUPABASE_URL: SET
- ‚úÖ SUPABASE_SERVICE_ROLE_KEY: SET (219 chars)

---

## ‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. TypeScript –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
**–ü—Ä–æ–±–ª–µ–º–∞:** `tsc: not found` –ø—Ä–∏ —Å–±–æ—Ä–∫–µ  
**–ü—Ä–∏—á–∏–Ω–∞:** Dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã  
**–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Å–±–æ—Ä–∫–∏:
```bash
npm install
npm run build
```

### 2. PM2 –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç .env –∏–∑ –∫–æ—Ä–Ω—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ª–æ–≥–∞—Ö –æ—à–∏–±–∫–∞ "Missing OPENAI_API_KEY"  
**–ü—Ä–∏—á–∏–Ω–∞:** PM2 –∏—â–µ—Ç .env –≤ dist/.env, –∞ –Ω–µ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞  
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `--update-env` –∏ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ .env –≤ –∫–æ—Ä–Ω–µ backend/

### 3. Node.js –≤–µ—Ä—Å–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞:** Node.js v18.20.8, —Ç—Ä–µ–±—É–µ—Ç—Å—è >=20.0.0 –¥–ª—è Supabase  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ä–∞–±–æ—Ç–∞–µ—Ç)

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢

- ‚úÖ Backend –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Health endpoint –æ—Ç–≤–µ—á–∞–µ—Ç
- ‚úÖ Debug endpoint –æ—Ç–≤–µ—á–∞–µ—Ç
- ‚úÖ Production API –¥–æ—Å—Ç—É–ø–µ–Ω
- ‚úÖ PM2 –∫–æ–Ω—Ñ–∏–≥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω
- ‚úÖ OPENAI_API_KEY –∑–∞–≥—Ä—É–∂–µ–Ω (164 —Å–∏–º–≤–æ–ª–∞)
- ‚úÖ Supabase –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

---

## üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Å–±–æ—Ä–∫–∏:**
   ```bash
   cd /var/www/onai-integrator-login-main/backend
   npm install
   npm run build
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É .env –≤ PM2:**
   ```bash
   pm2 restart onai-backend --update-env
   pm2 logs onai-backend --lines 20
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å Node.js –¥–æ –≤–µ—Ä—Å–∏–∏ 20+ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   ```bash
   # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å nvm –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   nvm install 20
   nvm use 20
   ```

---

## ‚úÖ –ò–¢–û–ì

**–î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!**

Backend —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ production:
- ‚úÖ PM2 –ø—Ä–æ—Ü–µ—Å—Å online
- ‚úÖ API endpoints –æ—Ç–≤–µ—á–∞—é—Ç
- ‚úÖ Environment variables –∑–∞–≥—Ä—É–∂–µ–Ω—ã
- ‚úÖ Production URL –¥–æ—Å—Ç—É–ø–µ–Ω: https://api.onai.academy

**–ù–µ–±–æ–ª—å—à–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –∏ –Ω–µ –º–µ—à–∞—é—Ç —Ä–∞–±–æ—Ç–µ.**

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-11-19  
**–í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 04:36

