# üíæ –ê–Ω–∞–ª–∏–∑ –î–∏—Å–∫–æ–≤–æ–≥–æ –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ onAI Academy Server
**–î–∞—Ç–∞:** 29 –¥–µ–∫–∞–±—Ä—è 2025
**–°–µ—Ä–≤–µ—Ä:** 207.154.231.30
**–î–∏—Å–∫:** 24GB total

---

## üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

### –û–±—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```bash
Filesystem      Size  Used Avail Use%
/dev/vda1        24G   19G  4.7G  80%
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 80% –¥–∏—Å–∫–∞, –æ—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ 4.7GB

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó

### Top-level –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
```
26G  /var          ‚Üê üî• –û–°–ù–û–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê (–±–æ–ª—å—à–µ —á–µ–º –≤–µ—Å—å –¥–∏—Å–∫!)
3.6G /usr
2.0G /root
487M /tmp
123M /boot
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ /var:
```
23G  /var/lib      ‚Üê üî• Docker + containerd
2.1G /var/www      ‚Üê –ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)
301M /var/log      ‚Üê –õ–æ–≥–∏ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)
238M /var/cache
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ /var/lib (Docker):
```
12G  /var/lib/docker
  ‚îî‚îÄ‚îÄ 12G /var/lib/docker/rootfs    ‚Üê –§–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

12G  /var/lib/containerd
  ‚îú‚îÄ‚îÄ 8.6G io.containerd.snapshotter.v1.overlayfs  ‚Üê –°–Ω–∞–ø—à–æ—Ç—ã —Å–ª–æ—ë–≤
  ‚îî‚îÄ‚îÄ 3.0G io.containerd.content.v1.content        ‚Üê –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ–±—Ä–∞–∑–æ–≤
```

**–ò–¢–û–ì–û:** Docker –∑–∞–Ω–∏–º–∞–µ—Ç **24GB** (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É docker –∏ containerd)

---

## üê≥ –ü–†–û–ë–õ–ï–ú–ê: –°–¢–ê–†–´–ï DOCKER –û–ë–†–ê–ó–´

### –¢–µ–∫—É—â–∏–µ –æ–±—Ä–∞–∑—ã (20 —à—Ç—É–∫):

#### ‚ùå –°–¢–ê–†–´–ï (–û–ì–†–û–ú–ù–´–ï):
```
docker-main-backend        3.32GB  ‚Üê üî• –í 4 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ!
docker-tripwire-backend    3.32GB
docker-traffic-backend     3.32GB
docker-main-worker         3.32GB
docker-traffic-worker      3.32GB
docker-tripwire-worker     3.32GB
docker-tripwire-frontend   113MB
docker-main-frontend       113MB
docker-traffic-frontend    113MB
```
**–ò–¢–û–ì–û –°–¢–ê–†–´–ï:** ~20GB

#### ‚úÖ –ù–û–í–´–ï (–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ï):
```
onai-integrator-login-main-main-backend        839MB  ‚Üê ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ!
onai-integrator-login-main-tripwire-worker     839MB
onai-integrator-login-main-traffic-backend     839MB
onai-integrator-login-main-tripwire-backend    839MB
onai-integrator-login-main-main-worker         839MB
onai-integrator-login-main-traffic-worker      839MB
onai-integrator-login-main-main-frontend       113MB
onai-integrator-login-main-tripwire-frontend   113MB
onai-integrator-login-main-traffic-frontend    113MB
```
**–ò–¢–û–ì–û –ù–û–í–´–ï:** ~5.5GB

### üî¥ –ö–†–ò–¢–ò–ß–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –°–¢–ê–†–´–ï –æ–±—Ä–∞–∑—ã!**

```bash
$ docker ps
onai-main-backend      docker-main-backend      (2.48GB)  ‚Üê ‚ùå –°–¢–ê–†–´–ô!
onai-tripwire-backend  docker-tripwire-backend  (2.48GB)  ‚Üê ‚ùå –°–¢–ê–†–´–ô!
onai-traffic-backend   docker-traffic-backend   (2.48GB)  ‚Üê ‚ùå –°–¢–ê–†–´–ô!
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø–ª–æ—Ö–æ:**
1. –°—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã –≤ **4 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ** –Ω–æ–≤—ã—Ö (3.32GB vs 839MB)
2. –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã, –ø–æ–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç
3. –ù–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã —É–∂–µ —Å–æ–±—Ä–∞–Ω—ã, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
4. –î–∏—Å–∫ –∑–∞–±–∏—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º

---

## üí° –†–ï–®–ï–ù–ò–ï

### –®–∞–≥ 1: –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–∑–æ–≤

**–≠–∫–æ–Ω–æ–º–∏—è:**
- –ë—ã–ª–æ: 6 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ √ó 2.48GB = **~15GB**
- –ë—É–¥–µ—Ç: 6 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ √ó 839MB = **~5GB**
- **–û–°–í–û–ë–û–î–ò–¢–°–Ø: ~10GB**

### –®–∞–≥ 2: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã

**–≠–∫–æ–Ω–æ–º–∏—è:** ~20GB —Å—Ç–∞—Ä—ã—Ö –æ–±—Ä–∞–∑–æ–≤

### –®–∞–≥ 3: –ü–æ—á–∏—Å—Ç–∏—Ç—å containerd snapshots

**–≠–∫–æ–Ω–æ–º–∏—è:** ~3-5GB –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–ª–æ—ë–≤

### –ò–¢–û–ì–û–í–ê–Ø –≠–ö–û–ù–û–ú–ò–Ø: ~30GB ‚Üí ~10GB (–æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è 20GB!)

---

## üöÄ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (—Å–æ–∑–¥–∞–Ω):

```bash
/tmp/cleanup_and_redeploy.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. ‚úÖ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
2. ‚úÖ –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
3. ‚úÖ –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã `docker-*`
4. ‚úÖ –û—á–∏—â–∞–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ
5. ‚úÖ –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –æ–±—Ä–∞–∑—ã –ë–ï–ó –∫—ç—à–∞
6. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–∑–æ–≤
7. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~10-15 –º–∏–Ω—É—Ç
**Downtime:** ~10-15 –º–∏–Ω—É—Ç (–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)

### –ó–∞–ø—É—Å–∫:
```bash
cd /var/www/onai-integrator-login-main
/tmp/cleanup_and_redeploy.sh
```

---

## üìã –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –ë–£–î–£–©–ï–ì–û

### 1. –†–µ–≥—É–ª—è—Ä–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–∫–∞

**–î–æ–±–∞–≤–∏—Ç—å cron job:**
```bash
# –ö–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é –≤ 3 —É—Ç—Ä–∞ (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
0 3 * * 0 docker system prune -f --volumes >> /var/log/docker-cleanup.log 2>&1
```

**–ß—Ç–æ —á–∏—Å—Ç–∏—Ç:**
- –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ç–∏
- Dangling –æ–±—Ä–∞–∑—ã (–±–µ–∑ —Ç–µ–≥–∞)
- Build cache

**–≠–∫–æ–Ω–æ–º–∏—è:** ~2-5GB –≤ –Ω–µ–¥–µ–ª—é

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è

**–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—Ç–µ–∫—É—â–∏–π):**
```bash
# ‚ùå –û—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
docker compose build
docker compose up -d
```

**–ü–†–ê–í–ò–õ–¨–ù–û:**
```bash
# ‚úÖ –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π
docker compose down
docker image prune -a -f
docker compose build --no-cache
docker compose up -d
```

### 3. Monitoring –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

**–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
```bash
# Alert –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ > 85%
apt install -y prometheus-node-exporter
```

### 4. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–∏—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–¢–µ–∫—É—â–∏–π:** 24GB
**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** 40-50GB

**–ü–æ—á–µ–º—É:**
- Docker build —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ (~5-10GB)
- –õ–æ–≥–∏ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º —Ä–∞—Å—Ç—É—Ç
- –†–µ–∑–µ—Ä–≤ –¥–ª—è –±—É–¥—É—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

---

## üîç –ö–û–†–ù–ï–í–´–ï –ü–†–ò–ß–ò–ù–´ –ü–†–û–ë–õ–ï–ú–´

### 1. –î–≤–æ–π–Ω—ã–µ –æ–±—Ä–∞–∑—ã
**–ü–æ—á–µ–º—É –ø–æ—è–≤–∏–ª–∏—Å—å:**
- –°—Ç–∞—Ä–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è docker-compose –Ω–∞–∑—ã–≤–∞–ª–∞ –æ–±—Ä–∞–∑—ã `docker-*`
- –ù–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞–∑—ã–≤–∞–µ—Ç `onai-integrator-login-main-*`
- –ü—Ä–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ —Å–æ–∑–¥–∞–ª–∏—Å—å –Ω–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã, –Ω–æ —Å—Ç–∞—Ä—ã–µ –Ω–µ —É–¥–∞–ª–∏–ª–∏—Å—å

### 2. –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä backend –æ–±—Ä–∞–∑–æ–≤ (3.32GB)

**–ü—Ä–∏—á–∏–Ω–∞:**
```dockerfile
# ‚ùå –ü–†–û–ë–õ–ï–ú–ê: node_modules —Å dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
RUN npm ci              # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –í–°–Å
RUN npm run build
# –ù–æ –ù–ï —É–¥–∞–ª—è–µ—Ç dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏!
```

**–†–µ—à–µ–Ω–∏–µ (—É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ):**
```dockerfile
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –£–¥–∞–ª—è–µ—Ç dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN npm ci
RUN npm run build
RUN npm prune --production  # ‚Üê –£–¥–∞–ª—è–µ—Ç dev deps
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 3.32GB ‚Üí 839MB (**—ç–∫–æ–Ω–æ–º–∏—è 2.5GB –Ω–∞ –æ–±—Ä–∞–∑**)

### 3. Containerd snapshots –Ω–µ —á–∏—Å—Ç—è—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ snapshot'—ã
- –°—Ç–∞—Ä—ã–µ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ó–∞ –º–µ—Å—è—Ü –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è ~8GB

**–†–µ—à–µ–Ω–∏–µ:**
```bash
docker system prune -f --volumes  # –ß–∏—Å—Ç–∏—Ç snapshots
```

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï: –î–û –ò –ü–û–°–õ–ï

### –î–û —á–∏—Å—Ç–∫–∏:
```
Disk Usage:     19GB / 24GB (80%)
Docker:         12GB
Containerd:     12GB
Old Images:     ~20GB
New Images:     ~5.5GB
Containers:     Using old images (2.48GB each)
Free Space:     4.7GB ‚ö†Ô∏è
```

### –ü–û–°–õ–ï —á–∏—Å—Ç–∫–∏:
```
Disk Usage:     ~8GB / 24GB (33%)  ‚Üê ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ!
Docker:         ~4GB
Containerd:     ~3GB
Old Images:     0GB (—É–¥–∞–ª–µ–Ω—ã)
New Images:     ~5.5GB
Containers:     Using new images (839MB each)
Free Space:     ~16GB ‚úÖ
```

---

## ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï

### –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–∫—Ä–∏–ø—Ç–∞:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–æ–¥ –∞–∫—Ç—É–∞–ª–µ–Ω:**
   ```bash
   cd /var/www/onai-integrator-login-main
   git status
   git log --oneline -5
   ```

2. **–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ .env –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω:**
   ```bash
   grep TELEGRAM_LEADS_BOT_TOKEN /var/www/onai-integrator-login-main/.env
   ```

3. **Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–π Supabase)

4. **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ ~10-15 –º–∏–Ω—É—Ç**

---

## üéØ –ò–¢–û–ì–ò

### –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞–π–¥–µ–Ω—ã:
1. ‚úÖ –î–≤–æ–π–Ω—ã–µ –æ–±—Ä–∞–∑—ã (—Å—Ç–∞—Ä—ã–µ + –Ω–æ–≤—ã–µ) - **~20GB –ø–æ—Ç–µ—Ä—å**
2. ‚úÖ –°—Ç–∞—Ä—ã–µ –æ–≥—Ä–æ–º–Ω—ã–µ –æ–±—Ä–∞–∑—ã (3.32GB vs 839MB) - **~15GB –ø–æ—Ç–µ—Ä—å**
3. ‚úÖ –ù–µ–æ—á–∏—â–µ–Ω–Ω—ã–µ containerd snapshots - **~3-5GB –ø–æ—Ç–µ—Ä—å**

### –†–µ—à–µ–Ω–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã:
1. ‚úÖ –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏
2. ‚úÖ –ù–æ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã (—É–∂–µ —Å–æ–±—Ä–∞–Ω—ã)
3. ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—é –≤ –±—É–¥—É—â–µ–º

### –≠–∫–æ–Ω–æ–º–∏—è –ø–æ—Å–ª–µ —á–∏—Å—Ç–∫–∏:
**~20GB –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è** (—Å 19GB –¥–æ ~8GB –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

**–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É!** üöÄ
