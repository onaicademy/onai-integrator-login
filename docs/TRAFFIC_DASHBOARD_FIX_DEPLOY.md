# üöÄ Traffic Dashboard Fix - Deployment Instructions

## üìã –ü—Ä–æ–±–ª–µ–º–∞

Traffic Dashboard –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏:
- **403 Forbidden** –Ω–∞ `/api/traffic-constructor/teams`
- **500 Internal Server Error** –Ω–∞ `/api/utm-analytics/overview?days=30`

## üîç –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

–í —Ñ–∞–π–ª–µ [`backend/src/config/supabase-traffic.ts`](backend/src/config/supabase-traffic.ts:11-13) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```typescript
TRAFFIC_SUPABASE_URL
TRAFFIC_SUPABASE_ANON_KEY
TRAFFIC_SERVICE_ROLE_KEY
```

–≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ `.env` –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ **401 Unauthorized** –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ Supabase API.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
cd /Users/miso/onai-integrator-login
./scripts/fix-traffic-env.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç, –µ—Å—Ç—å –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`
2. –ü–æ–ª—É—á–∏—Ç –∫–ª—é—á–∏ –∏–∑ Tripwire –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
3. –î–æ–±–∞–≤–∏—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç PM2 backend

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–û—Ç–∫—Ä—ã—Ç—å https://traffic.onai.academy –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
- API Integrations - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã —Å–µ—Ä–≤–∏—Å–æ–≤
- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –ø—Ä–æ–¥–∞–∂ - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å UTM –∞–Ω–∞–ª–∏—Ç–∏–∫—É
- –ö–æ–º–∞–Ω–¥—ã - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥

## üì¶ –ö–æ–º–º–∏—Ç—ã –¥–ª—è –¥–µ–ø–ª–æ—è

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–º–∏—Ç —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º .env.example
git checkout 49f3b7d

# –ö–æ–º–º–∏—Ç —Å–æ —Å–∫—Ä–∏–ø—Ç–æ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
git checkout a1412a9
```

## üìù –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è AA –∞–≥–µ–Ω—Ç–∞

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö Traffic Dashboard:**
   ```bash
   ssh root@207.154.231.30 "cd /var/www/onai-integrator-login-main && grep TRAFFIC .env"
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
   ```bash
   cd /Users/miso/onai-integrator-login
   ./scripts/fix-traffic-env.sh
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Traffic Dashboard —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   - –û—Ç–∫—Ä—ã—Ç—å https://traffic.onai.academy
   - –í–æ–π—Ç–∏ –∫–∞–∫ admin@onai.academy
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã

## üìä –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö Traffic Dashboard
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –∫–ª—é—á–∏ –∏–∑ Tripwire –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- ‚úÖ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç PM2 backend
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –µ—Å–ª–∏ –∫–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- [`scripts/fix-traffic-env.sh`](scripts/fix-traffic-env.sh) - –°–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [`.env.example`](.env.example) - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [`docs/TRAFFIC_DASHBOARD_ENV_FIX.md`](docs/TRAFFIC_DASHBOARD_ENV_FIX.md) - –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã
