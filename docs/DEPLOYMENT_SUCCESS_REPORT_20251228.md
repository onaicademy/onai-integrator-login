# üéâ –û—Ç—á–µ—Ç –æ –¥–µ–ø–ª–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π Traffic Dashboard
**–î–∞—Ç–∞:** 2025-12-28  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù

---

## üìã –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚úÖ API Integrations - 404 Error
**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç—Ä–∞–Ω–∏—Ü–∞ "API –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏" –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ 404 –æ—à–∏–±–∫—É  
**–ü—Ä–∏—á–∏–Ω–∞:** –ú–∞—Ä—à—Ä—É—Ç `/api/integrations/all` –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –≤ backend  
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª [`backend/src/routes/api-integrations.ts`](backend/src/routes/api-integrations.ts)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `GET /api/integrations/all` - –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- `GET /api/integrations/facebook` - –°—Ç–∞—Ç—É—Å Facebook API
- `GET /api/integrations/amocrm` - –°—Ç–∞—Ç—É—Å AmoCRM API
- `GET /api/integrations/supabase` - –°—Ç–∞—Ç—É—Å Supabase

**–¢–µ—Å—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:**
```bash
curl https://api.onai.academy/api/integrations/all
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

---

### 2. ‚úÖ UTM Analytics - 500 Error
**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç—Ä–∞–Ω–∏—Ü–∞ "UTM –ê–Ω–∞–ª–∏—Ç–∏–∫–∞" –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ 500 –æ—à–∏–±–∫—É  
**–ü—Ä–∏—á–∏–Ω–∞:** –ú–∞—Ä—à—Ä—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (Tripwire –≤–º–µ—Å—Ç–æ Traffic)  
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω [`backend/src/routes/utm-analytics.ts`](backend/src/routes/utm-analytics.ts)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
// –ë—ã–ª–æ:
import { tripwireAdminSupabase } from '../config/supabase-tripwire.js';

// –°—Ç–∞–ª–æ:
import { trafficSupabase } from '../config/supabase-traffic';
```

**–¢–µ—Å—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:**
```bash
curl https://api.onai.academy/api/utm-analytics/overview
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ú–∞—Ä—à—Ä—É—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç (–æ—à–∏–±–∫–∞ API –∫–ª—é—á–∞ - —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)

---

### 3. ‚úÖ Team Constructor - 403 Error
**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç—Ä–∞–Ω–∏—Ü–∞ "Team Constructor" –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ 403 –æ—à–∏–±–∫—É  
**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∏–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –º–∞—Ä—à—Ä—É—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–¢–µ—Å—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:**
```bash
curl https://api.onai.academy/api/traffic-constructor/teams
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ú–∞—Ä—à—Ä—É—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)

---

## üöÄ –ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è

### 1. –ö–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript
```bash
npm run build
```

### 2. –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
```bash
rsync -avz --delete backend/dist/ root@207.154.231.30:/var/www/onai-integrator-login-main/backend/dist/
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ PM2
```bash
ssh root@207.154.231.30 "pm2 restart onai-backend"
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
ssh root@207.154.231.30 "pm2 logs onai-backend --lines 30 --nostream"
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –î–æ | –ü–æ—Å–ª–µ | –°—Ç–∞—Ç—É—Å |
|----------|----|-------|--------|
| `/api/integrations/all` | 404 Not Found | 200 OK —Å –¥–∞–Ω–Ω—ã–º–∏ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω |
| `/api/utm-analytics/overview` | 500 Internal Error | 200 OK (–æ—à–∏–±–∫–∞ API –∫–ª—é—á–∞) | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω |
| `/api/traffic-constructor/teams` | 403 Forbidden | 401 Unauthorized (–Ω–æ—Ä–º–∞–ª—å–Ω–æ) | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

---

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- [`backend/src/routes/api-integrations.ts`](backend/src/routes/api-integrations.ts) - –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- [`backend/src/routes/utm-analytics.ts`](backend/src/routes/utm-analytics.ts) - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- [`backend/src/server.ts`](backend/src/server.ts) - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [`docs/TECHNICAL_FIXES_REPORT.md`](docs/TECHNICAL_FIXES_REPORT.md) - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç –¥—Ä—É–≥–æ–≥–æ –∞–≥–µ–Ω—Ç–∞

–°–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é, –¥—Ä—É–≥–æ–π –∞–≥–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–∏–ª:

1. ‚úÖ **UTM Attribution System** - –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞
   - Database schema –æ–±–Ω–æ–≤–ª–µ–Ω–∞
   - AmoCRM Utils Library —Å–æ–∑–¥–∞–Ω–∞
   - Webhook –æ–±–Ω–æ–≤–ª–µ–Ω —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º 3 –±–∞–≥–æ–≤
   - TypeScript —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω
   - Backend –∑–∞–¥–µ–ø–ª–æ–µ–Ω

2. ‚úÖ **Targetologist Patterns** - –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
   - Kenesary, Arystan, Muha, Traf4 - –≤—Å–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤ –ø–æ—Ä—è–¥–∫–µ

3. ‚úÖ **Traffic Teams** - —É–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã
   - Kenesary, Arystan, Muha, Traf4 - —É–¥–∞–ª–µ–Ω—ã –∏–∑ Traffic DB
   - –ë–∞–∑–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏:
1. [ ] –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. [ ] –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ —Ñ–æ—Ä–º–∞–º–∏
3. [ ] –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ Traffic –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ UI
4. [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å UTM Source/Medium –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã
5. [ ] –ü—Ä–∏–≤—è–∑–∞—Ç—å Facebook Ad Account ID –∏ Campaign ID

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –∫–ª—é—á –¥–ª—è Traffic –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (`TRAFFIC_SUPABASE_URL` –∏ `TRAFFIC_SUPABASE_ANON_KEY`)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ Facebook —Ç–æ–∫–µ–Ω—ã
- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ Traffic Dashboard UI

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ Traffic Dashboard –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω:

‚úÖ **API –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ **UTM –ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ **Team Constructor** - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç  

Backend —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ —Å–æ–∑–¥–∞–Ω–∏—é –Ω–æ–≤—ã—Ö Traffic –∫–æ–º–∞–Ω–¥.

---

**–ê–≤—Ç–æ—Ä:** Kilo Code  
**–î–∞—Ç–∞:** 2025-12-28  
**–í—Ä–µ–º—è:** 13:30 (UTC+5)
