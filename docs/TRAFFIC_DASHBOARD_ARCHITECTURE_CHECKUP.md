# Traffic Dashboard Architecture Checkup

## üìä –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞:

1. **supabase-traffic-dashboard** (oetodaexnjcunklkdlkv)
   - –û—Å–Ω–æ–≤–Ω–∞—è –ë–î Traffic Dashboard
   - –•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–æ–≤, –∫–æ–º–∞–Ω–¥—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

2. **supabase-leadland** (xikaiavwqinamgolmtcy)
   - Landing Database
   - –•—Ä–∞–Ω–∏—Ç –ª–∏–¥—ã —Å –ª–µ–Ω–¥–∏–Ω–≥–∞, –ø—Ä–æ–¥–∞–∂–∏, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

3. **supabase-main-platform** (arqhkacellqbhjhbebfh)
   - Tripwire Database
   - –•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ LMS –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

---

## üóÑÔ∏è –¢–∞–±–ª–∏—Ü—ã Traffic Dashboard DB

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `traffic_users` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (—Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–∏ –∏ –∞–¥–º–∏–Ω—ã) | 3 |
| `traffic_user_sessions` | –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–æ–≤ –≤ —Å–∏—Å—Ç–µ–º—É | 15 |
| `traffic_onboarding_progress` | –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è | 1 |
| `traffic_onboarding_step_tracking` | –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ | 0 |

### –ö–æ–º–∞–Ω–¥—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `traffic_teams` | –ö–æ–º–∞–Ω–¥—ã —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–æ–≤ | 0 |
| `traffic_ad_account_bindings` | –ü—Ä–∏–≤—è–∑–∫–∏ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∫ –∫–æ–º–∞–Ω–¥–∞–º | 0 |
| `traffic_admin_settings` | –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–º–∏–Ω–∞ | 0 |
| `traffic_targetologist_settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–æ–≤ (FB –∫–∞–±–∏–Ω–µ—Ç—ã, –∫–∞–º–ø–∞–Ω–∏–∏) | 3 |
| `traffic_user_utm_sources` | UTM –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | 4 |

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `traffic_sales_stats` | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –¥–∞—Ç–∞–º | 0 |
| `traffic_fb_campaigns` | –ö–∞–º–ø–∞–Ω–∏–∏ Facebook | 0 |
| `traffic_fb_ad_sets` | –†–µ–∫–ª–∞–º–Ω—ã–µ –Ω–∞–±–æ—Ä—ã Facebook | 0 |
| `traffic_fb_ads` | –û–±—ä—è–≤–ª–µ–Ω–∏—è Facebook | 0 |
| `traffic_weekly_plans` | –ù–µ–¥–µ–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã –∫–æ–º–∞–Ω–¥ | 0 |

### –õ–∏–¥—ã –∏ –ø—Ä–æ–¥–∞–∂–∏:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `traffic_leads` | –õ–∏–¥—ã –∏–∑ Facebook Lead Ads | 0 |
| `traffic_sales` | –ü—Ä–æ–¥–∞–∂–∏ Express Course | 0 |
| `challenge3d_sales` | –ü—Ä–æ–¥–∞–∂–∏ Challenge 3D (–ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã –∏ –ø–æ–ª–Ω—ã–µ –æ–ø–ª–∞—Ç—ã) | 0 |
| `all_sales_tracking` | –ü–æ–ª–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–¥–∞–∂ —Å AmoCRM | 0 |
| `lead_tracking` | –ê—Ç—Ä–∏–±—É—Ü–∏—è –ª–∏–¥–æ–≤ –ø–æ UTM | 0 |

### –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `traffic_lead_journey` | –≠—Ç–∞–ø—ã –≤–æ—Ä–æ–Ω–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–∏–¥–∞ | 0 |

### Facebook Ads:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `facebook_ad_spend` | –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É –ø–æ –∞–∫–∫–∞—É–Ω—Ç–∞–º | 0 |

### –õ–æ–≥–∏ –∏ –∞—É–¥–∏—Ç:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `sales_activity_log` | –õ–æ–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–∞–∂ | 0 |
| `audit_log` | –ê—É–¥–∏—Ç–æ—Ä—Å–∫–∏–π –∂—É—Ä–Ω–∞–ª | 0 |
| `historical_sync_log` | –õ–æ–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö UTM-–¥–∞–Ω–Ω—ã—Ö | 0 |

---

## üóÑÔ∏è –¢–∞–±–ª–∏—Ü—ã Landing Database

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `landing_leads` | –õ–∏–¥—ã —Å –ª–µ–Ω–¥–∏–Ω–≥–∞ | 1112 |
| `journey_stages` | –≠—Ç–∞–ø—ã –≤–æ—Ä–æ–Ω–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–∏–¥–∞ | 760 |

### –¢–∞–±–ª–∏—Ü—ã –ø—Ä–æ–¥–∞–∂:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `express_course_sales` | –ü—Ä–æ–¥–∞–∂–∏ Express Course (5,000 KZT) | 87 |
| `main_product_sales` | –ü—Ä–æ–¥–∞–∂–∏ Flagman (490,000 KZT) | 12 |
| `challenge3d_sales` | –ü—Ä–æ–¥–∞–∂–∏ Challenge 3D | 1 |

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `integration_tokens` | –¢–æ–∫–µ–Ω—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (AmoCRM, Telegram –∏ —Ç.–¥.) | 2 |
| `bulk_syncs` | –ú–∞—Å—Å–æ–≤—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å AmoCRM | 2 |
| `bulk_sync_results` | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ª–∏–¥–æ–≤ | 633 |

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `scheduled_notifications` | –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ SMS/Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | 557 |

### –ö–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `short_links` | –ö–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è SMS –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è | 1554 |
| `short_link_clicks` | –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–∫–æ–≤ | 473 |

### –õ–æ–≥–∏:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `integration_logs` | –õ–æ–≥–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π —Å –≤–Ω–µ—à–Ω–∏–º–∏ API | 1 |
| `error_logs` | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ | 30000 |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∫–æ–º–∞–Ω–¥—ã:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `traffic_teams` | –ö–æ–º–∞–Ω–¥—ã —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–æ–≤ | 4 |
| `traffic_users` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Traffic Dashboard | 5 |
| `traffic_targetologist_settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–æ–≤ | 0 |
| `traffic_admin_settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–º–∏–Ω–∞ | 0 |

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `traffic_stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Facebook Ads | 33 |
| `targetologist_utm_settings` | UTM –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–æ–≤ | 0 |
| `manual_attribution_log` | –õ–æ–≥ —Ä—É—á–Ω–æ–π –∞—Ç—Ä–∏–±—É—Ü–∏–∏ | 0 |
| `integration_ad_accounts` | –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã | 0 |

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–¥–∞–∂–∞—Ö:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `sales_notifications` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–¥–∞–∂–∞—Ö | 1 |

### –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `exchange_rates` | –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç (USD ‚Üí KZT) | 9 |

---

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. –ü–æ—Ç–æ–∫ –ª–∏–¥–æ–≤:

```
Facebook Lead Ads 
    ‚Üì
traffic_leads (Traffic Dashboard)
    ‚Üì
journey_stages (Landing Database)
    ‚Üì
express_course_sales / main_product_sales / challenge3d_sales (Landing Database)
```

### 2. UTM-–∞—Ç—Ä–∏–±—É—Ü–∏—è:

```
UTM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (utm_source, utm_medium, utm_campaign, utm_content)
    ‚Üì
traffic_user_utm_sources (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–æ–≤)
    ‚Üì
–ê—Ç—Ä–∏–±—É—Ü–∏—è –ø—Ä–æ–¥–∞–∂ –∫ –∫–æ–º–∞–Ω–¥–∞–º
    ‚Üì
traffic_sales_stats (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
```

### 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:

#### Facebook Ads:
```
Facebook Ads API
    ‚Üì
traffic_fb_campaigns / traffic_fb_ad_sets / traffic_fb_ads
    ‚Üì
traffic_stats (–µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è)
```

#### AmoCRM:
```
AmoCRM Webhook
    ‚Üì
express_course_sales / main_product_sales / challenge3d_sales
    ‚Üì
all_sales_tracking (–ø–æ–ª–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ)
```

### 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã:

```
traffic_sales_stats (–µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
    ‚Üì
traffic_weekly_plans (–Ω–µ–¥–µ–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã)
    ‚Üì
daily_traffic_reports (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã)
```

---

## üõ£Ô∏è API –º–∞—Ä—à—Ä—É—Ç—ã

### traffic-dashboard.ts:

| –ú–∞—Ä—à—Ä—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|-----------|
| `/aggregate` | POST | –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø—Ä–æ–¥–∞–∂ –∏–∑ AmoCRM |
| `/aggregate/today` | POST | –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è |
| `/aggregate/last-30-days` | POST | –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∑–∞ 30 –¥–Ω–µ–π |
| `/attribute` | POST | –ê—Ç—Ä–∏–±—É—Ü–∏—è UTM –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ |
| `/attribute/batch` | POST | –ü–∞–∫–µ—Ç–Ω–∞—è –∞—Ç—Ä–∏–±—É—Ü–∏—è |
| `/attribution-stats` | GET | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞—Ç—Ä–∏–±—É—Ü–∏–∏ |
| `/stats` | GET | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| `/health` | GET | Health check |
| `/leads/total` | GET | –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ª–∏–¥–∞–º |
| `/leads/by-funnel` | GET | –õ–∏–¥—ã —Ä–∞–∑–±–∏—Ç—ã–µ –ø–æ –≤–æ—Ä–æ–Ω–∫–∞–º |
| `/sales/total` | GET | –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ |

### traffic-admin.ts:

| –ú–∞—Ä—à—Ä—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|-----------|
| `/settings` | GET/POST | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ |
| `/users` | GET/PUT | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ |
| `/dashboard-stats` | GET | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞ |
| `/generate-all-plans` | POST | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–æ–≤ –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ |
| `/teams` | GET/POST | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–∞–º–∏ |
| `/ad-account-bindings` | GET/POST/DELETE | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ |

### traffic-stats.ts:

| –ú–∞—Ä—à—Ä—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|-----------|
| `/sales` | GET | –ü—Ä–æ–¥–∞–∂–∏ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |
| `/pipeline` | GET | –≠—Ç–∞–ø—ã –≤–æ—Ä–æ–Ω–∫–∏ |
| `/combined-analytics` | GET | –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (FB Ads + AmoCRM) |
| `/funnel/:teamId` | GET | –í–æ—Ä–æ–Ω–∫–∞ –∫–æ–º–∞–Ω–¥—ã |
| `/ai-insight` | GET | AI-–∏–Ω—Å–∞–π—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

### traffic-reports.ts:

| –ú–∞—Ä—à—Ä—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|-----------|
| `/save` | POST | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –∑–∞ –¥–µ–Ω—å |
| `/date/:date` | GET | –û—Ç—á–µ—Ç –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É |
| `/range` | GET | –û—Ç—á–µ—Ç—ã –∑–∞ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç |
| `/teams-analysis` | GET | –ê–Ω–∞–ª–∏–∑ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |

---

## üìä –¢–∞–±–ª–∏—Ü—ã –º–∏–≥—Ä–∞—Ü–∏–∏ (Traffic Dashboard)

### –¢–∞–±–ª–∏—Ü—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Landing DB:

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|---------|-----------|--------|
| `leads` | –õ–∏–¥—ã –∏–∑ Landing Database | 1000 |
| `journey_stages` | –≠—Ç–∞–ø—ã –≤–æ—Ä–æ–Ω–∫–∏ | 650 |

---

## üîë –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. –ú—É–ª—å—Ç–∏-–±–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- –î–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ–∂–¥—É —Ç—Ä–µ–º—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- –ö–∞–∂–¥–∞—è –ë–î –∏–º–µ–µ—Ç —Å–≤–æ—é —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é

### 2. UTM-–∞—Ç—Ä–∏–±—É—Ü–∏—è:
- –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥–æ–≤ –≤ `traffic_user_utm_sources`
- –†—É—á–Ω–∞—è –∞—Ç—Ä–∏–±—É—Ü–∏—è —á–µ—Ä–µ–∑ `manual_attribution_log`

### 3. RLS (Row Level Security):
- –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ

### 4. –í–µ–±—Ö—É–∫–∏:
- AmoCRM –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–¥–∞–∂–∞—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–æ–¥–∞–∂

### 5. Facebook Ads API:
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ–∫–ª–∞–º–µ
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –≤ `traffic_stats`

### 6. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
- Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- TTL: 20 –º–∏–Ω—É—Ç –¥–ª—è USER_ANALYTICS_CACHE_TTL

---

## üìà –î–∞–Ω–Ω—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥ 1-4 —è–Ω–≤–∞—Ä—è 2026

### Traffic Dashboard DB:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ù–æ–≤—ã–µ –ª–∏–¥—ã (leads) | 191 |
| –ü—Ä–µ–¥–æ–ø–ª–∞—Ç—ã (challenge3d_sales) | 0 |
| –ü—Ä–æ–¥–∞–∂–∏ Express (traffic_sales) | 0 |
| –≠—Ç–∞–ø—ã –≤–æ—Ä–æ–Ω–∫–∏ (journey_stages) | 0 |

### Landing Database:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ü—Ä–æ–¥–∞–∂–∏ Express | 0 |
| –ü—Ä–æ–¥–∞–∂–∏ Flagman | 0 |
| –ü—Ä–æ–¥–∞–∂–∏ Challenge 3D | 1 (5,000 KZT, –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞) |

### –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–¥–∞–∂–∏ Challenge 3D:

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| ID | 00150c4e-37e2-4111-8bbd-b9e87962fb5e |
| Deal ID | 99999999 |
| Pipeline ID | 9430994 |
| Status ID | 12345 |
| Amount | 5,000 KZT |
| Prepaid | true |
| UTM Source | kenjifb |
| UTM Medium | cpc |
| Customer Name | TEST_PREPAYMENT_WEBHOOK |
| Sale Date | 2026-01-03 18:35:34 |

---

## ‚ö†Ô∏è –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Traffic Dashboard:
- `traffic_sales` - 0 –∑–∞–ø–∏—Å–µ–π
- `challenge3d_sales` - 0 –∑–∞–ø–∏—Å–µ–π
- `traffic_leads` - 0 –∑–∞–ø–∏—Å–µ–π

### 2. –î–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤ Landing Database:
- –ü—Ä–æ–¥–∞–∂–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Landing DB
- –¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –≤ Traffic Dashboard DB

### 3. –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ Facebook Ads:
- `traffic_fb_campaigns` - 0 –∑–∞–ø–∏—Å–µ–π
- `traffic_fb_ad_sets` - 0 –∑–∞–ø–∏—Å–µ–π
- `traffic_fb_ads` - 0 –∑–∞–ø–∏—Å–µ–π

### 4. –ù–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
- `traffic_sales_stats` - 0 –∑–∞–ø–∏—Å–µ–π
- `traffic_weekly_plans` - 0 –∑–∞–ø–∏—Å–µ–π

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
- –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∂–∏ –∏–∑ Landing DB –≤ Traffic Dashboard DB
- –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ª–∏–¥—ã –∏–∑ Landing DB –≤ Traffic Dashboard DB

### 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Facebook Ads:
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ–∫–ª–∞–º–µ
- –°–æ–∑–¥–∞—Ç—å cron-–∑–∞–¥–∞—á–∏ –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 3. –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
- –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
- –ó–∞–ø–æ–ª–Ω–∏—Ç—å `traffic_sales_stats` –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### 4. –ê—Ç—Ä–∏–±—É—Ü–∏—è:
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∞—Ç—Ä–∏–±—É—Ü–∏—é –ø–æ UTM
- –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ä—É—á–Ω–æ–π –∞—Ç—Ä–∏–±—É—Ü–∏–∏

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-04
**–°—Ç–∞—Ç—É—Å:** Checkup –∑–∞–≤–µ—Ä—à–µ–Ω
