-- ========================================
-- –£–î–ê–õ–ï–ù–ò–ï –î–£–ë–õ–ò–ö–ê–¢–û–í –¢–ê–ë–õ–ò–¶
-- –î–∞—Ç–∞: 15 –Ω–æ—è–±—Ä—è 2025
-- ========================================

-- ‚ö†Ô∏è –í–ê–ñ–ù–û! –≠–¢–û–¢ SQL –£–î–ê–õ–Ø–ï–¢ –¢–ê–ë–õ–ò–¶–´!
-- –ó–ê–ü–£–°–ö–ê–ô –¢–û–õ–¨–ö–û –ü–û–°–õ–ï –ü–†–û–í–ï–†–ö–ò!

-- ========================================
-- –ê–ù–ê–õ–ò–ó (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–¥–∞ –∏ –¥–∞–Ω–Ω—ã—Ö):
-- ========================================

/*
‚úÖ –ß–¢–û –û–°–¢–ê–í–õ–Ø–ï–ú:

1. student_progress ‚Üí –û–°–ù–û–í–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê –î–õ–Ø –í–ò–î–ï–û
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ database.types.ts
   - –°–æ–¥–µ—Ä–∂–∏—Ç: user_id, lesson_id, watch_time_seconds, video_progress

2. user_achievements ‚Üí –ù–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ò–ì–†–û–§–ò–ö–ê–¶–ò–ò
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ achievements-api.ts (—Å—Ç—Ä–æ–∫–∞ 80)
   - –¢–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏–µ–π 20251115_add_gamification

3. user_stats ‚Üí –ï–°–¢–¨ –î–ê–ù–ù–´–ï (15 –∑–∞–ø–∏—Å–µ–π)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Achievements.tsx
   - –°–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

4. profiles ‚Üí –û–°–ù–û–í–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ (12 —Ñ–∞–π–ª–æ–≤)

5. achievements ‚Üí –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø –í 16 –§–ê–ô–õ–ê–•
   - –ü–û–ö–ê –û–°–¢–ê–í–õ–Ø–ï–ú (–Ω—É–∂–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)

‚ùå –ß–¢–û –£–î–ê–õ–Ø–ï–ú:

1. user_statistics ‚Üí –ü–£–°–¢–ê–Ø (0 –∑–∞–ø–∏—Å–µ–π)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ achievements-api.ts (—Å—Ç—Ä–æ–∫–∞ 42)
   - –î—É–±–ª–∏–∫–∞—Ç user_stats
   - –ù–£–ñ–ù–û: –æ–±–Ω–æ–≤–∏—Ç—å achievements-api.ts —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª user_stats

2. user_progress ‚Üí –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø –ù–ò–ì–î–ï
   - –î—É–±–ª–∏–∫–∞—Ç student_progress

3. progress ‚Üí –ú–ê–õ–û –î–ê–ù–ù–´–• (8 KB)
   - –î—É–±–ª–∏–∫–∞—Ç student_progress –∏–ª–∏ user_progress
*/

-- ========================================
-- –®–ê–ì–ò –£–î–ê–õ–ï–ù–ò–Ø
-- ========================================

-- –®–ê–ì 1: –£–¥–∞–ª–∏—Ç—å user_statistics (–ø—É—Å—Ç–∞—è, –¥—É–±–ª–∏–∫–∞—Ç user_stats)
DROP TABLE IF EXISTS public.user_statistics CASCADE;

-- –®–ê–ì 2: –£–¥–∞–ª–∏—Ç—å user_progress (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
DROP TABLE IF EXISTS public.user_progress CASCADE;

-- –®–ê–ì 3: –£–¥–∞–ª–∏—Ç—å progress (–¥—É–±–ª–∏–∫–∞—Ç)
DROP TABLE IF EXISTS public.progress CASCADE;

-- ========================================
-- –ü–†–û–í–ï–†–ö–ê –ü–û–°–õ–ï –£–î–ê–õ–ï–ù–ò–Ø
-- ========================================

SELECT 
    '‚úÖ –û–°–¢–ê–í–®–ò–ï–°–Ø –¢–ê–ë–õ–ò–¶–´ –ü–†–û–ì–†–ï–°–°–ê' as info,
    tablename,
    pg_size_pretty(pg_total_relation_size('public.'||tablename)) as size
FROM pg_tables 
WHERE schemaname = 'public'
AND tablename IN ('student_progress', 'module_progress')
ORDER BY tablename;

SELECT 
    '‚úÖ –û–°–¢–ê–í–®–ò–ï–°–Ø –¢–ê–ë–õ–ò–¶–´ –î–û–°–¢–ò–ñ–ï–ù–ò–ô' as info,
    tablename,
    pg_size_pretty(pg_total_relation_size('public.'||tablename)) as size
FROM pg_tables 
WHERE schemaname = 'public'
AND tablename IN ('achievements', 'user_achievements', 'achievement_history')
ORDER BY tablename;

SELECT 
    '‚úÖ –û–°–¢–ê–í–®–ò–ï–°–Ø –¢–ê–ë–õ–ò–¶–´ –°–¢–ê–¢–ò–°–¢–ò–ö–ò' as info,
    tablename,
    pg_size_pretty(pg_total_relation_size('public.'||tablename)) as size
FROM pg_tables 
WHERE schemaname = 'public'
AND tablename IN ('user_stats')
ORDER BY tablename;

-- ========================================
-- –ì–û–¢–û–í–û! üéâ
-- ========================================

/*
üìã –ü–û–°–õ–ï –£–î–ê–õ–ï–ù–ò–Ø –ù–£–ñ–ù–û:

1. –û–±–Ω–æ–≤–∏—Ç—å achievements-api.ts:
   - –ó–∞–º–µ–Ω–∏—Ç—å 'user_statistics' –Ω–∞ 'user_stats' (—Å—Ç—Ä–æ–∫–∞ 42)
   
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ª–æ–º–∞–ª–æ—Å—å:
   - –û—Ç–∫—Ä–æ–π /achievements –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
   - –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∏–≥—Ä–æ—Ñ–∏–∫–∞—Ü–∏–∏:
   - 20251115_add_gamification.sql
*/

