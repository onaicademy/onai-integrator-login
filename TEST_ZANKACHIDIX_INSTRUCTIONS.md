# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è zankachidix.ai@gmail.com

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î (SQL)

–û—Ç–∫—Ä–æ–π Supabase Dashboard ‚Üí SQL Editor –∏ –≤—ã–ø–æ–ª–Ω–∏:

```sql
-- 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT 
  u.id as user_id,
  u.email,
  tu.id as tripwire_user_id,
  tup.full_name
FROM users u
LEFT JOIN tripwire_users tu ON tu.user_id = u.id
LEFT JOIN tripwire_user_profile tup ON tup.user_id = u.id
WHERE u.email = 'zankachidix.ai@gmail.com';
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å `user_id`, `email`, `tripwire_user_id`

---

```sql
-- 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ Tripwire —É—Ä–æ–∫–∏ (67, 68, 69)
SELECT 
  tp.lesson_id,
  l.title,
  tp.is_completed,
  tp.completed_at
FROM tripwire_progress tp
JOIN lessons l ON l.id = tp.lesson_id
WHERE tp.tripwire_user_id IN (
  SELECT tu.id 
  FROM tripwire_users tu 
  JOIN users u ON u.id = tu.user_id 
  WHERE u.email = 'zankachidix.ai@gmail.com'
)
AND tp.lesson_id IN (67, 68, 69)
AND tp.is_completed = TRUE
ORDER BY tp.lesson_id;
```

**–ó–∞–ø–∏—à–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- [ ] –£—Ä–æ–∫ 67 –∑–∞–≤–µ—Ä—à—ë–Ω? ____
- [ ] –£—Ä–æ–∫ 68 –∑–∞–≤–µ—Ä—à—ë–Ω? ____
- [ ] –£—Ä–æ–∫ 69 –∑–∞–≤–µ—Ä—à—ë–Ω? ____

---

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç –≤ Node.js –∫–æ–Ω—Å–æ–ª–∏

–û—Ç–∫—Ä–æ–π —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
cd /Users/miso/onai-integrator-login
node
```

–í—ã–ø–æ–ª–Ω–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ Node.js:

```javascript
// 1. –ò–º–ø–æ—Ä—Ç —Å–µ—Ä–≤–∏—Å–∞ (–¥–ª—è CommonJS –±—ç–∫–µ–Ω–¥–∞ –Ω—É–∂–µ–Ω require —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞)
// –ï—Å–ª–∏ –±—ç–∫–µ–Ω–¥ –Ω–∞ TypeScript, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å

// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ 1: –ó–∞–ø—É—Å—Ç–∏ —á–µ—Ä–µ–∑ ts-node
// –í—ã–π–¥–∏ –∏–∑ node –∫–æ–Ω—Å–æ–ª–∏ (Ctrl+C –¥–≤–∞–∂–¥—ã) –∏ –≤—ã–ø–æ–ª–Ω–∏:
```

```bash
# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ ts-node
npx ts-node

# –ó–∞—Ç–µ–º –≤ –∫–æ–Ω—Å–æ–ª–∏ ts-node:
const amoCrm = require('./backend/src/services/amoCrmService');

// –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ù–∞–π—Ç–∏ —Å–¥–µ–ª–∫—É –≤ amoCRM
const email = 'zankachidix.ai@gmail.com';
console.log(`\nüîç –ò—â–µ–º —Å–¥–µ–ª–∫—É –¥–ª—è ${email}...\n`);
const leadId = await amoCrm.findLeadIdByEmail(email);
console.log(leadId ? `‚úÖ –ù–∞–π–¥–µ–Ω–∞ —Å–¥–µ–ª–∫–∞: ID ${leadId}` : `‚ùå –°–¥–µ–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –û–±–Ω–æ–≤–∏—Ç—å —Å–¥–µ–ª–∫—É –¥–ª—è –£—Ä–æ–∫–∞ 1 (–µ—Å–ª–∏ –∑–∞–≤–µ—Ä—à—ë–Ω)
if (leadId) {
  console.log(`\nüöÄ –û–±–Ω–æ–≤–ª—è–µ–º —Å–¥–µ–ª–∫—É –¥–ª—è –£—Ä–æ–∫–∞ 1...\n`);
  await amoCrm.onLessonCompleted(email, 1);
  console.log('‚úÖ –£—Ä–æ–∫ 1 –æ–±—Ä–∞–±–æ—Ç–∞–Ω');
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –û–±–Ω–æ–≤–∏—Ç—å —Å–¥–µ–ª–∫—É –¥–ª—è –£—Ä–æ–∫–∞ 2 (–µ—Å–ª–∏ –∑–∞–≤–µ—Ä—à—ë–Ω)
if (leadId) {
  console.log(`\nüöÄ –û–±–Ω–æ–≤–ª—è–µ–º —Å–¥–µ–ª–∫—É –¥–ª—è –£—Ä–æ–∫–∞ 2...\n`);
  await amoCrm.onLessonCompleted(email, 2);
  console.log('‚úÖ –£—Ä–æ–∫ 2 –æ–±—Ä–∞–±–æ—Ç–∞–Ω');
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –û–±–Ω–æ–≤–∏—Ç—å —Å–¥–µ–ª–∫—É –¥–ª—è –£—Ä–æ–∫–∞ 3 (–µ—Å–ª–∏ –∑–∞–≤–µ—Ä—à—ë–Ω)
if (leadId) {
  console.log(`\nüöÄ –û–±–Ω–æ–≤–ª—è–µ–º —Å–¥–µ–ª–∫—É –¥–ª—è –£—Ä–æ–∫–∞ 3...\n`);
  await amoCrm.onLessonCompleted(email, 3);
  console.log('‚úÖ –£—Ä–æ–∫ 3 –æ–±—Ä–∞–±–æ—Ç–∞–Ω');
}

console.log(`\nüéâ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—å amoCRM.`);
```

---

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å –≤ amoCRM

1. –û—Ç–∫—Ä–æ–π amoCRM: https://yoursubdomain.amocrm.ru
2. –ù–∞–π–¥–∏ –∫–æ–Ω—Ç–∞–∫—Ç: `zankachidix.ai@gmail.com`
3. –û—Ç–∫—Ä–æ–π —Å–¥–µ–ª–∫—É —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞
4. **–ü—Ä–æ–≤–µ—Ä—å —ç—Ç–∞–ø —Å–¥–µ–ª–∫–∏:**
   - –ï—Å–ª–∏ –∑–∞–≤–µ—Ä—à—ë–Ω –£—Ä–æ–∫ 1 ‚Üí –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ **"–ü–†–û–®–ï–õ –ü–ï–†–í–´–ô –£–†–û–ö"**
   - –ï—Å–ª–∏ –∑–∞–≤–µ—Ä—à—ë–Ω –£—Ä–æ–∫ 2 ‚Üí –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ **"–ü–†–û–®–ï–õ –í–¢–û–†–û–ô –£–†–û–ö"**
   - –ï—Å–ª–∏ –∑–∞–≤–µ—Ä—à—ë–Ω –£—Ä–æ–∫ 3 ‚Üí –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ **"–ü–†–û–®–ï–õ 3–ô –£–†–û–ö"**

---

## üéØ –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–µ—Å–ª–∏ ts-node –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞

1. **–ó–∞–≤–µ—Ä—à–∏—Ç–µ —É—Ä–æ–∫ –≤—Ä—É—á–Ω—É—é –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ:**
   - –ó–∞–π–¥–∏—Ç–µ –ø–æ–¥ `zankachidix.ai@gmail.com`
   - –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π Tripwire —É—Ä–æ–∫ (67, 68 –∏–ª–∏ 69)
   - –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫"

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   pm2 logs backend --lines 100 | grep -A 10 "zankachidix"
   ```

3. **–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
   ```
   [AMOCRM] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ amoCRM –¥–ª—è zankachidix.ai@gmail.com, —É—Ä–æ–∫ 1
   üéØ [AmoCRM] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å zankachidix.ai@gmail.com –∑–∞–≤–µ—Ä—à–∏–ª —É—Ä–æ–∫ 1
   [AmoCRM] –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –ø–æ email: zankachidix.ai@gmail.com
   [AmoCRM] –ù–∞–π–¥–µ–Ω –∫–æ–Ω—Ç–∞–∫—Ç: ID 123456
   [AmoCRM] –ù–∞–π–¥–µ–Ω–∞ —Å–¥–µ–ª–∫–∞: ID 789012
   [AmoCRM] –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Å–¥–µ–ª–∫—É 789012 –Ω–∞ —ç—Ç–∞–ø 12345678
   ‚úÖ [AmoCRM] –°–¥–µ–ª–∫–∞ 789012 —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –Ω–∞ —ç—Ç–∞–ø 12345678
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ amoCRM**, —á—Ç–æ —Å–¥–µ–ª–∫–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∞—Å—å

---

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ü—Ä—è–º–æ–π API –∑–∞–ø—Ä–æ—Å (curl)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ API:

```bash
# 1. –ü–æ–ª—É—á–∏ Access Token –∏–∑ .env
cat backend/.env | grep AMOCRM_ACCESS_TOKEN

# 2. –ù–∞–π–¥–∏ –∫–æ–Ω—Ç–∞–∫—Ç
curl -X GET "https://yoursubdomain.amocrm.ru/api/v4/contacts?query=zankachidix.ai@gmail.com" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"

# 3. –ù–∞–π–¥–∏ —Å–¥–µ–ª–∫—É –∫–æ–Ω—Ç–∞–∫—Ç–∞ (–∑–∞–º–µ–Ω–∏ CONTACT_ID)
curl -X GET "https://yoursubdomain.amocrm.ru/api/v4/leads?filter[id]=CONTACT_ID" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"

# 4. –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å —Å–¥–µ–ª–∫–∏ (–∑–∞–º–µ–Ω–∏ LEAD_ID –∏ STATUS_ID)
curl -X PATCH "https://yoursubdomain.amocrm.ru/api/v4/leads/LEAD_ID" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"status_id": STATUS_ID}'
```

**STATUS_ID –∏–∑ .env:**
- `AMOCRM_STAGE_LESSON_1` - –¥–ª—è –£—Ä–æ–∫–∞ 1
- `AMOCRM_STAGE_LESSON_2` - –¥–ª—è –£—Ä–æ–∫–∞ 2
- `AMOCRM_STAGE_LESSON_3` - –¥–ª—è –£—Ä–æ–∫–∞ 3

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

### –î–æ —Ç–µ—Å—Ç–∞:
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `zankachidix.ai@gmail.com` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î
- [ ] –•–æ—Ç—è –±—ã –æ–¥–∏–Ω Tripwire —É—Ä–æ–∫ (67, 68, 69) –∑–∞–≤–µ—Ä—à—ë–Ω
- [ ] –ö–æ–Ω—Ç–∞–∫—Ç —Å —ç—Ç–∏–º email —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ amoCRM
- [ ] –°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –∫–æ–Ω—Ç–∞–∫—Ç—É

### –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∞:
- [ ] –§—É–Ω–∫—Ü–∏—è `findLeadIdByEmail()` –Ω–∞—à–ª–∞ —Å–¥–µ–ª–∫—É
- [ ] –§—É–Ω–∫—Ü–∏—è `onLessonCompleted()` –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "‚úÖ –°–¥–µ–ª–∫–∞ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞"
- [ ] –í amoCRM —Å–¥–µ–ª–∫–∞ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —ç—Ç–∞–ø–µ

---

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: "–ö–æ–Ω—Ç–∞–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å email –≤ amoCRM (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ!)
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∫–æ–Ω—Ç–∞–∫—Ç —Å–æ–∑–¥–∞–Ω
3. –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–≥–∏—Å—Ç—Ä (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å)

### –ü—Ä–æ–±–ª–µ–º–∞: "–°–¥–µ–ª–∫–∞ –Ω–µ –≤ –≤–æ—Ä–æ–Ω–∫–µ"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–¥–µ–ª–∫–∞ –≤ –≤–æ—Ä–æ–Ω–∫–µ "onAI Academy"
2. –ü—Ä–æ–≤–µ—Ä—å `AMOCRM_PIPELINE_ID` –≤ `.env`
3. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π —Å–¥–µ–ª–∫—É –≤ –Ω—É–∂–Ω–æ–π –≤–æ—Ä–æ–Ω–∫–µ

### –ü—Ä–æ–±–ª–µ–º–∞: "–¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
npx ts-node
const amoCrm = require('./backend/src/services/amoCrmService');
await amoCrm.testConnection();

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 401:
await amoCrm.manualRefreshToken();
```

---

## üí° –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

1. **–ó–∞–π–¥–∏ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É** –ø–æ–¥ `zankachidix.ai@gmail.com`
2. **–û—Ç–∫—Ä–æ–π –ª—é–±–æ–π Tripwire —É—Ä–æ–∫** (–ú–æ–¥—É–ª—å 16, 17 –∏–ª–∏ 18)
3. **–ù–∞–∂–º–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫"**
4. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:**
   ```bash
   pm2 logs backend --lines 50 | grep AmoCRM
   ```
5. **–û—Ç–∫—Ä–æ–π amoCRM** –∏ –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–¥–µ–ª–∫–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∞—Å—å

**–≠—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!** ‚úÖ

---

**–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å ts-node –∏–ª–∏ node –∫–æ–Ω—Å–æ–ª—å—é, —Å–∫–∞–∂–∏ - –ø–æ–º–æ–≥—É –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å!** üöÄ










