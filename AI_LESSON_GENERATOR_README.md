# ü§ñ AI LESSON GENERATOR - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å–æ–≤–µ—Ç—ã

## üìã –ß–¢–û –≠–¢–û?

–°–∏—Å—Ç–µ–º–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏** –æ–ø–∏—Å–∞–Ω–∏–π –∏ —Å–æ–≤–µ—Ç–æ–≤ –¥–ª—è —É—Ä–æ–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ GPT-4o-mini.

### –ß—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è:

1. **–û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–∞** (3-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
   - –ü–æ–Ω—è—Ç–Ω–æ –¥–ª—è 10-–∫–ª–∞—Å—Å–Ω–∏–∫–∞
   - –ö—Ä–∞—Ç–∫–æ –∏ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–µ
   - –ü–µ—Ä–µ–¥–∞–µ—Ç —Å—É—Ç—å —É—Ä–æ–∫–∞

2. **–°–æ–≤–µ—Ç—ã –ø–æ —É—Ä–æ–∫—É** (3-5 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π)
   - –ö–∞–∫ –ª—É—á—à–µ —É—Å–≤–æ–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª
   - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏
   - –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–µ –≤–∏–¥–µ–æ

---

## üéØ ENDPOINTS

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—Ä–æ–∫–∞

**POST `/api/ai/generate-lesson-ai`**

```json
{
  "videoId": "48e82664-1fe9-4a71-9519-ae89b667ab68",
  "platform": "main",  // "main" –∏–ª–∏ "tripwire"
  "lessonId": 29
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "description": "–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –ø–æ–≥—Ä—É–∑–∏–º—Å—è –≤ –º–∏—Ä –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π...",
    "tips": "–°–æ–≤–µ—Ç 1: –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ —É—Ä–æ–∫ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑\n–°–æ–≤–µ—Ç 2: ...",
    "lessonId": 29,
    "platform": "main",
    "tokens": 450
  }
}
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —É—Ä–æ–∫–æ–≤

**POST `/api/ai/auto-generate-missing`**

–ù–∞–π–¥–µ—Ç –≤—Å–µ —É—Ä–æ–∫–∏:
- –° —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–µ–π ‚úÖ
- –ë–ï–ó –æ–ø–∏—Å–∞–Ω–∏—è ‚ùå

–ò —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–ª—è –Ω–∏—Ö –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å–æ–≤–µ—Ç—ã.

**Response:**
```json
{
  "success": true,
  "message": "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è 5 –∏–∑ 7 —É—Ä–æ–∫–æ–≤",
  "results": [
    { "lessonId": 29, "success": true },
    { "lessonId": 30, "success": true }
  ]
}
```

---

## üóÑÔ∏è –ë–ê–ó–ê –î–ê–ù–ù–´–•

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö:

#### `lessons` (–æ—Å–Ω–æ–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞):
- `ai_description` (TEXT) - AI-–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- `ai_tips` (TEXT) - AI-–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ —Å–æ–≤–µ—Ç—ã

#### `tripwire_lessons` (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç):
- `ai_description` (TEXT)
- `ai_tips` (TEXT)

---

## üß™ –ö–ê–ö –¢–ï–°–¢–ò–†–û–í–ê–¢–¨ –õ–û–ö–ê–õ–¨–ù–û

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω:
```bash
curl http://localhost:3000/api/health
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: {"status":"ok"}
```

### 2. –¢–µ—Å—Ç–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è —É—Ä–æ–∫–∞ 29:
```bash
curl -X POST http://localhost:3000/api/ai/generate-lesson-ai \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "videoId": "48e82664-1fe9-4a71-9519-ae89b667ab68",
    "platform": "main",
    "lessonId": 29
  }'
```

### 3. –ê–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —É—Ä–æ–∫–æ–≤:
```bash
curl -X POST http://localhost:3000/api/ai/auto-generate-missing \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î:
```sql
SELECT 
  id,
  title,
  LENGTH(ai_description) as desc_length,
  LENGTH(ai_tips) as tips_length
FROM lessons
WHERE ai_description IS NOT NULL;
```

---

## üé® FRONTEND –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

### –ì–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:

1. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Ä–æ–∫–∞** (`/courses/:courseId/modules/:moduleId/lessons/:lessonId`)
   - –í–∫–ª–∞–¥–∫–∞ "–û–ø–∏—Å–∞–Ω–∏–µ"
   - –í–∫–ª–∞–¥–∫–∞ "–°–æ–≤–µ—Ç—ã"

2. **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** (`/admin/content`)
   - –°–ø–∏—Å–æ–∫ —É—Ä–æ–∫–æ–≤ —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º AI-–∫–æ–Ω—Ç–µ–Ω—Ç–∞
   - –ö–Ω–æ–ø–∫–∞ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ" (–µ—Å–ª–∏ –ø—É—Å—Ç–æ)

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (TODO):

```typescript
// src/components/admin/AILessonContent.tsx
interface Props {
  lessonId: number;
  videoId: string;
  platform: 'main' | 'tripwire';
  currentDescription?: string;
  currentTips?: string;
}

export function AILessonContent({ lessonId, videoId, platform }: Props) {
  const handleGenerate = async () => {
    const response = await api.post('/api/ai/generate-lesson-ai', {
      videoId,
      platform,
      lessonId
    });
    // Update UI
  };

  return (
    <div>
      <h3>–û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–∞</h3>
      {currentDescription || <Button onClick={handleGenerate}>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI</Button>}
      
      <h3>–°–æ–≤–µ—Ç—ã –ø–æ —É—Ä–æ–∫—É</h3>
      {currentTips || <Button onClick={handleGenerate}>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI</Button>}
    </div>
  );
}
```

---

## ‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### Environment Variables (.env):

```env
OPENAI_API_KEY=sk-proj-...  # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!
```

### –ú–æ–¥–µ–ª—å:
- **GPT-4o-mini** (—ç–∫–æ–Ω–æ–º–∏—á–Ω–∞—è, –±—ã—Å—Ç—Ä–∞—è)
- Temperature: 0.7 (–±–∞–ª–∞–Ω—Å –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏/—Ç–æ—á–Ω–æ—Å—Ç–∏)
- Max tokens: 1000

### –°—Ç–æ–∏–º–æ—Å—Ç—å:
- ~$0.002 –∑–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é (2 –∑–∞–ø—Ä–æ—Å–∞)
- ~$0.20 –∑–∞ 100 —É—Ä–æ–∫–æ–≤

---

## üîÑ –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø

### Trigger –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–∏–¥–µ–æ:

```typescript
// backend/src/routes/streamUpload.ts

// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏:
if (transcriptionStatus === 'completed') {
  // –¢—Ä–∏–≥–≥–µ—Ä–∏–º AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—é
  await fetch('http://localhost:3000/api/ai/generate-lesson-ai', {
    method: 'POST',
    body: JSON.stringify({
      videoId,
      platform: 'main',
      lessonId
    })
  });
}
```

### Cron –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

```bash
# –ö–∞–∂–¥—ã–π —á–∞—Å –ø—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–∫–∏ –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è
0 * * * * curl -X POST http://localhost:3000/api/ai/auto-generate-missing
```

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì

### –õ–æ–≥–∏:
```
[AI Generator] üéØ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —É—Ä–æ–∫–∞ 29 (main)
[AI Generator] ‚úÖ –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ (11311 —Å–∏–º–≤–æ–ª–æ–≤)
[AI Generator] ü§ñ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ GPT-4o-mini...
[AI Generator] ‚úÖ AI —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –∫–æ–Ω—Ç–µ–Ω—Ç
[AI Generator] üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ lessons –¥–ª—è —É—Ä–æ–∫–∞ 29
```

### –ú–µ—Ç—Ä–∏–∫–∏:
- –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ~5-10 —Å–µ–∫
- –¢–æ–∫–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ~300-600
- –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$0.002 –∑–∞ —É—Ä–æ–∫

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

```
[ ] 1. Backend –∑–∞–ø—É—â–µ–Ω (npm run dev)
[ ] 2. OPENAI_API_KEY –∑–∞–≥—Ä—É–∂–µ–Ω
[ ] 3. –ï—Å—Ç—å —É—Ä–æ–∫ —Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–µ–π
[ ] 4. POST /api/ai/generate-lesson-ai ‚Üí 200 OK
[ ] 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î: ai_description –∑–∞–ø–æ–ª–Ω–µ–Ω
[ ] 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î: ai_tips –∑–∞–ø–æ–ª–Ω–µ–Ω
[ ] 7. –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–Ω—è—Ç–Ω–æ –¥–ª—è 10-–∫–ª–∞—Å—Å–Ω–∏–∫–∞
[ ] 8. –°–æ–≤–µ—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–µ
[ ] 9. Frontend –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ
[ ] 10. Frontend –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ–≤–µ—Ç—ã
```

---

## üêõ TROUBLESHOOTING

### –û—à–∏–±–∫–∞ "–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞":
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `video_transcriptions.status = 'completed'`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `transcript_text IS NOT NULL`

### –û—à–∏–±–∫–∞ "OpenAI API":
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `OPENAI_API_KEY` –≤ .env
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å OpenAI

### –û—à–∏–±–∫–∞ "Table tripwire_lessons does not exist":
- –ù–æ—Ä–º–∞–ª—å–Ω–æ! Fallback –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `lessons`

---

**–°–æ–∑–¥–∞–Ω–æ:** 2 –¥–µ–∫–∞–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä:** AI Assistant (Claude Sonnet 4.5)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

