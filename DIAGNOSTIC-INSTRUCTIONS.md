# ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê!

## üéØ **ROOT CAUSE –ù–ê–ô–î–ï–ù–ê –ò –ò–°–ü–†–ê–í–õ–ï–ù–ê**

### –ü—Ä–æ–±–ª–µ–º–∞
**Supabase –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `video_content` –∫–∞–∫ OBJECT, –∞ –Ω–µ ARRAY!**

```javascript
// ‚ùå Backend –æ–∂–∏–¥–∞–ª:
video_content: [{ id: '...', duration_seconds: 1800 }]

// ‚úÖ Supabase –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç (–∏–∑-–∑–∞ UNIQUE constraint):
video_content: { id: '...', duration_seconds: 1800 }
```

**Backend –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–ª:**
```typescript
if (Array.isArray(lesson.video_content)) {
  // –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å! ‚ùå
}
```

### –†–µ—à–µ–Ω–∏–µ
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω `backend/src/routes/lessons.ts`:**
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º `video_content` –∫–∞–∫ object –ò–õ–ò array
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ array –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è
- –í—ã—á–∏—Å–ª—è–µ–º `duration_minutes` –∏–∑ `video_content.duration_seconds`

---

## üìã **–ß–¢–û –ü–†–û–í–ï–†–ò–¢–¨ –°–ï–ô–ß–ê–°**

### 1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å frontend
```cmd
# –í –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞–∂–∞—Ç—å F5 –∏–ª–∏ Ctrl+R
```

### 2. –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥—É–ª—å "–í–≤–µ–¥–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é"
```
http://localhost:8080/course/1/module/2
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
```
–í—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –º–æ–¥—É–ª—è: 30 –º–∏–Ω—É—Ç (3 —É—Ä–æ–∫–∞)
```

**–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
–í—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –º–æ–¥—É–ª—è: 0 –º–∏–Ω—É—Ç
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend

**–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ backend –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
üìö ===== –ó–ê–ü–†–û–° –£–†–û–ö–û–í =====
üìå Module ID: 2
üì¶ –ü–æ–ª—É—á–µ–Ω–æ —É—Ä–æ–∫–æ–≤ –∏–∑ –ë–î: 3

üìò –£—Ä–æ–∫ 1: "–¢–µ—Å—Ç 1" (ID: 39)
   duration_minutes: 0
   video_content: 1 –≤–∏–¥–µ–æ
   üìπ –í–∏–¥–µ–æ 1: { duration_seconds: 1800, filename: 'test.mp4' }
   ‚úÖ –í–´–ß–ò–°–õ–ï–ù–û duration_minutes: 30 –º–∏–Ω—É—Ç (–∏–∑ 1800 —Å–µ–∫—É–Ω–¥)

üìò –£—Ä–æ–∫ 2: "–¢–µ—Å—Ç 2" (ID: 40)
   ‚ö†Ô∏è –£ —É—Ä–æ–∫–∞ –Ω–µ—Ç –≤–∏–¥–µ–æ

üìò –£—Ä–æ–∫ 3: "–¢–µ—Å—Ç 3" (ID: 41)
   ‚ö†Ô∏è –£ —É—Ä–æ–∫–∞ –Ω–µ—Ç –≤–∏–¥–µ–æ

‚è±Ô∏è –ò–¢–û–ì–û: 30 –º–∏–Ω—É—Ç
```

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ frontend

**–í Console –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
‚è±Ô∏è ===== –†–ê–°–ß–ï–¢ –í–†–ï–ú–ï–ù–ò –ú–û–î–£–õ–Ø =====
üì¶ –£—Ä–æ–∫–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ: 3
   1. "–¢–µ—Å—Ç 1": 30 –º–∏–Ω—É—Ç
   2. "–¢–µ—Å—Ç 2": 0 –º–∏–Ω—É—Ç
   3. "–¢–µ—Å—Ç 3": 0 –º–∏–Ω—É—Ç
‚è±Ô∏è –ò–¢–û–ì–û: 30 –º–∏–Ω—É—Ç
```

---

## üéâ **–†–ï–ó–£–õ–¨–¢–ê–¢**

- ‚úÖ Backend –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `video_content`
- ‚úÖ Backend –≤—ã—á–∏—Å–ª—è–µ—Ç `duration_minutes` –∏–∑ –≤–∏–¥–µ–æ
- ‚úÖ Frontend –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- ‚úÖ RLS policies –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î

---

## üìù **–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò**

1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å frontend (F5)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –º–æ–¥—É–ª—è
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend –∏ frontend
4. –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç - –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —É—Ä–æ–∫–æ–≤
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥—Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π

---

## üêõ **–ï–°–õ–ò –ü–†–û–ë–õ–ï–ú–ê –û–°–¢–ê–Å–¢–°–Ø**

–ü—Ä–∏—à–ª–∏ –ú–ù–ï:
1. **–õ–æ–≥–∏ backend** (–∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω backend)
2. **–õ–æ–≥–∏ frontend** (–∏–∑ Console –±—Ä–∞—É–∑–µ—Ä–∞ F12)
3. **–°–∫—Ä–∏–Ω—à–æ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–æ–¥—É–ª—è**

---

## üìö **–ß–¢–û –ë–´–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–û**

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. `backend/src/routes/lessons.ts` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ video_content –∫–∞–∫ object
2. `fix-video-content-rls.sql` - RLS policies (—É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã)
3. `backend/src/config/supabase.ts` - Authorization header (—É–∂–µ –ø—Ä–∏–º–µ–Ω—ë–Ω)

### –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ fix'—ã:
1. ‚úÖ RLS policies –¥–ª—è video_content
2. ‚úÖ UNIQUE constraint –Ω–∞ lesson_id
3. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ video_content –∫–∞–∫ object
4. ‚úÖ –í—ã—á–∏—Å–ª–µ–Ω–∏–µ duration_minutes –∏–∑ duration_seconds

---

**–¢–µ–ø–µ—Ä—å –≤—Å—ë –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å! üöÄ**
