# üìã –ü–û–õ–ù–´–ô –û–¢–ß–Å–¢: –°–∏—Å—Ç–µ–º–∞ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤

**–î–∞—Ç–∞:** 8 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ localhost

---

## üìå –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–±–ª–µ–º](#–∏—Å—Ç–æ—Ä–∏—è-–ø—Ä–æ–±–ª–µ–º)
2. [–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏](#—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ-—Ñ—É–Ω–∫—Ü–∏–∏)
3. [–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã](#–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ-—Ñ–∞–π–ª—ã)
4. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQL)](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö-sql)
5. [Edge Function](#edge-function)
6. [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é](#–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è-–ø–æ-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é)
7. [–§–∞–π–ª—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã](#—Ñ–∞–π–ª—ã-–¥–ª—è-—Ä–∞–±–æ—Ç—ã)

---

## üêõ –ò–°–¢–û–†–ò–Ø –ü–†–û–ë–õ–ï–ú

### **–ü—Ä–æ–±–ª–µ–º–∞ 1: –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login –Ω–µ —Ä–∞–±–æ—Ç–∞–ª**

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–π—Ç–∏ –Ω–∞ `/admin/students-activity` –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–¥–∞–ª –Ω–∞ `/courses` –≤–º–µ—Å—Ç–æ `/login`.

**–ü—Ä–∏—á–∏–Ω–∞:**  
`AdminGuard.tsx` —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–ª –í–°–ï–• –Ω–µ-–∞–¥–º–∏–Ω–æ–≤ (–≤–∫–ª—é—á–∞—è –Ω–µ–∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã—Ö) –Ω–∞ `/courses`.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –†–∞–∑–ª–∏—á–∞–µ–º –¥–≤–∞ —Å–ª—É—á–∞—è:
if (!hasSession) {
  // –ù–µ—Ç —Å–µ—Å—Å–∏–∏ ‚Üí /login
  return <Navigate to="/login" replace />;
}
if (!isAdmin) {
  // –ï—Å—Ç—å —Å–µ—Å—Å–∏—è, –Ω–æ –Ω–µ –∞–¥–º–∏–Ω ‚Üí /courses
  return <Navigate to="/courses" replace />;
}
```

**–§–∞–π–ª:** `src/components/AdminGuard.tsx`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### **–ü—Ä–æ–±–ª–µ–º–∞ 2: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ –∫—Ä–∞—à–∏–ª–æ —Å—Ç—Ä–∞–Ω–∏—Ü—É**

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å" –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ `supabase.auth.admin.deleteUser()` —Å Anon Key, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫—É 403.

**–ü—Ä–∏—á–∏–Ω–∞:**  
Anon Key –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Auth. –¢—Ä–µ–±—É–µ—Ç—Å—è Service Role Key.

**–†–µ—à–µ–Ω–∏–µ:**  
–í–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ Auth ‚Üí –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤ `profiles`:
```typescript
await supabase
  .from('profiles')
  .update({ 
    is_active: false,
    deleted_at: now,
    deactivation_reason: 'manual'
  })
  .eq('id', studentId);
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å Anon Key
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (—é—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞)
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏
- ‚úÖ –ú–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é

**–§–∞–π–ª:** `src/pages/admin/StudentsActivity.tsx`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### **–ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞**

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–°—Ç—É–¥–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –±–µ–∑ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç—ë–∫—à–∏–µ –∞–∫–∫–∞—É–Ω—Ç—ã.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞ —É–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ä–æ–∫: 3/6/12 –º–µ—Å—è—Ü–µ–≤
2. –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
3. –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –µ—Å–ª–∏ –∏—Å—Ç—ë–∫
4. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å < 7 –¥–Ω–µ–π

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞–º–∏ (—Å–º. –Ω–∏–∂–µ)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

---

## ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò

### **1. –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è**

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- ‚ùå –ë–´–õ–û: –ö–Ω–æ–ø–∫–∞ üóëÔ∏è "–£–¥–∞–ª–∏—Ç—å" ‚Üí –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
- ‚úÖ –°–¢–ê–õ–û: –ö–Ω–æ–ø–∫–∞ ‚õî "–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å" ‚Üí –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–ú–µ—Ö–∞–Ω–∏–∑–º:**
```sql
is_active = false
deleted_at = —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞
deactivation_reason = 'manual' | 'expired' | 'violation'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –ú–û–ñ–ï–¢ –≤–æ–π—Ç–∏
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ (–∫—É—Ä—Å—ã, –ø—Ä–æ–≥—Ä–µ—Å—Å, —Å–æ–æ–±—â–µ–Ω–∏—è) –°–û–•–†–ê–ù–ï–ù–´
- –ú–æ–∂–Ω–æ —Ä–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å: `UPDATE profiles SET is_active = true`

---

### **2. –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞**

**–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞:**

–ù–æ–≤–æ–µ –ø–æ–ª–µ –≤ —Ñ–æ—Ä–º–µ:
```
–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ *
‚îú‚îÄ ‚è±Ô∏è 3 –º–µ—Å—è—Ü–∞
‚îú‚îÄ üìÖ 6 –º–µ—Å—è—Ü–µ–≤ (–ø–æ–ª–≥–æ–¥–∞)
‚îî‚îÄ üìÜ 12 –º–µ—Å—è—Ü–µ–≤ (–≥–æ–¥) ‚Üê –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—ã—á–∏—Å–ª—è–µ—Ç `account_expires_at` (–¥–∞—Ç–∞ + X –º–µ—Å—è—Ü–µ–≤)
2. –ü–µ—Ä–µ–¥–∞—ë—Ç –≤ Edge Function `create-student`
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `profiles.account_expires_at`
4. –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å—Ä–æ–∫ 12 –º–µ—Å—è—Ü–µ–≤

---

### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ**

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email/–ø–∞—Ä–æ–ª—å ‚Üí
‚úÖ Auth —É—Å–ø–µ—à–µ–Ω ‚Üí
üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ profiles.is_active = false ‚Üí
‚õî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º"
‚Üí –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
‚Üí –û—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ /login
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ò—Å—Ç—ë–∫—à–∏–π —Å—Ä–æ–∫**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email/–ø–∞—Ä–æ–ª—å ‚Üí
‚úÖ Auth —É—Å–ø–µ—à–µ–Ω ‚Üí
üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ account_expires_at < now() ‚Üí
‚è∞ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∏—Å—Ç—ë–∫"
‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è (is_active=false, reason='expired')
‚Üí –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
‚Üí –û—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ /login
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–∫–æ—Ä–æ –∏—Å—Ç–µ—á—ë—Ç (< 7 –¥–Ω–µ–π)**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email/–ø–∞—Ä–æ–ª—å ‚Üí
‚úÖ Auth —É—Å–ø–µ—à–µ–Ω ‚Üí
üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ account_expires_at - now() < 7 –¥–Ω–µ–π ‚Üí
‚ö†Ô∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–°—Ä–æ–∫ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ X –¥–Ω–µ–π"
‚Üí –í—Ö–æ–¥ —Ä–∞–∑—Ä–µ—à—ë–Ω
```

**–§–∞–π–ª:** `src/pages/Login.tsx`

---

### **4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è**

**SQL —Ñ—É–Ω–∫—Ü–∏—è:**
```sql
CREATE FUNCTION deactivate_expired_accounts()
RETURNS void AS $$
BEGIN
  UPDATE profiles
  SET 
    is_active = false,
    deleted_at = NOW(),
    deactivation_reason = 'expired'
  WHERE 
    account_expires_at < NOW()
    AND is_active = true;
END;
$$;
```

**–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
```sql
-- –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ –ø–æ–ª–Ω–æ—á—å
SELECT cron.schedule(
  'deactivate-expired-accounts',
  '0 0 * * *',
  'SELECT deactivate_expired_accounts()'
);
```

---

## üìÅ –ò–ó–ú–ï–ù–Å–ù–ù–´–ï –§–ê–ô–õ–´

### **–§—Ä–æ–Ω—Ç–µ–Ω–¥ (React/TypeScript)**

| –§–∞–π–ª | –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ |
|------|-------------|
| `src/components/AdminGuard.tsx` | ‚úÖ –†–∞–∑–ª–∏—á–µ–Ω–∏–µ –Ω–µ–∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã—Ö –∏ –Ω–µ-–∞–¥–º–∏–Ω–æ–≤<br>‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login –¥–ª—è –Ω–µ–∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã—Ö |
| `src/pages/admin/StudentsActivity.tsx` | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ "–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è" –≤ —Ñ–æ—Ä–º—É<br>‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è phone –∏ password<br>‚úÖ –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è<br>‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ account_expires_at –≤ Edge Function<br>‚úÖ –ö–Ω–æ–ø–∫–∞ ‚õî –≤–º–µ—Å—Ç–æ üóëÔ∏è |
| `src/pages/Login.tsx` | ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ is_active<br>‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ account_expires_at<br>‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∏—Å—Ç—ë–∫—à–∏—Ö<br>‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Å–∫–æ—Ä–æ–º –∏—Å—Ç–µ—á–µ–Ω–∏–∏<br>‚úÖ –†–∞–∑–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω |

---

### **Edge Function**

**–§–∞–π–ª:** `supabase/functions/create-student/index.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–ü—Ä–∏–Ω–∏–º–∞–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è:**
```typescript
const { 
  email, 
  full_name, 
  phone,                    // ‚Üê –ù–û–í–û–ï
  password,                 // ‚Üê –ù–û–í–û–ï
  role = 'student',
  account_expires_at        // ‚Üê –ù–û–í–û–ï
} = await req.json()
```

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
```typescript
if (!phone) {
  return Response(400, 'Phone is required')
}
if (!password || password.length < 8) {
  return Response(400, 'Password must be at least 8 characters')
}
```

3. **–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å:**
```typescript
// ‚ùå –ë–´–õ–û: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è
const tempPassword = Math.random()...

// ‚úÖ –°–¢–ê–õ–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ —Ñ–æ—Ä–º—ã
password  // –ü–µ—Ä–µ–¥–∞–Ω –∏–∑ —Ñ–æ—Ä–º—ã
```

4. **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è:**
```typescript
// ‚ùå –ë–´–õ–û: –¢–∞–±–ª–∏—Ü–∞ 'users'
.from('users')

// ‚úÖ –°–¢–ê–õ–û: –¢–∞–±–ª–∏—Ü–∞ 'profiles'
.from('profiles')
.insert({
  id: authData.user.id,
  email,
  full_name,
  role,
  is_active: true,
  account_expires_at,  // ‚Üê –ù–û–í–û–ï
  created_at: new Date().toISOString()
})
```

5. **–°–æ–∑–¥–∞–Ω–∏–µ student_profiles:**
```typescript
if (role === 'student') {
  await supabaseAdmin
    .from('student_profiles')
    .insert({
      user_id: authData.user.id,
      full_name,
      phone,  // ‚Üê –ù–û–í–û–ï: —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω
      total_xp: 0,
      streak_days: 0,
      is_active: true
    })
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞, –≥–æ—Ç–æ–≤–∞ –∫ –¥–µ–ø–ª–æ—é

---

## üóÑÔ∏è –ë–ê–ó–ê –î–ê–ù–ù–´–• (SQL)

### **–ú–∏–≥—Ä–∞—Ü–∏—è:** `supabase/migrations/20251108_add_account_expiration.sql`

**–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç:**

1. **–ù–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ `profiles`:**
```sql
ALTER TABLE profiles 
  ADD COLUMN IF NOT EXISTS deleted_at TIMESTAMPTZ,
  ADD COLUMN IF NOT EXISTS account_expires_at TIMESTAMPTZ,
  ADD COLUMN IF NOT EXISTS deactivation_reason TEXT;
```

2. **–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞:**
```sql
CREATE INDEX idx_profiles_account_expires_at ON profiles(account_expires_at);
CREATE INDEX idx_profiles_deleted_at ON profiles(deleted_at);
CREATE INDEX idx_profiles_is_active ON profiles(is_active);
```

3. **–§—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏:**
```sql
CREATE FUNCTION deactivate_expired_accounts()
RETURNS void AS $$
BEGIN
  UPDATE profiles
  SET 
    is_active = false,
    deleted_at = NOW(),
    deactivation_reason = 'expired'
  WHERE 
    account_expires_at < NOW()
    AND is_active = true;
END;
$$;
```

4. **–î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:**
```sql
-- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ä–æ–∫ 12 –º–µ—Å—è—Ü–µ–≤ –æ—Ç –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è
UPDATE profiles
SET account_expires_at = created_at + INTERVAL '12 months'
WHERE role = 'student' 
  AND account_expires_at IS NULL
  AND is_active = true;
```

5. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
```sql
-- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
-- - –í—Å–µ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
-- - –ê–∫—Ç–∏–≤–Ω—ã—Ö
-- - –ò—Å—Ç—ë–∫ —Å—Ä–æ–∫
-- - –ò—Å—Ç–µ–∫–∞–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 7 –¥–Ω–µ–π
```

**–ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å:**
```
1. –û—Ç–∫—Ä–æ–π: https://supabase.com/dashboard/project/arqhkacellqbhjhbebfh/sql/new
2. –°–∫–æ–ø–∏—Ä—É–π –í–ï–°–¨ –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞
3. –ù–∞–∂–º–∏ "Run"
4. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏
```

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ù–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ (–∂–¥—ë—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

---

## üöÄ EDGE FUNCTION

### **–§–∞–π–ª:** `supabase/functions/create-student/index.ts`

**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**
- ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `phone`, `password`, `account_expires_at`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π
- ‚úÖ –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ `profiles` –∏ `student_profiles`
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω –≤ `student_profiles`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å (–Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç)

**–ö–∞–∫ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å:**

**–í–∞—Ä–∏–∞–Ω—Ç 1: CLI**
```bash
cd "/Users/miso/Documents/MVP onAI Academy Platform/onai-integrator-login"
supabase functions deploy create-student --project-ref arqhkacellqbhjhbebfh
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: Dashboard**
```
1. –û—Ç–∫—Ä–æ–π: https://supabase.com/dashboard/project/arqhkacellqbhjhbebfh/functions
2. –ù–∞–π–¥–∏ "create-student" ‚Üí Edit
3. –°–∫–æ–ø–∏—Ä—É–π –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞
4. –í—Å—Ç–∞–≤—å –∏ –Ω–∞–∂–º–∏ "Deploy"
```

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ù–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞ (–∂–¥—ë—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

---

## üß™ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

### **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**

---

### **–®–ê–ì 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é** ‚ö†Ô∏è **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!**

```
–§–∞–π–ª: supabase/migrations/20251108_add_account_expiration.sql
URL: https://supabase.com/dashboard/project/arqhkacellqbhjhbebfh/sql/new

–î–µ–π—Å—Ç–≤–∏—è:
1. –û—Ç–∫—Ä–æ–π SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π –í–ï–°–¨ –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞
3. –ù–∞–∂–º–∏ "Run"
4. –î–æ–∂–¥–∏—Å—å "Success"
5. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤)

–†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏: deleted_at, account_expires_at, deactivation_reason
‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è: deactivate_expired_accounts()
‚úÖ –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å—Ä–æ–∫ 12 –º–µ—Å—è—Ü–µ–≤
```

---

### **–®–ê–ì 2: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

```
URL: https://localhost:8080/admin/students-activity

–î–µ–π—Å—Ç–≤–∏—è:
1. –ù–∞–∂–º–∏ "–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
2. –ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É:
   - Email: test@example.com
   - –ü–æ–ª–Ω–æ–µ –∏–º—è: –¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
   - –¢–µ–ª–µ—Ñ–æ–Ω: +7 777 123 4567
   - –ü–∞—Ä–æ–ª—å: testpassword123
   - –†–æ–ª—å: –°—Ç—É–¥–µ–Ω—Ç
   - –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 3 –º–µ—Å—è—Ü–∞
3. –ù–∞–∂–º–∏ "–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω!"
‚úÖ –ú–æ–¥–∞–ª–∫–∞ —Å email –∏ –ø–∞—Ä–æ–ª–µ–º
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—è–≤–∏–ª—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ

–õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ (F12):
üì§ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {...}
üìÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 3 –º–µ—Å—è—Ü–µ–≤
üìÖ –ò—Å—Ç–µ–∫–∞–µ—Ç: 2025-02-08T...
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω!
```

---

### **–®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Supabase**

```
–§–∞–π–ª: supabase/CHECK_USER_CREATION.sql
URL: https://supabase.com/dashboard/project/arqhkacellqbhjhbebfh/sql/new

–î–µ–π—Å—Ç–≤–∏—è:
1. –û—Ç–∫—Ä–æ–π SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π –í–ï–°–¨ –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞ CHECK_USER_CREATION.sql
3. –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏ –≤ –∫–æ–¥–µ —Å—Ç—Ä–æ–∫—É:
   \set test_email 'test@example.com'
   –ù–∞ —Ä–µ–∞–ª—å–Ω—ã–π email —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –ù–∞–∂–º–∏ "Run"
5. –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º:
‚úÖ Auth.users - email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω, –µ—Å—Ç—å metadata
‚úÖ Profiles - full_name, role, is_active=true, account_expires_at —á–µ—Ä–µ–∑ ~90 –¥–Ω–µ–π
‚úÖ Student_profiles - phone –∑–∞–ø–æ–ª–Ω–µ–Ω, total_xp=0
‚úÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (~90 –¥–Ω–µ–π –¥–ª—è 3 –º–µ—Å—è—Ü–µ–≤)
‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ 6 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω—ã
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
üß™ –ò–¢–û–ì–û–í–ê–Ø –ü–†–û–í–ï–†–ö–ê –°–û–ó–î–ê–ù–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
Email: test@example.com

1Ô∏è‚É£ Auth.users: ‚úÖ –ù–∞–π–¥–µ–Ω
2Ô∏è‚É£ Profiles: ‚úÖ –ù–∞–π–¥–µ–Ω
3Ô∏è‚É£ Student_profiles: ‚úÖ –ù–∞–π–¥–µ–Ω
4Ô∏è‚É£ –¢–µ–ª–µ—Ñ–æ–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω: ‚úÖ –î–∞
5Ô∏è‚É£ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ‚úÖ –î–∞
6Ô∏è‚É£ –ê–∫–∫–∞—É–Ω—Ç –∞–∫—Ç–∏–≤–µ–Ω: ‚úÖ –î–∞

üéâ –í–°–Å –û–¢–õ–ò–ß–ù–û! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ!
```

---

### **–®–ê–ì 4: –¢–µ—Å—Ç –ª–æ–≥–∏–Ω–∞**

```
–î–µ–π—Å—Ç–≤–∏—è:
1. –í—ã–π–¥–∏ –∏–∑ –∞–¥–º–∏–Ω-–∞–∫–∫–∞—É–Ω—Ç–∞ (–∏–ª–∏ –æ—Ç–∫—Ä–æ–π —Ä–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ)
2. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞: https://localhost:8080/login
3. –í–≤–µ–¥–∏:
   Email: test@example.com
   Password: testpassword123
4. –ù–∞–∂–º–∏ "–í–æ–π—Ç–∏"

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!"
‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /courses
‚úÖ –†–æ–ª—å: student (–Ω–µ—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –≤ –º–µ–Ω—é)

–õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ (F12):
‚úÖ –í–•–û–î –£–°–ü–ï–®–ï–ù
üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–∫–∫–∞—É–Ω—Ç–∞...
üìä –ü—Ä–æ—Ñ–∏–ª—å: {is_active: true, account_expires_at: "2025-02-08..."}
‚úÖ –†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞: student
```

---

### **–®–ê–ì 5: –¢–µ—Å—Ç –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏**

```
–î–µ–π—Å—Ç–≤–∏—è:
1. –ó–∞–ª–æ–≥–∏–Ω—å—Å—è –∫–∞–∫ –∞–¥–º–∏–Ω (saint@onaiacademy.kz)
2. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞: https://localhost:8080/admin/students-activity
3. –ù–∞–π–¥–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ‚õî "–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å"
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –≤ alert'–µ

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–°—Ç—É–¥–µ–Ω—Ç –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã."
‚úÖ –°—Ç—É–¥–µ–Ω—Ç –∏—Å—á–µ–∑ –∏–∑ —Å–ø–∏—Å–∫–∞ (—Ñ–∏–ª—å—Ç—Ä "–í—Å–µ" –∏–ª–∏ "–ê–∫—Ç–∏–≤–Ω—ã–µ")
‚úÖ –°—Ç—É–¥–µ–Ω—Ç –≤–∏–¥–µ–Ω –≤ —Ñ–∏–ª—å—Ç—Ä–µ "–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ"

–ü—Ä–æ–≤–µ—Ä—å –≤ Supabase:
SELECT is_active, deleted_at, deactivation_reason 
FROM profiles 
WHERE email = 'test@example.com';

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
is_active: false
deleted_at: 2025-11-08 (—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞)
deactivation_reason: 'manual'
```

---

### **–®–ê–ì 6: –¢–µ—Å—Ç –ª–æ–≥–∏–Ω–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ**

```
–î–µ–π—Å—Ç–≤–∏—è:
1. –ü–æ–ø—Ä–æ–±—É–π –≤–æ–π—Ç–∏ –∫–∞–∫ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
   Email: test@example.com
   Password: testpassword123

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚õî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –±—ã–ª –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."
‚ùå –ù–ï–¢ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ /courses
‚ùå –û—Å—Ç–∞—ë—à—å—Å—è –Ω–∞ /login

–õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ (F12):
‚úÖ –í–•–û–î –£–°–ü–ï–®–ï–ù
üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–∫–∫–∞—É–Ω—Ç–∞...
‚ùå –ê–∫–∫–∞—É–Ω—Ç –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
(–≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã)
```

---

### **–®–ê–ì 7: –¢–µ—Å—Ç –∏—Å—Ç—ë–∫—à–µ–≥–æ —Å—Ä–æ–∫–∞**

```
–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
1. –í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏:

UPDATE profiles 
SET account_expires_at = NOW() - INTERVAL '1 day',
    is_active = true,
    deleted_at = NULL
WHERE email = 'test@example.com';

2. –ü–æ–ø—Ä–æ–±—É–π –≤–æ–π—Ç–∏ –∫–∞–∫ test@example.com

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚è∞ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∏—Å—Ç—ë–∫. –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏—Å—Ç—ë–∫. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è."
‚ùå –ù–ï–¢ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ /courses
‚ùå –û—Å—Ç–∞—ë—à—å—Å—è –Ω–∞ /login
‚úÖ –ê–∫–∫–∞—É–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å –≤ Supabase:
SELECT is_active, deleted_at, deactivation_reason 
FROM profiles 
WHERE email = 'test@example.com';

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
is_active: false
deleted_at: 2025-11-08 (—Ç–æ–ª—å–∫–æ —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
deactivation_reason: 'expired'
```

---

### **–®–ê–ì 8: –¢–µ—Å—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è**

```
–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
1. –í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏:

UPDATE profiles 
SET account_expires_at = NOW() + INTERVAL '5 days',
    is_active = true,
    deleted_at = NULL
WHERE email = 'test@example.com';

2. –ü–æ–ø—Ä–æ–±—É–π –≤–æ–π—Ç–∏ –∫–∞–∫ test@example.com

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚ö†Ô∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–í–Ω–∏–º–∞–Ω–∏–µ! –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 5 –¥–Ω–µ–π. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."
‚úÖ –í—Ö–æ–¥ —Ä–∞–∑—Ä–µ—à—ë–Ω (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /courses)
‚úÖ –ê–∫–∫–∞—É–Ω—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º
```

---

### **–§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö–õ–ò–°–¢:**

- [ ] SQL –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω
- [ ] –î–∞–Ω–Ω—ã–µ –≤ Supabase –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [ ] –õ–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –õ–æ–≥–∏–Ω –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- [ ] –ò—Å—Ç—ë–∫—à–∏–π —Å—Ä–æ–∫ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è + –∞–≤—Ç–æ–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
- [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Å–∫–æ—Ä–æ–º –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üìÑ –§–ê–ô–õ–´ –î–õ–Ø –†–ê–ë–û–¢–´

### **SQL –§–∞–π–ª—ã:**

1. **`supabase/migrations/20251108_add_account_expiration.sql`**
   - –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ü–ï–†–í–´–ú
   - URL: https://supabase.com/dashboard/project/arqhkacellqbhjhbebfh/sql/new

2. **`supabase/CHECK_USER_CREATION.sql`**
   - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ü–û–°–õ–ï —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ó–∞–º–µ–Ω–∏ `test_email` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π!

---

### **Edge Function:**

3. **`supabase/functions/create-student/index.ts`**
   - –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è Edge Function
   - –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å —á–µ—Ä–µ–∑ CLI –∏–ª–∏ Dashboard
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç phone, password, account_expires_at

---

### **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**

4. **`DEPLOYMENT_PLAN_ACCOUNT_EXPIRATION.md`**
   - –ü–ª–∞–Ω –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
   - –ß–∏—Ç–∞—Ç—å –ü–û–°–õ–ï —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

5. **`EDGE_FUNCTION_DEPLOY_INSTRUCTIONS.md`**
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é Edge Function
   - 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞: CLI –∏ Dashboard

6. **`LOCALHOST_TEST_CHECKLIST.md`**
   - –î–µ—Ç–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - 9 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### **–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞:**
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π **–°–û–•–†–ê–ù–ï–ù–´**
- –ú–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å: `UPDATE profiles SET is_active = true WHERE id = '...'`

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ü–∞—Ä–æ–ª–∏ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Supabase Auth
- Edge Function –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Service Role Key

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –°–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–∏ –≤ sessionStorage
- –û–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã

---

## üêõ –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### **–ü—Ä–æ–±–ª–µ–º–∞: "Failed to load resource: 400" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏**

**–ü—Ä–∏—á–∏–Ω–∞:** Edge Function –Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞ –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å (F12) ‚Üí Network
2. –ù–∞–π–¥–∏ –∑–∞–ø—Ä–æ—Å –∫ `create-student`
3. –ü–æ—Å–º–æ—Ç—Ä–∏ Response
4. –ï—Å–ª–∏ "Function not found" ‚Üí –∑–∞–¥–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏—é
5. –ï—Å–ª–∏ –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ ‚Üí –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ –ª–æ–≥

---

### **–ü—Ä–æ–±–ª–µ–º–∞: –¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è**

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–∞–±–ª–∏—Ü–∞ `student_profiles` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ `phone`

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã:
SELECT * FROM information_schema.tables WHERE table_name = 'student_profiles';

-- –ü—Ä–æ–≤–µ—Ä—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
SELECT * FROM information_schema.columns WHERE table_name = 'student_profiles';

-- –ï—Å–ª–∏ –Ω–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ phone:
ALTER TABLE student_profiles ADD COLUMN IF NOT EXISTS phone TEXT;
```

---

### **–ü—Ä–æ–±–ª–µ–º–∞: –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è NULL**

**–ü—Ä–∏—á–∏–Ω–∞:** SQL –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏:
SELECT * FROM information_schema.columns 
WHERE table_name='profiles' AND column_name='account_expires_at';

-- –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 20251108_add_account_expiration.sql
```

---

### **–ü—Ä–æ–±–ª–µ–º–∞: "Policy error" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏**

**–ü—Ä–∏—á–∏–Ω–∞:** RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–æ–∑–¥–∞–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å –ø–æ–ª–∏—Ç–∏–∫–∏:
SELECT * FROM pg_policies WHERE tablename = 'profiles';

-- –£–±–µ–¥–∏—Å—å —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è 20251108_CLEAN_AND_FIX_RLS.sql –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
```

---

## üéØ –ß–¢–û –î–ê–õ–¨–®–ï

### **–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –Ω–∞ localhost:**

1. ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
2. ‚úÖ –î–∞–Ω–Ω—ã–µ –≤ Supabase –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
3. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### **–î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**

```bash
# 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω Supabase
# 2. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å Edge Function
supabase functions deploy create-student --project-ref arqhkacellqbhjhbebfh

# 3. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add -A
git commit -m "feat: —Å–∏—Å—Ç–µ–º–∞ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤"
git push origin main

# 4. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Digital Ocean
./deploy.sh
```

### **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**

```sql
-- –í—ã–ø–æ–ª–Ω–∏ –≤ Supabase SQL Editor:
SELECT cron.schedule(
  'deactivate-expired-accounts',
  '0 0 * * *', -- –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ –ø–æ–ª–Ω–æ—á—å
  'SELECT deactivate_expired_accounts()'
);
```

---

## üìä –ò–¢–û–ì–ò

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è)
- ‚úÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ (3/6/12 –º–µ—Å—è—Ü–µ–≤)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ (–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ/–∏—Å—Ç—ë–∫—à–∏–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è)
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Å–∫–æ—Ä–æ–º –∏—Å—Ç–µ—á–µ–Ω–∏–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∏—Å—Ç—ë–∫—à–∏—Ö
- ‚úÖ –†–∞–∑–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω
- ‚úÖ SQL –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ò–∑–º–µ–Ω–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 6  
**–°–æ–∑–¥–∞–Ω–æ SQL –º–∏–≥—Ä–∞—Ü–∏–π:** 1  
**–°–æ–∑–¥–∞–Ω–æ SQL –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:** 1  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ Edge Functions:** 1  

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ localhost

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 8 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è:** –ü–µ—Ä–µ–¥–∞–π –¥—Ä—É–≥–æ–º—É –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

---

## üÜò –ö–û–ù–¢–ê–ö–¢–´ –î–õ–Ø –ü–û–ú–û–©–ò

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:
1. –°–∫–æ–ø–∏—Ä—É–π –ª–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ (F12)
2. –°–¥–µ–ª–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç –æ—à–∏–±–∫–∏
3. –û—Ç–ø—Ä–∞–≤—å –º–Ω–µ
4. –û–ø–∏—à–∏ —á—Ç–æ –¥–µ–ª–∞–ª –¥–æ —ç—Ç–æ–≥–æ

**–£–¥–∞—á–∏ —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º!** üöÄ

