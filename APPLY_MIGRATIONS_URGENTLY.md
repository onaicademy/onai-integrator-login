# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ú–ò–ì–†–ê–¶–ò–ò –î–õ–Ø PRODUCTION

## ‚ùå **–ü–†–û–ë–õ–ï–ú–´ –ù–ê PRODUCTION:**

1. **–¢–∞–±–ª–∏—Ü–∞ `scheduled_notifications` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** ‚Üí 406 –æ—à–∏–±–∫–∏
2. **View `leads_with_journey` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** ‚Üí 404 –æ—à–∏–±–∫–∏  
3. **RPC —Ñ—É–Ω–∫—Ü–∏—è `find_or_create_unified_lead()` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** ‚Üí Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ—Ç deduplication

---

## ‚úÖ **–†–ï–®–ï–ù–ò–ï: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é**

### **–®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard**

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ **Landing Supabase**:
https://supabase.com/dashboard/project/xikaiavwqinamgolmtcy

---

### **–®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor**

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –Ω–∞–∂–º–∏—Ç–µ **SQL Editor**
2. –ù–∞–∂–º–∏—Ç–µ **New Query**

---

### **–®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏**

#### **3.1 –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É `scheduled_notifications`** (–ö–†–ò–¢–ò–ß–ù–û!)

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞:
```
supabase/migrations/20250114_create_scheduled_notifications.sql
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
‚úÖ Table scheduled_notifications created
‚úÖ 2 indexes created
‚úÖ 1 trigger created
‚úÖ 1 RLS policy created
```

---

#### **3.2 –°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É journey tracking** (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞:
```
supabase/migrations/20250114_create_lead_journey.sql
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç:
- –¢–∞–±–ª–∏—Ü—É `lead_journey` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç—Ç–∞–ø–æ–≤
- View `leads_with_journey` –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- RPC —Ñ—É–Ω–∫—Ü–∏—é `find_or_create_unified_lead()` –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- Trigger –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
‚úÖ Table lead_journey created
‚úÖ View leads_with_journey created
‚úÖ Function find_or_create_unified_lead() created
‚úÖ Trigger for phone normalization created
```

---

## üìä **–ü–û–°–õ–ï –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø –ú–ò–ì–†–ê–¶–ò–ô:**

### **–ß—Ç–æ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. ‚úÖ **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ 406**
2. ‚úÖ **–°—Ç–∞—Ç—É—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
3. ‚úÖ **Journey stages –±—É–¥—É—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å—Å—è**
4. ‚úÖ **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ª–∏–¥–æ–≤ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å**
5. ‚úÖ **Manual AmoCRM export –ø–æ–ª—É—á–∏—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

---

## ‚ö†Ô∏è **–í–ê–ñ–ù–û: Environment Variables**

**–ù–ï –ó–ê–ë–£–î–¨–¢–ï** —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel!

–ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://vercel.com/onais-projects-6a1beeec/backend/settings/environment-variables

–î–æ–±–∞–≤—å—Ç–µ –º–∏–Ω–∏–º—É–º:
```
AMOCRM_DOMAIN=onaiagencykz
AMOCRM_ACCESS_TOKEN=<—Ç–æ–∫–µ–Ω –∏–∑ backend/env.env>
LANDING_SUPABASE_URL=https://xikaiavwqinamgolmtcy.supabase.co
LANDING_SUPABASE_SERVICE_KEY=<–∫–ª—é—á –∏–∑ backend/env.env>
MOBIZON_API_KEY=<–∫–ª—é—á –∏–∑ backend/env.env>
RESEND_API_KEY=<–∫–ª—é—á –∏–∑ backend/env.env>
```

–ó–∞—Ç–µ–º **Redeploy** backend!

---

## üéØ **–ü–†–ò–û–†–ò–¢–ï–¢:**

1. **–°–†–û–ß–ù–û:** –î–æ–±–∞–≤–∏—Ç—å env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Vercel + redeploy
2. **–°–†–û–ß–ù–û:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é `scheduled_notifications`
3. **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é `lead_journey`

---

## ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:**

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –∏ redeploy:

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ ProfTest
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend (–¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —É—Å–ø–µ—à–Ω—ã–µ AmoCRM sync)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–æ—à–∏–±–∫–∏ 406 –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ AmoCRM (–ª–∏–¥ –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)

---

**–ì–æ—Ç–æ–≤–æ! –ü–æ—Å–ª–µ —ç—Ç–∏—Ö —à–∞–≥–æ–≤ –í–°–Å –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ!** üöÄ
